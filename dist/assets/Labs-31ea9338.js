import{j as e}from"./ui-cacc1eea.js";import{r as s}from"./vendor-696af5bd.js";import{aj as t,a$ as a,B as r,r as l,w as i,S as n,m as c,n as d,o as m,p as o,a1 as x,D as h,f as j,g as p,h as u,i as g,L as N,I as f,T as b,x as v,aF as y,F as _,b8 as w,K as F,s as C,J as D,M as k,Z as E,a0 as S,$ as O,b as L,U as $,Q as P,ae as B,at as U,C as I,j as M,k as G,l as T,ag as V,a5 as z,ah as A,v as q}from"./index-3a8dc84c.js";import{D as J,a as Q,b as K,c as R,d as H}from"./dropdown-menu-0651433f.js";import{T as X,a as Z,b as W,c as Y}from"./tabs-952e3ebd.js";import{C as ee,a as se,b as te}from"./collapsible-d3d2b240.js";import{u as ae}from"./labStore-8f239aba.js";import{u as re}from"./labOrderStore-b969024d.js";import{g as le,a as ie}from"./cardStyles-c77ef46a.js";import{u as ne,T as ce}from"./useTimeFilteredStats-1c30c8be.js";import{n as de,X as me}from"./notificationService-09cb27cc.js";import{E as oe}from"./exportService-1536567b.js";import{T as xe,a as he,b as je,c as pe,d as ue,e as ge}from"./table-20957d0a.js";import{B as Ne}from"./building-2-acc8549f.js";import{M as fe}from"./map-pin-a7696fe0.js";import{P as be}from"./pen-square-6c634feb.js";import{T as ve,D as ye}from"./upload-4df8a268.js";import{C as _e,a as we}from"./chevrons-right-9b995d31.js";import{C as Fe}from"./chevron-left-343e35ff.js";import{P as Ce}from"./phone-a8e6eab2.js";import{C as De}from"./calculator-63fcb348.js";import{F as ke}from"./file-text-861b9f90.js";import{P as Ee}from"./plus-1eab3b5b.js";import{F as Se}from"./filter-f006659c.js";import"./pdf-991f41f6.js";import"./utils-ec524415.js";import"./charts-b4389b44.js";import"./index-a46c293c.js";import"./excel-37615a09.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=t("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);function Le({labs:t,onEdit:h,onDelete:j,searchQuery:p}){const{isLoading:u}=ae(),{getOrdersByLab:g}=re(),[N,f]=s.useState(1),[b,v]=s.useState(10),y=t.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.contact_info&&e.contact_info.toLowerCase().includes(p.toLowerCase())||e.address&&e.address.toLowerCase().includes(p.toLowerCase())),_=y.length,w=Math.ceil(_/b),F=(N-1)*b,C=y.slice(F,F+b),D=e=>{f(e)};return u?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل المختبرات..."})]})}):0===y.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:p?"لا توجد نتائج":"لا توجد مختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:p?`لم يتم العثور على مختبرات تطابق "${p}"`:"لم يتم إضافة أي مختبرات بعد"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(xe,{className:"table-center-all",children:[e.jsx(he,{children:e.jsxs(je,{children:[e.jsx(pe,{className:"text-center",children:"#"}),e.jsx(pe,{className:"text-center",children:"اسم المختبر"}),e.jsx(pe,{className:"text-center",children:"معلومات الاتصال"}),e.jsx(pe,{className:"text-center",children:"العنوان"}),e.jsx(pe,{className:"text-center",children:"عدد الطلبات"}),e.jsx(pe,{className:"text-center",children:"تاريخ الإضافة"}),e.jsx(pe,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),e.jsx(ue,{children:C.map((s,t)=>{return e.jsxs(je,{className:"hover:bg-muted/50",children:[e.jsx(ge,{className:"font-medium text-center",children:F+t+1}),e.jsx(ge,{className:"font-medium text-center table-cell-wrap-truncate-md",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[s.name,e.jsx(Ne,{className:"h-4 w-4 text-blue-600"})]})}),e.jsx(ge,{className:"text-center table-cell-wrap-truncate-sm",children:s.contact_info?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("button",{onClick:async()=>{const e=`https://api.whatsapp.com/send/?phone=${s.contact_info?.replace(/[^\d]/g,"")||""}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(t){console.log("Method 1 failed:",t)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(t){console.log("Method 2 failed:",t)}window.open(e,"_blank","noopener,noreferrer")},className:"text-sm text-green-600 hover:text-green-700 hover:underline transition-colors cursor-pointer flex items-center gap-1",children:[s.contact_info,e.jsx(a,{className:"h-3 w-3"})]})}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),e.jsx(ge,{className:"text-center",children:s.address?e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"text-sm",children:s.address}),e.jsx(fe,{className:"h-4 w-4 text-orange-600"})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),e.jsx(ge,{className:"text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs(r,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[(n=s.id,g(n).length),e.jsx(Oe,{className:"h-3 w-3"})]})})}),e.jsx(ge,{className:"text-sm text-muted-foreground text-center",children:l(s.created_at)}),e.jsx(ge,{className:"min-w-[140px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>(e=>{h(e)})(s),children:[e.jsx(be,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(i,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>(e=>{const s=g(e.id);s.length>0?de.warning(`لا يمكن حذف المختبر "${e.name}" لأنه يحتوي على ${s.length} طلب`):j(e)})(s),children:[e.jsx(ve,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},s.id);var n})})]}),w>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(n,{value:`${b}`,onValueChange:e=>{v(parseInt(e)),f(1)},children:[e.jsx(c,{className:"h-8 w-[70px]",children:e.jsx(d,{placeholder:b})}),e.jsx(m,{side:"top",children:[5,10,20,30,50].map(s=>e.jsx(o,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",N," من ",w]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(i,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>D(1),disabled:1===N,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(_e,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>D(N-1),disabled:1===N,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(x,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>D(N+1),disabled:N===w,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(Fe,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>D(w),disabled:N===w,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(we,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",F+1," إلى ",Math.min(F+b,_)," من ",_," نتيجة"]})]})]})}function $e({open:t,onOpenChange:a,editingLab:r}){const{createLab:l,updateLab:n,isLoading:c}=ae(),[d,m]=s.useState({name:"",contact_info:"",address:""}),[o,x]=s.useState({});s.useEffect(()=>{t&&(m(r?{name:r.name||"",contact_info:r.contact_info||"",address:r.address||""}:{name:"",contact_info:"",address:""}),x({}))},[t,r]);const _=(e,s)=>{m(t=>({...t,[e]:s})),o[e]&&x(s=>({...s,[e]:""}))};return e.jsx(h,{open:t,onOpenChange:a,children:e.jsxs(j,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(p,{className:"text-right",dir:"rtl",children:[e.jsxs(u,{className:"flex items-center gap-2 justify-end text-right",children:[e.jsx("span",{children:r?"تعديل المختبر":"إضافة مختبر جديد"}),e.jsx(Ne,{className:"h-5 w-5 text-blue-600"})]}),e.jsx(g,{className:"text-right",children:r?"قم بتعديل معلومات المختبر أدناه":"أدخل معلومات المختبر الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(console.log("🔍 [DEBUG] AddLabDialog.handleSubmit() called"),e.preventDefault(),console.log("📝 [DEBUG] Form data before validation:",d),(()=>{const e={};return d.name.trim()?d.name.trim().length<2&&(e.name="اسم المختبر يجب أن يكون على الأقل حرفين"):e.name="اسم المختبر مطلوب",d.contact_info&&d.contact_info.trim().length<5&&(e.contact_info="معلومات الاتصال يجب أن تكون على الأقل 5 أحرف"),d.address&&d.address.trim().length<5&&(e.address="العنوان يجب أن يكون على الأقل 5 أحرف"),x(e),0===Object.keys(e).length})()){console.log("✅ [DEBUG] Form validation passed");try{const e={name:d.name.trim(),contact_info:d.contact_info.trim()||void 0,address:d.address.trim()||void 0};console.log("📤 [DEBUG] Prepared lab data for submission:",e),r?(console.log("🔄 [DEBUG] Updating existing lab with ID:",r.id),await n(r.id,e),de.success("تم تحديث المختبر بنجاح")):(console.log("➕ [DEBUG] Creating new lab"),await l(e),console.log("✅ [DEBUG] Lab created successfully"),de.success("تم إضافة المختبر بنجاح")),console.log("🚪 [DEBUG] Closing dialog"),a(!1)}catch(s){console.error("❌ [DEBUG] Error in AddLabDialog.handleSubmit:",s),console.error("❌ [DEBUG] Error stack:",s.stack),de.error(r?"فشل في تحديث المختبر":"فشل في إضافة المختبر")}}else console.log("❌ [DEBUG] Form validation failed")},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"اسم المختبر *"})]}),e.jsx(f,{id:"name",value:d.name,onChange:e=>_("name",e.target.value),placeholder:"أدخل اسم المختبر",className:"text-right "+(o.name?"border-destructive":""),disabled:c,dir:"rtl"}),o.name&&e.jsx("p",{className:"text-sm text-destructive text-right",children:o.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"contact_info",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ce,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"معلومات الاتصال"})]}),e.jsx(f,{id:"contact_info",value:d.contact_info,onChange:e=>_("contact_info",e.target.value),placeholder:"رقم الهاتف أو البريد الإلكتروني",className:"text-right "+(o.contact_info?"border-destructive":""),disabled:c,dir:"rtl"}),o.contact_info&&e.jsx("p",{className:"text-sm text-destructive text-right",children:o.contact_info})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"address",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(fe,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"العنوان"})]}),e.jsx(b,{id:"address",value:d.address,onChange:e=>_("address",e.target.value),placeholder:"عنوان المختبر",className:"text-right "+(o.address?"border-destructive":""),disabled:c,rows:3,dir:"rtl"}),o.address&&e.jsx("p",{className:"text-sm text-destructive text-right",children:o.address})]}),e.jsxs(v,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[e.jsx(i,{type:"submit",disabled:c,className:"min-w-[100px]",children:c?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 ml-2 animate-spin"}),r?"جاري التحديث...":"جاري الإضافة..."]}):r?"تحديث":"إضافة"}),e.jsx(i,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:c,children:"إلغاء"})]})]})]})})}function Pe({open:s,onOpenChange:t,lab:a}){const{deleteLab:l,isLoading:n}=ae(),{getOrdersByLab:c}=re();if(!a)return null;const d=c(a.id),m=d.length>0;return e.jsx(h,{open:s,onOpenChange:t,children:e.jsxs(j,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(u,{className:"flex items-center gap-2 text-destructive text-right",children:[e.jsx(_,{className:"h-5 w-5"}),"تأكيد حذف المختبر"]}),e.jsx(g,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف المختبر نهائياً من النظام."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"اسم المختبر:"}),e.jsx("span",{children:a.name})]}),a.contact_info&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"معلومات الاتصال:"}),e.jsx("span",{className:"text-sm",children:a.contact_info})]}),a.address&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"العنوان:"}),e.jsx("span",{className:"text-sm",children:a.address})]})]}),m&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive mb-2",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"تحذير مهم"})]}),e.jsx("p",{className:"text-sm text-destructive mb-3",children:"هذا المختبر يحتوي على طلبات مرتبطة به. حذف المختبر سيؤدي إلى حذف جميع الطلبات المرتبطة به أيضاً."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"text-sm font-medium",children:"عدد الطلبات المرتبطة:"}),e.jsxs(r,{variant:"destructive",className:"text-xs",children:[d.length," طلب"]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف هذا المختبر؟"}),m&&e.jsxs("span",{className:"block mt-1",children:["سيتم حذف جميع الطلبات المرتبطة بهذا المختبر (",d.length," طلب)."]})]})})]}),e.jsxs(v,{className:"gap-2",dir:"rtl",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:n,children:"إلغاء"}),e.jsx(i,{type:"button",variant:"destructive",onClick:async()=>{try{await l(a.id),de.success(`تم حذف المختبر "${a.name}" بنجاح`),t(!1)}catch(e){console.error("Error deleting lab:",e),de.error("فشل في حذف المختبر")}},disabled:n,className:"min-w-[100px]",children:n?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function Be({labOrders:t,onEdit:a,onDelete:h,onView:j}){const{isLoading:p}=re(),{labs:u}=ae(),[g,N]=s.useState(1),[f,b]=s.useState(10),v=(e,s)=>{if(s?.name)return s.name;const t=u.find(s=>s.id===e);return t?t.name:`مختبر غير محدد (${e.substring(0,8)}...)`},y=s=>{switch(s){case"آجل":return e.jsxs(r,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"آجل"]});case"مكتمل":return e.jsxs(r,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"مكتمل"]});case"ملغي":return e.jsxs(r,{variant:"destructive",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"ملغي"]});default:return e.jsx(r,{variant:"outline",children:s})}},_=(s,t=0)=>{const a=s-t,l=s>0?Math.round(t/s*100):0;return a<=0?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(r,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مدفوع بالكامل"}),e.jsx("span",{className:"text-xs text-green-600",children:"100%"})]}):t>0?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(r,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"مدفوع جزئياً"}),e.jsxs("span",{className:"text-xs text-yellow-600",children:[l,"%"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(r,{variant:"secondary",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"غير مدفوع"}),e.jsx("span",{className:"text-xs text-red-600",children:"0%"})]})},w=t.length,L=Math.ceil(w/f),$=(g-1)*f,P=t.slice($,$+f),B=e=>{N(e)};return p?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل طلبات المختبرات..."})]})}):0===t.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Oe,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد طلبات مختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم إضافة أي طلبات مختبرات بعد"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(xe,{className:"table-center-all",children:[e.jsx(he,{children:e.jsxs(je,{children:[e.jsx(pe,{className:"text-center w-[60px]",children:"رقم"}),e.jsx(pe,{className:"text-center",children:"اسم المختبر"}),e.jsx(pe,{className:"text-center",children:"اسم الخدمة"}),e.jsx(pe,{className:"text-center",children:"التكلفة"}),e.jsx(pe,{className:"text-center",children:"المدفوع"}),e.jsx(pe,{className:"text-center",children:"تاريخ الطلب"}),e.jsx(pe,{className:"text-center",children:"الحالة"}),e.jsx(pe,{className:"text-center",children:"حالة الدفع"}),e.jsx(pe,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),e.jsx(ue,{children:P.map((s,t)=>e.jsxs(je,{className:"hover:bg-muted/50",children:[e.jsx(ge,{className:"font-medium text-center",children:$+t+1}),e.jsx(ge,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("span",{className:"font-medium",children:v(s.lab_id,s.lab)}),v(s.lab_id,s.lab).includes("مختبر غير محدد")&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"المختبر قد يكون محذوفاً"})]}),e.jsx(Ne,{className:"h-4 w-4 text-blue-600"})]})}),e.jsx(ge,{className:"text-center",children:e.jsx("span",{children:s.service_name})}),e.jsx(ge,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"font-semibold",children:F(s.cost)}),e.jsx(C,{className:"h-4 w-4 text-green-600"})]})}),e.jsxs(ge,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:F(s.paid_amount||0)}),e.jsx(D,{className:"h-4 w-4 text-blue-600"})]}),s.remaining_balance&&s.remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["متبقي: ",F(s.remaining_balance)]})]}),e.jsx(ge,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"text-sm",children:l(s.order_date)}),e.jsx(k,{className:"h-4 w-4 text-gray-600"})]})}),e.jsx(ge,{className:"text-center",children:y(s.status)}),e.jsx(ge,{className:"text-center",children:_(s.cost,s.paid_amount)}),e.jsx(ge,{className:"min-w-[180px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[j&&e.jsxs(i,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:()=>j(s),children:[e.jsx(E,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض"})]}),e.jsxs(i,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>a(s),children:[e.jsx(be,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(i,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>h(s),children:[e.jsx(ve,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},s.id))})]}),L>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(n,{value:`${f}`,onValueChange:e=>{b(parseInt(e)),N(1)},children:[e.jsx(c,{className:"h-8 w-[70px]",children:e.jsx(d,{placeholder:f})}),e.jsx(m,{side:"top",children:[5,10,20,30,50].map(s=>e.jsx(o,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",g," من ",L]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(i,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>B(1),disabled:1===g,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(_e,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>B(g-1),disabled:1===g,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(x,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>B(g+1),disabled:g===L,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(Fe,{className:"h-4 w-4"})]}),e.jsxs(i,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>B(L),disabled:g===L,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(we,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",$+1," إلى ",Math.min($+f,w)," من ",w," نتيجة"]})]})]})}function Ue({open:t,onOpenChange:a,editingOrder:r}){const{labs:l}=ae(),{patients:x}=L(),{createLabOrder:_,updateLabOrder:E,isLoading:S}=re(),[O,P]=s.useState({lab_id:"",patient_id:"",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:"",expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"",priority:"1",lab_instructions:"",material_type:"",color_shade:""}),[B,U]=s.useState({});s.useEffect(()=>{if(t){if(r)P({lab_id:r.lab_id||"",patient_id:r.patient_id||"none",appointment_id:r.appointment_id||"",tooth_treatment_id:r.tooth_treatment_id||"",tooth_number:r.tooth_number?.toString()||"",service_name:r.service_name||"",cost:r.cost?.toString()||"",order_date:r.order_date||"",expected_delivery_date:r.expected_delivery_date||"",actual_delivery_date:r.actual_delivery_date||"",status:r.status||"معلق",notes:r.notes||"",paid_amount:r.paid_amount?.toString()||"0",priority:r.priority?.toString()||"1",lab_instructions:r.lab_instructions||"",material_type:r.material_type||"",color_shade:r.color_shade||""});else{const e=(new Date).toISOString().split("T")[0];P({lab_id:"",patient_id:"none",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:e,expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"0",priority:"1",lab_instructions:"",material_type:"",color_shade:""})}U({})}},[t,r]);const I=(e,s)=>{P(t=>({...t,[e]:s})),B[e]&&U(s=>({...s,[e]:""}))};return e.jsx(h,{open:t,onOpenChange:a,children:e.jsxs(j,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(p,{className:"text-right",dir:"rtl",children:[e.jsxs(u,{className:"flex items-center gap-2 justify-end text-right",children:[e.jsx("span",{children:r?"تعديل طلب المختبر":"إضافة طلب مختبر جديد"}),e.jsx(w,{className:"h-5 w-5 text-purple-600"})]}),e.jsx(g,{className:"text-right",children:r?"قم بتعديل معلومات طلب المختبر أدناه":"أدخل معلومات طلب المختبر الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(O.lab_id||(e.lab_id="يجب اختيار المختبر"),O.service_name.trim()?O.service_name.trim().length<2&&(e.service_name="اسم الخدمة يجب أن يكون على الأقل حرفين"):e.service_name="اسم الخدمة/التحليل مطلوب",O.cost.trim()){const s=parseFloat(O.cost);(isNaN(s)||s<=0)&&(e.cost="التكلفة يجب أن تكون رقم موجب")}else e.cost="التكلفة مطلوبة";if(O.order_date||(e.order_date="تاريخ الطلب مطلوب"),O.paid_amount.trim()){const s=parseFloat(O.paid_amount),t=parseFloat(O.cost);isNaN(s)||s<0?e.paid_amount="المبلغ المدفوع يجب أن يكون رقم غير سالب":!isNaN(t)&&s>t&&(e.paid_amount="المبلغ المدفوع لا يمكن أن يكون أكبر من التكلفة الإجمالية")}return U(e),0===Object.keys(e).length})())try{const e=parseFloat(O.cost),s=parseFloat(O.paid_amount)||0,t=e-s,l={lab_id:O.lab_id,patient_id:"none"===O.patient_id?void 0:O.patient_id||void 0,appointment_id:O.appointment_id||void 0,tooth_treatment_id:O.tooth_treatment_id||void 0,tooth_number:O.tooth_number?parseInt(O.tooth_number):void 0,service_name:O.service_name.trim(),cost:e,order_date:O.order_date,expected_delivery_date:O.expected_delivery_date||void 0,actual_delivery_date:O.actual_delivery_date||void 0,status:O.status,notes:O.notes.trim()||void 0,paid_amount:s,remaining_balance:t,priority:parseInt(O.priority)||1,lab_instructions:O.lab_instructions.trim()||void 0,material_type:O.material_type.trim()||void 0,color_shade:O.color_shade.trim()||void 0};if(console.log("🔍 [DEBUG] Submitting lab order data:",l),!l.lab_id)throw new Error("Lab ID is required");if(!l.service_name||0===l.service_name.trim().length)throw new Error("Service name is required");if(!l.cost||l.cost<=0)throw new Error("Valid cost is required");if(!l.order_date)throw new Error("Order date is required");r?(await E(r.id,l),de.success("تم تحديث طلب المختبر بنجاح")):(await _(l),de.success("تم إضافة طلب المختبر بنجاح")),a(!1)}catch(s){console.error("Error saving lab order:",s);let e="Unknown error occurred",t={};s instanceof Error?(e=s.message||"Unknown error occurred",t={message:s.message,stack:s.stack,name:s.name,cause:s.cause}):"string"==typeof s?(e=s,t={message:s,type:"string"}):"object"==typeof s&&null!==s?(e=s.message||JSON.stringify(s)||"Object error occurred",t={message:s.message,stack:s.stack,name:s.name,type:typeof s,keys:Object.keys(s),stringified:JSON.stringify(s)}):(e="Unknown error type: "+typeof s,t={type:typeof s,value:s}),console.error("Error details:",t),console.error("Full error object:",s),console.error("Error constructor:",s?.constructor?.name),console.error("Error prototype:",Object.getPrototypeOf(s)),de.error(`${r?"فشل في تحديث طلب المختبر":"فشل في إضافة طلب المختبر"}: ${e}`)}},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"lab_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"المختبر *"})]}),e.jsxs(n,{value:O.lab_id,onValueChange:e=>I("lab_id",e),disabled:S,dir:"rtl",children:[e.jsx(c,{className:"text-right bg-background border-input text-foreground "+(B.lab_id?"border-destructive":""),children:e.jsx(d,{placeholder:"اختر المختبر",className:"text-muted-foreground"})}),e.jsx(m,{children:l.map(s=>e.jsx(o,{value:s.id,children:s.name},s.id))})]}),B.lab_id&&e.jsx("p",{className:"text-sm text-destructive text-right",children:B.lab_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"patient_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx($,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"المريض (اختياري)"})]}),e.jsxs(n,{value:O.patient_id,onValueChange:e=>I("patient_id",e),disabled:S,dir:"rtl",children:[e.jsx(c,{className:"text-right bg-background border-input text-foreground",children:e.jsx(d,{placeholder:"اختر المريض (اختياري)",className:"text-muted-foreground"})}),e.jsxs(m,{children:[e.jsx(o,{value:"none",children:"بدون مريض محدد"}),x.map(s=>e.jsx(o,{value:s.id,children:s.full_name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"service_name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(w,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"اسم الخدمة *"})]}),e.jsx(f,{id:"service_name",value:O.service_name,onChange:e=>I("service_name",e.target.value),placeholder:"مثال: تحليل دم شامل، أشعة بانوراما، إلخ",className:"text-right "+(B.service_name?"border-destructive":""),disabled:S,dir:"rtl"}),B.service_name&&e.jsx("p",{className:"text-sm text-destructive text-right",children:B.service_name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"cost",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"التكلفة *"})]}),e.jsx(f,{id:"cost",type:"number",step:"0.1",min:"0",value:O.cost,onChange:e=>I("cost",e.target.value),onBlur:e=>{const s=parseFloat(e.target.value)||0;I("cost",s.toString())},placeholder:"0.00",className:"text-right "+(B.cost?"border-destructive":""),disabled:S,dir:"rtl"}),B.cost&&e.jsx("p",{className:"text-sm text-destructive text-right",children:B.cost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"paid_amount",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"المبلغ المدفوع"})]}),e.jsx(f,{id:"paid_amount",type:"number",step:"0.1",min:"0",value:O.paid_amount,onChange:e=>I("paid_amount",e.target.value),onBlur:e=>{const s=parseFloat(e.target.value)||0;I("paid_amount",s.toString())},placeholder:"0.00",className:"text-right "+(B.paid_amount?"border-destructive":""),disabled:S,dir:"rtl"}),B.paid_amount&&e.jsx("p",{className:"text-sm text-destructive text-right",children:B.paid_amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(De,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"المبلغ المتبقي"})]}),e.jsx("div",{className:"h-10 px-3 py-2 border rounded-md bg-muted flex items-center justify-end",children:e.jsx("span",{className:"text-sm font-medium",children:F((parseFloat(O.cost)||0)-(parseFloat(O.paid_amount)||0))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"order_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(k,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"تاريخ الطلب *"})]}),e.jsx(f,{id:"order_date",type:"date",value:O.order_date,onChange:e=>I("order_date",e.target.value),className:"text-right "+(B.order_date?"border-destructive":""),disabled:S,dir:"rtl"}),B.order_date&&e.jsx("p",{className:"text-sm text-destructive text-right",children:B.order_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"status",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(w,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"الحالة *"})]}),e.jsxs(n,{value:O.status,onValueChange:e=>I("status",e),disabled:S,dir:"rtl",children:[e.jsx(c,{className:"text-right bg-background border-input text-foreground",children:e.jsx(d,{className:"text-muted-foreground"})}),e.jsxs(m,{children:[e.jsx(o,{value:"معلق",children:"معلق"}),e.jsx(o,{value:"مكتمل",children:"مكتمل"}),e.jsx(o,{value:"ملغي",children:"ملغي"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"expected_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(k,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"تاريخ التسليم المتوقع"})]}),e.jsx(f,{id:"expected_delivery_date",type:"date",value:O.expected_delivery_date,onChange:e=>I("expected_delivery_date",e.target.value),className:"text-right",disabled:S,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"actual_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(k,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"تاريخ التسليم الفعلي"})]}),e.jsx(f,{id:"actual_delivery_date",type:"date",value:O.actual_delivery_date,onChange:e=>I("actual_delivery_date",e.target.value),className:"text-right",disabled:S,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"priority",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(De,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{children:"الأولوية"})]}),e.jsxs(n,{value:O.priority,onValueChange:e=>I("priority",e),disabled:S,dir:"rtl",children:[e.jsx(c,{className:"text-right bg-background border-input text-foreground",children:e.jsx(d,{className:"text-muted-foreground"})}),e.jsxs(m,{children:[e.jsx(o,{value:"1",children:"عالية (1)"}),e.jsx(o,{value:"2",children:"متوسطة (2)"}),e.jsx(o,{value:"3",children:"منخفضة (3)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"material_type",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ne,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"نوع المادة"})]}),e.jsx(f,{id:"material_type",value:O.material_type,onChange:e=>I("material_type",e.target.value),placeholder:"مثال: زيركونيا، بورسلين، أكريل",className:"text-right",disabled:S,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"color_shade",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(w,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"درجة اللون"})]}),e.jsx(f,{id:"color_shade",value:O.color_shade,onChange:e=>I("color_shade",e.target.value),placeholder:"مثال: A1، B2، C3",className:"text-right",disabled:S,dir:"rtl"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"lab_instructions",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(ke,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{children:"تعليمات للمختبر"})]}),e.jsx(b,{id:"lab_instructions",value:O.lab_instructions,onChange:e=>I("lab_instructions",e.target.value),placeholder:"تعليمات خاصة للمختبر...",className:"text-right min-h-[80px] resize-none",disabled:S,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"notes",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:"ملاحظات"})]}),e.jsx(b,{id:"notes",value:O.notes,onChange:e=>I("notes",e.target.value),placeholder:"أي ملاحظات إضافية حول الطلب...",disabled:S,rows:3,className:"text-right",dir:"rtl"})]}),e.jsxs(v,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[e.jsx(i,{type:"submit",disabled:S,className:"min-w-[100px]",children:S?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 ml-2 animate-spin"}),r?"جاري التحديث...":"جاري الإضافة..."]}):r?"تحديث":"إضافة"}),e.jsx(i,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:S,children:"إلغاء"})]})]})]})})}function Ie({open:s,onOpenChange:t,labOrder:a}){const{deleteLabOrder:n,isLoading:c}=re();if(!a)return null;return e.jsx(h,{open:s,onOpenChange:t,children:e.jsxs(j,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(u,{className:"flex items-center gap-2 text-destructive text-right",children:[e.jsx(_,{className:"h-5 w-5"}),"تأكيد حذف طلب المختبر"]}),e.jsx(g,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف طلب المختبر نهائياً من النظام."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"المختبر:"}),e.jsx("span",{children:a.lab?.name||"غير محدد"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-semibold",children:"اسم الخدمة:"}),e.jsx("span",{children:a.service_name})]}),a.patient&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-semibold",children:"المريض:"}),e.jsx("span",{children:a.patient.full_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-semibold",children:"التكلفة:"}),e.jsx("span",{className:"font-bold",children:F(a.cost)})]}),a.paid_amount&&a.paid_amount>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"المبلغ المدفوع:"}),e.jsx("span",{className:"font-bold",children:F(a.paid_amount)})]}),a.remaining_balance&&a.remaining_balance>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"المبلغ المتبقي:"}),e.jsx("span",{className:"font-bold text-red-600",children:F(a.remaining_balance)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"تاريخ الطلب:"}),e.jsx("span",{children:l(a.order_date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"الحالة:"}),(s=>{switch(s){case"آجل":return e.jsx(r,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"آجل"});case"مكتمل":return e.jsx(r,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مكتمل"});case"ملغي":return e.jsx(r,{variant:"destructive",children:"ملغي"});default:return e.jsx(r,{variant:"outline",children:s})}})(a.status)]}),a.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-semibold",children:"الملاحظات:"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-background p-2 rounded border",children:a.notes})]})]}),a.paid_amount&&a.paid_amount>0&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 dark:text-yellow-200 mb-2",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"تحذير"})]}),e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["هذا الطلب يحتوي على مدفوعات بقيمة ",F(a.paid_amount),". حذف الطلب لن يؤثر على سجلات المدفوعات الأخرى في النظام."]})]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف طلب المختبر هذا؟"}),e.jsx("span",{className:"block mt-1",children:"سيتم حذف جميع المعلومات المرتبطة بهذا الطلب نهائياً."})]})})]}),e.jsxs(v,{className:"gap-2",dir:"rtl",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:c,children:"إلغاء"}),e.jsx(i,{type:"button",variant:"destructive",onClick:async()=>{try{await n(a.id),de.success("تم حذف طلب المختبر بنجاح"),t(!1)}catch(e){console.error("Error deleting lab order:",e),de.error("فشل في حذف طلب المختبر")}},disabled:c,className:"min-w-[100px]",children:c?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function Me(){const{labs:t,loadLabs:a,isLoading:r}=ae(),{labOrders:x,filteredLabOrders:h,totalOrders:j,totalCost:p,totalPaid:u,totalRemaining:g,pendingOrders:N,completedOrders:b,cancelledOrders:v,loadLabOrders:y,setSearchQuery:D,setStatusFilter:k,setLabFilter:E,setDateRangeFilter:$,clearFilters:me,isLoading:xe}=re(),{patients:he,loadPatients:je}=L(),{settings:pe}=P(),ue=ne({data:x,dateField:"order_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[ge,fe]=s.useState(""),[be,ve]=s.useState("all"),[_e,we]=s.useState("all"),[Fe,Ce]=s.useState({start:"",end:""}),[De,Oe]=s.useState(!1),[Me,Ge]=s.useState(!1),[Te,Ve]=s.useState(!1),[ze,Ae]=s.useState(!1),[qe,Je]=s.useState(!1),[Qe,Ke]=s.useState(null),[Re,He]=s.useState(null),[Xe,Ze]=s.useState(null),[We,Ye]=s.useState(null),[es,ss]=s.useState("orders");B(),s.useEffect(()=>{(async()=>{try{await a(),await y(),await je()}catch(e){console.error("Error loading data:",e)}})()},[a,y,je]),s.useEffect(()=>{"orders"===es&&D(ge)},[ge,es,D]),s.useEffect(()=>{k(be)},[be,k]),s.useEffect(()=>{E(_e)},[_e,E]),s.useEffect(()=>{$(Fe)},[Fe,$]);return e.jsxs("div",{className:"space-y-6 p-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"إدارة المختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة المختبرات وطلبات التحاليل والفحوصات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:async()=>{try{await Promise.all([a(),y(),je()]),de.success("تم تحديث البيانات بنجاح")}catch(e){de.error("فشل في تحديث البيانات")}},disabled:r||xe,children:[e.jsx(U,{className:"w-4 h-4 mr-2 "+(r||xe?"animate-spin":"")}),"تحديث"]}),e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"تصدير"]})}),e.jsxs(K,{align:"end",className:"w-48",children:[e.jsxs(R,{onClick:async()=>{try{let e="";if("orders"===es){e=["رقم الطلب","اسم المختبر","اسم الخدمة/التحليل","اسم المريض","التكلفة","المبلغ المدفوع","المبلغ المتبقي","تاريخ الطلب","الحالة","الملاحظات"].join(",")+"\n",h.forEach((s,t)=>{const a=[t+1,`"${s.lab?.name||"غير محدد"}"`,`"${s.service_name}"`,`"${s.patient?.full_name||"غير محدد"}"`,s.cost,s.paid_amount||0,s.remaining_balance||0,l(s.order_date),`"${s.status}"`,`"${s.notes||""}"`];e+=a.join(",")+"\n"})}else{e=["اسم المختبر","معلومات الاتصال","العنوان","عدد الطلبات","تاريخ الإضافة"].join(",")+"\n",t.forEach(s=>{const t=x.filter(e=>e.lab_id===s.id).length,a=[`"${s.name}"`,`"${s.contact_info||""}"`,`"${s.address||""}"`,t,l(s.created_at)];e+=a.join(",")+"\n"})}"orders"===es?await oe.exportLabsToExcel(t,h):await oe.exportLabsToExcel(t,x),de.success("تم تصدير البيانات بنجاح إلى ملف Excel مع التنسيق الجميل")}catch(e){console.error("Export error:",e),de.error("فشل في تصدير البيانات")}},className:"arabic-enhanced",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"تصدير Excel"]}),e.jsx(H,{}),e.jsxs(R,{onClick:async()=>{try{if("orders"===es){if(0===h.length)return void de.info("لا توجد طلبات مختبرات لتصديرها بصيغة PDF.");const e=pe?.clinic_name||"عيادة الأسنان الحديثة";await oe.exportLabsToPDF(t,h,e),de.success(`تم تصدير ${h.length} طلب مختبر بنجاح إلى ملف PDF مع التنسيق الجميل!`)}else de.info("تصدير PDF للمختبرات (القائمة) سيُضاف قريباً.")}catch(e){console.error("Export PDF error:",e),de.error("فشل في تصدير البيانات إلى PDF")}},className:"arabic-enhanced",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"تصدير PDF"]})]})]})]})]}),e.jsx(ce,{value:ue.timeFilter,onChange:ue.handleFilterChange,onClear:ue.resetFilter,title:"فلترة زمنية - طلبات المختبرات",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",dir:"rtl",children:[e.jsxs(I,{className:le("blue"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"إجمالي الطلبات":"الطلبات المفلترة"}),e.jsx(w,{className:`h-4 w-4 ${ie("blue")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?x.length:ue.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"طلبات إجمالية":"طلبات في الفترة المحددة"}),ue.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(ue.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(ue.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(I,{className:le("green"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"إجمالي التكلفة":"التكلفة المفلترة"}),e.jsx(C,{className:`h-4 w-4 ${ie("green")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:F("all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?p:ue.filteredData.reduce((e,s)=>e+(s.cost||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"تكلفة جميع الطلبات":"تكلفة الطلبات في الفترة المحددة"}),ue.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(ue.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(ue.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(I,{className:le("purple"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"إجمالي الدفعات":"الدفعات المفلترة"}),e.jsx(S,{className:`h-4 w-4 ${ie("purple")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:F("all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?u:ue.filteredData.reduce((e,s)=>e+(s.paid_amount||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"جميع الدفعات المسجلة":"دفعات في الفترة المحددة"})]})]}),e.jsxs(I,{className:le("orange"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"الدفعات المتبقية":"المتبقية المفلترة"}),e.jsx(_,{className:`h-4 w-4 ${ie("orange")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:F("all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?g:ue.filteredData.reduce((e,s)=>e+(s.remaining_balance||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?x.filter(e=>(e.remaining_balance||0)>0).length:ue.filteredData.filter(e=>(e.remaining_balance||0)>0).length} طلب غير مكتمل الدفع`})]})]}),e.jsxs(I,{className:le("yellow"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"طلبات آجلة":"طلبات آجلة مفلترة"}),e.jsx(O,{className:`h-4 w-4 ${ie("yellow")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?N:ue.filteredData.filter(e=>"آجل"===e.status).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"في انتظار الإنجاز":"آجلة في الفترة المحددة"})]})]}),e.jsxs(I,{className:le("emerald"),children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"طلبات مكتملة":"طلبات مكتملة مفلترة"}),e.jsx(S,{className:`h-4 w-4 ${ie("emerald")}`})]}),e.jsxs(T,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?b:ue.filteredData.filter(e=>"مكتمل"===e.status).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===ue.timeFilter.preset||!ue.timeFilter.startDate&&!ue.timeFilter.endDate?"تم إنجازها بنجاح":"مكتملة في الفترة المحددة"})]})]})]}),e.jsxs(X,{value:es,onValueChange:ss,className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs(Z,{className:"grid w-fit grid-cols-2",children:[e.jsxs(W,{value:"orders",className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"طلبات المختبرات"]}),e.jsxs(W,{value:"labs",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"إدارة المختبرات"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["orders"===es&&e.jsxs(i,{onClick:()=>{Ze(null),Ve(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"طلب جديد"]}),"labs"===es&&e.jsxs(i,{onClick:()=>{Ke(null),Ge(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"مختبر جديد"]})]})]}),e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(f,{placeholder:"orders"===es?"البحث في طلبات المختبرات...":"البحث في المختبرات...",value:ge,onChange:e=>fe(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),"orders"===es&&e.jsx(ee,{open:De,onOpenChange:Oe,children:e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"تصفية",e.jsx(z,{className:"w-4 h-4 ml-2 transition-transform "+(De?"rotate-180":"")})]})})}),(be||_e||Fe.start||Fe.end)&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{fe(""),ve("all"),we("all"),Ce({start:"",end:""}),me()},children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"مسح التصفية"]})]}),"orders"===es&&e.jsx(ee,{open:De,onOpenChange:Oe,children:e.jsx(te,{className:"space-y-4",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),e.jsxs(n,{value:be,onValueChange:ve,dir:"rtl",children:[e.jsx(c,{className:"text-right",children:e.jsx(d,{placeholder:"جميع الحالات"})}),e.jsxs(m,{children:[e.jsx(o,{value:"all",children:"جميع الحالات"}),e.jsx(o,{value:"آجل",children:"آجل"}),e.jsx(o,{value:"مكتمل",children:"مكتمل"}),e.jsx(o,{value:"ملغي",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"المختبر"}),e.jsxs(n,{value:_e,onValueChange:we,dir:"rtl",children:[e.jsx(c,{className:"text-right",children:e.jsx(d,{placeholder:"جميع المختبرات"})}),e.jsxs(m,{children:[e.jsx(o,{value:"all",children:"جميع المختبرات"}),t.map(s=>e.jsx(o,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"من تاريخ"}),e.jsx(f,{type:"date",value:Fe.start,onChange:e=>Ce(s=>({...s,start:e.target.value})),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"إلى تاريخ"}),e.jsx(f,{type:"date",value:Fe.end,onChange:e=>Ce(s=>({...s,end:e.target.value})),className:"text-right",dir:"rtl"})]})]})})})]}),e.jsx(Y,{value:"orders",className:"space-y-4",dir:"rtl",children:e.jsxs(I,{children:[e.jsxs(M,{dir:"rtl",children:[e.jsxs(G,{className:"flex items-center gap-2 text-right",children:[e.jsx(w,{className:"w-5 h-5"}),"طلبات المختبرات"]}),e.jsx(q,{className:"text-right",children:"إدارة جميع طلبات التحاليل والفحوصات المرسلة للمختبرات"})]}),e.jsx(T,{children:e.jsx(Be,{labOrders:h,onEdit:e=>{Ze(e),Ve(!0)},onDelete:e=>{Ye(e),Je(!0)}})})]})}),e.jsx(Y,{value:"labs",className:"space-y-4",dir:"rtl",children:e.jsxs(I,{children:[e.jsxs(M,{dir:"rtl",children:[e.jsxs(G,{className:"flex items-center gap-2 text-right",children:[e.jsx(Ne,{className:"w-5 h-5"}),"إدارة المختبرات"]}),e.jsx(q,{className:"text-right",children:"إدارة معلومات المختبرات المتعاونة"})]}),e.jsx(T,{children:e.jsx(Le,{labs:t,onEdit:e=>{Ke(e),Ge(!0)},onDelete:e=>{He(e),Ae(!0)},searchQuery:ge})})]})})]}),e.jsx($e,{open:Me,onOpenChange:()=>{Ge(!1),Ke(null)},editingLab:Qe}),e.jsx(Pe,{open:ze,onOpenChange:()=>{Ae(!1),He(null)},lab:Re}),e.jsx(Ue,{open:Te,onOpenChange:()=>{Ve(!1),Ze(null)},editingOrder:Xe}),e.jsx(Ie,{open:qe,onOpenChange:()=>{Je(!1),Ye(null)},labOrder:We})]})}export{Me as default};
