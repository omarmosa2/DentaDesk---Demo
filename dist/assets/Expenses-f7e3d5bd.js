import{j as e}from"./ui-cacc1eea.js";import{r as s,c as a}from"./vendor-696af5bd.js";import{aj as r,e as t,u as n,D as l,f as c,g as i,h as d,R as m,i as x,L as o,I as h,s as u,S as p,m as j,n as g,o as v,p as N,T as f,M as y,x as b,w as _,aF as w,B as C,r as k,Z as S,a1 as F,$ as E,J as D,aZ as M,Q as O,F as q,C as A,l as P,ag as T,ah as z,y as V,z as $,E as L,G as I,H as B,N as H,P as Q,O as Z}from"./index-3a8dc84c.js";import{C as G,a as J,b as K}from"./collapsible-d3d2b240.js";import{u as R}from"./expensesStore-f3f1428b.js";import{C as U}from"./currency-display-e01ebf49.js";import{n as W}from"./notificationService-09cb27cc.js";import{E as X}from"./exportService-1536567b.js";import{D as Y,a as ee,b as se,c as ae,d as re}from"./dropdown-menu-0651433f.js";import{C as te}from"./checkbox-8b9b9c35.js";import{T as ne,a as le,b as ce,c as ie,d as de,e as me}from"./table-20957d0a.js";import{P as xe}from"./pen-square-6c634feb.js";import{T as oe,D as he}from"./upload-4df8a268.js";import{M as ue}from"./more-horizontal-5517ce56.js";import{C as pe,a as je}from"./chevrons-right-9b995d31.js";import{C as ge}from"./chevron-left-343e35ff.js";import{b as ve,A as Ne,a as fe}from"./arrow-up-832b5917.js";import{F as ye}from"./file-text-861b9f90.js";import{P as be}from"./plus-1eab3b5b.js";import{F as _e}from"./filter-f006659c.js";import"./pdf-991f41f6.js";import"./utils-ec524415.js";import"./charts-b4389b44.js";import"./excel-37615a09.js";import"./index-a46c293c.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=r("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Ce=({open:a,onOpenChange:r,editingExpense:C})=>{const{createExpense:k,updateExpense:S,isLoading:F,categories:E,vendors:D}=R(),{currentCurrency:M,formatAmount:O,getCurrencySymbol:q}=t(),{toast:A}=n(),[P,T]=s.useState({expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:"",due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),[z,V]=s.useState({}),$=e=>e.replace(/,/g,"");s.useEffect(()=>{T(C?{expense_name:C.expense_name||"",amount:C.amount?.toString()||"",expense_type:C.expense_type||"",category:C.category||"",description:C.description||"",payment_method:C.payment_method||"",payment_date:C.payment_date?.split("T")[0]||"",due_date:C.due_date?.split("T")[0]||"",is_recurring:C.is_recurring||!1,recurring_frequency:C.recurring_frequency||"",recurring_end_date:C.recurring_end_date?.split("T")[0]||"",status:C.status||"pending",receipt_number:C.receipt_number||"",vendor:C.vendor||"",notes:C.notes||""}:{expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:(new Date).toISOString().split("T")[0],due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),V({})},[C,a]);const L=(e,s)=>{T(a=>({...a,[e]:s})),z[e]&&V(s=>({...s,[e]:""}))},I=e=>{const s=(e=>{if(!e)return"";const s=e.replace(/,/g,"");if(isNaN(Number(s)))return e;const a=s.split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join(".")})(e);L("amount",s)};return e.jsx(l,{open:a,onOpenChange:r,children:e.jsxs(c,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-primary"}),C?"تعديل المصروف":"إضافة مصروف جديد"]}),e.jsx(x,{children:C?"تعديل بيانات المصروف":"إضافة مصروف جديد للعيادة"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return P.expense_name.trim()||(e.expense_name="اسم المصروف مطلوب"),(!P.amount||parseFloat($(P.amount))<=0)&&(e.amount="المبلغ مطلوب ويجب أن يكون أكبر من صفر"),P.expense_type||(e.expense_type="نوع المصروف مطلوب"),P.payment_method||(e.payment_method="طريقة الدفع مطلوبة"),P.payment_date||(e.payment_date="تاريخ الدفع مطلوب"),P.is_recurring&&!P.recurring_frequency&&(e.recurring_frequency="تكرار المصروف مطلوب للمصروفات المتكررة"),V(e),0===Object.keys(e).length})())try{const e={...P,amount:parseFloat($(P.amount)),payment_date:new Date(P.payment_date).toISOString(),due_date:P.due_date?new Date(P.due_date).toISOString():void 0,recurring_end_date:P.recurring_end_date?new Date(P.recurring_end_date).toISOString():void 0};C?(await S(C.id,e),A({title:"تم التحديث بنجاح",description:"تم تحديث المصروف بنجاح"})):(await k(e),A({title:"تم الإضافة بنجاح",description:"تم إضافة المصروف بنجاح"})),r(!1)}catch(s){A({title:"خطأ",description:C?"فشل في تحديث المصروف":"فشل في إضافة المصروف",variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"expense_name",children:"اسم المصروف *"}),e.jsx(h,{id:"expense_name",value:P.expense_name,onChange:e=>L("expense_name",e.target.value),placeholder:"مثال: راتب السكرتيرة",className:z.expense_name?"border-destructive":""}),z.expense_name&&e.jsx("p",{className:"text-sm text-destructive",children:z.expense_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"amount",children:["المبلغ (",q(),") *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{id:"amount",type:"text",value:P.amount,onChange:e=>I(e.target.value),onBlur:e=>{const s=parseFloat($(e.target.value))||0;L("amount",s.toString())},placeholder:"0.00",className:"pl-10 "+(z.amount?"border-destructive":"")})]}),z.amount&&e.jsx("p",{className:"text-sm text-destructive",children:z.amount})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"expense_type",children:"نوع المصروف *"}),e.jsxs(p,{value:P.expense_type,onValueChange:e=>L("expense_type",e),children:[e.jsx(j,{className:z.expense_type?"border-destructive":"",children:e.jsx(g,{placeholder:"اختر نوع المصروف"})}),e.jsx(v,{children:[{value:"salary",label:"راتب"},{value:"utilities",label:"مرافق (كهرباء، مياه، غاز)"},{value:"rent",label:"إيجار"},{value:"maintenance",label:"صيانة"},{value:"supplies",label:"مستلزمات"},{value:"insurance",label:"تأمين"},{value:"other",label:"أخرى"}].map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]}),z.expense_type&&e.jsx("p",{className:"text-sm text-destructive",children:z.expense_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"category",children:"الفئة"}),e.jsx(h,{id:"category",value:P.category,onChange:e=>L("category",e.target.value),placeholder:"مثال: مصروفات إدارية",list:"categories"}),e.jsx("datalist",{id:"categories",children:E.map(s=>e.jsx("option",{value:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"الوصف"}),e.jsx(f,{id:"description",value:P.description,onChange:e=>L("description",e.target.value),placeholder:"وصف تفصيلي للمصروف",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"payment_method",children:"طريقة الدفع *"}),e.jsxs(p,{value:P.payment_method,onValueChange:e=>L("payment_method",e),children:[e.jsx(j,{className:z.payment_method?"border-destructive":"",children:e.jsx(g,{placeholder:"اختر طريقة الدفع"})}),e.jsx(v,{children:[{value:"cash",label:"نقدي"},{value:"bank_transfer",label:"تحويل بنكي"},{value:"check",label:"شيك"},{value:"credit_card",label:"بطاقة ائتمان"}].map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]}),z.payment_method&&e.jsx("p",{className:"text-sm text-destructive",children:z.payment_method})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"الحالة"}),e.jsxs(p,{value:P.status,onValueChange:e=>L("status",e),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"اختر الحالة"})}),e.jsx(v,{children:[{value:"pending",label:"آجل"},{value:"paid",label:"مدفوع"},{value:"overdue",label:"متأخر"},{value:"cancelled",label:"ملغي"}].map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"payment_date",children:"تاريخ الدفع *"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{id:"payment_date",type:"date",value:P.payment_date,onChange:e=>L("payment_date",e.target.value),className:"pl-10 "+(z.payment_date?"border-destructive":"")})]}),z.payment_date&&e.jsx("p",{className:"text-sm text-destructive",children:z.payment_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"due_date",children:"تاريخ الاستحقاق"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{id:"due_date",type:"date",value:P.due_date,onChange:e=>L("due_date",e.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"is_recurring",checked:P.is_recurring,onCheckedChange:e=>L("is_recurring",e)}),e.jsx(o,{htmlFor:"is_recurring",children:"مصروف متكرر"})]}),P.is_recurring&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"recurring_frequency",children:"تكرار المصروف *"}),e.jsxs(p,{value:P.recurring_frequency,onValueChange:e=>L("recurring_frequency",e),children:[e.jsx(j,{className:z.recurring_frequency?"border-destructive":"",children:e.jsx(g,{placeholder:"اختر التكرار"})}),e.jsx(v,{children:[{value:"daily",label:"يومي"},{value:"weekly",label:"أسبوعي"},{value:"monthly",label:"شهري"},{value:"quarterly",label:"ربع سنوي"},{value:"yearly",label:"سنوي"}].map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]}),z.recurring_frequency&&e.jsx("p",{className:"text-sm text-destructive",children:z.recurring_frequency})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"recurring_end_date",children:"تاريخ انتهاء التكرار"}),e.jsx(h,{id:"recurring_end_date",type:"date",value:P.recurring_end_date,onChange:e=>L("recurring_end_date",e.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"receipt_number",children:"رقم الإيصال"}),e.jsx(h,{id:"receipt_number",value:P.receipt_number,onChange:e=>L("receipt_number",e.target.value),placeholder:"رقم الإيصال أو الفاتورة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"vendor",children:"المورد/الجهة"}),e.jsx(h,{id:"vendor",value:P.vendor,onChange:e=>L("vendor",e.target.value),placeholder:"اسم المورد أو الجهة",list:"vendors"}),e.jsx("datalist",{id:"vendors",children:D.map(s=>e.jsx("option",{value:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"notes",children:"ملاحظات"}),e.jsx(f,{id:"notes",value:P.notes,onChange:e=>L("notes",e.target.value),placeholder:"ملاحظات إضافية",rows:3})]}),e.jsxs(b,{className:"gap-2",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:F,children:"إلغاء"}),e.jsxs(_,{type:"submit",disabled:F,children:[F&&e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),C?"تحديث":"إضافة"]})]})]})]})})};function ke({expenses:a,isLoading:r,onEdit:n,onDelete:l,onViewDetails:c,onMarkAsPaid:i}){const[d,x]=s.useState(null),[o,h]=s.useState(null),[f,b]=s.useState(1),[w,E]=s.useState(10);t();const D=s.useMemo(()=>{let e=a;d&&o&&(e=[...a].sort((e,s)=>{let a=e[d],r=s[d];return null==a&&null==r?0:null==a?"asc"===o?1:-1:null==r?"asc"===o?-1:1:(a=String(a).toLowerCase(),r=String(r).toLowerCase(),a<r?"asc"===o?-1:1:a>r?"asc"===o?1:-1:0)}));const s=(f-1)*w,r=s+w;return{expenses:e.slice(s,r),totalPages:Math.ceil(e.length/w),totalCount:e.length}},[a,d,o,f,w]),M=s=>d!==s?e.jsx(ve,{className:"w-4 h-4 opacity-50"}):"asc"===o?e.jsx(Ne,{className:"w-4 h-4"}):"desc"===o?e.jsx(fe,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4 opacity-50"}),O=({field:s,children:a})=>e.jsx(ie,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{d===e?"asc"===o?h("desc"):"desc"===o?(x(null),h(null)):h("asc"):(x(e),h("asc"))})(s),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsx("span",{children:a}),M(s)]})}),q=e=>{switch(e){case"paid":return"default";case"pending":return"secondary";case"overdue":return"destructive";default:return"outline"}};if(r)return e.jsx("div",{className:"border rounded-lg",children:e.jsxs(ne,{className:"table-center-all",children:[e.jsx(le,{children:e.jsxs(ce,{children:[e.jsx(ie,{className:"text-center",children:"#"}),e.jsx(ie,{className:"text-center",children:"اسم المصروف"}),e.jsx(ie,{className:"text-center",children:"المبلغ"}),e.jsx(ie,{className:"text-center",children:"النوع"}),e.jsx(ie,{className:"text-center",children:"تاريخ الدفع"}),e.jsx(ie,{className:"text-center",children:"الحالة"}),e.jsx(ie,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(de,{children:[...Array(5)].map((s,a)=>e.jsx(ce,{children:[...Array(7)].map((s,a)=>e.jsx(me,{children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},a))},a))})]})});if(0===a.length)return e.jsx("div",{className:"border rounded-lg",children:e.jsxs(ne,{className:"table-center-all",children:[e.jsx(le,{children:e.jsxs(ce,{children:[e.jsx(ie,{className:"text-center w-12 max-w-12 min-w-12",children:e.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),e.jsx(O,{field:"expense_name",children:"اسم المصروف"}),e.jsx(O,{field:"amount",children:"المبلغ"}),e.jsx(O,{field:"expense_type",children:"النوع"}),e.jsx(O,{field:"payment_date",children:"تاريخ الدفع"}),e.jsx(O,{field:"status",children:"الحالة"}),e.jsx(ie,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(de,{children:e.jsx(ce,{children:e.jsx(me,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(m,{className:"w-12 h-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد مصروفات"})]})})})})]})});const{expenses:A,totalPages:P,totalCount:T}=D,z=(f-1)*w,V=e=>{b(e)};return e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{className:"table-center-all",dir:"rtl",children:[e.jsx(le,{children:e.jsxs(ce,{className:"bg-muted/50",children:[e.jsx(ie,{className:"text-center w-12 max-w-12 min-w-12",children:e.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),e.jsx(O,{field:"expense_name",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"اسم المصروف"})}),e.jsx(O,{field:"amount",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"المبلغ"})}),e.jsx(O,{field:"expense_type",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"النوع"})}),e.jsx(O,{field:"vendor",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"المورد"})}),e.jsx(O,{field:"payment_date",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ الدفع"})}),e.jsx(O,{field:"status",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الحالة"})}),e.jsx(ie,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الإجراءات"})})]})}),e.jsx(de,{children:A.map((s,a)=>{const r=z+a+1;return e.jsxs(ce,{className:"hover:bg-muted/50",children:[e.jsx(me,{className:"font-medium text-center w-12 max-w-12 min-w-12 text-xs",children:r}),e.jsx(me,{className:"font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:e.jsx(m,{className:"w-4 h-4"})}),e.jsx("span",{className:"arabic-enhanced",children:s.expense_name})]})}),e.jsx(me,{className:"text-center font-semibold",children:e.jsx(U,{amount:s.amount})}),e.jsx(me,{className:"min-w-[120px] text-center",children:e.jsx(C,{variant:"outline",className:"max-w-[120px] truncate arabic-enhanced",children:(d=s.expense_type,{salary:"الرواتب",utilities:"المرافق",rent:"الإيجار",maintenance:"الصيانة",supplies:"المستلزمات",insurance:"التأمين",other:"أخرى"}[d]||d)})}),e.jsx(me,{className:"min-w-[120px] text-center table-cell-wrap-truncate-sm",children:e.jsx("span",{className:"arabic-enhanced",children:s.vendor||e.jsx("span",{className:"text-muted-foreground text-sm arabic-enhanced",children:"غير محدد"})})}),e.jsx(me,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsx(y,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm arabic-enhanced",children:k(s.payment_date)})]})}),e.jsx(me,{className:"text-center",children:e.jsx(C,{variant:q(s.status),className:"arabic-enhanced",children:(t=s.status,{paid:"مدفوع",pending:"آجل",overdue:"متأخر",cancelled:"ملغي"}[t]||t)})}),e.jsx(me,{className:"w-auto text-center",dir:"rtl",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",dir:"rtl",children:[e.jsxs(_,{variant:"ghost",size:"sm",className:"action-btn-view h-8 px-2 min-w-0",onClick:()=>c(s),title:"عرض تفاصيل المصروف",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline mr-1",children:"عرض"})]}),e.jsxs(_,{variant:"ghost",size:"sm",className:"action-btn-edit h-8 px-2 min-w-0",onClick:()=>n(s),title:"تعديل بيانات المصروف",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline mr-1",children:"تعديل"})]}),e.jsxs(_,{variant:"ghost",size:"sm",className:"action-btn-delete text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2 min-w-0",onClick:()=>l(s),title:"حذف المصروف",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline mr-1",children:"حذف"})]}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 px-2 min-w-0",title:"المزيد من الخيارات",children:e.jsx(ue,{className:"w-3 h-3"})})}),e.jsxs(se,{align:"end",className:"expenses-actions-dropdown",children:["pending"===s.status&&i&&e.jsxs(ae,{onClick:()=>i(s),className:"dropdown-item",children:[e.jsx(u,{className:"w-4 h-4 ml-2"}),e.jsx("span",{className:"arabic-enhanced",children:"تحديد كمدفوع"})]}),e.jsx(re,{}),e.jsxs(ae,{onClick:()=>c(s),className:"dropdown-item",children:[e.jsx(S,{className:"w-4 h-4 ml-2"}),e.jsx("span",{className:"arabic-enhanced",children:"عرض التفاصيل الكاملة"})]})]})]})]})})]},s.id);var t,d})})]})})}),T>0&&e.jsxs("div",{className:"flex items-center justify-between px-2",dir:"rtl",children:[e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",(f-1)*w+1," إلى ",Math.min(f*w,T)," من ",T," مصروف"]})}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(p,{value:`${w}`,onValueChange:e=>{E(parseInt(e)),b(1)},dir:"rtl",children:[e.jsx(j,{className:"h-8 w-[70px]",children:e.jsx(g,{placeholder:w})}),e.jsx(v,{side:"top",children:[10,20,30,50,100].map(s=>e.jsx(N,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",f," من ",P]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(_,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>V(1),disabled:1===f,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(pe,{className:"h-4 w-4"})]}),e.jsxs(_,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>V(f-1),disabled:1===f,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(F,{className:"h-4 w-4"})]}),e.jsxs(_,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>V(f+1),disabled:f===P,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(ge,{className:"h-4 w-4"})]}),e.jsxs(_,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>V(P),disabled:f===P,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(je,{className:"h-4 w-4"})]})]})]})]})]})}function Se({expense:s,open:a,onOpenChange:r}){if(!s)return null;return e.jsx(l,{open:a,onOpenChange:r,children:e.jsxs(c,{className:"sm:max-w-[600px] arabic-enhanced",dir:"rtl",children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-3 arabic-enhanced",children:[e.jsx("div",{className:"w-10 h-10 bg-primary rounded-full flex items-center justify-center text-primary-foreground",children:e.jsx(m,{className:"w-5 h-5"})}),e.jsx("span",{className:"arabic-enhanced",children:"تفاصيل المصروف"})]}),e.jsx(x,{className:"arabic-enhanced",children:"عرض جميع تفاصيل المصروف المحدد"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"اسم المصروف"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(m,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium arabic-enhanced",children:s.expense_name})]})]}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"المبلغ"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(u,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(U,{amount:s.amount,className:"font-bold text-lg"})]})]}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"النوع"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(we,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(C,{variant:"outline",className:"arabic-enhanced",children:(o=s.expense_type,{salary:"الرواتب",utilities:"المرافق",rent:"الإيجار",maintenance:"الصيانة",supplies:"المستلزمات",insurance:"التأمين",other:"أخرى"}[o]||o)})]})]}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"الحالة"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(C,{variant:(e=>{switch(e){case"paid":return"default";case"pending":return"secondary";case"overdue":return"destructive";default:return"outline"}})(s.status),className:"arabic-enhanced",children:(n=s.status,{paid:"مدفوع",pending:"آجل",overdue:"متأخر",cancelled:"ملغي"}[n]||n)})]})]}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"تاريخ الدفع"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"arabic-enhanced",children:k(s.payment_date)})]})]}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"طريقة الدفع"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(D,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"arabic-enhanced",children:(t=s.payment_method,{cash:"نقدي",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمانية"}[t]||t)})]})]}),s.vendor&&e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"المورد"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(we,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"arabic-enhanced",children:s.vendor})]})]}),s.receipt_number&&e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"رقم الإيصال"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",dir:"rtl",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"arabic-enhanced",children:s.receipt_number})]})]})]}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground arabic-enhanced",children:"الوصف"}),e.jsx("div",{className:"p-3 border rounded-lg bg-muted/50",dir:"rtl",children:e.jsx("p",{className:"text-sm arabic-enhanced whitespace-pre-wrap",children:s.description})})]})]}),(s.due_date||s.is_recurring||s.notes)&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsx("h4",{className:"text-sm font-medium arabic-enhanced",children:"معلومات إضافية"}),s.due_date&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/30 rounded",dir:"rtl",children:[e.jsx(y,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm arabic-enhanced",children:["تاريخ الاستحقاق: ",k(s.due_date)]})]}),s.is_recurring&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/30 rounded",dir:"rtl",children:[e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm arabic-enhanced",children:["متكرر: ",s.recurring_frequency?`كل ${s.recurring_frequency}`:"نعم"]})]}),s.notes&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/30 rounded",dir:"rtl",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm arabic-enhanced",children:["ملاحظات: ",s.notes]})]})]})]}),e.jsx(M,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-muted-foreground",dir:"rtl",children:[e.jsxs("div",{className:"arabic-enhanced",children:["تاريخ الإنشاء: ",k(s.created_at)]}),e.jsxs("div",{className:"arabic-enhanced",children:["آخر تحديث: ",k(s.updated_at)]})]})]})]})});var t,n,o}function Fe(){const{expenses:r,filteredExpenses:l,isLoading:c,error:i,searchQuery:d,filters:x,categories:o,vendors:f,expenseTypes:y,analytics:b,loadExpenses:w,deleteExpense:C,updateExpense:k,setSearchQuery:S,setFilters:F,clearError:M}=R(),{settings:te}=O();t();const{toast:ne}=n(),[le,ce]=s.useState(!1),[ie,de]=s.useState(!1),[me,xe]=s.useState(!1),[ue,pe]=s.useState(null),[je,ge]=s.useState(null),[ve,Ne]=s.useState(null),[fe,we]=s.useState(null),[Fe,De]=s.useState(!1),[Me,Oe]=s.useState("all"),[qe,Ae]=s.useState("all"),[Pe,Te]=s.useState({min:"",max:""}),[ze,Ve]=s.useState({start:"",end:""});s.useEffect(()=>{w()},[w]);const $e=a.useMemo(()=>{let e=[...l];if("all"!==Me&&(e=e.filter(e=>e.status===Me)),"all"!==qe&&(e=e.filter(e=>e.expense_type===qe)),Pe.min&&Pe.max){const s=parseFloat(Pe.min),a=parseFloat(Pe.max);e=e.filter(e=>e.amount>=s&&e.amount<=a)}if(ze.start&&ze.end){const s=new Date(ze.start),a=new Date(ze.end);a.setHours(23,59,59,999),e=e.filter(e=>{const r=new Date(e.payment_date);return r>=s&&r<=a})}return e},[l,Me,qe,Pe,ze]);return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:i}),e.jsx(_,{onClick:()=>{M(),w()},children:"إعادة المحاولة"})]})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(m,{className:"w-8 h-8 text-primary"}),"مصروفات العيادة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة المصروفات التشغيلية للعيادة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(_,{variant:"outline",disabled:0===$e.length,children:[e.jsx(he,{className:"w-4 h-4 ml-2"}),"تصدير"]})}),e.jsxs(se,{align:"end",className:"w-48",children:[e.jsxs(ae,{onClick:async()=>{try{if(0===$e.length)return void W.noDataToExport("لا توجد بيانات مصروفات للتصدير");await X.exportClinicExpensesToExcel($e),W.exportSuccess(`تم تصدير ${$e.length} مصروف بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting clinic expenses:",e),W.exportError("فشل في تصدير بيانات المصروفات")}},className:"arabic-enhanced",children:[e.jsx(he,{className:"w-4 h-4 ml-2"}),"تصدير Excel"]}),e.jsx(re,{}),e.jsxs(ae,{onClick:async()=>{try{if(console.log("🔄 Starting PDF export process..."),0===$e.length)return console.warn("⚠️ No expenses data to export"),void W.noDataToExport("لا توجد بيانات مصروفات للتصدير بصيغة PDF.");console.log(`📊 Exporting ${$e.length} expenses`);const e=$e.reduce((e,s)=>e+s.amount,0),s=$e.filter(e=>"paid"===e.status).reduce((e,s)=>e+s.amount,0),a=$e.filter(e=>"pending"===e.status).reduce((e,s)=>e+s.amount,0),r=$e.filter(e=>"overdue"===e.status).reduce((e,s)=>e+s.amount,0),t=$e.filter(e=>"cancelled"===e.status).reduce((e,s)=>e+s.amount,0);console.log("📈 Calculated statistics:",{totalAmount:e,paidAmount:s,pendingAmount:a,overdueAmount:r,cancelledAmount:t});const n=$e.reduce((e,s)=>{const a=s.expense_type;return e[a]||(e[a]={amount:0,count:0}),e[a].amount+=s.amount,e[a].count++,e},{}),l=(Object.entries(n).map(([s,a])=>({type:s,amount:a.amount,count:a.count,percentage:e>0?a.amount/e*100:0})),$e.reduce((e,s)=>{const a=s.payment_method;return e[a]||(e[a]={amount:0,count:0}),e[a].amount+=s.amount,e[a].count++,e},{})),c=(Object.entries(l).map(([s,a])=>({method:s,amount:a.amount,count:a.count,percentage:e>0?a.amount/e*100:0})),te?.clinic_name||"عيادة الأسنان الحديثة");console.log("🏥 Clinic name for export:",c),console.log("🚀 Calling ExportService.exportClinicExpensesToPDF..."),await X.exportClinicExpensesToPDF($e,c),console.log("✅ PDF export completed successfully"),W.exportSuccess(`تم تصدير ${$e.length} مصروف بنجاح إلى ملف PDF مع التنسيق الجميل!`)}catch(e){console.error("❌ Error exporting expenses (PDF):",e),W.exportError("فشل في تصدير بيانات المصروفات إلى PDF")}},className:"arabic-enhanced",children:[e.jsx(ye,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),e.jsxs(_,{onClick:()=>ce(!0),children:[e.jsx(be,{className:"w-4 h-4 ml-2"}),"إضافة مصروف"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ee,{title:"إجمالي المصروفات",value:e.jsx(U,{amount:b.totalAmount}),icon:e.jsx(u,{}),color:"blue"}),e.jsx(Ee,{title:"المدفوع",value:e.jsx(U,{amount:b.paidAmount}),icon:e.jsx(D,{}),color:"green"}),e.jsx(Ee,{title:"الآجل",value:e.jsx(U,{amount:b.pendingAmount}),icon:e.jsx(E,{}),color:"yellow"}),e.jsx(Ee,{title:"المتأخر",value:e.jsx(U,{amount:b.overdueAmount}),icon:e.jsx(q,{}),color:"red"})]}),e.jsx(A,{children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(T,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(h,{placeholder:"البحث بالاسم أو النوع أو المورد...",value:d,onChange:e=>S(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),e.jsx(G,{open:Fe,onOpenChange:De,children:e.jsx(J,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"تصفية",("all"!==Me||"all"!==qe||Pe.min||Pe.max||ze.start||ze.end)&&e.jsx("span",{className:"mr-2 w-2 h-2 bg-primary rounded-full"})]})})}),(d||"all"!==Me||"all"!==qe||Pe.min||Pe.max||ze.start||ze.end)&&e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>{S(""),Oe("all"),Ae("all"),Te({min:"",max:""}),Ve({start:"",end:""}),De(!1)},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"مسح الكل"]})]}),e.jsx(G,{open:Fe,onOpenChange:De,children:e.jsx(K,{className:"space-y-4",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),e.jsxs(p,{value:Me,onValueChange:Oe,dir:"rtl",children:[e.jsx(j,{className:"text-right",children:e.jsx(g,{placeholder:"جميع الحالات"})}),e.jsxs(v,{children:[e.jsx(N,{value:"all",children:"جميع الحالات"}),e.jsx(N,{value:"paid",children:"مدفوع"}),e.jsx(N,{value:"pending",children:"آجل"}),e.jsx(N,{value:"overdue",children:"متأخر"}),e.jsx(N,{value:"cancelled",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"نوع المصروف"}),e.jsxs(p,{value:qe,onValueChange:Ae,dir:"rtl",children:[e.jsx(j,{className:"text-right",children:e.jsx(g,{placeholder:"جميع الأنواع"})}),e.jsxs(v,{children:[e.jsx(N,{value:"all",children:"جميع الأنواع"}),e.jsx(N,{value:"salary",children:"الرواتب"}),e.jsx(N,{value:"utilities",children:"المرافق"}),e.jsx(N,{value:"rent",children:"الإيجار"}),e.jsx(N,{value:"maintenance",children:"الصيانة"}),e.jsx(N,{value:"supplies",children:"المستلزمات"}),e.jsx(N,{value:"insurance",children:"التأمين"}),e.jsx(N,{value:"other",children:"أخرى"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"نطاق المبلغ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{type:"number",placeholder:"من مبلغ",value:Pe.min,onChange:e=>Te(s=>({...s,min:e.target.value})),className:"text-right",dir:"rtl"}),e.jsx(h,{type:"number",placeholder:"إلى مبلغ",value:Pe.max,onChange:e=>Te(s=>({...s,max:e.target.value})),className:"text-right",dir:"rtl"})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"تاريخ الدفع"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{type:"date",placeholder:"من تاريخ",value:ze.start,onChange:e=>Ve(s=>({...s,start:e.target.value})),className:"text-right",dir:"rtl"}),e.jsx(h,{type:"date",placeholder:"إلى تاريخ",value:ze.end,onChange:e=>Ve(s=>({...s,end:e.target.value})),className:"text-right",dir:"rtl"})]})]})]})})})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(ke,{expenses:$e,isLoading:c,onEdit:e=>{pe(e),ce(!0)},onDelete:e=>{ge(e),de(!0),we(e.id)},onViewDetails:e=>{Ne(e),xe(!0)},onMarkAsPaid:async e=>{try{await k(e.id,{status:"paid"}),ne({title:"تم تحديث الحالة",description:"تم تحديث حالة المصروف إلى مدفوع بنجاح"})}catch(s){ne({title:"خطأ",description:"فشل في تحديث حالة المصروف",variant:"destructive"})}}})}),e.jsx(Ce,{open:le,onOpenChange:()=>{ce(!1),pe(null)},editingExpense:ue}),e.jsx(V,{open:ie,onOpenChange:de,children:e.jsxs($,{dir:"rtl",className:"arabic-enhanced",children:[e.jsxs(L,{children:[e.jsxs(I,{className:"flex items-center gap-2 arabic-enhanced",children:[e.jsx(oe,{className:"w-5 h-5 text-destructive"}),"تأكيد حذف المصروف"]}),e.jsxs(B,{className:"arabic-enhanced",children:["هل أنت متأكد من حذف هذا المصروف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"تحذير: لا يمكن التراجع عن هذا الإجراء!"})]})]}),e.jsxs(H,{className:"flex-row-reverse",children:[e.jsxs(Q,{onClick:async()=>{if(fe)try{await C(fe),W.deleteSuccess("تم حذف المصروف بنجاح"),de(!1),ge(null),we(null)}catch(e){W.deleteError("فشل في حذف المصروف")}},className:"bg-destructive hover:bg-destructive/90 arabic-enhanced",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"تأكيد الحذف"]}),e.jsx(Z,{className:"arabic-enhanced",children:"إلغاء"})]})]})}),e.jsx(Se,{expense:ve,open:me,onOpenChange:xe})]})}const Ee=({title:s,value:a,icon:r,color:t})=>e.jsx(A,{className:"transition-all duration-200 hover:shadow-lg border rounded-lg",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a})]}),e.jsx("div",{className:`p-3 rounded-full bg-muted ${{blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",yellow:"text-yellow-600 dark:text-yellow-400",red:"text-red-600 dark:text-red-400"}[t]}`,children:r})]})})});export{Fe as default};
