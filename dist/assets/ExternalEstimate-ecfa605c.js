import{j as e}from"./ui-cacc1eea.js";import{r as s}from"./vendor-696af5bd.js";import{aj as t,Q as n,e as a,ar as i,V as r,W as l,X as d,Y as c,D as o,f as m,g as x,h,i as p,r as j,x as u,w as g,Z as b,C as f,j as v,k as y,R as N,l as w,L as P,I as C,B as k,S as T,m as _,n as S,o as F,p as D,T as R,aZ as q,bj as E,bd as z,bi as O}from"./index-3a8dc84c.js";import{n as I}from"./notificationService-09cb27cc.js";import{_ as U}from"./pdf-991f41f6.js";import{F as L}from"./file-text-861b9f90.js";import{P as V}from"./phone-a8e6eab2.js";import{M as A}from"./map-pin-a7696fe0.js";import{D as $,T as G}from"./upload-4df8a268.js";import{P as H}from"./printer-5ab76652.js";import{C as M}from"./calculator-63fcb348.js";import{P as Q}from"./plus-1eab3b5b.js";import"./utils-ec524415.js";import"./charts-b4389b44.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=t("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);function Z({open:t,onOpenChange:b,estimateData:f}){const{settings:v}=n(),{formatAmount:y}=a();i();const N=r(),w=l(),P=d(),{phone:C,email:k,address:T}=c(),_=s.useRef(null),[S,F]=s.useState(!1),D=`EST-${Date.now().toString().slice(-6)}`,R=(new Date).toISOString().split("T")[0],q="percentage"===f.discountType?f.subtotal*f.discount/100:f.discount;return e.jsx(o,{open:t,onOpenChange:b,children:e.jsxs(m,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center text-xl font-semibold",children:[e.jsx(L,{className:"w-5 h-5 ml-2"}),"معاينة الفاتورة التقديرية"]}),e.jsx(p,{children:"معاينة الفاتورة قبل الطباعة أو التصدير"})]}),e.jsxs("div",{ref:_,className:"estimate-container bg-white text-black",style:{fontFamily:"Arial, sans-serif"},children:[e.jsxs("div",{className:"estimate-header bg-gradient-to-br from-blue-500 to-blue-700 text-white p-8 text-center",children:[e.jsx("div",{className:"estimate-title text-3xl font-bold mb-2",children:"فاتورة تقديرية"}),e.jsxs("div",{className:"estimate-number text-lg opacity-90",children:["رقم التقدير: ",D]})]}),e.jsxs("div",{className:"clinic-info bg-gray-50 p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[P&&""!==P.trim()&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:P,alt:"شعار العيادة",className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-300 shadow-sm",onError:e=>{console.log("Estimate logo failed to load:",P),e.currentTarget.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"clinic-name text-xl font-bold text-gray-800 mb-1",children:N}),w&&e.jsxs("div",{className:"doctor-name text-lg text-gray-600",children:["د. ",w]})]})]}),e.jsxs("div",{className:"contact-info flex gap-6 flex-wrap text-sm text-gray-600",children:[C&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:C})]}),k&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"📧"}),e.jsx("span",{children:k})]}),T&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:T})]})]})]}),e.jsx("div",{className:"patient-info p-6 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"اسم المريض:"}),e.jsx("span",{children:f.patientName||"غير محدد"})]}),f.patientPhone&&e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"رقم الهاتف:"}),e.jsx("span",{children:f.patientPhone})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"تاريخ التقدير:"}),e.jsx("span",{children:j(R)})]}),e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"صالح حتى:"}),e.jsx("span",{children:j(f.validUntil)})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("table",{className:"items-table w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"#"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"العلاج"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"الكمية"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"السعر"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"المجموع"})]})}),e.jsx("tbody",{children:f.items.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b border-gray-200",children:t+1}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.treatmentName}),s.notes&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.notes})]})}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:s.quantity}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:y(s.unitPrice)}),e.jsx("td",{className:"p-3 border-b border-gray-200 font-medium",children:y(s.totalPrice)})]},s.id))})]})}),e.jsx("div",{className:"summary-section p-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-md mr-auto",children:[e.jsxs("div",{className:"summary-row flex justify-between mb-2",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsx("span",{children:y(f.subtotal)})]}),f.discount>0&&e.jsxs("div",{className:"summary-row flex justify-between mb-2 text-green-600",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["-",y(q)]})]}),f.tax>0&&e.jsxs("div",{className:"summary-row flex justify-between mb-2",children:[e.jsxs("span",{children:["الضريبة (",f.taxRate,"%):"]}),e.jsx("span",{children:y(f.tax)})]}),e.jsxs("div",{className:"summary-total flex justify-between text-lg font-bold text-gray-800 border-t-2 border-blue-500 pt-3 mt-3",children:[e.jsx("span",{children:"المجموع الكلي:"}),e.jsx("span",{children:y(f.total)})]})]})}),f.notes&&e.jsxs("div",{className:"notes-section p-6 bg-yellow-50 border-t border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"ملاحظات:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:f.notes})]}),e.jsx("div",{className:"stamp-area m-6 p-6 border-2 border-dashed border-gray-300 text-center text-gray-500",children:v?.estimate_show_clinic_stamp&&P&&""!==P.trim()?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("img",{src:P,alt:"ختم العيادة",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-400 shadow-md opacity-60",onError:e=>{console.log("Stamp logo failed to load:",P),e.currentTarget.style.display="none"}}),e.jsx("div",{className:"text-sm",children:"ختم العيادة"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"مكان ختم العيادة"}),e.jsx("div",{className:"text-sm",children:"هذا التقدير صالح لمدة محددة ويخضع للتغيير حسب الحالة الفعلية"})]})}),e.jsxs("div",{className:"footer p-6 text-center bg-gray-800 text-white text-sm",children:[e.jsx("div",{children:"شكراً لثقتكم بنا"}),e.jsxs("div",{className:"mt-1",children:["تم إنشاء هذا التقدير في ",j(R)]})]})]}),e.jsxs(u,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(g,{variant:"outline",onClick:()=>b(!1),children:"إغلاق"}),e.jsxs(g,{variant:"outline",onClick:async()=>{F(!0);try{const e=(await U(()=>import("./pdf-991f41f6.js").then(e=>e.b),[],import.meta.url)).default,s=(await U(()=>import("./pdf-991f41f6.js").then(e=>e.j),[],import.meta.url)).default;if(!_.current)return;const t=await e(_.current,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:_.current.scrollWidth,height:_.current.scrollHeight}),n=t.toDataURL("image/jpeg",.95),a=new s({orientation:"portrait",unit:"mm",format:"a4"}),i=a.internal.pageSize.getWidth(),r=a.internal.pageSize.getHeight(),l=i-20,d=t.height*l/t.width;let c=d,o=10;for(a.addImage(n,"JPEG",10,o,l,d),c-=r-20;c>=0;)o=c-d+10,a.addPage(),a.addImage(n,"JPEG",10,o,l,d),c-=r-20;const m=`فاتورة_تقديرية_${f.patientName||"مريض"}_${(new Date).toLocaleDateString("en-GB").replace(/\//g,"-")}.pdf`;a.save(m),I.success("تم تصدير الفاتورة بنجاح")}catch(e){console.error("Error exporting PDF:",e),I.error("فشل في تصدير الفاتورة")}finally{F(!1)}},disabled:S,children:[e.jsx($,{className:"w-4 h-4 ml-2"}),S?"جاري التصدير...":"تصدير PDF"]}),e.jsxs(g,{onClick:()=>{if(!_.current)return;const e=window.open("","_blank");if(e){const s=_.current.innerHTML;e.document.write(`\n        <!DOCTYPE html>\n        <html dir="rtl">\n        <head>\n          <meta charset="utf-8">\n          <title>فاتورة تقديرية - ${D}</title>\n          <style>\n            body {\n              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n              direction: rtl;\n              margin: 0;\n              padding: 20px;\n              background: white;\n              color: black;\n              font-size: 14px;\n              line-height: 1.6;\n            }\n            .estimate-container {\n              max-width: 800px;\n              margin: 0 auto;\n              background: white;\n              border: 1px solid #ddd;\n              border-radius: 8px;\n              overflow: hidden;\n            }\n            .estimate-header {\n              background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n              color: white;\n              padding: 30px;\n              text-align: center;\n            }\n            .estimate-title {\n              font-size: 28px;\n              font-weight: bold;\n              margin-bottom: 10px;\n            }\n            .estimate-number {\n              font-size: 16px;\n              opacity: 0.9;\n            }\n            .clinic-info {\n              background: #f8fafc;\n              padding: 20px;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .clinic-logo {\n              width: 60px;\n              height: 60px;\n              border-radius: 8px;\n              object-fit: cover;\n              border: 2px solid #e2e8f0;\n              box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n              margin-left: 15px;\n              float: right;\n            }\n            .clinic-name {\n              font-size: 20px;\n              font-weight: bold;\n              color: #1e293b;\n              margin-bottom: 5px;\n            }\n            .doctor-name {\n              font-size: 16px;\n              color: #64748b;\n              margin-bottom: 10px;\n            }\n            .contact-info {\n              display: flex;\n              gap: 20px;\n              flex-wrap: wrap;\n              font-size: 14px;\n              color: #64748b;\n            }\n            .patient-info {\n              padding: 20px;\n              background: #fefefe;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 8px;\n            }\n            .info-label {\n              font-weight: 600;\n              color: #374151;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin: 20px 0;\n            }\n            .items-table th,\n            .items-table td {\n              padding: 12px;\n              text-align: right;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .items-table th {\n              background: #f1f5f9;\n              font-weight: 600;\n              color: #374151;\n            }\n            .items-table tbody tr:hover {\n              background: #f8fafc;\n            }\n            .summary-section {\n              padding: 20px;\n              background: #f8fafc;\n            }\n            .summary-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 8px;\n              padding: 4px 0;\n            }\n            .summary-total {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1e293b;\n              border-top: 2px solid #3b82f6;\n              padding-top: 12px;\n              margin-top: 12px;\n            }\n            .notes-section {\n              padding: 20px;\n              background: #fffbeb;\n              border-top: 1px solid #e2e8f0;\n            }\n            .footer {\n              padding: 20px;\n              text-align: center;\n              background: #1e293b;\n              color: white;\n              font-size: 12px;\n            }\n            .stamp-area {\n              margin-top: 30px;\n              padding: 20px;\n              border: 2px dashed #cbd5e1;\n              text-align: center;\n              color: #64748b;\n            }\n            .stamp-logo {\n              width: 80px;\n              height: 80px;\n              border-radius: 50%;\n              object-fit: cover;\n              border: 2px solid #9ca3af;\n              box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n              opacity: 0.6;\n              margin: 0 auto 10px;\n            }\n            @media print {\n              body { margin: 0; padding: 0; }\n              .estimate-container { border: none; border-radius: 0; }\n            }\n          </style>\n        </head>\n        <body>\n          ${s}\n        </body>\n        </html>\n      `),e.document.close(),e.focus(),setTimeout(()=>{e.print(),e.close()},250)}},children:[e.jsx(H,{className:"w-4 h-4 ml-2"}),"طباعة"]})]})]})})}function B(){const{settings:t,loadSettings:d}=n(),{formatAmount:c}=a();i(),r(),l(),s.useEffect(()=>{t||d()},[t,d]);const[j,U]=s.useState({patientName:"",patientPhone:"",items:[],subtotal:0,discount:0,discountType:"percentage",tax:0,taxRate:t?.estimate_default_tax_rate||0,total:0,notes:t?.estimate_default_notes||"",validUntil:new Date(Date.now()+24*(t?.estimate_default_validity_days||30)*60*60*1e3).toISOString().split("T")[0]}),[V,A]=s.useState(!1),[$,H]=s.useState({treatmentType:"",treatmentName:"",quantity:1,unitPrice:0,notes:""}),[B,J]=s.useState(null),[Y,X]=s.useState(!1),[K,ee]=s.useState(!1);s.useEffect(()=>{const e=j.items.reduce((e,s)=>e+s.totalPrice,0),s="percentage"===j.discountType?e*j.discount/100:j.discount,t=e-s,n=t*j.taxRate/100,a=t+n;U(s=>({...s,subtotal:e,tax:n,total:a}))},[j.items,j.discount,j.discountType,j.taxRate]);return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"فاتورة تقديرية خارجية"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إنشاء فاتورة تقديرية للمرضى دون ربطها بالنظام"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",onClick:()=>ee(!0),disabled:0===j.items.length,children:[e.jsx(b,{className:"w-4 h-4 ml-2"}),"معاينة"]}),e.jsxs(g,{variant:"outline",onClick:()=>{U(e=>({...e,items:[],patientName:"",patientPhone:"",notes:""})),I.success("تم مسح جميع البيانات")},disabled:0===j.items.length,children:[e.jsx(G,{className:"w-4 h-4 ml-2"}),"مسح الكل"]})]})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(N,{className:"w-5 h-5 ml-2"}),"معلومات المريض"]})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"patientName",children:"اسم المريض"}),e.jsx(C,{id:"patientName",value:j.patientName,onChange:e=>U(s=>({...s,patientName:e.target.value})),placeholder:"أدخل اسم المريض"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"patientPhone",children:"رقم الهاتف (اختياري)"}),e.jsx(C,{id:"patientPhone",value:j.patientPhone,onChange:e=>U(s=>({...s,patientPhone:e.target.value})),placeholder:"أدخل رقم الهاتف"})]})]})})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(M,{className:"w-5 h-5 ml-2"}),"العلاجات المطلوبة"]}),e.jsxs(g,{onClick:()=>A(!0),children:[e.jsx(Q,{className:"w-4 h-4 ml-2"}),"إضافة علاج"]})]})}),e.jsx(w,{children:0===j.items.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لم يتم إضافة أي علاجات بعد"}),e.jsx("p",{className:"text-sm",children:'اضغط على "إضافة علاج" لبدء إنشاء الفاتورة'})]}):e.jsx("div",{className:"space-y-4",children:j.items.map((s,t)=>e.jsx("div",{className:"border rounded-lg p-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",children:t+1}),e.jsx("h4",{className:"font-medium",children:s.treatmentName})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["الكمية: ",s.quantity," × ",c(s.unitPrice)," = ",c(s.totalPrice)]}),s.notes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["ملاحظات: ",s.notes]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{J(s),X(!0)},children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{return e=s.id,U(s=>({...s,items:s.items.filter(s=>s.id!==e)})),void I.success("تم حذف العلاج");var e},children:e.jsx(G,{className:"w-4 h-4"})})]})]})},s.id))})})]}),j.items.length>0&&e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(y,{children:"الحسابات"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"discount",children:"خصم"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{id:"discount",type:"number",value:j.discount,onChange:e=>U(s=>({...s,discount:Number(e.target.value)})),placeholder:"0"}),e.jsxs(T,{value:j.discountType,onValueChange:e=>U(s=>({...s,discountType:e})),children:[e.jsx(_,{className:"w-24",children:e.jsx(S,{})}),e.jsxs(F,{children:[e.jsx(D,{value:"percentage",children:"%"}),e.jsx(D,{value:"fixed",children:"ثابت"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"taxRate",children:"ضريبة (%)"}),e.jsx(C,{id:"taxRate",type:"number",value:j.taxRate,onChange:e=>U(s=>({...s,taxRate:Number(e.target.value)})),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"validUntil",children:"صالح حتى"}),e.jsx(C,{id:"validUntil",type:"date",value:j.validUntil,onChange:e=>U(s=>({...s,validUntil:e.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"notes",children:"ملاحظات إضافية"}),e.jsx(R,{id:"notes",value:j.notes,onChange:e=>U(s=>({...s,notes:e.target.value})),placeholder:"أي ملاحظات أو شروط إضافية...",rows:3})]}),e.jsx(q,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsx("span",{children:c(j.subtotal)})]}),j.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["-",c("percentage"===j.discountType?j.subtotal*j.discount/100:j.discount)]})]}),j.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الضريبة (",j.taxRate,"%):"]}),e.jsx("span",{children:c(j.tax)})]}),e.jsx(q,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"المجموع الكلي:"}),e.jsx("span",{children:c(j.total)})]})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsxs(g,{onClick:()=>ee(!0),disabled:0===j.items.length,className:"flex-1",children:[e.jsx(b,{className:"w-4 h-4 ml-2"}),"معاينة وطباعة"]})})]})]}),e.jsx(o,{open:V,onOpenChange:A,children:e.jsxs(m,{className:"max-w-md",dir:"rtl",children:[e.jsxs(x,{children:[e.jsx(h,{children:"إضافة علاج جديد"}),e.jsx(p,{children:"أدخل تفاصيل العلاج المطلوب"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"treatmentType",children:"نوع العلاج"}),e.jsxs(T,{value:$.treatmentType,onValueChange:e=>{const s=E.find(s=>s.value===e);H(t=>({...t,treatmentType:e,treatmentName:s?.label||""}))},children:[e.jsx(_,{children:e.jsx(S,{placeholder:"اختر نوع العلاج"})}),e.jsx(F,{children:z.map(s=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1 text-sm font-medium text-muted-foreground",children:s.label}),O(s.value).map(s=>e.jsx(D,{value:s.value,children:s.label},s.value))]},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"treatmentName",children:"اسم العلاج"}),e.jsx(C,{id:"treatmentName",value:$.treatmentName,onChange:e=>H(s=>({...s,treatmentName:e.target.value})),placeholder:"أو أدخل اسم مخصص"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"quantity",children:"الكمية"}),e.jsx(C,{id:"quantity",type:"number",min:"1",value:$.quantity,onChange:e=>H(s=>({...s,quantity:Number(e.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"unitPrice",children:"السعر"}),e.jsx(C,{id:"unitPrice",type:"number",min:"0",step:"0.01",value:$.unitPrice,onChange:e=>H(s=>({...s,unitPrice:Number(e.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"itemNotes",children:"ملاحظات (اختياري)"}),e.jsx(R,{id:"itemNotes",value:$.notes,onChange:e=>H(s=>({...s,notes:e.target.value})),placeholder:"أي ملاحظات خاصة بهذا العلاج...",rows:2})]})]}),e.jsxs(u,{children:[e.jsx(g,{variant:"outline",onClick:()=>A(!1),children:"إلغاء"}),e.jsx(g,{onClick:()=>{if(!$.treatmentType||!$.treatmentName||!$.unitPrice)return void I.error("يرجى ملء جميع الحقول المطلوبة");const e={id:Date.now().toString(),treatmentType:$.treatmentType,treatmentName:$.treatmentName,quantity:$.quantity||1,unitPrice:$.unitPrice,totalPrice:($.quantity||1)*($.unitPrice||0),notes:$.notes};U(s=>({...s,items:[...s.items,e]})),H({treatmentType:"",treatmentName:"",quantity:1,unitPrice:0,notes:""}),A(!1),I.success("تم إضافة العلاج بنجاح")},children:"إضافة"})]})]})}),e.jsx(o,{open:Y,onOpenChange:X,children:e.jsxs(m,{className:"max-w-md",dir:"rtl",children:[e.jsxs(x,{children:[e.jsx(h,{children:"تعديل العلاج"}),e.jsx(p,{children:"تعديل تفاصيل العلاج"})]}),B&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"editTreatmentName",children:"اسم العلاج"}),e.jsx(C,{id:"editTreatmentName",value:B.treatmentName,onChange:e=>J(s=>s?{...s,treatmentName:e.target.value}:null)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"editQuantity",children:"الكمية"}),e.jsx(C,{id:"editQuantity",type:"number",min:"1",value:B.quantity,onChange:e=>J(s=>s?{...s,quantity:Number(e.target.value)}:null)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"editUnitPrice",children:"السعر"}),e.jsx(C,{id:"editUnitPrice",type:"number",min:"0",step:"0.01",value:B.unitPrice,onChange:e=>J(s=>s?{...s,unitPrice:Number(e.target.value)}:null)})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"editItemNotes",children:"ملاحظات"}),e.jsx(R,{id:"editItemNotes",value:B.notes||"",onChange:e=>J(s=>s?{...s,notes:e.target.value}:null),rows:2})]})]}),e.jsxs(u,{children:[e.jsx(g,{variant:"outline",onClick:()=>X(!1),children:"إلغاء"}),e.jsx(g,{onClick:()=>{B&&(U(e=>({...e,items:e.items.map(e=>e.id===B.id?{...B,totalPrice:B.quantity*B.unitPrice}:e)})),J(null),X(!1),I.success("تم تحديث العلاج بنجاح"))},children:"حفظ التغييرات"})]})]})}),e.jsx(Z,{open:K,onOpenChange:ee,estimateData:j})]})}export{B as default};
