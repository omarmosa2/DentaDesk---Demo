import{h as n,E as t}from"./pdf-991f41f6.js";import{b6 as e,bq as a,K as i,q as s,aL as r,aI as o,br as d,bs as l,bt as c,bu as p,bv as h}from"./index-3a8dc84c.js";class m{static createEnhancedAppointmentReportHTML(n,t){const a=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø­Ø¶ÙˆØ±"),i=b.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${i}\n      </head>\n      <body>\n        ${a}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ“…</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h3>\n              <div class="number">${n.totalAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ…</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>\n              <div class="number">${n.completedAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">âŒ</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©</h3>\n              <div class="number warning">${n.cancelledAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">âš ï¸</div>\n            <div class="card-content">\n              <h3>Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</h3>\n              <div class="number danger">${n.noShowAppointments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ“Š</div>\n            <div class="card-content">\n              <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>\n              <div class="number">${n.attendanceRate?.toFixed(1)||"0"}%</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">ğŸ“‰</div>\n            <div class="card-content">\n              <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</h3>\n              <div class="number warning">${n.cancellationRate?.toFixed(1)||"0"}%</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Appointments List Section --\x3e\n        ${n.appointmentsList&&n.appointmentsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯\n          </div>\n          <div class="section-content">\n            <div class="appointments-grid">\n              ${n.appointmentsList.slice(0,50).map((n,t)=>{const a=n.start_time?(()=>{try{const t=new Date(n.start_time);if(isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";const e=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}/${a}/${i} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}})():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",i=(n=>{switch(n){case"completed":return{text:"Ù…ÙƒØªÙ…Ù„",class:"status-completed"};case"cancelled":return{text:"Ù…Ù„ØºÙŠ",class:"status-cancelled"};case"no_show":return{text:"Ù„Ù… ÙŠØ­Ø¶Ø±",class:"status-no-show"};case"scheduled":return{text:"Ù…Ø¬Ø¯ÙˆÙ„",class:"status-scheduled"};default:return{text:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",class:"status-unknown"}}})(n.status);return`\n                  <div class="appointment-card">\n                    <div class="appointment-header">\n                      <div class="appointment-avatar">\n                        ${(n.patient_name||"Ù…").charAt(0)}\n                      </div>\n                      <div class="appointment-info">\n                        <h4 class="appointment-patient">${n.patient_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</h4>\n                        <span class="appointment-serial">#${n.id||(t+1).toString().padStart(3,"0")}</span>\n                      </div>\n                    </div>\n                    <div class="appointment-details">\n                      <div class="detail-item">\n                        <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</span>\n                        <span class="detail-value">${a}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬:</span>\n                        <span class="detail-value">${n.treatment_name?e(n.treatment_name):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">Ø§Ù„Ù…Ø¯Ø©:</span>\n                        <span class="detail-value">${n.duration||30} Ø¯Ù‚ÙŠÙ‚Ø©</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>\n                        <span class="detail-value ${i.class}">${i.text}</span>\n                      </div>\n                      ${n.notes?`\n                      <div class="detail-item">\n                        <span class="detail-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>\n                        <span class="detail-value">${n.notes}</span>\n                      </div>\n                      `:""}\n                    </div>\n                  </div>\n                `}).join("")}\n            </div>\n            ${n.appointmentsList.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ù…ÙˆØ¹Ø¯ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.appointmentsList.length.toLocaleString()} Ù…ÙˆØ¹Ø¯</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“Š</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.appointmentsByStatus?.map(n=>{const t=parseFloat(n.percentage?.toFixed(1)||"0"),e=Math.max(5,t);return`\n                      <tr>\n                        <td class="category-cell">${n.status}</td>\n                        <td class="number-cell">${n.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${t}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${e}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        ${n.appointmentsByTreatment&&n.appointmentsByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ¦·</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.appointmentsByTreatment.slice(0,10).map(t=>{const a=Math.max(...n.appointmentsByTreatment.map(n=>n.count)),i=a>0?t.count/a*100:0,s=Math.max(5,i);return`\n                      <tr>\n                        <td class="category-cell">${e(t.treatment)}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${n.appointmentsByDay&&n.appointmentsByDay.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“…</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ÙŠÙˆÙ…</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.appointmentsByDay.map(t=>{const e=Math.max(...n.appointmentsByDay.map(n=>n.count)),a=e>0?t.count/e*100:0,i=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.day}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${i}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${n.peakHours&&n.peakHours.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">â°</span>\n            Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ÙˆÙ‚Øª</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.peakHours.map(t=>{const e=Math.max(...n.peakHours.map(n=>n.count)),a=e>0?t.count/e*100:0,i=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.hour}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${i}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n          <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedFinancialReportHTML(n,t){const s=b.getEnhancedHeader("Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª"),r=b.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${r}\n      </head>\n      <body>\n        ${s}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ’°</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n              <div class="number">${(()=>{const e=a(n.totalRevenue||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ…</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>\n              <div class="number">${n.completedPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ”„</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</h3>\n              <div class="number">${n.partialPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">â³</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n              <div class="number">${n.pendingPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">âš ï¸</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</h3>\n              <div class="number">${n.overduePayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Methods Analysis --\x3e\n        ${n.revenueByPaymentMethod&&n.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ’³</span>\n            Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.revenueByPaymentMethod.map(n=>{const e=n.percentage||0,s=Math.max(5,e);return`\n                      <tr>\n                        <td class="category-cell">${"Ù†Ù‚Ø¯ÙŠ"===n.method?"ğŸ’µ":"Ø¨Ø·Ø§Ù‚Ø©"===n.method?"ğŸ’³":"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ"===n.method?"ğŸ¦":"ğŸ’°"} ${n.method}</td>\n                        <td class="number-cell">${(()=>{const e=a(n.amount||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</td>\n                        <td class="percentage-cell">${e.toFixed(1)}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n\n\n        ${n.revenueByTreatment&&n.revenueByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ¦·</span>\n            Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬</th>\n                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</th>\n                    <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.revenueByTreatment.slice(0,10).map(n=>`\n                    <tr>\n                      <td class="category-cell">${e(n.treatment)}</td>\n                      <td class="number-cell">${(()=>{const e=a(n.amount||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</td>\n                      <td class="number-cell">${n.count?.toLocaleString()||"0"}</td>\n                      <td class="number-cell">${(()=>{const e=a(n.avgAmount||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Payment Status Analysis --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“ˆ</span>\n            ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(()=>{const t=n.dataCount||0;return[{status:"Ù…ÙƒØªÙ…Ù„",count:n.completedPayments||0,icon:"âœ…",color:"success"},{status:"Ø¬Ø²Ø¦ÙŠ",count:n.partialPayments||0,icon:"ğŸ”„",color:"info"},{status:"Ø¢Ø¬Ù„",count:n.pendingPayments||0,icon:"â³",color:"warning"},{status:"Ù…ØªØ£Ø®Ø±",count:n.overduePayments||0,icon:"âš ï¸",color:"danger"},{status:"ÙØ§Ø´Ù„",count:n.failedPayments||0,icon:"âŒ",color:"danger"}].map(n=>{const e=t>0?n.count/t*100:0,a=Math.max(5,e);return`\n                        <tr>\n                          <td class="category-cell">${n.icon} ${n.status}</td>\n                          <td class="number-cell">${n.count.toLocaleString()}</td>\n                          <td class="percentage-cell">${e.toFixed(1)}%</td>\n                          <td class="chart-cell">\n                            <div class="progress-bar">\n                              <div class="progress-fill ${n.color}" style="width: ${a}%"></div>\n                            </div>\n                          </td>\n                        </tr>\n                      `}).join("")})()}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Status Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“Š</span>\n            ØªØ­Ù„ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${(()=>{const t=n.dataCount||0;return[{status:"Ù…ÙƒØªÙ…Ù„",count:n.completedPayments||0,icon:"âœ…",color:"#065f46",bgColor:"#d1fae5"},{status:"Ø¬Ø²Ø¦ÙŠ",count:n.partialPayments||0,icon:"ğŸ”„",color:"#1e40af",bgColor:"#dbeafe"},{status:"Ø¢Ø¬Ù„",count:n.pendingPayments||0,icon:"â³",color:"#92400e",bgColor:"#fef3c7"},{status:"Ù…ØªØ£Ø®Ø±",count:n.overduePayments||0,icon:"âš ï¸",color:"#991b1b",bgColor:"#fee2e2"}].map(n=>{const e=t>0?n.count/t*100:0;return`\n                    <div class="analysis-card" style="border-left-color: ${n.color}; border-left-width: 6px;">\n                      <div class="analysis-icon" style="background: ${n.bgColor}; color: ${n.color}; border: 2px solid ${n.color};">\n                        ${n.icon}\n                      </div>\n                      <div class="analysis-content">\n                        <h3 style="color: ${n.color};">${n.status}</h3>\n                        <div class="analysis-stats">\n                          <div class="stat">\n                            <span class="stat-label">Ø§Ù„Ø¹Ø¯Ø¯:</span>\n                            <span class="stat-value" style="color: ${n.color};">${n.count.toLocaleString()}</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">Ø§Ù„Ù†Ø³Ø¨Ø©:</span>\n                            <span class="stat-value" style="color: ${n.color};">${e.toFixed(1)}%</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>\n                            <span class="stat-value">${t.toLocaleString()}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  `}).join("")})()}\n            </div>\n          </div>\n        </div>\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${n.filterInfo?`<p class="filter-info">ğŸ“Š ${n.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ’° ${(()=>{try{const{getCurrencyConfig:e,formatCurrencyWithConfig:a,getDefaultCurrency:i}=require("@/lib/utils"),s=e(t?.currency||i());return a(n.totalRevenue||0,s)}catch(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:t?.currency||"USD"}).format(n.totalRevenue||0)}})()} Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>\n                <span class="stat-item">âœ… ${n.completedPayments?.toLocaleString()||"0"} Ù…ÙƒØªÙ…Ù„</span>\n                <span class="stat-item">ğŸ”„ ${n.partialPayments?.toLocaleString()||"0"} Ø¬Ø²Ø¦ÙŠ</span>\n                <span class="stat-item">ğŸ“Š ${n.dataCount?.toLocaleString()||"0"} Ù…Ø¹Ø§Ù…Ù„Ø©</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedInventoryReportHTML(n,t){const e=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"),s=b.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${s}\n      </head>\n      <body>\n        ${e}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ“¦</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>\n              <div class="number">${n.totalItems.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">ğŸ’°</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>\n              <div class="number">${(()=>{const e=a(n.totalValue||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">âš ï¸</div>\n            <div class="card-content">\n              <h3>Ø£ØµÙ†Ø§Ù Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>\n              <div class="number">${n.lowStockItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">â°</div>\n            <div class="card-content">\n              <h3>Ø£ØµÙ†Ø§Ù Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h3>\n              <div class="number">${n.expiredItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">âŒ</div>\n            <div class="card-content">\n              <h3>Ø£ØµÙ†Ø§Ù Ù†ÙØ¯ Ù…Ø®Ø²ÙˆÙ†Ù‡Ø§</h3>\n              <div class="number">${n.outOfStockItems||0}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Inventory Items List Section --\x3e\n        ${n.inventoryItems&&n.inventoryItems.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†\n          </div>\n          <div class="section-content">\n            <div class="inventory-grid">\n              ${n.inventoryItems.slice(0,50).map((n,e)=>`\n                <div class="inventory-card">\n                  <div class="inventory-header">\n                    <div class="inventory-avatar">\n                      ${(n.name||"Øµ").charAt(0)}\n                    </div>\n                    <div class="inventory-info">\n                      <h4 class="inventory-name">${n.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</h4>\n                      <span class="inventory-category">${n.category||"ØºÙŠØ± Ù…ØµÙ†Ù"}</span>\n                    </div>\n                  </div>\n                  <div class="inventory-details">\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„ÙƒÙ…ÙŠØ©:</span>\n                      <span class="detail-value ${n.quantity<=n.minimum_stock?"status-warning":"status-success"}">${n.quantity.toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©:</span>\n                      <span class="detail-value">${(()=>{const e=n.unit_price||n.cost_per_unit||0,s=a(e,"USD",t?.currency||"USD");return i(s,t?.currency||"USD")})()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>\n                      <span class="detail-value">${(()=>{const e=(n.unit_price||n.cost_per_unit||0)*n.quantity,s=a(e,"USD",t?.currency||"USD");return i(s,t?.currency||"USD")})()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰:</span>\n                      <span class="detail-value">${n.minimum_stock||0}</span>\n                    </div>\n                    ${n.expiry_date?`\n                    <div class="detail-item">\n                      <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span>\n                      <span class="detail-value ${new Date(n.expiry_date)<new Date?"status-danger":"status-info"}">${new Date(n.expiry_date).toLocaleDateString("ar-SA")}</span>\n                    </div>\n                    `:""}\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>\n                      <span class="detail-value ${0===n.quantity?"status-danger":n.quantity<=n.minimum_stock?"status-warning":"status-success"}">\n                        ${0===n.quantity?"Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":n.quantity<=n.minimum_stock?"Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶":"Ù…ØªÙˆÙØ±"}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${n.inventoryItems.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 ØµÙ†Ù Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.inventoryItems.length.toLocaleString()} ØµÙ†Ù</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Category Distribution --\x3e\n        ${n.itemsByCategory&&n.itemsByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“Š</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ÙØ¦Ø©</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù</th>\n                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.itemsByCategory.map(e=>{const s=n.totalItems>0?Math.round(e.count/n.totalItems*100):0;return`\n                    <tr>\n                      <td class="category-name">${e.category}</td>\n                      <td class="count-cell">${e.count.toLocaleString()}</td>\n                      <td class="value-cell">${(()=>{const n=a(e.value||0,"USD",t?.currency||"USD");return i(n,t?.currency||"USD")})()}</td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill" style="width: ${s}%"></div>\n                        </div>\n                        <span class="percentage">${s}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Stock Alerts Section --\x3e\n        ${n.stockAlerts&&n.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">âš ï¸</span>\n            ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ØµÙ†Ù</th>\n                    <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>\n                    <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                    <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.stockAlerts.slice(0,20).map(n=>{const t=0===n.quantity?"critical":"warning",e=n.minimum_stock>0?Math.min(100,Math.round(n.quantity/n.minimum_stock*100)):0;return`\n                    <tr>\n                      <td class="item-name">${n.name}</td>\n                      <td class="quantity-cell ${t}">${n.quantity.toLocaleString()}</td>\n                      <td class="minimum-cell">${n.minimum_stock||0}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${t}">\n                          ${0===n.quantity?"Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":"Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶"}\n                        </span>\n                      </td>\n                      <td class="alert-level">\n                        ${0===n.quantity?"ğŸ”´ Ø¹Ø§Ø¬Ù„":"ğŸŸ¡ ØªØ­Ø°ÙŠØ±"}\n                      </td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill ${t}" style="width: ${e}%"></div>\n                        </div>\n                        <span class="percentage">${e}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.stockAlerts.length>20?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 20 ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.stockAlerts.length.toLocaleString()} ØªÙ†Ø¨ÙŠÙ‡</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Expiry Alerts Section --\x3e\n        ${n.expiryAlerts&&n.expiryAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">â°</span>\n            ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ØµÙ†Ù</th>\n                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>\n                    <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>\n                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.expiryAlerts.slice(0,15).map(n=>{const t=new Date(n.expiry_date),e=new Date,a=Math.ceil((t.getTime()-e.getTime())/864e5),i=a<0,s=a<=30&&a>=0;return`\n                    <tr>\n                      <td class="item-name">${n.name}</td>\n                      <td class="date-cell">${t.toLocaleDateString("ar-SA")}</td>\n                      <td class="days-cell ${i?"expired":s?"expiring":"safe"}">\n                        ${i?"Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©":`${a} ÙŠÙˆÙ…`}\n                      </td>\n                      <td class="quantity-cell">${n.quantity.toLocaleString()}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${i?"critical":s?"warning":"safe"}">\n                          ${i?"Ù…Ù†ØªÙ‡ÙŠ":s?"ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹":"Ø¢Ù…Ù†"}\n                        </span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.expiryAlerts.length>15?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 15 ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.expiryAlerts.length.toLocaleString()} ØªÙ†Ø¨ÙŠÙ‡</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${n.filterInfo?`<p class="filter-info">ğŸ“Š ${n.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ“¦ ${n.totalItems?.toLocaleString()||"0"} ØµÙ†Ù</span>\n                <span class="stat-item">ğŸ’° ${(()=>{const e=a(n.totalValue||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()} Ù‚ÙŠÙ…Ø©</span>\n                <span class="stat-item">âš ï¸ ${n.lowStockItems?.toLocaleString()||"0"} Ù…Ù†Ø®ÙØ¶</span>\n                <span class="stat-item">ğŸ“Š ${n.dataCount?.toLocaleString()||"0"} Ù…ÙÙ„ØªØ±</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedTreatmentReportHTML(n,t){const s=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø³Ù†ÙŠØ©",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"),r=b.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${r}\n      </head>\n      <body>\n        ${s}\n\n        \x3c!-- Summary Statistics --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“Š</span>\n            Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª\n          </div>\n          <div class="section-content">\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${n.totalTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${n.completedTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${n.plannedTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø©</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${n.inProgressTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>\n              </div>\n            </div>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${(()=>{const e=a(n.totalRevenue||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</div>\n                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${(()=>{const e=a(n.averageTreatmentCost||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</div>\n                <div class="stat-label">Ù…ØªÙˆØ³Ø· ØªÙƒÙ„ÙØ© Ø§Ù„Ø¹Ù„Ø§Ø¬</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${n.completionRate||"0"}%</div>\n                <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${n.cancelledTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Treatment Status Distribution --\x3e\n        ${n.treatmentsByStatus&&n.treatmentsByStatus.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“ˆ</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.treatmentsByStatus.map(n=>{const t=Math.max(5,n.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${n.status}</td>\n                        <td class="number-cell">${n.count?.toLocaleString()||"0"}</td>\n                        <td class="percentage-cell">${n.percentage?.toFixed(1)||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${t}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Treatment Types Distribution --\x3e\n        ${n.treatmentsByType&&n.treatmentsByType.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ¦·</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.treatmentsByType.slice(0,15).map(n=>{const t=Math.max(5,n.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${n.type}</td>\n                        <td class="number-cell">${n.count?.toLocaleString()||"0"}</td>\n                        <td class="percentage-cell">${n.percentage?.toFixed(1)||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${t}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Revenue by Category --\x3e\n        ${n.revenueByCategory&&n.revenueByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ’°</span>\n            Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ ÙØ¦Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>ÙØ¦Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬</th>\n                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</th>\n                    <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.revenueByCategory.slice(0,10).map(n=>{const e=n.count>0?n.revenue/n.count:0;return`\n                      <tr>\n                        <td class="category-cell">${n.category}</td>\n                        <td class="number-cell">${(()=>{const e=a(n.revenue||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</td>\n                        <td class="number-cell">${n.count?.toLocaleString()||"0"}</td>\n                        <td class="number-cell">${(()=>{const n=a(e,"USD",t?.currency||"USD");return i(n,t?.currency||"USD")})()}</td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Pending Treatments --\x3e\n        ${n.pendingTreatments&&n.pendingTreatments.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">â³</span>\n            Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© (${n.pendingTreatments.length})\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬</th>\n                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>\n                    <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.pendingTreatments.slice(0,20).map(n=>`\n                    <tr>\n                      <td class="category-cell">${e(n.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯")}</td>\n                      <td class="patient-cell">${n.patient?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                      <td class="status-cell">\n                        <span class="status-badge warning">${n.treatment_status||"Ø¢Ø¬Ù„"}</span>\n                      </td>\n                      <td class="date-cell">${n.created_at?(()=>{const t=new Date(n.created_at);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                      <td class="number-cell">${(()=>{const e=a(n.cost||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")})()}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.pendingTreatments.length>20?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 20 Ø¹Ù„Ø§Ø¬ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.pendingTreatments.length.toLocaleString()} Ø¹Ù„Ø§Ø¬ Ø¢Ø¬Ù„</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${t?.clinic_address?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${t?.clinic_phone?`<p class="clinic-phone">ğŸ“ ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}static createEnhancedProfitLossReportHTML(n,t){const{reportData:e,payments:a,labOrders:i,clinicNeeds:s,inventoryItems:r,clinicExpenses:o,patients:d,appointments:l,filter:c,currency:p}=n,h=b.getEnhancedHeader("Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±",t,"ØªØ­Ù„ÙŠÙ„ Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ ÙŠØ±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"),m=b.getEnhancedStyles(),g=n=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:p||"SAR",minimumFractionDigits:2}).format(n||0),v=n=>{try{const t=new Date(n);return isNaN(t.getTime())?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":t.toLocaleDateString("en-GB")}catch{return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${m}\n        <style>\n          .profit-loss-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin: 20px 0;\n          }\n          .profit-card {\n            background: linear-gradient(135deg, #10b981, #059669);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .loss-card {\n            background: linear-gradient(135deg, #ef4444, #dc2626);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .financial-breakdown {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 30px 0;\n          }\n          .revenue-section, .expenses-section {\n            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 10px;\n            border: 2px solid #1a365d;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .revenue-section h3 {\n            color: #059669;\n            border-bottom: 2px solid #10b981;\n            padding-bottom: 10px;\n          }\n          .expenses-section h3 {\n            color: #dc2626;\n            border-bottom: 2px solid #ef4444;\n            padding-bottom: 10px;\n          }\n          .breakdown-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px 0;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          .breakdown-item:last-child {\n            border-bottom: none;\n            font-weight: bold;\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            padding: 12px;\n            margin-top: 10px;\n            border-radius: 5px;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            font-size: 12px;\n          }\n          .details-table th,\n          .details-table td {\n            border: 1px solid #e2e8f0;\n            padding: 8px;\n            text-align: right;\n          }\n          .details-table th {\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            font-weight: bold;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table tr:nth-child(even) {\n            background: #f8fafc;\n          }\n          .statistics-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 15px;\n            margin: 20px 0;\n          }\n          .stat-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            border: 2px solid #1a365d;\n            border-radius: 8px;\n            padding: 15px;\n            text-align: center;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .stat-number {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e40af;\n          }\n          .stat-label {\n            font-size: 12px;\n            color: #64748b;\n            margin-top: 5px;\n          }\n        </style>\n      </head>\n      <body>\n        ${h}\n\n        \x3c!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© --\x3e\n        <div class="profit-loss-summary">\n          <div class="${e.calculations.isProfit?"profit-card":"loss-card"}">\n            <h2>${e.calculations.isProfit?"ğŸ‰ Ø±Ø¨Ø­":"âš ï¸ Ø®Ø³Ø§Ø±Ø©"}</h2>\n            <div class="number" style="font-size: 28px; margin: 10px 0;">\n              ${g(e.calculations.isProfit?e.calculations.netProfit:e.calculations.lossAmount)}\n            </div>\n            <p>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­: ${e.calculations.profitMargin.toFixed(2)}%</p>\n          </div>\n          <div class="summary-card info">\n            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>\n            <p><strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</strong> ${e.filterInfo.dateRange}</p>\n            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:</strong> ${e.filterInfo.totalRecords}</p>\n            <p><strong>Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©:</strong> ${e.filterInfo.filteredRecords}</p>\n            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${v((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        \x3c!-- ØªÙØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª --\x3e\n        <div class="financial-breakdown">\n          <div class="revenue-section">\n            <h3>ğŸ“ˆ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n            <div class="breakdown-item">\n              <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>\n              <span>${g(e.revenue.completedPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©:</span>\n              <span>${g(e.revenue.partialPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¢Ø¬Ù„Ø© (ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©):</span>\n              <span>${g(e.revenue.pendingAmount||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</span>\n              <span>${g(e.revenue.remainingBalances)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</span>\n              <span>${g(e.revenue.totalRevenue)}</span>\n            </div>\n          </div>\n\n          <div class="expenses-section">\n            <h3>ğŸ“‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>\n            <div class="breakdown-item">\n              <span>Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±:</span>\n              <span>${g(e.expenses.labOrdersTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…Ø®Ø§Ø¨Ø±:</span>\n              <span>${g(e.expenses.labOrdersRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</span>\n              <span>${g(e.expenses.clinicNeedsTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª:</span>\n              <span>${g(e.expenses.clinicNeedsRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:</span>\n              <span>${g(e.expenses.inventoryExpenses)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:</span>\n              <span>${g(e.expenses.clinicExpensesTotal||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</span>\n              <span>${g(e.calculations.totalExpenses)}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© --\x3e\n        <div class="statistics-grid">\n          <div class="stat-card">\n            <div class="stat-number">${e.details.totalPatients}</div>\n            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${e.details.totalAppointments}</div>\n            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${e.details.totalLabOrders}</div>\n            <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${e.details.totalClinicNeeds}</div>\n            <div class="stat-label">Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</div>\n          </div>\n        </div>\n\n        \x3c!-- Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª --\x3e\n        <div class="section">\n          <h3>ğŸ“Š Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">\n            <div class="summary-card">\n              <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶</h4>\n              <div class="number">${g(e.details.averageRevenuePerPatient)}</div>\n            </div>\n            <div class="summary-card">\n              <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù…ÙˆØ¹Ø¯</h4>\n              <div class="number">${g(e.details.averageRevenuePerAppointment)}</div>\n            </div>\n          </div>\n        </div>\n\n        ${a&&a.length>0?`\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª --\x3e\n        <div class="section">\n          <h3>ğŸ’° ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Ø£Ø­Ø¯Ø« 20 Ø¯ÙØ¹Ø©)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${a.slice(0,20).map(n=>{const t=n.amount||0;let e=0,a=0;if("partial"===n.status){e=n.total_amount_due||n.treatment_total_cost||0;const i=n.amount_paid||n.treatment_total_paid||t;a=Math.max(0,e-i)}else"pending"===n.status?(e=n.total_amount_due||n.treatment_total_cost||t,a=e):(e=t,a=0);return`\n                <tr>\n                  <td>${n.patient_name||""}</td>\n                  <td>${g(t)}</td>\n                  <td>${g(e)}</td>\n                  <td>${g(a)}</td>\n                  <td>${"completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"partial"===n.status?"Ø¬Ø²Ø¦ÙŠ":"Ø¢Ø¬Ù„"}</td>\n                  <td>${n.payment_method||""}</td>\n                  <td>${n.payment_date?v(n.payment_date):""}</td>\n                </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ© --\x3e\n          <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); border: 2px solid #1a365d; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">\n            <h4>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</h4>\n            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">\n              <div>\n                <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©:</strong><br>\n                ${g(a.filter(n=>"pending"===n.status).reduce((n,t)=>n+(t.total_amount_due||t.treatment_total_cost||0),0))}\n              </div>\n              <div>\n                <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©:</strong><br>\n                ${g(a.filter(n=>"partial"===n.status).reduce((n,t)=>{const e=t.total_amount_due||t.treatment_total_cost||0,a=t.amount_paid||t.treatment_total_paid||t.amount||0;return n+Math.max(0,e-a)},0))}\n              </div>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${i&&i.length>0?`\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø± --\x3e\n        <div class="section">\n          <h3>ğŸ”¬ ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø± (Ø£Ø­Ø¯Ø« 15 Ø·Ù„Ø¨)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>\n                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø±</th>\n                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>\n                <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>\n                <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>\n                <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${i.slice(0,15).map((n,t)=>{const e="completed"===n.status?"status-success":"pending"===n.status?"status-warning":"status-danger",a="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"pending"===n.status?"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±":"Ù…Ù„ØºÙŠ";return`\n                  <tr>\n                    <td>#${n.id||(t+1).toString().padStart(3,"0")}</td>\n                    <td>${n.lab?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                    <td>${n.patient?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                    <td>${v(n.order_date)}</td>\n                    <td>${n.delivery_date?v(n.delivery_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                    <td>${g(n.cost||0)}</td>\n                    <td>${g(n.paid_amount||0)}</td>\n                    <td>${g((n.cost||0)-(n.paid_amount||0))}</td>\n                    <td><span class="status-badge ${e}">${a}</span></td>\n                  </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${s&&s.length>0?`\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© --\x3e\n        <div class="section">\n          <h3>ğŸ¥ ØªÙØ§ØµÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ø£Ø­Ø¯Ø« 15 Ø§Ø­ØªÙŠØ§Ø¬)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø¬Ø©</th>\n                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>\n                <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>\n                <th>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${s.slice(0,15).map((n,t)=>{const e="received"===n.status?"status-success":"ordered"===n.status?"status-info":"status-warning",a="received"===n.status?"Ù…Ø³ØªÙ„Ù…Ø©":"ordered"===n.status?"Ù…Ø·Ù„ÙˆØ¨Ø©":"Ø¢Ø¬Ù„Ø©",i="urgent"===n.priority?"Ø¹Ø§Ø¬Ù„":"high"===n.priority?"Ø¹Ø§Ù„ÙŠ":"medium"===n.priority?"Ù…ØªÙˆØ³Ø·":"Ù…Ù†Ø®ÙØ¶";return`\n                  <tr>\n                    <td>${n.need_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                    <td>${n.quantity.toLocaleString()}</td>\n                    <td>${g(n.price||0)}</td>\n                    <td>${g((n.quantity||0)*(n.price||0))}</td>\n                    <td>${i}</td>\n                    <td><span class="status-badge ${e}">${a}</span></td>\n                    <td>${v(n.created_at)}</td>\n                  </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© --\x3e\n          <div style="margin-top: 15px; padding: 10px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); border-radius: 5px;">\n            <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${g(s.reduce((n,t)=>n+(t.quantity||0)*(t.price||0),0))}</strong>\n          </div>\n        </div>\n        `:""}\n\n        ${o&&o.length>0?`\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© --\x3e\n        <div class="section">\n          <h3>ğŸ’¸ ØªÙØ§ØµÙŠÙ„ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ø£Ø­Ø¯Ø« 15 Ù…ØµØ±ÙˆÙ)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</th>\n                <th>Ø§Ù„Ù†ÙˆØ¹</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>\n                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${o.slice(0,15).map(n=>`\n                <tr>\n                  <td>${n.expense_name||""}</td>\n                  <td>${n.expense_type||""}</td>\n                  <td>${g(n.amount||0)}</td>\n                  <td>${v(n.payment_date)}</td>\n                  <td>${n.payment_method||""}</td>\n                  <td>${n.vendor||""}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- Footer --\x3e\n        <div class="footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="report-date">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${v((new Date).toISOString())}</p>\n              <p class="report-time">ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${(new Date).toLocaleTimeString("ar-SA")}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${t?.clinic_address?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${t?.clinic_phone?`<p class="clinic-phone">ğŸ“ ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}static createEnhancedLabReportHTML(n,t){const e=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª ÙˆØ­Ø§Ù„ØªÙ‡Ø§"),s=b.getEnhancedStyles(),r=n=>{const e=a(n||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")},o=n=>{try{const t=new Date(n);return isNaN(t.getTime())?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":t.toLocaleDateString("ar-SA")}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${s}\n      </head>\n      <body>\n        ${e}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ”¬</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</h3>\n              <div class="number">${n.totalOrders.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ…</div>\n            <div class="card-content">\n              <h3>Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</h3>\n              <div class="number">${n.completedOrders.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">â³</div>\n            <div class="card-content">\n              <h3>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>\n              <div class="number warning">${n.pendingOrders.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">âŒ</div>\n            <div class="card-content">\n              <h3>Ø·Ù„Ø¨Ø§Øª Ù…Ù„ØºÙŠØ©</h3>\n              <div class="number danger">${n.cancelledOrders.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ’°</div>\n            <div class="card-content">\n              <h3>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>\n              <div class="number">${r(n.totalCost)}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ’¸</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h3>\n              <div class="number">${r(n.totalRemaining)}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Lab Orders List Section --\x3e\n        ${n.labOrdersList&&n.labOrdersList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª\n          </div>\n          <div class="section-content">\n            <div class="data-table-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>\n                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø±</th>\n                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>\n                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>\n                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>\n                    <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>\n                    <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>\n                    <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.labOrdersList.slice(0,50).map((n,t)=>{const e="completed"===n.status?"status-success":"pending"===n.status?"status-warning":"status-danger",a="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"pending"===n.status?"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±":"Ù…Ù„ØºÙŠ";return`\n                      <tr>\n                        <td>#${n.id||(t+1).toString().padStart(3,"0")}</td>\n                        <td>${n.lab?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                        <td>${n.patient?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                        <td>${o(n.order_date)}</td>\n                        <td>${n.expected_delivery_date?o(n.expected_delivery_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                        <td>${r(n.cost||0)}</td>\n                        <td>${r(n.paid_amount||0)}</td>\n                        <td>${r((n.cost||0)-(n.paid_amount||0))}</td>\n                        <td><span class="status-badge ${e}">${a}</span></td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.labOrdersList.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ø·Ù„Ø¨ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.labOrdersList.length.toLocaleString()} Ø·Ù„Ø¨</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${n.filterInfo?`<p class="filter-info">ğŸ“Š ${n.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ”¬ ${n.totalOrders?.toLocaleString()||"0"} Ø·Ù„Ø¨</span>\n                <span class="stat-item">âœ… ${n.completedOrders?.toLocaleString()||"0"} Ù…ÙƒØªÙ…Ù„</span>\n                <span class="stat-item">â³ ${n.pendingOrders?.toLocaleString()||"0"} Ø¨Ø§Ù†ØªØ¸Ø§Ø±</span>\n                <span class="stat-item">ğŸ’° ${r(n.totalCost)} Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedClinicNeedsReportHTML(n,t){const e=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ÙˆØ­Ø§Ù„ØªÙ‡Ø§"),s=b.getEnhancedStyles(),r=n=>{const e=a(n||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${s}\n      </head>\n      <body>\n        ${e}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ¥</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</h3>\n              <div class="number">${n.totalNeeds.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ…</div>\n            <div class="card-content">\n              <h3>Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…Ø³ØªÙ„Ù…Ø©</h3>\n              <div class="number">${n.receivedCount.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">ğŸ“¦</div>\n            <div class="card-content">\n              <h3>Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©</h3>\n              <div class="number warning">${n.orderedCount.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">â³</div>\n            <div class="card-content">\n              <h3>Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø¢Ø¬Ù„Ø©</h3>\n              <div class="number danger">${n.pendingCount.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ’°</div>\n            <div class="card-content">\n              <h3>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>\n              <div class="number">${r(n.totalCost)}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ’¸</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h3>\n              <div class="number">${r(n.totalRemaining)}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Clinic Needs List Section --\x3e\n        ${n.clinicNeedsList&&n.clinicNeedsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©\n          </div>\n          <div class="section-content">\n            <div class="data-table-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø¬Ø©</th>\n                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>\n                    <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>\n                    <th>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.clinicNeedsList.slice(0,50).map((n,t)=>{const e="received"===n.status?"status-success":"ordered"===n.status?"status-info":"status-warning",a="received"===n.status?"Ù…Ø³ØªÙ„Ù…Ø©":"ordered"===n.status?"Ù…Ø·Ù„ÙˆØ¨Ø©":"Ø¢Ø¬Ù„Ø©",i="urgent"===n.priority?"Ø¹Ø§Ø¬Ù„":"high"===n.priority?"Ø¹Ø§Ù„ÙŠ":"medium"===n.priority?"Ù…ØªÙˆØ³Ø·":"Ù…Ù†Ø®ÙØ¶";return`\n                      <tr>\n                        <td>${n.need_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                        <td>${n.quantity.toLocaleString()}</td>\n                        <td>${r(n.price||0)}</td>\n                        <td>${r((n.quantity||0)*(n.price||0))}</td>\n                        <td>${i}</td>\n                        <td><span class="status-badge ${e}">${a}</span></td>\n                        <td>${(n=>{try{const t=new Date(n);return isNaN(t.getTime())?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":t.toLocaleDateString("ar-SA")}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}})(n.created_at)}</td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.clinicNeedsList.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ø­Ø§Ø¬Ø© Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.clinicNeedsList.length.toLocaleString()} Ø­Ø§Ø¬Ø©</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${n.filterInfo?`<p class="filter-info">ğŸ“Š ${n.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ¥ ${n.totalNeeds?.toLocaleString()||"0"} Ø­Ø§Ø¬Ø©</span>\n                <span class="stat-item">âœ… ${n.receivedCount?.toLocaleString()||"0"} Ù…Ø³ØªÙ„Ù…Ø©</span>\n                <span class="stat-item">â³ ${n.pendingCount?.toLocaleString()||"0"} Ø¢Ø¬Ù„Ø©</span>\n                <span class="stat-item">ğŸ’° ${r(n.totalCost)} Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedExpenseReportHTML(n,t){const e=b.getEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"),s=b.getEnhancedStyles(),r=n=>{const e=a(n||0,"USD",t?.currency||"USD");return i(e,t?.currency||"USD")};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${s}\n      </head>\n      <body>\n        ${e}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ’¸</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>\n              <div class="number">${r(n.totalExpenses)}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ…</div>\n            <div class="card-content">\n              <h3>Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¯ÙÙˆØ¹Ø©</h3>\n              <div class="number">${n.paidExpenses.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">â³</div>\n            <div class="card-content">\n              <h3>Ù…ØµØ±ÙˆÙØ§Øª Ø¢Ø¬Ù„Ø©</h3>\n              <div class="number warning">${n.pendingExpenses.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ“Š</div>\n            <div class="card-content">\n              <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>\n              <div class="number">${n.dataCount.toLocaleString()}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Expense List Section --\x3e\n        ${n.expensesList&&n.expensesList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª\n          </div>\n          <div class="section-content">\n            <div class="data-table-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</th>\n                    <th>Ø§Ù„Ù†ÙˆØ¹</th>\n                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>\n                    <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                    <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.expensesList.slice(0,50).map((n,t)=>`\n                    <tr>\n                      <td>${n.expense_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                      <td>${n.expense_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                      <td>${r(n.amount||0)}</td>\n                      <td>${(n=>{try{const t=new Date(n);return isNaN(t.getTime())?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":t.toLocaleDateString("ar-SA")}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}})(n.payment_date)}</td>\n                      <td>${n.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                      <td>${n.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${n.expensesList.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ù…ØµØ±ÙˆÙ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.expensesList.length.toLocaleString()} Ù…ØµØ±ÙˆÙ</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n              ${n.filterInfo?`<p class="filter-info">ğŸ“Š ${n.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ’¸ ${r(n.totalExpenses)} Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>\n                <span class="stat-item">âœ… ${n.paidExpenses?.toLocaleString()||"0"} Ù…Ø¯ÙÙˆØ¹</span>\n                <span class="stat-item">â³ ${n.pendingExpenses?.toLocaleString()||"0"} Ø¢Ø¬Ù„</span>\n                <span class="stat-item">ğŸ“Š ${n.dataCount?.toLocaleString()||"0"} Ù…ØµØ±ÙˆÙ</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static async exportClinicNeedsReport(n,t,e){if(!n||0===n.totalNeeds)return void window.api.sendNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.","error");const a=this.createEnhancedClinicNeedsReportHTML(n,t),i=`ClinicNeedsReport-${(new Date).toLocaleDateString("en-CA")}.pdf`,s=e?.fileName||i;try{await window.api.exportPdf({html:a,fileName:s}),window.api.sendNotification("ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­","success")}catch(r){console.error("Failed to export clinic needs report:",r),window.api.sendNotification("ÙØ´Ù„ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©.","error")}}}class g{worker=null;callbacks=new Map;constructor(){this.initializeWorker()}initializeWorker(){if("undefined"!=typeof Worker)try{const n=new Blob(["\n        // PDF Processing Worker\n        class PDFWorkerProcessor {\n          static async processHTML(data) {\n            try {\n              // Import html2canvas dynamically\n              const html2canvas = await import('https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js')\n\n              // Create temporary element\n              const tempDiv = document.createElement('div')\n              tempDiv.innerHTML = data.htmlContent\n              tempDiv.style.position = 'absolute'\n              tempDiv.style.left = '-9999px'\n              tempDiv.style.top = '-9999px'\n              tempDiv.style.width = '800px'\n\n              document.body.appendChild(tempDiv)\n\n              // Process in chunks if content is large\n              const canvas = await html2canvas.default(tempDiv, {\n                scale: data.scale || 1.5,\n                useCORS: true,\n                allowTaint: true,\n                backgroundColor: '#ffffff',\n                width: 800,\n                height: tempDiv.scrollHeight,\n              })\n\n              document.body.removeChild(tempDiv)\n\n              return {\n                canvasData: canvas.toDataURL('image/jpeg', 0.8),\n                width: canvas.width,\n                height: canvas.height\n              }\n            } catch (error) {\n              throw new Error('Failed to process HTML: ' + error.message)\n            }\n          }\n\n          static async generatePDF(data) {\n            try {\n              // Import jsPDF dynamically\n              const jsPDF = await import('https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js')\n\n              const pdf = new jsPDF.default({\n                orientation: 'portrait',\n                unit: 'mm',\n                format: 'a4'\n              })\n\n              const pdfWidth = pdf.internal.pageSize.getWidth()\n              const pdfHeight = pdf.internal.pageSize.getHeight()\n              const imgWidth = pdfWidth - 20\n              const imgHeight = (data.height * imgWidth) / data.width\n\n              let heightLeft = imgHeight\n              let position = 10\n\n              // Add first page\n              pdf.addImage(data.canvasData, 'JPEG', 10, position, imgWidth, imgHeight)\n              heightLeft -= (pdfHeight - 20)\n\n              // Add additional pages\n              while (heightLeft >= 0) {\n                position = heightLeft - imgHeight + 10\n                pdf.addPage()\n                pdf.addImage(data.canvasData, 'JPEG', 10, position, imgWidth, imgHeight)\n                heightLeft -= (pdfHeight - 20)\n              }\n\n              return {\n                pdfData: pdf.output('blob'),\n                filename: data.filename\n              }\n            } catch (error) {\n              throw new Error('Failed to generate PDF: ' + error.message)\n            }\n          }\n        }\n\n        // Worker message handler\n        self.onmessage = async function(e) {\n          const { type, data, id } = e.data\n\n          try {\n            let result\n\n            switch (type) {\n              case 'PROCESS_HTML':\n                result = await PDFWorkerProcessor.processHTML(data)\n                break\n              case 'GENERATE_PDF':\n                result = await PDFWorkerProcessor.generatePDF(data)\n                break\n              default:\n                throw new Error('Unknown worker message type: ' + type)\n            }\n\n            self.postMessage({\n              type: type.replace('PROCESS_', 'PROCESSED_').replace('GENERATE_', 'GENERATED_'),\n              data: result,\n              id\n            })\n          } catch (error) {\n            self.postMessage({\n              type: 'ERROR',\n              error: error.message,\n              id\n            })\n          }\n        }\n      "],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n)),this.worker.onmessage=n=>{const{type:t,data:e,id:a,error:i}=n.data,s=this.callbacks.get(a);s&&(s("ERROR"===t?{error:i}:{result:e}),this.callbacks.delete(a))},this.worker.onerror=n=>{console.error("PDF Worker error:",n)}}catch(n){console.error("Failed to initialize PDF worker:",n)}else console.warn("Web Workers not supported in this environment")}async processHTML(n,t=1.5){if(!this.worker)throw new Error("Web Worker not available");const e=Math.random().toString(36).substr(2,9);return new Promise((a,i)=>{this.callbacks.set(e,({result:n,error:t})=>{t?i(new Error(t)):a(n)}),this.worker.postMessage({type:"PROCESS_HTML",data:{htmlContent:n,scale:t},id:e}),setTimeout(()=>{this.callbacks.delete(e),i(new Error("PDF processing timeout"))},3e4)})}async generatePDF(n,t,e,a){if(!this.worker)throw new Error("Web Worker not available");const i=Math.random().toString(36).substr(2,9);return new Promise((s,r)=>{this.callbacks.set(i,({result:n,error:t})=>{t?r(new Error(t)):s(n)}),this.worker.postMessage({type:"GENERATE_PDF",data:{canvasData:n,width:t,height:e,filename:a},id:i}),setTimeout(()=>{this.callbacks.delete(i),r(new Error("PDF generation timeout"))},3e4)})}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.callbacks.clear()}}let v=null;class b{static COLORS={primary:"#1e40af",secondary:"#3b82f6",accent:"#f59e0b",success:"#059669",warning:"#d97706",danger:"#dc2626",info:"#0891b2",muted:"#6b7280",light:"#f8fafc",white:"#ffffff",border:"#e5e7eb",surface:"#f1f5f9",shadow:"rgba(0,0,0,0.08)",text:{primary:"#0f172a",secondary:"#475569",muted:"#64748b",accent:"#1e40af"},gradients:{primary:"linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)",success:"linear-gradient(135deg, #059669 0%, #10b981 100%)",accent:"linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)",card:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",header:"linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)"}};static TYPOGRAPHY={fonts:{primary:"'Tajawal', 'Cairo', 'Segoe UI', system-ui, sans-serif",secondary:"'Tajawal', 'Cairo', 'Segoe UI', system-ui, sans-serif",heading:"'Tajawal', 'Cairo', 'Segoe UI', system-ui, sans-serif",monospace:"'JetBrains Mono', 'Fira Code', 'Courier New', monospace"},sizes:{h1:"32px",h2:"26px",h3:"22px",h4:"20px",h5:"18px",h6:"16px",body:"15px",small:"13px",tiny:"11px",micro:"9px"},weights:{light:"300",normal:"400",medium:"500",semibold:"600",bold:"700",extrabold:"800"},lineHeights:{tight:"1.25",normal:"1.5",relaxed:"1.75",loose:"2"},letterSpacing:{tight:"-0.025em",normal:"0",wide:"0.025em"}};static LAYOUT={margins:{top:"50px",bottom:"50px",left:"35px",right:"35px"},spacing:{section:"40px",subsection:"25px",card:"24px",element:"18px",small:"12px",tiny:"8px"},borderRadius:{small:"6px",medium:"10px",large:"16px",xl:"20px"},shadows:{card:"0 6px 24px rgba(0,0,0,0.06), 0 2px 8px rgba(0,0,0,0.04)",header:"0 4px 16px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.06)",elevation:"0 12px 32px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.06)",inset:"inset 0 2px 4px rgba(0,0,0,0.06)"},borderWidth:{thin:"1px",medium:"2px",thick:"3px"}};static getEnhancedHeader(n,t,e){return this.createEnhancedHeader(n,t,e)}static getEnhancedStyles(){return this.createEnhancedStyles()}static createEnhancedHeader(n,t,e){const a="Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"+(t?.clinic_name&&""!==t.clinic_name.trim()?" - "+t.clinic_name:""),i=t?.doctor_name||"Ø¯. Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯",s=t?.clinic_address||"",r=t?.clinic_phone||"",o=t?.clinic_logo||"";return(()=>{const n=new Date;n.getDate().toString().padStart(2,"0"),(n.getMonth()+1).toString().padStart(2,"0"),n.getFullYear()})(),`\n      <div class="enhanced-header">\n        <div class="header-content">\n          <div class="clinic-info">\n            ${o&&""!==o.trim()?`\n              <div class="clinic-logo">\n                <img src="${o}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" />\n              </div>\n            `:""}\n            <div class="clinic-details">\n              <h1 class="clinic-name">${a}</h1>\n              ${i?`<h2 class="doctor-name">${i}</h2>`:""}\n              ${s?`<p class="clinic-address">${s}</p>`:""}\n              ${r?`<p class="clinic-phone">ğŸ“ ${r}</p>`:""}\n            </div>\n          </div>\n\n          <div class="report-info">\n            <h3 class="report-title">${n}</h3>\n            ${e?`<p class="report-subtitle">${e}</p>`:""}\n            <p class="report-date">ğŸ“… ${this.formatGregorianDate(new Date)}</p>\n            <p class="report-time">ğŸ• ${(new Date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}</p>\n          </div>\n        </div>\n\n        <div class="header-decoration"></div>\n      </div>\n    `}static createEnhancedStyles(){return`\n      <style>\n        @import url('/fonts/Tajawal-Regular.ttf');\n        @import url('/fonts/Tajawal-Bold.ttf');\n        @import url('/fonts/Tajawal-Medium.ttf');\n\n        * {\n          box-sizing: border-box;\n          margin: 0;\n          padding: 0;\n        }\n\n        body {\n           font-family: ${this.TYPOGRAPHY.fonts.primary};\n           direction: rtl;\n           line-height: ${this.TYPOGRAPHY.lineHeights.normal};\n           color: ${this.COLORS.text.primary};\n           background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n           margin: ${this.LAYOUT.margins.top} ${this.LAYOUT.margins.right} ${this.LAYOUT.margins.bottom} ${this.LAYOUT.margins.left};\n           font-size: ${this.TYPOGRAPHY.sizes.body};\n           font-weight: ${this.TYPOGRAPHY.weights.normal};\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.normal};\n           -webkit-font-smoothing: antialiased;\n           -moz-osx-font-smoothing: grayscale;\n        }\n\n        /* Enhanced Header Styles */\n        .enhanced-header {\n           background: ${this.COLORS.gradients.header};\n           color: ${this.COLORS.white};\n           padding: ${this.LAYOUT.spacing.card} ${this.LAYOUT.spacing.element};\n           border-radius: ${this.LAYOUT.borderRadius.large};\n           margin-bottom: ${this.LAYOUT.spacing.section};\n           box-shadow: ${this.LAYOUT.shadows.header};\n           position: relative;\n           overflow: hidden;\n           border: ${this.LAYOUT.borderWidth.thin} solid rgba(255,255,255,0.1);\n        }\n\n        .header-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          position: relative;\n          z-index: 2;\n        }\n\n        .clinic-info {\n          display: flex;\n          align-items: center;\n          gap: ${this.LAYOUT.spacing.element};\n        }\n\n        .clinic-logo {\n          width: 70px;\n          height: 70px;\n          border-radius: 50%;\n          overflow: hidden;\n          background: ${this.COLORS.white};\n          padding: 4px;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.15);\n          border: 2px solid rgba(255,255,255,0.8);\n          flex-shrink: 0;\n        }\n\n        .clinic-logo img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 50%;\n          max-width: 70px;\n          max-height: 70px;\n        }\n\n        .clinic-details h1.clinic-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 5px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .clinic-details h2.doctor-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          margin-bottom: 8px;\n          opacity: 0.95;\n        }\n\n        .clinic-details p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .report-info {\n          text-align: left;\n          direction: ltr;\n        }\n\n        .report-info h3.report-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h3};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 8px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .report-info p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .header-decoration {\n          position: absolute;\n          top: -50%;\n          right: -10%;\n          width: 200px;\n          height: 200px;\n          background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n          border-radius: 50%;\n        }\n\n        /* Enhanced Card Styles */\n        .summary-cards {\n           display: grid;\n           grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n           gap: ${this.LAYOUT.spacing.element};\n           margin: ${this.LAYOUT.spacing.section} 0;\n        }\n\n        .summary-card {\n           background: ${this.COLORS.gradients.card};\n           border: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.border};\n           border-radius: ${this.LAYOUT.borderRadius.medium};\n           padding: ${this.LAYOUT.spacing.card};\n           box-shadow: ${this.LAYOUT.shadows.card};\n           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n           position: relative;\n           overflow: hidden;\n           display: flex;\n           align-items: center;\n           gap: ${this.LAYOUT.spacing.element};\n           backdrop-filter: blur(10px);\n           border-bottom: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.primary};\n        }\n\n        .summary-card.primary::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.primary};\n        }\n\n        .summary-card.success::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.success};\n        }\n\n        .summary-card.info::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: #1e40af;\n        }\n\n        .summary-card.warning::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.warning};\n        }\n\n        .card-icon {\n           font-size: 36px;\n           min-width: 60px;\n           height: 60px;\n           display: flex;\n           align-items: center;\n           justify-content: center;\n           background: linear-gradient(135deg, ${this.COLORS.white} 0%, ${this.COLORS.surface} 100%);\n           border-radius: ${this.LAYOUT.borderRadius.large};\n           flex-shrink: 0;\n           box-shadow: ${this.LAYOUT.shadows.inset};\n           border: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.border};\n           position: relative;\n           overflow: hidden;\n        }\n\n        .card-icon::before {\n           content: '';\n           position: absolute;\n           top: -50%;\n           left: -50%;\n           width: 200%;\n           height: 200%;\n           background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);\n           animation: pulse 3s ease-in-out infinite;\n        }\n\n        @keyframes pulse {\n           0%, 100% { transform: scale(1); opacity: 0.7; }\n           50% { transform: scale(1.1); opacity: 1; }\n        }\n\n        .card-content {\n          flex: 1;\n          text-align: right;\n        }\n\n        .summary-card h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: ${this.LAYOUT.spacing.small};\n        }\n\n        .summary-card .number {\n           font-size: ${this.TYPOGRAPHY.sizes.h1};\n           font-weight: ${this.TYPOGRAPHY.weights.extrabold};\n           color: ${this.COLORS.primary};\n           margin-bottom: ${this.LAYOUT.spacing.tiny};\n           text-shadow: 0 2px 4px rgba(0,0,0,0.1);\n           font-family: ${this.TYPOGRAPHY.fonts.monospace};\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.tight};\n           position: relative;\n        }\n\n        .summary-card .number::after {\n           content: '';\n           position: absolute;\n           bottom: -2px;\n           left: 0;\n           right: 0;\n           height: 3px;\n           background: linear-gradient(90deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n           border-radius: ${this.LAYOUT.borderRadius.small};\n        }\n\n        .summary-card .currency {\n          color: ${this.COLORS.success};\n        }\n\n        .summary-card .warning {\n          color: ${this.COLORS.warning};\n        }\n\n        .summary-card .danger {\n          color: ${this.COLORS.danger};\n        }\n\n        /* Enhanced Section Styles */\n        .section {\n           margin: ${this.LAYOUT.spacing.section} 0;\n           background: ${this.COLORS.white};\n           border-radius: ${this.LAYOUT.borderRadius.large};\n           overflow: hidden;\n           box-shadow: ${this.LAYOUT.shadows.elevation};\n           border: ${this.LAYOUT.borderWidth.thin} solid ${this.COLORS.border};\n           page-break-inside: avoid !important;\n           break-inside: avoid !important;\n           position: relative;\n        }\n\n        .section-title {\n           font-size: ${this.TYPOGRAPHY.sizes.h4};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           color: ${this.COLORS.text.primary};\n           margin-bottom: ${this.LAYOUT.spacing.element};\n           padding: ${this.LAYOUT.spacing.element} ${this.LAYOUT.spacing.card};\n           background: ${this.COLORS.gradients.primary};\n           color: ${this.COLORS.white};\n           border-bottom: ${this.LAYOUT.borderWidth.medium} solid rgba(255,255,255,0.2);\n           position: relative;\n           display: flex;\n           align-items: center;\n           gap: ${this.LAYOUT.spacing.small};\n           page-break-after: avoid !important;\n           break-after: avoid !important;\n           page-break-inside: avoid !important;\n           break-inside: avoid !important;\n           text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.wide};\n        }\n\n        .section-title::before {\n          content: '';\n          position: absolute;\n          left: 0;\n          top: 0;\n          bottom: 0;\n          width: 4px;\n          background: ${this.COLORS.primary};\n        }\n\n        .section-icon {\n          font-size: 20px;\n        }\n\n        .section-content {\n          padding: ${this.LAYOUT.spacing.card};\n        }\n\n        /* Patient Cards Grid */\n        .patients-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .patient-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .patient-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.primary};\n        }\n\n        .patient-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .patient-avatar {\n          width: 50px;\n          height: 50px;\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .patient-info {\n          flex: 1;\n        }\n\n        .patient-name {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .patient-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .patient-details {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 10px;\n        }\n\n        .detail-item {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 8px 0;\n        }\n\n        .detail-label {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          font-weight: medium;\n        }\n\n        .detail-value {\n          font-size: 12px;\n          color: ${this.COLORS.text.primary};\n          font-weight: bold;\n        }\n\n        .status-active {\n          color: ${this.COLORS.success};\n        }\n\n        .pagination-info {\n           text-align: center;\n           padding: ${this.LAYOUT.spacing.card};\n           background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.surface} 100%);\n           border-radius: ${this.LAYOUT.borderRadius.large};\n           margin-top: ${this.LAYOUT.spacing.element};\n           border: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.border};\n           box-shadow: ${this.LAYOUT.shadows.card};\n         }\n\n         .pagination-info p {\n           color: ${this.COLORS.text.secondary};\n           font-size: ${this.TYPOGRAPHY.sizes.body};\n           margin: 0;\n           font-weight: ${this.TYPOGRAPHY.weights.medium};\n         }\n\n        /* Data Quality Indicators */\n        .data-quality-indicator {\n           display: inline-flex;\n           align-items: center;\n           gap: ${this.LAYOUT.spacing.tiny};\n           padding: ${this.LAYOUT.spacing.tiny} ${this.LAYOUT.spacing.small};\n           background: ${this.COLORS.surface};\n           border-radius: ${this.LAYOUT.borderRadius.medium};\n           border: ${this.LAYOUT.borderWidth.thin} solid ${this.COLORS.border};\n           font-size: ${this.TYPOGRAPHY.sizes.micro};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           color: ${this.COLORS.text.secondary};\n           margin: 0 ${this.LAYOUT.spacing.tiny};\n        }\n\n        .accuracy-badge {\n           display: inline-flex;\n           align-items: center;\n           gap: ${this.LAYOUT.spacing.tiny};\n           padding: ${this.LAYOUT.spacing.tiny} ${this.LAYOUT.spacing.small};\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           font-size: ${this.TYPOGRAPHY.sizes.micro};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           text-transform: uppercase;\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.wide};\n        }\n\n        .accuracy-badge.verified {\n           background: linear-gradient(135deg, ${this.COLORS.success}, rgba(16, 185, 129, 0.8));\n           color: ${this.COLORS.white};\n        }\n\n        .accuracy-badge.pending {\n           background: linear-gradient(135deg, ${this.COLORS.warning}, rgba(245, 158, 11, 0.8));\n           color: ${this.COLORS.white};\n        }\n\n        /* KPI Cards */\n        .kpi-card {\n           background: linear-gradient(135deg, ${this.COLORS.white} 0%, ${this.COLORS.surface} 100%);\n           border: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.border};\n           border-radius: ${this.LAYOUT.borderRadius.large};\n           padding: ${this.LAYOUT.spacing.card};\n           text-align: center;\n           box-shadow: ${this.LAYOUT.shadows.card};\n           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n           position: relative;\n           overflow: hidden;\n        }\n\n        .kpi-card::before {\n           content: '';\n           position: absolute;\n           top: 0;\n           left: 0;\n           right: 0;\n           height: 4px;\n           background: ${this.COLORS.gradients.primary};\n        }\n\n        .kpi-value {\n           font-size: ${this.TYPOGRAPHY.sizes.h2};\n           font-weight: ${this.TYPOGRAPHY.weights.extrabold};\n           color: ${this.COLORS.primary};\n           margin-bottom: ${this.LAYOUT.spacing.tiny};\n           font-family: ${this.TYPOGRAPHY.fonts.monospace};\n        }\n\n        .kpi-label {\n           font-size: ${this.TYPOGRAPHY.sizes.small};\n           color: ${this.COLORS.text.secondary};\n           font-weight: ${this.TYPOGRAPHY.weights.medium};\n           text-transform: uppercase;\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.wide};\n        }\n\n        .kpi-trend {\n           display: inline-flex;\n           align-items: center;\n           gap: ${this.LAYOUT.spacing.tiny};\n           font-size: ${this.TYPOGRAPHY.sizes.tiny};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           margin-top: ${this.LAYOUT.spacing.tiny};\n        }\n\n        .kpi-trend.positive {\n           color: ${this.COLORS.success};\n        }\n\n        .kpi-trend.negative {\n           color: ${this.COLORS.danger};\n        }\n\n        /* Appointment Cards Grid */\n        .appointments-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .appointment-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .appointment-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.accent};\n        }\n\n        .appointment-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .appointment-avatar {\n          width: 50px;\n          height: 50px;\n          background: linear-gradient(135deg, ${this.COLORS.accent}, ${this.COLORS.warning});\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .appointment-info {\n          flex: 1;\n        }\n\n        .appointment-patient {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .appointment-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .appointment-details {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 8px;\n        }\n\n        .status-completed {\n          color: ${this.COLORS.success};\n          background: rgba(6, 95, 70, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-cancelled {\n          color: ${this.COLORS.warning};\n          background: rgba(146, 64, 14, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-no-show {\n          color: ${this.COLORS.danger};\n          background: rgba(153, 27, 27, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-scheduled {\n          color: ${this.COLORS.primary};\n          background: rgba(26, 54, 93, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-unknown {\n          color: ${this.COLORS.text.muted};\n          background: rgba(75, 85, 99, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        /* Enhanced Table Styles */\n        table {\n           width: 100%;\n           border-collapse: separate;\n           border-spacing: 0;\n           margin: ${this.LAYOUT.spacing.element} 0;\n           background: ${this.COLORS.white};\n           border-radius: ${this.LAYOUT.borderRadius.medium};\n           overflow: hidden;\n           box-shadow: ${this.LAYOUT.shadows.card};\n           border: ${this.LAYOUT.borderWidth.thin} solid ${this.COLORS.border};\n        }\n\n        th {\n           background: ${this.COLORS.gradients.primary};\n           color: ${this.COLORS.white};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           font-size: ${this.TYPOGRAPHY.sizes.small};\n           padding: ${this.LAYOUT.spacing.element} ${this.LAYOUT.spacing.small};\n           text-align: center;\n           border: none;\n           text-shadow: 0 1px 3px rgba(0,0,0,0.3);\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.normal};\n           position: relative;\n        }\n\n        th::after {\n           content: '';\n           position: absolute;\n           bottom: 0;\n           left: 0;\n           right: 0;\n           height: 2px;\n           background: rgba(255,255,255,0.3);\n        }\n\n        td {\n           padding: ${this.LAYOUT.spacing.element} ${this.LAYOUT.spacing.small};\n           text-align: center;\n           border-bottom: ${this.LAYOUT.borderWidth.thin} solid ${this.COLORS.border};\n           font-size: ${this.TYPOGRAPHY.sizes.body};\n           color: ${this.COLORS.text.primary};\n           font-weight: ${this.TYPOGRAPHY.weights.medium};\n           line-height: ${this.TYPOGRAPHY.lineHeights.normal};\n        }\n\n        tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        tr:hover {\n          background: rgba(14, 165, 233, 0.05);\n        }\n\n        /* Enhanced Footer */\n        .report-footer {\n          margin-top: ${this.LAYOUT.spacing.section};\n          padding: ${this.LAYOUT.spacing.card};\n          background: ${this.COLORS.light};\n          border-radius: ${this.LAYOUT.borderRadius};\n          text-align: center;\n          border-top: 3px solid ${this.COLORS.primary};\n        }\n\n        .report-footer p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: 5px;\n        }\n\n        .report-footer .generated-info {\n          font-size: ${this.TYPOGRAPHY.sizes.tiny};\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n        }\n\n        /* Enhanced Data Table Styles */\n        .data-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: ${this.LAYOUT.spacing.element} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: visible;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: auto;\n          page-break-after: auto;\n          display: table !important;\n        }\n\n        .data-table th {\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          border: 2px solid ${this.COLORS.border};\n          border-bottom: 3px solid ${this.COLORS.secondary};\n        }\n\n        .data-table td {\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border: 1px solid ${this.COLORS.border};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.primary};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          page-break-inside: avoid;\n          break-inside: avoid;\n        }\n\n        .data-table tr {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: avoid !important;\n          page-break-after: avoid !important;\n          display: table-row !important;\n        }\n\n        .data-table thead {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-after: avoid !important;\n          display: table-header-group !important;\n        }\n\n        .data-table tbody {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          display: table-row-group !important;\n        }\n\n        .data-table tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        .data-table tr:nth-child(odd) {\n          background: ${this.COLORS.white};\n        }\n\n        .data-table tr:hover {\n          background: #e2e8f0;\n        }\n\n        .category-cell {\n           text-align: right !important;\n           font-weight: ${this.TYPOGRAPHY.weights.semibold};\n           color: ${this.COLORS.text.primary};\n           background: ${this.COLORS.surface};\n           border-left: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.primary};\n           padding-left: ${this.LAYOUT.spacing.small} !important;\n        }\n\n        .number-cell {\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           color: ${this.COLORS.primary};\n           font-size: ${this.TYPOGRAPHY.sizes.small};\n           background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           margin: 0 ${this.LAYOUT.spacing.tiny};\n        }\n\n        .percentage-cell {\n           font-weight: ${this.TYPOGRAPHY.weights.semibold};\n           color: ${this.COLORS.info};\n           background: linear-gradient(135deg, rgba(8, 145, 178, 0.1) 0%, rgba(8, 145, 178, 0.05) 100%);\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           padding: ${this.LAYOUT.spacing.tiny} ${this.LAYOUT.spacing.small} !important;\n           margin: 0 ${this.LAYOUT.spacing.tiny};\n        }\n\n        .currency-cell {\n           font-weight: ${this.TYPOGRAPHY.weights.extrabold};\n           color: ${this.COLORS.success};\n           background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           padding: ${this.LAYOUT.spacing.tiny} ${this.LAYOUT.spacing.small} !important;\n           margin: 0 ${this.LAYOUT.spacing.tiny};\n           font-family: ${this.TYPOGRAPHY.fonts.monospace};\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.tight};\n        }\n\n        .status-cell {\n           padding: ${this.LAYOUT.spacing.tiny} !important;\n        }\n\n        .status-badge {\n           display: inline-block;\n           padding: ${this.LAYOUT.spacing.tiny} ${this.LAYOUT.spacing.small};\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           font-size: ${this.TYPOGRAPHY.sizes.micro};\n           font-weight: ${this.TYPOGRAPHY.weights.bold};\n           text-transform: uppercase;\n           letter-spacing: ${this.TYPOGRAPHY.letterSpacing.wide};\n           border: ${this.LAYOUT.borderWidth.thin} solid transparent;\n        }\n\n        .status-badge.success {\n           background: linear-gradient(135deg, ${this.COLORS.success}, rgba(16, 185, 129, 0.8));\n           color: ${this.COLORS.white};\n           border-color: rgba(16, 185, 129, 0.3);\n        }\n\n        .status-badge.warning {\n           background: linear-gradient(135deg, ${this.COLORS.warning}, rgba(245, 158, 11, 0.8));\n           color: ${this.COLORS.white};\n           border-color: rgba(245, 158, 11, 0.3);\n        }\n\n        .status-badge.danger {\n           background: linear-gradient(135deg, ${this.COLORS.danger}, rgba(239, 68, 68, 0.8));\n           color: ${this.COLORS.white};\n           border-color: rgba(239, 68, 68, 0.3);\n        }\n\n        .status-badge.info {\n           background: linear-gradient(135deg, ${this.COLORS.info}, rgba(8, 145, 178, 0.8));\n           color: ${this.COLORS.white};\n           border-color: rgba(8, 145, 178, 0.3);\n        }\n\n        .chart-cell {\n          width: 150px;\n          padding: 8px !important;\n        }\n\n        .progress-bar {\n           width: 100%;\n           height: 24px;\n           background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.surface} 100%);\n           border: ${this.LAYOUT.borderWidth.medium} solid ${this.COLORS.border};\n           border-radius: ${this.LAYOUT.borderRadius.medium};\n           overflow: hidden;\n           position: relative;\n           box-shadow: ${this.LAYOUT.shadows.inset};\n        }\n\n        .progress-fill {\n           height: 100%;\n           background: ${this.COLORS.gradients.primary};\n           border-radius: ${this.LAYOUT.borderRadius.small};\n           transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n           position: relative;\n           border: ${this.LAYOUT.borderWidth.thin} solid rgba(255,255,255,0.3);\n           box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        }\n\n        .progress-fill::after {\n           content: '';\n           position: absolute;\n           top: 0;\n           left: 0;\n           right: 0;\n           bottom: 0;\n           background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);\n           animation: shimmer 2s infinite;\n        }\n\n        @keyframes shimmer {\n           0% { transform: translateX(-100%); }\n           100% { transform: translateX(100%); }\n        }\n\n        .progress-fill.gender-male {\n          background: #1e40af;\n          border-color: #1e3a8a;\n        }\n\n        .progress-fill.gender-female {\n          background: #be185d;\n          border-color: #9d174d;\n        }\n\n        .progress-fill.trend {\n          background: ${this.COLORS.success};\n          border-color: #047857;\n        }\n\n        .no-data {\n          text-align: center !important;\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n          padding: 30px !important;\n        }\n\n        .chart-container {\n          background: ${this.COLORS.white};\n          border-radius: 8px;\n          overflow: hidden;\n        }\n\n        /* Enhanced Footer Styles */\n        .footer-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          gap: 20px;\n        }\n\n        .footer-left {\n          flex: 1;\n          text-align: right;\n        }\n\n        .footer-right {\n          flex-shrink: 0;\n        }\n\n        .footer-title {\n          margin: 0 0 5px 0;\n          color: ${this.COLORS.text.primary};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .footer-stats {\n          display: flex;\n          gap: 15px;\n          align-items: center;\n        }\n\n        .stat-item {\n          background: ${this.COLORS.white};\n          padding: 8px 12px;\n          border-radius: 20px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          color: ${this.COLORS.text.primary};\n          border: 1px solid ${this.COLORS.border};\n        }\n\n        /* Page Break */\n        .page-break {\n          page-break-before: always;\n          break-before: page;\n          height: 0;\n          margin: 0;\n          padding: 0;\n        }\n\n        /* Page Header for New Pages */\n        .page-header {\n          text-align: center;\n          margin: 40px 0 30px 0;\n          padding: 30px 20px;\n          background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n          border-radius: ${this.LAYOUT.borderRadius};\n          border: 2px solid ${this.COLORS.border};\n          position: relative;\n        }\n\n        .page-header::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          height: 4px;\n          background: linear-gradient(90deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          border-radius: ${this.LAYOUT.borderRadius} ${this.LAYOUT.borderRadius} 0 0;\n        }\n\n        .page-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n          margin: 0 0 10px 0;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.1);\n        }\n\n        .page-subtitle {\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.secondary};\n          margin: 0;\n          font-style: italic;\n        }\n\n        /* Analysis Cards */\n        .analysis-cards {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .analysis-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-left: 4px solid ${this.COLORS.primary};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 25px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          display: flex;\n          align-items: center;\n          gap: 20px;\n          transition: all 0.3s ease;\n        }\n\n        .analysis-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 15px rgba(0,0,0,0.15);\n        }\n\n        .analysis-icon {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 28px;\n          flex-shrink: 0;\n        }\n\n        .analysis-content {\n          flex: 1;\n        }\n\n        .analysis-content h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 15px 0;\n        }\n\n        .analysis-stats {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 10px;\n        }\n\n        .stat {\n          display: flex;\n          flex-direction: column;\n          gap: 5px;\n        }\n\n        .stat-label {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .stat-value {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n        }\n\n        /* Inventory Specific Styles */\n        .inventory-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .inventory-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 20px;\n          box-shadow: ${this.LAYOUT.shadows.card};\n          transition: all 0.3s ease;\n          break-inside: avoid;\n          page-break-inside: avoid;\n        }\n\n        .inventory-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 6px 25px rgba(0,0,0,0.12);\n        }\n\n        .inventory-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .inventory-avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          color: ${this.COLORS.white};\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-transform: uppercase;\n          flex-shrink: 0;\n        }\n\n        .inventory-info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .inventory-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n          line-height: 1.3;\n          word-wrap: break-word;\n        }\n\n        .inventory-category {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 4px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .inventory-details {\n          display: grid;\n          gap: 10px;\n        }\n\n        .status-warning {\n          color: #f59e0b !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-success {\n          color: #10b981 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-danger {\n          color: #ef4444 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-info {\n          color: #3b82f6 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        /* Alert Level Styles */\n        .alert-level {\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-align: center;\n        }\n\n        .status-badge {\n          padding: 4px 8px;\n          border-radius: 12px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          text-align: center;\n          display: inline-block;\n        }\n\n        .status-badge.critical {\n          background: #fef2f2;\n          color: #dc2626;\n          border: 1px solid #fecaca;\n        }\n\n        .status-badge.warning {\n          background: #fffbeb;\n          color: #d97706;\n          border: 1px solid #fed7aa;\n        }\n\n        .status-badge.safe {\n          background: #f0fdf4;\n          color: #16a34a;\n          border: 1px solid #bbf7d0;\n        }\n\n        /* Expiry Status Styles */\n        .days-cell.expired {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.expiring {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.safe {\n          color: #16a34a;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.critical {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.warning {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .progress-fill.critical {\n          background: linear-gradient(90deg, #dc2626, #ef4444);\n        }\n\n        .progress-fill.warning {\n          background: linear-gradient(90deg, #d97706, #f59e0b);\n        }\n\n        /* Print Optimizations - Ø­Ù…Ø§ÙŠØ© Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */\n        @media print {\n          * {\n            -webkit-print-color-adjust: exact !important;\n            color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n\n          body {\n            margin: 0;\n            padding: 20px;\n            background: white !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          .enhanced-header {\n            background: ${this.COLORS.primary} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .summary-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .summary-card::before {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .section {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .inventory-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .data-table {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table !important;\n            width: 100% !important;\n            table-layout: fixed !important;\n            border-collapse: collapse !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            margin: 0 !important;\n            position: relative !important;\n          }\n\n          .data-table thead {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            display: table-header-group !important;\n          }\n\n          .data-table tbody {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            display: table-row-group !important;\n          }\n\n          .data-table tr {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ */\n          .data-table td, .data-table th {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* Ø­Ù…Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù… */\n          .section-title {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ù…ÙŠØ© */\n          .no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: auto !important;\n            page-break-after: auto !important;\n            display: block !important;\n            overflow: visible !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            position: relative !important;\n          }\n\n          /* Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØµØºÙŠØ±Ø© */\n          .data-table.small-table {\n            min-height: 200px !important;\n            max-height: 400px !important;\n          }\n\n          /* Ù…Ù†Ø¹ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ØµÙÙˆÙ */\n          .data-table tr.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* Ø­Ù…Ø§ÙŠØ© Ø®Ø§ØµØ© Ù„Ù„Ø®Ù„Ø§ÙŠØ§ */\n          .data-table td.no-break,\n          .data-table th.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            white-space: nowrap !important;\n            overflow: hidden !important;\n            text-overflow: ellipsis !important;\n          }\n\n          .data-table th {\n            background: ${this.COLORS.primary} !important;\n            color: white !important;\n            border: 2px solid ${this.COLORS.border} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .data-table td {\n            border: 1px solid ${this.COLORS.border} !important;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .progress-fill {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            border: 1px solid ${this.COLORS.text.primary} !important;\n          }\n\n          .patient-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .appointment-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .analysis-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          table {\n            break-inside: auto;\n          }\n\n          tr {\n            break-inside: avoid;\n            break-after: auto;\n          }\n\n          .page-break {\n            page-break-before: always !important;\n            break-before: page !important;\n          }\n        }\n      </style>\n    `}static generatePDFFileName(n){const t=new Date,e=`${t.getDate().toString().padStart(2,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getFullYear()}`,a=t.toTimeString().split(" ")[0].replace(/:/g,"-");return`${{patients:"ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø±Ø¶Ù‰",appointments:"ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",financial:"Ø§Ù„ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø§Ù„ÙŠ",inventory:"ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",treatments:"ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª",comprehensive:"Ø§Ù„ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø´Ø§Ù…Ù„"}[n]||`ØªÙ‚Ø±ÙŠØ±_${n}`}_${e}_${a}.pdf`}static async exportPatientReport(n,t){try{const e=this.createEnhancedPatientReportHTML(n,t),a=this.generatePDFFileName("patients");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting patient report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰")}}static async exportAppointmentReport(n,t){try{const e=m.createEnhancedAppointmentReportHTML(n,t),a=this.generatePDFFileName("appointments");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting appointment report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯")}}static async exportFinancialReport(n,t){try{const e=m.createEnhancedFinancialReportHTML(n,t),a=this.generatePDFFileName("financial");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting financial report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ")}}static async exportInventoryReport(n,t){try{const e=m.createEnhancedInventoryReportHTML(n,t),a=this.generatePDFFileName("inventory");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting inventory report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†")}}static filterDataByDateRange(n,t,e){if(!t||!t.start||!t.end)return n;const a=new Date(t.start),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),s=new Date(t.end),r=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);return n.filter(n=>{const t=n[e];if(!t)return!1;const a=new Date(t);let s;return s=t.includes("T")||t.includes(" ")?a:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),s>=i&&s<=r})}static async exportProfitLossReport(n,t){try{const{reportData:e,payments:a,labOrders:i,clinicNeeds:s,inventoryItems:r,clinicExpenses:o,patients:d,appointments:l,filter:c,currency:p}=n,h=await this.optimizeAndFilterReportData({reportData:e,payments:a,labOrders:i,clinicNeeds:s,inventoryItems:r,clinicExpenses:o,patients:d,appointments:l,filter:c,currency:p}),g=m.createEnhancedProfitLossReportHTML(h,t),v=this.generatePDFFileName("profit-loss");await this.convertHTMLToPDF(g,v)}catch(e){throw console.error("Error exporting profit/loss report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±")}}static async optimizeAndFilterReportData(n){const{reportData:t,payments:e,labOrders:a,clinicNeeds:i,inventoryItems:s,clinicExpenses:r,patients:o,appointments:d,filter:l,currency:c}=n,p=n=>t=>{if(!l||!l.start||!l.end)return t;const e=new Date(l.start),a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),i=new Date(l.end),s=new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999);return t.filter(t=>{const e=t[n];if(!e)return!1;const i=new Date(e);let r;return r=e.includes("T")||e.includes(" ")?i:new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),r>=a&&r<=s})},h=p("payment_date"),m=p("order_date"),g=p("created_at"),[v,b,u,f,$,x]=await Promise.all([h(e),m(a),g(i),g(d),g(s),r?h(r):Promise.resolve([])]);return{reportData:t,payments:v,labOrders:b,clinicNeeds:u,inventoryItems:$,clinicExpenses:x,patients:o,appointments:f,filter:l,currency:c}}static async exportComprehensivePendingInvoice(n){try{const t=this.createComprehensivePendingInvoiceHTML(n),e=this.generatePDFFileName(`pending-invoice-${n.patient.full_name}`);await this.convertHTMLToPDF(t,e)}catch(t){throw console.error("Error exporting comprehensive pending invoice:",t),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©")}}static createComprehensivePendingInvoiceHTML(n){const{patient:t,summary:e,settings:a,clinic_info:i}=n,s=n=>{try{const t=new Date(n);if(isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";const e=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${e}/${a}/${t.getFullYear()}`}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}},r=n=>{try{const t=new Date(n);if(isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";const e=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}/${a}/${i} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}},o=n=>{try{if(i?.currency){const t={USD:"$",EUR:"â‚¬",SYP:"Ù„.Ø³",TRY:"â‚º",SAR:"Ø±.Ø³"}[i.currency]||i.currency;return`${n.toLocaleString("en-US")} ${t}`}return`${n.toLocaleString("en-US")} Ù„.Ø³`}catch(t){return`${n} Ù„.Ø³`}};return`\n    <!DOCTYPE html>\n    <html dir="rtl" lang="ar">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© - ${t.full_name}</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n\n        body {\n          font-family: 'Arial', 'Tahoma', sans-serif;\n          direction: rtl;\n          background: white;\n          color: #333;\n          line-height: 1.6;\n          font-size: 14px;\n        }\n\n        .invoice-container {\n          max-width: 800px;\n          margin: 0 auto;\n          padding: 20px;\n          background: white;\n        }\n\n        .header {\n          text-align: center;\n          margin-bottom: 30px;\n          border-bottom: 3px solid #2563eb;\n          padding-bottom: 20px;\n        }\n\n        .header h1 {\n          color: #2563eb;\n          font-size: 28px;\n          margin-bottom: 10px;\n          font-weight: bold;\n        }\n\n        .header .invoice-info {\n          display: flex;\n          justify-content: space-between;\n          margin-top: 15px;\n          font-size: 12px;\n          color: #666;\n        }\n\n        .info-section {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 20px;\n          margin-bottom: 30px;\n        }\n\n        .info-card {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 15px;\n          background: #f9fafb;\n        }\n\n        .info-card h3 {\n          color: #2563eb;\n          font-size: 16px;\n          margin-bottom: 10px;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 5px;\n        }\n\n        .info-card p {\n          margin: 5px 0;\n          font-size: 13px;\n        }\n\n        .items-section {\n          margin-bottom: 30px;\n        }\n\n        .items-header {\n          background: #2563eb;\n          color: white;\n          padding: 15px;\n          border-radius: 8px 8px 0 0;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .items-header h3 {\n          font-size: 18px;\n        }\n\n        .items-badge {\n          background: rgba(255, 255, 255, 0.2);\n          padding: 4px 12px;\n          border-radius: 20px;\n          font-size: 12px;\n        }\n\n        .items-list {\n          border: 1px solid #e5e7eb;\n          border-top: none;\n          border-radius: 0 0 8px 8px;\n        }\n\n        .item-row {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px;\n          border-bottom: 1px solid #e5e7eb;\n          transition: background-color 0.2s;\n        }\n\n        .item-row:last-child {\n          border-bottom: none;\n        }\n\n        .item-row:hover {\n          background: #f9fafb;\n        }\n\n        .item-details {\n          flex: 1;\n        }\n\n        .item-title {\n          font-weight: bold;\n          color: #1f2937;\n          margin-bottom: 5px;\n        }\n\n        .item-meta {\n          font-size: 11px;\n          color: #6b7280;\n          display: flex;\n          gap: 15px;\n          flex-wrap: wrap;\n        }\n\n        .item-amount {\n          text-align: left;\n          font-weight: bold;\n          font-size: 16px;\n          color: #059669;\n        }\n\n        .summary-section {\n          background: #f9fafb;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 20px;\n          margin-bottom: 30px;\n        }\n\n        .summary-title {\n          color: #2563eb;\n          font-size: 18px;\n          margin-bottom: 15px;\n          text-align: center;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 10px;\n        }\n\n        .summary-row {\n          display: flex;\n          justify-content: space-between;\n          margin: 10px 0;\n          padding: 5px 0;\n        }\n\n        .summary-row.discount {\n          color: #dc2626;\n        }\n\n        .summary-row.tax {\n          color: #2563eb;\n        }\n\n        .summary-row.total {\n          border-top: 2px solid #2563eb;\n          padding-top: 15px;\n          margin-top: 15px;\n          font-size: 20px;\n          font-weight: bold;\n          color: #2563eb;\n        }\n\n        .footer {\n          text-align: center;\n          margin-top: 40px;\n          padding-top: 20px;\n          border-top: 1px solid #e5e7eb;\n          color: #6b7280;\n          font-size: 12px;\n        }\n\n        .date-range {\n          background: #eff6ff;\n          border: 1px solid #bfdbfe;\n          border-radius: 6px;\n          padding: 10px;\n          margin-bottom: 20px;\n          text-align: center;\n          font-size: 12px;\n          color: #1e40af;\n        }\n\n        @media print {\n          body {\n            margin: 0;\n            padding: 0;\n          }\n\n          .invoice-container {\n            max-width: none;\n            margin: 0;\n            padding: 15px;\n          }\n\n          .item-row:hover {\n            background: transparent;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      <div class="invoice-container">\n        \x3c!-- Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø© --\x3e\n        <div class="header">\n          <h1>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h1>\n          <div class="invoice-info">\n            <div>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${n.invoice_number}</div>\n            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${s(n.invoice_date)}</div>\n            <div>ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${r(n.generated_at)}</div>\n          </div>\n        </div>\n\n        \x3c!-- Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® --\x3e\n        <div class="date-range">\n          <strong>ÙØªØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> Ù…Ù† ${s(e.date_range.from)} Ø¥Ù„Ù‰ ${s(e.date_range.to)}\n        </div>\n\n        \x3c!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ ÙˆØ§Ù„Ø¹ÙŠØ§Ø¯Ø© --\x3e\n        <div class="info-section">\n          <div class="info-card">\n            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h3>\n            <p><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</strong> ${t.full_name}</p>\n            <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${t.phone||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n            ${t.email?`<p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${t.email}</p>`:""}\n            ${t.address?`<p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${t.address}</p>`:""}\n            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> ${t.date_of_birth?s(t.date_of_birth):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n          </div>\n\n          <div class="info-card">\n            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h3>\n            <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${i.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n            ${i.clinic_phone?`<p><strong>Ù‡Ø§ØªÙ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${i.clinic_phone}</p>`:""}\n            ${i.clinic_address?`<p><strong>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${i.clinic_address}</p>`:""}\n            ${i.clinic_email?`<p><strong>Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${i.clinic_email}</p>`:""}\n          </div>\n        </div>\n\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© --\x3e\n        <div class="items-section">\n          <div class="items-header">\n            <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n            <div class="items-badge">${e.total_items} Ø¹Ù†ØµØ±</div>\n          </div>\n\n          <div class="items-list">\n            ${e.items.map((n,t)=>`\n              <div class="item-row">\n                <div class="item-details">\n                  <div class="item-title">\n                    ${t+1}. ${n.appointment_title||n.treatment_type||n.description||"Ø¹Ù†ØµØ± ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\n                  </div>\n                  <div class="item-meta">\n                    ${n.appointment_date?`<span>ğŸ“… ${s(n.appointment_date)}</span>`:""}\n                    ${n.tooth_name?`<span>ğŸ¦· ${n.tooth_name} (${n.tooth_number})</span>`:""}\n                    ${n.treatment_type?`<span>ğŸ”§ ${n.treatment_type}</span>`:""}\n                    ${n.notes?`<span>ğŸ“ ${n.notes}</span>`:""}\n                  </div>\n                </div>\n                <div class="item-amount">\n                  ${o(n.amount)}\n                  ${n.discount_amount&&n.discount_amount>0?`<div style="font-size: 11px; color: #dc2626;">Ø®ØµÙ…: ${o(n.discount_amount)}</div>`:""}\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n\n        \x3c!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº --\x3e\n        <div class="summary-section">\n          <h3 class="summary-title">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h3>\n\n          <div class="summary-row">\n            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>\n            <span>${o(e.subtotal)}</span>\n          </div>\n\n          ${e.total_discount>0?`\n            <div class="summary-row discount">\n              <span>Ø§Ù„Ø®ØµÙ… (${"percentage"===a.discount_type?`${a.discount_value}%`:"Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª"}):</span>\n              <span>-${o(e.total_discount)}</span>\n            </div>\n            ${a.discount_reason?`\n              <div style="font-size: 11px; color: #6b7280; text-align: center; margin: 5px 0;">\n                Ø³Ø¨Ø¨ Ø§Ù„Ø®ØµÙ…: ${a.discount_reason}\n              </div>\n            `:""}\n          `:""}\n\n          ${e.total_tax>0?`\n            <div class="summary-row tax">\n              <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (${a.tax_rate}%):</span>\n              <span>+${o(e.total_tax)}</span>\n            </div>\n          `:""}\n\n          <div class="summary-row total">\n            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>\n            <span>${o(e.final_total)}</span>\n          </div>\n        </div>\n\n        \x3c!-- Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ --\x3e\n        ${a.include_payment_terms&&a.payment_terms_text?`\n          <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 15px; margin-bottom: 20px;">\n            <h4 style="color: #92400e; margin-bottom: 8px;">Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹:</h4>\n            <p style="color: #92400e; font-size: 13px;">${a.payment_terms_text}</p>\n          </div>\n        `:""}\n\n        \x3c!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª --\x3e\n        ${a.footer_notes?`\n          <div class="footer">\n            <p>${a.footer_notes}</p>\n          </div>\n        `:""}\n\n        \x3c!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© --\x3e\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ ÙÙŠ ${r(n.generated_at)}</p>\n          <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n        </div>\n      </div>\n    </body>\n    </html>\n    `}static async exportComprehensiveReport(n,t,e,a){try{const i=this.createComprehensiveReportHTML(n,t,e,a),s=this.generatePDFFileName("comprehensive");await this.convertHTMLToPDF(i,s)}catch(i){throw console.error("Error exporting comprehensive report:",i),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„")}}static async exportComprehensiveFinancialReport(n,t){try{const e=this.createComprehensiveFinancialReportHTML(n,t),a=this.generatePDFFileName("comprehensive_financial");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting comprehensive financial report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„")}}static createEnhancedPatientReportHTML(n,t){const e=this.createEnhancedHeader("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰",t,"ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª"),a=this.createEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰ - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        ${a}\n      </head>\n      <body>\n        ${e}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">ğŸ‘¥</div>\n            <div class="card-content">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</h3>\n              <div class="number">${n.totalPatients.toLocaleString("en-US")}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">âœ¨</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯</h3>\n              <div class="number">${(n.newPatients||0).toLocaleString("en-US")}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">ğŸ’š</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3>\n              <div class="number">${n.activePatients.toLocaleString("en-US")}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">â¸ï¸</div>\n            <div class="card-content">\n              <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>\n              <div class="number">${(n.totalPatients-n.activePatients).toLocaleString("en-US")}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Patient List Section --\x3e\n        ${n.patientsList&&n.patientsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“‹</span>\n            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰\n          </div>\n          <div class="section-content">\n            <div class="patients-grid">\n              ${n.patientsList.slice(0,50).map((n,t)=>`\n                <div class="patient-card">\n                  <div class="patient-header">\n                    <div class="patient-avatar">\n                      ${(n.full_name||n.first_name||"Ù…").charAt(0)}\n                    </div>\n                    <div class="patient-info">\n                      <h4 class="patient-name">${n.full_name||`${n.first_name||""} ${n.last_name||""}`.trim()}</h4>\n                      <span class="patient-serial">#${n.serial_number||(t+1).toString().padStart(3,"0")}</span>\n                    </div>\n                  </div>\n                  <div class="patient-details">\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ø¬Ù†Ø³:</span>\n                      <span class="detail-value">${"male"===n.gender?"Ø°ÙƒØ±":"female"===n.gender?"Ø£Ù†Ø«Ù‰":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ø¹Ù…Ø±:</span>\n                      <span class="detail-value">${n.age||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"} Ø³Ù†Ø©</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ù‡Ø§ØªÙ:</span>\n                      <span class="detail-value">${n.phone||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>\n                      <span class="detail-value status-active">${n.patient_condition||"Ù†Ø´Ø·"}</span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${n.patientsList.length>50?`\n            <div class="pagination-info">\n              <p>Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ù…Ø±ÙŠØ¶ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${n.patientsList.length.toLocaleString("en-US")} Ù…Ø±ÙŠØ¶</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Age Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“Š</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ø±\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.ageDistribution?.map(t=>{const e=n.totalPatients>0?(t.count/n.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(e));return`\n                      <tr>\n                        <td class="category-cell">${t.ageGroup}</td>\n                        <td class="number-cell">${t.count.toLocaleString("en-US")}</td>\n                        <td class="percentage-cell">${e}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Page Break Before Gender Distribution --\x3e\n        <div class="page-break"></div>\n\n        \x3c!-- Gender Distribution Page Header --\x3e\n        <div class="page-header">\n          <h2 class="page-title">ğŸ“Š ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³</h2>\n          <p class="page-subtitle">ØªÙ‚Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠ Ø¹Ù† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³</p>\n        </div>\n\n        \x3c!-- Gender Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ‘¥</span>\n            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„Ø¬Ù†Ø³</th>\n                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.genderDistribution?.map(t=>{const e=n.totalPatients>0?(t.count/n.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(e));return`\n                      <tr>\n                        <td class="category-cell">${"Ø°ÙƒØ±"===t.gender?"ğŸ‘¨":"Ø£Ù†Ø«Ù‰"===t.gender?"ğŸ‘©":"ğŸ‘¤"} ${t.gender}</td>\n                        <td class="number-cell">${t.count.toLocaleString("en-US")}</td>\n                        <td class="percentage-cell">${e}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill gender-${"Ø°ÙƒØ±"===t.gender?"male":"female"}" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Gender Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“ˆ</span>\n            ØªØ­Ù„ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${n.genderDistribution?.map(t=>{const e=n.totalPatients>0?(t.count/n.totalPatients*100).toFixed(1):"0.0",a="Ø°ÙƒØ±"===t.gender?"ğŸ‘¨":"Ø£Ù†Ø«Ù‰"===t.gender?"ğŸ‘©":"ğŸ‘¤",i="Ø°ÙƒØ±"===t.gender?"#1e40af":"Ø£Ù†Ø«Ù‰"===t.gender?"#be185d":"#374151";return`\n                  <div class="analysis-card" style="border-left-color: ${i}; border-left-width: 6px;">\n                    <div class="analysis-icon" style="background: ${"Ø°ÙƒØ±"===t.gender?"#dbeafe":"Ø£Ù†Ø«Ù‰"===t.gender?"#fce7f3":"#f3f4f6"}; color: ${i}; border: 2px solid ${i};">\n                      ${a}\n                    </div>\n                    <div class="analysis-content">\n                      <h3 style="color: ${i};">${t.gender}</h3>\n                      <div class="analysis-stats">\n                        <div class="stat">\n                          <span class="stat-label">Ø§Ù„Ø¹Ø¯Ø¯:</span>\n                          <span class="stat-value" style="color: ${i};">${t.count.toLocaleString("en-US")}</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">Ø§Ù„Ù†Ø³Ø¨Ø©:</span>\n                          <span class="stat-value" style="color: ${i};">${e}%</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>\n                          <span class="stat-value">${n.totalPatients.toLocaleString("en-US")}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                `}).join("")||'<p class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„</p>'}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Registration Trend --\x3e\n        ${n.registrationTrend&&n.registrationTrend.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">ğŸ“ˆ</span>\n            Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>Ø§Ù„Ø´Ù‡Ø±</th>\n                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯</th>\n                    <th>Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${n.registrationTrend.map(t=>{const e=Math.max(...n.registrationTrend.map(n=>n.count)),a=e>0?Math.max(5,t.count/e*100):5;return`\n                      <tr>\n                        <td class="category-cell">${t.period}</td>\n                        <td class="number-cell">${t.count.toLocaleString("en-US")}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill trend" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</p>\n              <p class="generated-info">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</p>\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">ğŸ“Š ${n.totalPatients.toLocaleString("en-US")} Ù…Ø±ÙŠØ¶</span>\n                <span class="stat-item">âœ¨ ${(n.newPatients||0).toLocaleString("en-US")} Ø¬Ø¯ÙŠØ¯</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createPatientReportHTML(n){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 16px; color: #1e293b; }\n          .summary-card .number { font-size: 24px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</div>\n          <div class="report-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</h3>\n            <div class="number">${n.totalPatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯</h3>\n            <div class="number">${n.newPatients||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3>\n            <div class="number">${n.activePatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>\n            <div class="number">${n.totalPatients-n.activePatients||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ø±</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.ageDistribution?.map(n=>`\n                <tr>\n                  <td>${n.ageGroup}</td>\n                  <td>${n.count}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„Ø¬Ù†Ø³</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.genderDistribution?.map(n=>`\n                <tr>\n                  <td>${"male"===n.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</td>\n                  <td>${n.count}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createAppointmentReportHTML(n){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 120px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 20px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</div>\n          <div class="report-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h3>\n            <div class="number">${n.totalAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>\n            <div class="number">${n.completedAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ù„ØºÙŠØ©</h3>\n            <div class="number">${n.cancelledAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</h3>\n            <div class="number">${n.noShowAppointments||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>\n            <div class="number">${n.attendanceRate?.toFixed(1)||0}%</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.appointmentsByStatus?.map(n=>`\n                <tr>\n                  <td>${this.translateStatus(n.status)}</td>\n                  <td>${n.count}</td>\n                  <td>${n.percentage?.toFixed(1)||0}%</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createFinancialReportHTML(n){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</div>\n          <div class="report-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n            <div class="number">$${n.totalRevenue?.toLocaleString("en-US")||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>\n            <div class="number">$${n.totalRevenue?.toLocaleString("en-US")||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n            <div class="number">$${n.pendingPayments?.toLocaleString("en-US")||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</h3>\n            <div class="number">$${n.overduePayments?.toLocaleString("en-US")||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.paymentMethodStats?.map(n=>`\n                <tr>\n                  <td>${this.translatePaymentMethod(n.method)}</td>\n                  <td>${n.amount?.toLocaleString("en-US")||0} $</td>\n                  <td>${n.count||0}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createInventoryReportHTML(n){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .warning { color: #f59e0b !important; }\n          .danger { color: #ef4444 !important; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</div>\n          <div class="report-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>\n            <div class="number">${n.totalItems}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>\n            <div class="number">${n.totalValue?.toLocaleString("en-US")||0} $</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø£ØµÙ†Ø§Ù Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>\n            <div class="number warning">${n.lowStockItems||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>Ø£ØµÙ†Ø§Ù Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h3>\n            <div class="number danger">${n.expiredItems||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„ÙØ¦Ø©</th>\n                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.itemsByCategory?.map(n=>`\n                <tr>\n                  <td>${n.category}</td>\n                  <td>${n.count}</td>\n                  <td>${n.value?.toLocaleString("en-US")||0} $</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        ${n.stockAlerts&&n.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„ØµÙ†Ù</th>\n                <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.stockAlerts.slice(0,10).map(n=>`\n                <tr>\n                  <td>${n.name}</td>\n                  <td>${n.quantity}</td>\n                  <td class="${0===n.quantity?"danger":"warning"}">\n                    ${0===n.quantity?"Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":"Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶"}\n                  </td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n      </body>\n      </html>\n    `}static createComprehensiveReportHTML(n,t,e,a){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-section { display: flex; justify-content: space-between; margin: 30px 0; flex-wrap: wrap; }\n          .summary-group { background: #f8fafc; padding: 20px; border-radius: 8px; min-width: 200px; margin: 10px; }\n          .summary-group h3 { margin: 0 0 15px 0; font-size: 16px; color: #0ea5e9; text-align: center; }\n          .summary-item { margin: 8px 0; font-size: 14px; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</div>\n          <div class="report-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-section">\n          <div class="summary-group">\n            <h3>Ø§Ù„Ù…Ø±Ø¶Ù‰</h3>\n            <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${n.totalPatients}</div>\n            <div class="summary-item">Ø¬Ø¯Ø¯: ${n.newPatients||0}</div>\n            <div class="summary-item">Ù†Ø´Ø·ÙˆÙ†: ${n.activePatients}</div>\n          </div>\n          <div class="summary-group">\n            <h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h3>\n            <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t.totalAppointments}</div>\n            <div class="summary-item">Ù…ÙƒØªÙ…Ù„Ø©: ${t.completedAppointments}</div>\n            <div class="summary-item">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±: ${t.attendanceRate?.toFixed(1)||0}%</div>\n          </div>\n          <div class="summary-group">\n            <h3>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n            <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${e.totalRevenue?.toLocaleString("en-US")||0} $</div>\n            <div class="summary-item">Ù…ÙƒØªÙ…Ù„Ø©: ${e.totalRevenue?.toLocaleString("en-US")||0} $</div>\n          </div>\n          <div class="summary-group">\n            <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>\n            <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${a.totalItems}</div>\n            <div class="summary-item">Ø§Ù„Ù‚ÙŠÙ…Ø©: ${a.totalValue?.toLocaleString("en-US")||0} $</div>\n            <div class="summary-item">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª: ${(a.lowStockItems||0)+(a.expiredItems||0)}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ù„Ù…Ø¤Ø´Ø±</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>Ù…Ø¹Ø¯Ù„ Ù†Ù…Ùˆ Ø§Ù„Ù…Ø±Ø¶Ù‰</td>\n                <td>${((n.newPatients||0)/n.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n              <tr>\n                <td>Ù…Ø¹Ø¯Ù„ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</td>\n                <td>${t.attendanceRate?.toFixed(1)||0}%</td>\n              </tr>\n              <tr>\n                <td>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>\n                <td>${t.cancellationRate?.toFixed(1)||0}%</td>\n              </tr>\n              <tr>\n                <td>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶</td>\n                <td>${(()=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:a,getDefaultCurrency:i}=require("@/lib/utils"),s=t(i());return a((e.totalRevenue||0)/n.totalPatients,s)}catch(t){return`$${((e.totalRevenue||0)/n.totalPatients).toLocaleString("en-US")}`}})()}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static async convertHTMLToPDF(t,e){try{const a=document.createElement("div");a.innerHTML=t,a.style.position="absolute",a.style.left="-9999px",a.style.top="-9999px",a.style.width="800px",a.style.fontFamily="Arial, sans-serif",a.style.direction="rtl",a.style.fontSize="14px",a.style.lineHeight="1.6",a.style.color="#000",a.style.background="#fff",a.style.padding="20px",document.body.appendChild(a),await new Promise(n=>setTimeout(n,100));const i=t.length>5e4||a.scrollHeight>5e3;let s;s=i&&"undefined"!=typeof Worker?await this.processPDFWithWebWorker(a):await n(a,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:a.scrollHeight,scrollX:0,scrollY:0}),document.body.removeChild(a),await this.createPDFAsync(s,e)}catch(a){throw console.error("Error converting HTML to PDF:",a),new Error("ÙØ´Ù„ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ PDF")}}static async processPDFWithWebWorker(t){try{if("undefined"==typeof Worker||t.scrollHeight<3e3)return await n(t,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:t.scrollHeight,scrollX:0,scrollY:0});const e=(v||(v=new g),v),a=t.outerHTML,i=await e.processHTML(a,1.5),s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");if(!r)throw new Error("Failed to get canvas context");const o=new Image;return o.src=i.canvasData,new Promise((n,t)=>{o.onload=()=>{r.drawImage(o,0,0),n(s)},o.onerror=()=>{t(new Error("Failed to load canvas image from Web Worker"))}})}catch(e){return console.error("Web Worker PDF processing failed:",e),await n(t,{scale:1.2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:t.scrollHeight,scrollX:0,scrollY:0})}}static chunkHTMLProcessing(n){const t=[];if(n.scrollHeight<=2e3)return[{element:n,height:n.scrollHeight}];const e=n.scrollHeight;let a=0;for(;a<e;){const i=Math.min(2e3,e-a),s=n.cloneNode(!0);s.style.height=`${i}px`,s.style.overflow="hidden",s.style.position="relative",t.push({element:s,height:i}),a+=i}return t}static combineCanvases(n){if(0===n.length)throw new Error("No canvases to combine");if(1===n.length)return n[0];const t=n[0].width,e=n.reduce((n,t)=>n+t.height,0),a=document.createElement("canvas");a.width=t,a.height=e;const i=a.getContext("2d");if(!i)throw new Error("Failed to get canvas context");let s=0;return n.forEach(n=>{i.drawImage(n,0,s,t,n.height),s+=n.height}),a}static async createPDFAsync(n,e){const a=n.toDataURL("image/jpeg",.8),i=new t({orientation:"portrait",unit:"mm",format:"a4"}),s=i.internal.pageSize.getWidth(),r=i.internal.pageSize.getHeight(),o=s-20,d=n.height*o/n.width;let l=d,c=10;i.addImage(a,"JPEG",10,c,o,d),l-=r-20;let p=1;for(;l>=0&&p<50;)c=l-d+10,i.addPage(),i.addImage(a,"JPEG",10,c,o,d),l-=r-20,p++,p%10==0&&await new Promise(n=>setTimeout(n,10));i.save(e)}static async exportTreatmentReport(n,t){try{const e=m.createEnhancedTreatmentReportHTML(n,t),a=this.generatePDFFileName("treatments");await this.convertHTMLToPDF(e,a)}catch(e){throw console.error("Error exporting treatment report:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª")}}static async exportIndividualPatientRecord(n,t){try{const e=this.createIndividualPatientRecordHTML(n,t),a=(new Date).toLocaleDateString("en-US").replace(/\//g,"-"),i=`${n.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(e,i)}catch(e){throw console.error("Error exporting individual patient record:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶")}}static async exportPatientPayments(n,t){try{const e=this.createPatientPaymentsHTML(n,t),a=(new Date).toLocaleDateString("en-US").replace(/\//g,"-"),i=`Ù…Ø¯ÙÙˆØ¹Ø§Øª_${n.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(e,i)}catch(e){throw console.error("Error exporting patient payments:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶")}}static async exportPatientTreatments(n,t){try{const e=this.createPatientTreatmentsHTML(n,t),a=(new Date).toLocaleDateString("en-US").replace(/\//g,"-"),i=`Ø¹Ù„Ø§Ø¬Ø§Øª_${n.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(e,i)}catch(e){throw console.error("Error exporting patient treatments:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶")}}static async exportPatientAppointments(n,t){try{const e=this.createPatientAppointmentsHTML(n,t),a=(new Date).toLocaleDateString("en-US").replace(/\//g,"-"),i=`Ù…ÙˆØ§Ø¹ÙŠØ¯_${n.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(e,i)}catch(e){throw console.error("Error exporting patient appointments:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙŠØ¶")}}static async exportPatientPrescriptions(n,t){try{const e=this.createPatientPrescriptionsHTML(n,t),a=(new Date).toLocaleDateString("en-US").replace(/\//g,"-"),i=`ÙˆØµÙØ§Øª_${n.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(e,i)}catch(e){throw console.error("Error exporting patient prescriptions:",e),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ÙˆØµÙØ§Øª Ø§Ù„Ù…Ø±ÙŠØ¶")}}static createPatientRecordHTMLForPrint(n,t){return this.createIndividualPatientRecordHTML(n,t)}static createIndividualPatientRecordHTML(n,t){const{patient:e,appointments:a,treatments:i,payments:r,prescriptions:o,labOrders:p,stats:h}=n,m=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",g=n=>{try{const e=d(t?.currency||l());return c(n||0,e)}catch(e){return`$${(n||0).toFixed(2)}`}},v=(n,t,e,a=!1,i="")=>`\n        <div style="page-break-before: auto; page-break-inside: avoid !important; break-inside: avoid !important; display: block; margin-bottom: 30px;">\n          <div class="section-title" style="page-break-after: avoid !important; break-after: avoid !important; margin-bottom: 10px;">${n}</div>\n          <div style="page-break-inside: avoid !important; break-inside: avoid !important; display: block; overflow: visible;">\n            <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important; width: 100%; table-layout: fixed; border-collapse: collapse; margin: 0;">\n              <thead style="page-break-inside: avoid !important; break-inside: avoid !important; page-break-after: avoid !important;">\n                <tr>\n                  ${t.map(n=>`<th>${n}</th>`).join("")}\n                </tr>\n              </thead>\n              <tbody style="page-break-inside: avoid !important; break-inside: avoid !important;">\n                ${e.join("")}\n                ${a&&i?i:""}\n              </tbody>\n            </table>\n          </div>\n        </div>`;let b=0,u=0;const f=[],$=[];r?.forEach(n=>{n.appointment_id||(n.tooth_treatment_id?f.push(n):$.push(n)),u+=n.amount||0}),a?.forEach(n=>{n.cost&&(b+=n.cost)}),i?.forEach(n=>{n.cost&&(b+=n.cost)}),$.forEach(n=>{const t=n.treatment_cost||n.total_amount||n.amount||0;b+=t});const x=Math.max(0,b-u);let y=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>${e.full_name} - ${m((new Date).toISOString())}</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n          body {\n            font-family: 'Arial', sans-serif;\n            line-height: 1.6;\n            color: #000;\n            background: #fff;\n            padding: 20px;\n            direction: rtl;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #000;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 24px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 20px;\n            margin-bottom: 5px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #666;\n          }\n          .patient-info {\n            border: 2px solid #000;\n            padding: 20px;\n            margin-bottom: 30px;\n          }\n          .patient-name {\n            font-size: 22px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 20px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .info-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .info-label {\n            font-weight: bold;\n            width: 30%;\n          }\n          .info-value {\n            width: 65%;\n          }\n          .section-title {\n            font-size: 18px;\n            font-weight: bold;\n            margin: 30px 0 15px 0;\n            padding: 10px;\n            border: 2px solid #000;\n            text-align: center;\n            background: #f5f5f5;\n            page-break-after: avoid;\n            break-after: avoid;\n          }\n          .data-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #000;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table th {\n            background: #f0f0f0;\n            border: 1px solid #000;\n            padding: 10px;\n            text-align: center;\n            font-weight: bold;\n          }\n          .data-table td {\n            border: 1px solid #000;\n            padding: 8px;\n            text-align: center;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr {\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr:nth-child(even) {\n            background: #f9f9f9;\n          }\n          .financial-summary {\n            border: 2px solid #000;\n            padding: 20px;\n            margin: 20px 0;\n            page-break-before: always;\n            page-break-inside: avoid;\n          }\n          .financial-title {\n            font-size: 18px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .financial-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .financial-label {\n            font-weight: bold;\n          }\n          .financial-amount {\n            font-weight: bold;\n          }\n          .no-data {\n            text-align: center;\n            color: #666;\n            font-style: italic;\n            padding: 20px;\n            border: 1px solid #ccc;\n            margin: 20px 0;\n          }\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            font-size: 12px;\n            color: #666;\n            border-top: 1px solid #ccc;\n            padding-top: 20px;\n          }\n\n          @media print {\n  .data-table {\n    page-break-inside: avoid;\n    break-inside: avoid;\n    display: table;\n    width: 100%;\n  }\n\n  .data-table thead {\n    display: table-header-group;\n  }\n\n  .data-table tbody {\n    display: table-row-group;\n  }\n\n  .data-table tr {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .data-table td,\n  .data-table th {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .section-title {\n    page-break-before: always;\n    break-before: always;\n  }\n}\n\n        </style>\n      </head>\n      <body>\n        \x3c!-- Ø±Ø£Ø³ Ø§Ù„ØªÙ‚Ø±ÙŠØ± --\x3e\n        <div class="header">\n          ${t?.clinic_logo&&""!==t.clinic_logo.trim()?`\n            <div style="text-align: center; margin-bottom: 15px;">\n              <img src="${t.clinic_logo}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #000; object-fit: cover;" />\n            </div>\n          `:""}\n          <div class="clinic-name">${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</div>\n          ${t?.doctor_name?`<div style="font-size: 16px; margin-bottom: 10px;">Ø¯. ${t.doctor_name}</div>`:""}\n          <div class="report-title">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø·Ø¨ÙŠ</div>\n          <div class="report-date">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${m((new Date).toISOString())}</div>\n        </div>\n\n        \x3c!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© --\x3e\n        <div class="patient-info">\n          <div class="patient-name">${e.full_name}</div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø¹Ù…Ø±:</span>\n            <span class="info-value">${e.age} Ø³Ù†Ø©</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø¬Ù†Ø³:</span>\n            <span class="info-value">${"male"===e.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>\n            <span class="info-value">${e.phone||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span>\n            <span class="info-value">${e.email||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>\n            <span class="info-value">${e.address||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶:</span>\n            <span class="info-value">${e.patient_condition||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©:</span>\n            <span class="info-value">${e.allergies||"Ù„Ø§ ØªÙˆØ¬Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©:</span>\n            <span class="info-value">${e.medical_conditions||"Ù„Ø§ ØªÙˆØ¬Ø¯"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span>\n            <span class="info-value">${m(e.date_added)}</span>\n          </div>\n        </div>`;if(y+=`\n      \x3c!-- Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ --\x3e\n      <div class="financial-summary">\n        <div class="header" style="margin-bottom: 30px;">\n          <div class="clinic-name">${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</div>\n          <div class="report-title">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø±ÙŠØ¶</div>\n          <div class="report-date">${e.full_name} - ${m((new Date).toISOString())}</div>\n        </div>\n\n        <div class="financial-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>\n        <div class="financial-row">\n          <span class="financial-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ:</span>\n          <span class="financial-amount">${g(b)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span>\n          <span class="financial-amount">${g(u)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span>\n          <span class="financial-amount">${g(x)}</span>\n        </div>\n\n        <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px;">\n          <div style="font-weight: bold; margin-bottom: 10px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø§Ù„ÙŠØ©:</div>\n          <div style="font-size: 14px; line-height: 1.6;">\n            ${x>0?`â€¢ ÙŠÙˆØ¬Ø¯ Ù…Ø¨Ù„Øº Ù…ØªØ¨Ù‚ÙŠ Ù‚Ø¯Ø±Ù‡ ${g(x)} ÙŠØ¬Ø¨ ØªØ­ØµÙŠÙ„Ù‡`:"â€¢ ØªÙ… Ø³Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"}\n            <br>â€¢ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${m((new Date).toISOString())}\n            <br>â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${r?r.length:0}\n          </div>\n        </div>\n      </div>`,a&&a.length>0){const n=`Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (${a.length})`,t=["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„ÙˆÙ‚Øª","Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ¹Ø¯","Ø§Ù„Ø­Ø§Ù„Ø©","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=a.map(n=>{const t="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"scheduled"===n.status?"Ù…Ø¬Ø¯ÙˆÙ„":"cancelled"===n.status?"Ù…Ù„ØºÙŠ":"Ø¢Ø¬Ù„";return`\n          <tr>\n            <td>${m(n.start_time)}</td>\n            <td>${e=n.start_time,e?new Date(e).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n            <td>${n.appointment_type||"Ø¹Ø§Ù…"}</td>\n            <td>${t}</td>\n            <td>${n.notes||"-"}</td>\n          </tr>`;var e});y+=v(n,t,e)}else y+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';if(i&&i.length>0){const n=`Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª (${i.length})`,t=["Ø±Ù‚Ù… Ø§Ù„Ø³Ù†","Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬","Ø§Ù„ØªÙƒÙ„ÙØ©","Ø§Ù„Ø­Ø§Ù„Ø©","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=i.map(n=>{const t="completed"===n.treatment_status?"Ù…ÙƒØªÙ…Ù„":"in_progress"===n.treatment_status?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°":"Ù…Ø®Ø·Ø·",e=s(n.treatment_name||n.treatment_type||""),a=f.filter(t=>t.tooth_treatment_id===n.id).reduce((n,t)=>n+(t.amount||0),0);return`\n          <tr>\n            <td>${n.tooth_number||"-"}</td>\n            <td>${e}</td>\n            <td>${g(n.cost||0)}</td>\n            <td>${t}</td>\n            <td>${m(n.treatment_date||n.created_at)}</td>\n            <td>${g(a)}</td>\n            <td>${n.notes||"-"}</td>\n          </tr>`});y+=v(n,t,e)}else y+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ø¬Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';if(r&&r.length>0){const n=`Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (${r.length})`,t=["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹","Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù†ÙˆØ¹","Ø§Ù„ÙˆØµÙ","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=r.map(n=>{const t="cash"===n.payment_method?"Ù†Ù‚Ø¯ÙŠ":"card"===n.payment_method?"Ø¨Ø·Ø§Ù‚Ø©":"bank_transfer"===n.payment_method?"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ":"Ø£Ø®Ø±Ù‰";let e="Ø¹Ø§Ù…",a=n.description||"-";const i={zirconia_post_core:"Ø¯Ø¹Ø§Ù…Ø© Ø²ÙŠØ±ÙƒÙˆÙ†ÙŠØ§ - Ù‚Ù„Ø¨ ÙˆØªØ¯",bone_graft:"ØªØ±Ù‚ÙŠØ¹ Ø¹Ø¸Ù…",crown:"ØªØ§Ø¬",filling:"Ø­Ø´ÙˆØ©",root_canal:"Ø¹Ù„Ø§Ø¬ Ø¹ØµØ¨",extraction:"Ø®Ù„Ø¹",cleaning:"ØªÙ†Ø¸ÙŠÙ",implant:"Ø²Ø±Ø§Ø¹Ø©",bridge:"Ø¬Ø³Ø±",veneer:"Ù‚Ø´Ø±Ø©",orthodontics:"ØªÙ‚ÙˆÙŠÙ…",whitening:"ØªØ¨ÙŠÙŠØ¶",scaling:"ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬ÙŠØ±",polishing:"ØªÙ„Ù…ÙŠØ¹",consultation:"Ø§Ø³ØªØ´Ø§Ø±Ø©"};if(n.tooth_treatment_id){e="Ø¹Ù„Ø§Ø¬ Ø£Ø³Ù†Ø§Ù†";const t=n.treatment_name||n.description||"";a=i[t]||t||"Ø¹Ù„Ø§Ø¬ Ø£Ø³Ù†Ø§Ù†"}else if(n.appointment_id)e="Ù…ÙˆØ¹Ø¯",a=n.appointment_title||n.description||"Ù…ÙˆØ¹Ø¯";else{const t=n.description||"";a=i[t]||t||"Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø©"}return`\n          <tr>\n            <td>${m(n.payment_date||n.created_at)}</td>\n            <td>${g(n.amount||n.total_amount)}</td>\n            <td>${g(n.treatment_cost||n.total_amount||n.amount)}</td>\n            <td>${t}</td>\n            <td>${e}</td>\n            <td>${a}</td>\n            <td>${n.notes||"-"}</td>\n          </tr>`}),a=r.reduce((n,t)=>n+(t.amount||t.total_amount||0),0),i=r.reduce((n,t)=>n+(t.treatment_cost||t.total_amount||t.amount||0),0),s=`\n        <tr style="background-color: #f8f9fa; font-weight: bold; border-top: 2px solid #dee2e6;">\n          <td style="text-align: right; padding: 12px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</td>\n          <td style="padding: 12px; color: #28a745;">${g(a)}</td>\n          <td style="padding: 12px; color: #007bff;">${g(i)}</td>\n          <td colspan="4"></td>\n        </tr>`;y+=v(n,t,e,!0,s)}else y+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';if(o&&o.length>0){const n=`Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ© (${o.length})`,t=["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡","Ø§Ù„Ø¬Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ±Ø§Ø±","Ø§Ù„Ù…Ø¯Ø©","ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=[];o.forEach(n=>{n.medications&&n.medications.length>0?n.medications.forEach((t,a)=>{e.push(`\n              <tr>\n                <td>${m(n.prescription_date||n.created_at)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dosage||"-"}</td>\n                <td>${t.frequency||"-"}</td>\n                <td>${t.duration||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${n.notes||"-"}</td>\n              </tr>`)}):e.push(`\n            <tr>\n              <td>${m(n.prescription_date||n.created_at)}</td>\n              <td>${n.medication_name||"-"}</td>\n              <td>${n.dosage||"-"}</td>\n              <td>${n.frequency||"-"}</td>\n              <td>${n.duration||"-"}</td>\n              <td>${n.instructions||"-"}</td>\n              <td>${n.notes||"-"}</td>\n            </tr>`)}),y+=v(n,t,e)}else y+='\n        <div class="section-title">Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØµÙØ§Øª Ø·Ø¨ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';return p&&p.length>0?(y+=`\n        <div style="page-break-before: auto; page-break-inside: avoid; break-inside: avoid;">\n          <div class="section-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø± (${p.length})</div>\n          <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important;">\n            <thead>\n              <tr>\n                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>\n                <th>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>\n                <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>\n              </tr>\n            </thead>\n            <tbody>`,p.forEach(n=>{const t="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"in_progress"===n.status?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°":"Ø¢Ø¬Ù„";y+=`\n            <tr>\n              <td>${m(n.order_date||n.created_at)}</td>\n              <td>${n.order_type||"-"}</td>\n              <td>${t}</td>\n              <td>${g(n.cost||0)}</td>\n              <td>${n.notes||"-"}</td>\n            </tr>`}),y+="\n            </tbody>\n          </table>\n        </div>"):y+='\n        <div class="section-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø®ØªØ¨Ø± Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>',e.notes&&(y+=`\n        <div class="section-title">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>\n        <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0;">\n          ${e.notes}\n        </div>`),y+=`\n        <div class="footer">\n          ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§  Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ ${m((new Date).toISOString())} - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}\n        </div>\n      </body>\n      </html>`,y}static createClinicNeedsReportHTML(n,t){const{title:e,currency:a,isDarkMode:i}=t,s=n=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:e}=require("@/lib/utils");return e(n||0,t(a||"USD"))}catch(t){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:a||"USD",minimumFractionDigits:2}).format(n||0)}catch(e){try{const{getCurrencyConfig:t,getDefaultCurrency:e}=require("@/lib/utils"),i=t(a||e()),s=(n||0).toFixed(i.decimals);return"before"===i.position?`${i.symbol}${s}`:`${s} ${i.symbol}`}catch(i){return`$${(n||0).toFixed(2)}`}}}},r=n=>{try{const t=new Date(n);if(isNaN(t.getTime()))return"--";const e=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${e}/${a}/${t.getFullYear()}`}catch(t){return"--"}},o=n=>p(n),d=n=>h(n);return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>${e}</title>\n        <style>\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap');\n\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n\n          body {\n            font-family: 'Noto Sans Arabic', Arial, sans-serif;\n            line-height: 1.6;\n            color: ${i?"#e5e7eb":"#1f2937"};\n            background-color: ${i?"#1f2937":"#ffffff"};\n            direction: rtl;\n            padding: 20px;\n          }\n\n          .header {\n            text-align: center;\n            margin-bottom: 30px;\n            border-bottom: 3px solid #3b82f6;\n            padding-bottom: 20px;\n          }\n\n          .header h1 {\n            color: #3b82f6;\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom: 10px;\n          }\n\n          .header p {\n            color: ${i?"#9ca3af":"#6b7280"};\n            font-size: 14px;\n          }\n\n          .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n          }\n\n          .stat-card {\n            background: ${i?"#374151":"#f8fafc"};\n            border: 1px solid ${i?"#4b5563":"#e2e8f0"};\n            border-radius: 8px;\n            padding: 20px;\n            text-align: center;\n          }\n\n          .stat-card h3 {\n            color: #3b82f6;\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 8px;\n          }\n\n          .stat-card .value {\n            font-size: 24px;\n            font-weight: 700;\n            color: ${i?"#e5e7eb":"#1f2937"};\n          }\n\n          .section {\n            margin-bottom: 30px;\n          }\n\n          .section h2 {\n            color: #3b82f6;\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            border-bottom: 2px solid #e2e8f0;\n            padding-bottom: 8px;\n          }\n\n          .table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            background: ${i?"#374151":"#ffffff"};\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n          }\n\n          .table th,\n          .table td {\n            padding: 12px;\n            text-align: right;\n            border-bottom: 1px solid ${i?"#4b5563":"#e2e8f0"};\n          }\n\n          .table th {\n            background: ${i?"#4b5563":"#f1f5f9"};\n            font-weight: 600;\n            color: ${i?"#e5e7eb":"#374151"};\n          }\n\n          .table tr:hover {\n            background: ${i?"#4b5563":"#f8fafc"};\n          }\n\n          .badge {\n            display: inline-block;\n            padding: 4px 8px;\n            border-radius: 4px;\n            font-size: 12px;\n            font-weight: 500;\n          }\n\n          .badge-pending { background: #fef3c7; color: #92400e; }\n          .badge-ordered { background: #dbeafe; color: #1e40af; }\n          .badge-received { background: #d1fae5; color: #065f46; }\n          .badge-cancelled { background: #fee2e2; color: #991b1b; }\n          .badge-urgent { background: #fee2e2; color: #991b1b; }\n          .badge-high { background: #fef3c7; color: #92400e; }\n          .badge-medium { background: #dbeafe; color: #1e40af; }\n          .badge-low { background: #d1fae5; color: #065f46; }\n\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            color: ${i?"#9ca3af":"#6b7280"};\n            font-size: 12px;\n            border-top: 1px solid ${i?"#4b5563":"#e2e8f0"};\n            padding-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>${e}</h1>\n          <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`})()} | ${n.filterInfo||"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"}</p>\n        </div>\n\n        <div class="stats-grid">\n          <div class="stat-card">\n            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</h3>\n            <div class="value">${n.totalNeeds||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>\n            <div class="value">${s(n.totalValue||0)}</div>\n          </div>\n          <div class="stat-card">\n            <h3>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n            <div class="value">${n.pendingCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</h3>\n            <div class="value">${n.urgentCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h3>\n            <div class="value">${(n.completionRate||0).toFixed(1)}%</div>\n          </div>\n          <div class="stat-card">\n            <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</h3>\n            <div class="value">${s(n.averageNeedValue||0)}</div>\n          </div>\n        </div>\n\n        ${n.needsByStatus&&n.needsByStatus.length>0?`\n        <div class="section">\n          <h2>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.needsByStatus.map(n=>`\n                <tr>\n                  <td><span class="badge badge-${n.status}">${o(n.status)}</span></td>\n                  <td>${n.count}</td>\n                  <td>${n.percentage.toFixed(1)}%</td>\n                  <td>${s(n.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.needsByPriority&&n.needsByPriority.length>0?`\n        <div class="section">\n          <h2>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.needsByPriority.map(n=>`\n                <tr>\n                  <td><span class="badge badge-${n.priority}">${d(n.priority)}</span></td>\n                  <td>${n.count}</td>\n                  <td>${n.percentage.toFixed(1)}%</td>\n                  <td>${s(n.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.topExpensiveNeeds&&n.topExpensiveNeeds.length>0?`\n        <div class="section">\n          <h2>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø£ØºÙ„Ù‰ Ø³Ø¹Ø±Ø§Ù‹ (Ø£Ø¹Ù„Ù‰ 10)</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</th>\n                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.topExpensiveNeeds.map(n=>`\n                <tr>\n                  <td>${n.need_name}</td>\n                  <td>${n.quantity}</td>\n                  <td>${s(n.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.needsByCategory&&n.needsByCategory.length>0?`\n        <div class="section">\n          <h2>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ù„ÙØ¦Ø©</th>\n                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.needsByCategory.map(n=>`\n                <tr>\n                  <td>${n.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${n.count}</td>\n                  <td>${s(n.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.urgentNeeds&&n.urgentNeeds.length>0?`\n        <div class="section">\n          <h2>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</th>\n                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>\n                <th>Ø§Ù„ÙØ¦Ø©</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.urgentNeeds.slice(0,10).map(n=>`\n                <tr>\n                  <td>${n.need_name}</td>\n                  <td><span class="badge badge-${n.status}">${o(n.status)}</span></td>\n                  <td>${n.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${s(n.price*n.quantity)}</td>\n                  <td>${r(n.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.pendingNeeds&&n.pendingNeeds.length>0?`\n        <div class="section">\n          <h2>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</th>\n                <th>Ø§Ù„ÙØ¦Ø©</th>\n                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.pendingNeeds.slice(0,10).map(n=>`\n                <tr>\n                  <td>${n.need_name}</td>\n                  <td>${n.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td><span class="badge badge-${n.priority}">${d(n.priority)}</span></td>\n                  <td>${s(n.price*n.quantity)}</td>\n                  <td>${r(n.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${n.recentlyReceived&&n.recentlyReceived.length>0?`\n        <div class="section">\n          <h2>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</th>\n                <th>Ø§Ù„ÙØ¦Ø©</th>\n                <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>\n                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.recentlyReceived.slice(0,10).map(n=>`\n                <tr>\n                  <td>${n.need_name}</td>\n                  <td>${n.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${n.supplier||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${s(n.price*n.quantity)}</td>\n                  <td>${r(n.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© | ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static createComprehensiveFinancialReportHTML(n,t){const e=n=>{try{const e=d(t?.currency||l());return c(n||0,e)}catch(e){return`$${(n||0).toFixed(2)}`}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ - ${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†"}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .report-subtitle {\n            font-size: 16px;\n            color: #64748b;\n            margin-bottom: 10px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #64748b;\n          }\n          .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin: 30px 0;\n          }\n          .summary-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 12px;\n            text-align: center;\n            border: 1px solid #e2e8f0;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          }\n          .summary-card h3 {\n            margin: 0 0 10px 0;\n            font-size: 14px;\n            color: #64748b;\n            font-weight: 600;\n          }\n          .summary-card .number {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          .profit { color: #10b981 !important; }\n          .loss { color: #ef4444 !important; }\n          .warning { color: #f59e0b !important; }\n          .section {\n            margin: 40px 0;\n            page-break-inside: avoid;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .subsection-title {\n            font-size: 16px;\n            font-weight: bold;\n            color: #1e293b;\n            margin: 20px 0 10px 0;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          td {\n            font-size: 13px;\n          }\n          .profit-loss-section {\n            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n            padding: 25px;\n            border-radius: 12px;\n            border: 1px solid #0ea5e9;\n            margin: 30px 0;\n          }\n          .two-column {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 20px 0;\n          }\n          .info-box {\n            background: #f8fafc;\n            padding: 15px;\n            border-radius: 8px;\n            border-left: 4px solid #0ea5e9;\n            margin: 15px 0;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n          @media print {\n            body { margin: 0; }\n            .section { page-break-inside: avoid; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">${t?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</div>\n          <div class="report-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</div>\n          <div class="report-subtitle">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>\n          <div class="report-date">${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</div>\n          ${n.filterInfo?`<div class="info-box">${n.filterInfo}</div>`:""}\n        </div>\n\n        \x3c!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --\x3e\n        <div class="section">\n          <div class="section-title">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>\n              <div class="number profit">${e(n.totalRevenue||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>\n              <div class="number">${e(n.totalExpenses||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>ØµØ§ÙÙŠ ${n.isProfit?"Ø§Ù„Ø±Ø¨Ø­":"Ø§Ù„Ø®Ø³Ø§Ø±Ø©"}</h3>\n              <div class="number ${n.isProfit?"profit":"loss"}">\n                ${e(n.isProfit?n.netProfit||0:n.lossAmount||0)}\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</h3>\n              <div class="number ${n.profitMargin>=0?"profit":"loss"}">\n                ${(n.profitMargin||0).toFixed(2)}%\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n              <div class="number warning">${e(n.totalPending||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</h3>\n              <div class="number warning">${e(n.totalOverdue||0)}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± --\x3e\n        <div class="profit-loss-section">\n          <div class="section-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</div>\n          <div class="two-column">\n            <div>\n              <div class="subsection-title">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>\n              <table>\n                <tr><td>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</td><td>${e(n.totalPaid||0)}</td></tr>\n                <tr><td>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</td><td>${e((n.totalRevenue||0)-(n.totalPaid||0))}</td></tr>\n                <tr><td><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</strong></td><td><strong>${e(n.totalRevenue||0)}</strong></td></tr>\n              </table>\n            </div>\n            <div>\n              <div class="subsection-title">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>\n              <table>\n                <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</td><td>${e(n.clinicExpensesTotal||0)}</td></tr>\n                <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±</td><td>${e(n.labOrdersTotal||0)}</td></tr>\n                <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</td><td>${e(n.clinicNeedsTotal||0)}</td></tr>\n                <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</td><td>${e(n.inventoryExpenses||0)}</td></tr>\n                <tr><td><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</strong></td><td><strong>${e(n.totalExpenses||0)}</strong></td></tr>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª --\x3e\n        <div class="section">\n          <div class="section-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>\n              <div class="number">${n.totalTransactions||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>\n              <div class="number profit">${n.completedPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</h3>\n              <div class="number warning">${n.partialPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>\n              <div class="number">${n.pendingPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</h3>\n              <div class="number profit">${n.successRate||"0.0"}%</div>\n            </div>\n            <div class="summary-card">\n              <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h3>\n              <div class="number">${e(parseFloat(n.averageTransaction||"0"))}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- ØªÙˆØ²ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ --\x3e\n        ${n.revenueByPaymentMethod&&n.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.revenueByPaymentMethod.map(n=>`\n                <tr>\n                  <td>${n.method}</td>\n                  <td>${e(n.amount)}</td>\n                  <td>${n.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ --\x3e\n        ${n.expensesByType&&n.expensesByType.length>0?`\n        <div class="section">\n          <div class="section-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.expensesByType.map(n=>`\n                <tr>\n                  <td>${n.type}</td>\n                  <td>${e(n.amount)}</td>\n                  <td>${n.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© --\x3e\n        ${n.expenses&&n.expenses.length>0?`\n        <div class="section">\n          <div class="section-title">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Ø¢Ø®Ø± 10 Ù…ØµØ±ÙˆÙØ§Øª)</div>\n          <table>\n            <thead>\n              <tr>\n                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</th>\n                <th>Ø§Ù„Ù†ÙˆØ¹</th>\n                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>\n                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>\n                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>\n                <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n.expenses.slice(0,10).map(n=>`\n                <tr>\n                  <td>${n.expense_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${{salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"}[n.expense_type]||n.expense_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${e(n.amount||0)}</td>\n                  <td>${{cash:"Ù†Ù‚Ø¯Ø§Ù‹",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",check:"Ø´ÙŠÙƒ",credit_card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†"}[n.payment_method]||n.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${n.payment_date?(()=>{try{return new Date(n.payment_date).toLocaleDateString("en-US")}catch{return n.payment_date}})():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                  <td>${n.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© | ${(()=>{const n=new Date;return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} - ${n.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static translateStatus(n){return r(n)}static translatePaymentMethod(n){return o(n)}static formatGregorianDate(n){if(!n||isNaN(n.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`}static createPatientPaymentsHTML(n,t){const{patient:e,payments:a}=n,i=t||{},s=n=>{if(i?.currency&&"SYP"!==i?.currency){const t={USD:"$",EUR:"â‚¬",SYP:"Ù„.Ø³",TRY:"â‚º",SAR:"Ø±.Ø³"}[i.currency]||i.currency;return`${n.toLocaleString("en-US")} ${t}`}return`${n.toLocaleString("en-US")} Ù„.Ø³`},r=n=>{const t=new Date(n);if(!t||isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`};let o=0;const d=[],l=[];a?.forEach(n=>{n.tooth_treatment_id?d.push(n):n.appointment_id&&l.push(n),o+=n.amount||0});let c=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ - ${e.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</h1>\n            ${i?.address?`<p>${i.address}</p>`:""}\n            ${i?.phone?`<p>Ø§Ù„Ù‡Ø§ØªÙ: ${i.phone}</p>`:""}\n            ${i?.email?`<p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${i.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>ØªÙ‚Ø±ÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h2>\n            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${r((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h3>\n          <div class="info-grid">\n            <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${e.full_name}</div>\n            <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${"male"===e.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</div>\n            <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${e.age} Ø³Ù†Ø©</div>\n            ${e.phone?`<div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${e.phone}</div>`:""}\n            ${e.email?`<div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${e.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª:</span>\n              <span class="value">${s(o)}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª:</span>\n              <span class="value">${a?.length||0}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª:</span>\n              <span class="value">${d.length}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</span>\n              <span class="value">${l.length}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const n="Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",t=["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù…Ø¨Ù„Øº","Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù†ÙˆØ¹","Ø§Ù„ÙˆØµÙ","Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„","Ø§Ù„Ø­Ø§Ù„Ø©"],e=a.map(n=>{const t=n.tooth_treatment_id?"Ø¹Ù„Ø§Ø¬ Ø³Ù†ÙŠ":n.appointment_id?"Ù…ÙˆØ¹Ø¯":"Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø©",e="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"partial"===n.status?"Ø¬Ø²Ø¦ÙŠ":"Ø¢Ø¬Ù„",a="cash"===n.payment_method?"Ù†Ù‚Ø¯ÙŠ":"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ";return`\n          <tr>\n            <td>${r(n.payment_date)}</td>\n            <td>${s(n.amount)}</td>\n            <td>${a}</td>\n            <td>${t}</td>\n            <td>${n.description||"-"}</td>\n            <td>${n.receipt_number||"-"}</td>\n            <td>${e}</td>\n          </tr>`});c+=`\n        <div class="section-title">${n}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(n=>`<th>${n}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${e.join("")}\n          </tbody>\n        </table>`}else c+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';return c+=`\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</p>\n          <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${r((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,c}static createPatientTreatmentsHTML(n,t){const{patient:e,treatments:a}=n,i=t||{},r=n=>{if(i?.currency&&"SYP"!==i?.currency){const t={USD:"$",EUR:"â‚¬",SYP:"Ù„.Ø³",TRY:"â‚º",SAR:"Ø±.Ø³"}[i.currency]||i.currency;return`${n.toLocaleString("en-US")} ${t}`}return`${n.toLocaleString("en-US")} Ù„.Ø³`},o=n=>{const t=new Date(n);if(!t||isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},d=a?.length||0,l=a?.filter(n=>"completed"===n.treatment_status).length||0,c=a?.filter(n=>"in_progress"===n.treatment_status).length||0,p=a?.filter(n=>"planned"===n.treatment_status).length||0,h=a?.reduce((n,t)=>n+(t.cost||0),0)||0;let m=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ - ${e.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</h1>\n            ${i?.address?`<p>${i.address}</p>`:""}\n            ${i?.phone?`<p>Ø§Ù„Ù‡Ø§ØªÙ: ${i.phone}</p>`:""}\n            ${i?.email?`<p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${i.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>ØªÙ‚Ø±ÙŠØ± Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h2>\n            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${o((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h3>\n          <div class="info-grid">\n            <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${e.full_name}</div>\n            <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${"male"===e.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</div>\n            <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${e.age} Ø³Ù†Ø©</div>\n            ${e.phone?`<div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${e.phone}</div>`:""}\n            ${e.email?`<div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${e.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø©:</span>\n              <span class="value">${p}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©:</span>\n              <span class="value">${r(h)}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const n="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª",t=["Ø±Ù‚Ù… Ø§Ù„Ø³Ù†","Ø§Ø³Ù… Ø§Ù„Ø³Ù†","Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬","Ø§Ù„ØªÙƒÙ„ÙØ©","Ø§Ù„Ø­Ø§Ù„Ø©","ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡","ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=a.map(n=>{const t="completed"===n.treatment_status?"Ù…ÙƒØªÙ…Ù„":"in_progress"===n.treatment_status?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°":"planned"===n.treatment_status?"Ù…Ø®Ø·Ø·":"Ù…Ù„ØºÙŠ",e=s(n.treatment_type||"");return`\n          <tr>\n            <td>${n.tooth_number||"-"}</td>\n            <td>${n.tooth_name||"-"}</td>\n            <td>${e}</td>\n            <td>${r(n.cost||0)}</td>\n            <td>${t}</td>\n            <td>${n.start_date?o(n.start_date):"-"}</td>\n            <td>${n.completion_date?o(n.completion_date):"-"}</td>\n            <td>${n.notes||"-"}</td>\n          </tr>`});m+=`\n        <div class="section-title">${n}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(n=>`<th>${n}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${e.join("")}\n          </tbody>\n        </table>`}else m+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ø¬Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';return m+=`\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</p>\n          <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${o((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,m}static createPatientAppointmentsHTML(n,t){const{patient:e,appointments:a}=n,i=t||{},s=n=>{if(!n)return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";const t=new Date(n);if(!t||isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},r=n=>{if(!n)return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";const t=new Date(n);return!t||isNaN(t.getTime())?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})},o=a?.length||0,d=a?.filter(n=>"completed"===n.status).length||0,l=a?.filter(n=>"cancelled"===n.status).length||0,c=a?.filter(n=>"scheduled"===n.status).length||0,p=a?.filter(n=>"no_show"===n.status).length||0;let h=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙŠØ¶ - ${e.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</h1>\n            ${i?.address?`<p>${i.address}</p>`:""}\n            ${i?.phone?`<p>Ø§Ù„Ù‡Ø§ØªÙ: ${i.phone}</p>`:""}\n            ${i?.email?`<p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${i.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙŠØ¶</h2>\n            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${s((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h3>\n          <div class="info-grid">\n            <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${e.full_name}</div>\n            <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${"male"===e.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</div>\n            <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${e.age} Ø³Ù†Ø©</div>\n            ${e.phone?`<div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${e.phone}</div>`:""}\n            ${e.email?`<div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${e.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ù„Ù… ÙŠØ­Ø¶Ø±:</span>\n              <span class="value">${p}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const n="Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",t=["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„ÙˆÙ‚Øª","Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ¹Ø¯","Ø§Ù„Ø­Ø§Ù„Ø©","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=a.map(n=>{const t="completed"===n.status?"Ù…ÙƒØªÙ…Ù„":"cancelled"===n.status?"Ù…Ù„ØºÙŠ":"scheduled"===n.status?"Ù…Ø¬Ø¯ÙˆÙ„":"no_show"===n.status?"Ù„Ù… ÙŠØ­Ø¶Ø±":"Ø¢Ø¬Ù„",e=(n=>{if(!n)return{date:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",time:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"};const t=new Date(n);return!t||isNaN(t.getTime())?{date:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",time:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}:{date:s(n),time:r(n)}})(n.start_time);return`\n          <tr>\n            <td>${e.date}</td>\n            <td>${e.time}</td>\n            <td>${n.title||n.appointment_type||"ÙØ­Øµ Ø¹Ø§Ù…"}</td>\n            <td>${t}</td>\n            <td>${n.notes||"-"}</td>\n          </tr>`});h+=`\n        <div class="section-title">${n}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(n=>`<th>${n}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${e.join("")}\n          </tbody>\n        </table>`}else h+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';return h+=`\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</p>\n          <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${s((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,h}static createPatientPrescriptionsHTML(n,t){const{patient:e,prescriptions:a}=n,i=t||{},s=n=>{const t=new Date(n);if(!t||isNaN(t.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},r=a?.length||0,o=a?.reduce((n,t)=>n+(t.medications?.length||0),0)||0,d=a?.filter(n=>{const t=new Date(n.prescription_date),e=new Date;return e.setDate(e.getDate()-30),t>=e}).length||0;let l=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>ÙˆØµÙØ§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ - ${e.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</h1>\n            ${i?.address?`<p>${i.address}</p>`:""}\n            ${i?.phone?`<p>Ø§Ù„Ù‡Ø§ØªÙ: ${i.phone}</p>`:""}\n            ${i?.email?`<p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${i.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>ØªÙ‚Ø±ÙŠØ± ÙˆØµÙØ§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h2>\n            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${s((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h3>\n          <div class="info-grid">\n            <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${e.full_name}</div>\n            <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${"male"===e.gender?"Ø°ÙƒØ±":"Ø£Ù†Ø«Ù‰"}</div>\n            <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${e.age} Ø³Ù†Ø©</div>\n            ${e.phone?`<div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${e.phone}</div>`:""}\n            ${e.email?`<div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${e.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>Ù…Ù„Ø®Øµ Ø§Ù„ÙˆØµÙØ§Øª</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙØ§Øª:</span>\n              <span class="value">${r}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (30 ÙŠÙˆÙ…):</span>\n              <span class="value">${d}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const n="Ø³Ø¬Ù„ Ø§Ù„ÙˆØµÙØ§Øª",t=["ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙØ©","Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡","Ø§Ù„Ø¬Ø±Ø¹Ø©","ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"],e=[];a.forEach(n=>{n.medications&&n.medications.length>0?n.medications.forEach(t=>{e.push(`\n              <tr>\n                <td>${s(n.prescription_date)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dose||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${n.notes||"-"}</td>\n              </tr>`)}):e.push(`\n            <tr>\n              <td>${s(n.prescription_date)}</td>\n              <td>-</td>\n              <td>-</td>\n              <td>-</td>\n              <td>${n.notes||"-"}</td>\n            </tr>`)}),l+=`\n        <div class="section-title">${n}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(n=>`<th>${n}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${e.join("")}\n          </tbody>\n        </table>`}else l+='\n        <div class="section-title">Ø³Ø¬Ù„ Ø§Ù„ÙˆØµÙØ§Øª</div>\n        <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØµÙØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶</div>';return l+=`\n        <div class="footer">\n          <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ${i?.clinic_name||"Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"}</p>\n          <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${s((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,l}static async exportLabReport(n,t,e){if(!n||0===n.totalOrders)return void("undefined"!=typeof window&&window.api&&window.api.sendNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.","error"));const a=m.createEnhancedLabReportHTML(n,t),i=e?.fileName||`ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª_${(new Date).toISOString().slice(0,10)}.pdf`;await this.convertHTMLToPDF(a,i)}static async exportClinicNeedsReport(n,t,e){if(!n||0===n.totalNeeds)return void("undefined"!=typeof window&&window.api&&window.api.sendNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.","error"));const a=m.createEnhancedClinicNeedsReportHTML(n,t),i=e?.fileName||`ØªÙ‚Ø±ÙŠØ±_Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª_Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©_${(new Date).toISOString().slice(0,10)}.pdf`;await this.convertHTMLToPDF(a,i)}static async exportExpenseReport(n,t,e){if(!n||0===n.totalExpenses)return void("undefined"!=typeof window&&window.api&&window.api.sendNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.","error"));const a=m.createEnhancedExpenseReportHTML(n,t),i=e?.fileName||`ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª_${(new Date).toISOString().slice(0,10)}.pdf`;await this.convertHTMLToPDF(a,i)}}export{b as P};
