import{j as e}from"./ui-cacc1eea.js";import{r as s}from"./vendor-696af5bd.js";import{aj as t,w as a,r as l,S as i,m as n,n as r,o as c,p as d,a1 as x,D as m,f as h,g as o,h as j,i as p,L as u,I as N,T as g,x as f,ah as v,y as b,z as w,E as y,G as C,F as k,H as S,N as F,O as P,P as D,C as _,j as O,k as M,l as E,B as L,M as z,$ as T,U as $,aY as V,a_ as R,b9 as A,ba as I,bb as Q,bc as q,Z as B,b as H,ae as X,at as G,a0 as J,v as K,a5 as U,ag as Y}from"./index-3a8dc84c.js";import{T as Z,a as W,b as ee,c as se}from"./tabs-952e3ebd.js";import{C as te,b as ae}from"./collapsible-d3d2b240.js";import{u as le,A as ie}from"./AddPrescriptionDialog-e7062ace.js";import{g as ne,a as re}from"./cardStyles-c77ef46a.js";import{u as ce,T as de}from"./useTimeFilteredStats-1c30c8be.js";import{S as xe,n as me}from"./notificationService-09cb27cc.js";import{T as he,a as oe,b as je,c as pe,d as ue,e as Ne}from"./table-20957d0a.js";import{P as ge}from"./pill-2f66511d.js";import{P as fe}from"./pen-square-6c634feb.js";import{T as ve}from"./upload-4df8a268.js";import{C as be,a as we}from"./chevrons-right-9b995d31.js";import{C as ye}from"./chevron-left-343e35ff.js";import{P as Ce}from"./PrescriptionReceiptDialog-36713fb4.js";import{F as ke}from"./file-text-861b9f90.js";import{P as Se}from"./printer-5ab76652.js";import{P as Fe}from"./plus-1eab3b5b.js";import{F as Pe}from"./filter-f006659c.js";import"./pdf-991f41f6.js";import"./utils-ec524415.js";import"./charts-b4389b44.js";import"./index-a46c293c.js";import"./qr-d6f50769.js";import"./settings-39dd9f65.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=t("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function _e({medications:t,onEdit:m,onDelete:h,searchQuery:o}){const{isLoading:j}=le(),[p,u]=s.useState(1),[N,g]=s.useState(10),f=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.instructions&&e.instructions.toLowerCase().includes(o.toLowerCase())),v=f.length,b=Math.ceil(v/N),w=(p-1)*N,y=f.slice(w,w+N),C=e=>{u(e)};return j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الأدوية..."})]})}):0===f.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد أدوية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:o?"لم يتم العثور على أدوية تطابق البحث":"لم يتم إضافة أي أدوية بعد"}),!o&&e.jsxs(a,{onClick:()=>m({}),children:[e.jsx(ge,{className:"w-4 h-4 ml-2"}),"إضافة دواء جديد"]})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(he,{className:"table-center-all",children:[e.jsx(oe,{children:e.jsxs(je,{children:[e.jsx(pe,{className:"text-center",children:"#"}),e.jsx(pe,{className:"text-center",children:"اسم الدواء"}),e.jsx(pe,{className:"text-center",children:"التعليمات"}),e.jsx(pe,{className:"text-center",children:"تاريخ الإضافة"}),e.jsx(pe,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),e.jsx(ue,{children:y.map((s,t)=>e.jsxs(je,{className:"hover:bg-muted/50",children:[e.jsx(Ne,{className:"font-medium text-center",children:w+t+1}),e.jsx(Ne,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(Ne,{className:"text-center",children:e.jsx("div",{className:"max-w-xs mx-auto",children:s.instructions?e.jsx("div",{className:"text-sm text-muted-foreground",title:s.instructions,children:s.instructions}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد تعليمات"})})}),e.jsx(Ne,{className:"text-center",children:e.jsx("div",{className:"text-sm",children:l(s.created_at)})}),e.jsx(Ne,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{m(e)})(s),className:"action-btn-edit action-btn-icon",title:"تعديل الدواء",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{h(e)})(s),className:"action-btn-delete action-btn-icon",title:"حذف الدواء",children:e.jsx(ve,{className:"w-4 h-4"})})]})})]},s.id))})]}),b>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(i,{value:`${N}`,onValueChange:e=>{g(parseInt(e)),u(1)},children:[e.jsx(n,{className:"h-8 w-[70px]",children:e.jsx(r,{placeholder:N})}),e.jsx(c,{side:"top",children:[5,10,20,30,50].map(s=>e.jsx(d,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",p," من ",b]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(a,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(be,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(p-1),disabled:1===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(x,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(p+1),disabled:p===b,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(ye,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(b),disabled:p===b,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(we,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",w+1," إلى ",Math.min(w+N,v)," من ",v," نتيجة"]})]}),e.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["إجمالي الأدوية: ",f.length]}),o&&e.jsxs("span",{children:["نتائج البحث: ",f.length," من ",t.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"قاعدة بيانات الأدوية"})]})]})})]})}function Oe({open:t,onOpenChange:l,editingMedication:i}){const{createMedication:n,updateMedication:r,isLoading:c}=le(),[d,x]=s.useState({name:"",instructions:""}),[b,w]=s.useState({});s.useEffect(()=>{t&&(x(i?{name:i.name||"",instructions:i.instructions||""}:{name:"",instructions:""}),w({}))},[t,i]);const y=(e,s)=>{x(t=>({...t,[e]:s})),b[e]&&w(s=>({...s,[e]:""}))},C=()=>{c||l(!1)};return e.jsx(m,{open:t,onOpenChange:C,children:e.jsxs(h,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(o,{children:[e.jsxs(j,{className:"flex items-center gap-2 text-right",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),i?"تعديل الدواء":"إضافة دواء جديد"]}),e.jsx(p,{className:"text-right",children:i?"قم بتعديل معلومات الدواء أدناه":"أدخل معلومات الدواء الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return d.name.trim()?d.name.trim().length<2&&(e.name="اسم الدواء يجب أن يكون على الأقل حرفين"):e.name="اسم الدواء مطلوب",w(e),0===Object.keys(e).length})())try{const e={name:d.name.trim(),instructions:d.instructions.trim()||void 0};i&&i.id?(await r(i.id,e),me.success("تم تحديث الدواء بنجاح")):(await n(e),me.success("تم إضافة الدواء بنجاح")),l(!1)}catch(s){console.error("Error saving medication:",s),me.error(i?"فشل في تحديث الدواء":"فشل في إضافة الدواء")}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"name",className:"text-right block",children:["اسم الدواء ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(N,{id:"name",value:d.name,onChange:e=>y("name",e.target.value),placeholder:"أدخل اسم الدواء",className:"text-right "+(b.name?"border-red-500":""),dir:"rtl",disabled:c}),b.name&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:b.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"instructions",className:"text-right block",children:"تعليمات الاستخدام"}),e.jsx(g,{id:"instructions",value:d.instructions,onChange:e=>y("instructions",e.target.value),placeholder:"أدخل تعليمات استخدام الدواء (اختياري)",className:"text-right min-h-[100px]",dir:"rtl",disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"مثال: قرص واحد كل 8 ساعات بعد الأكل"})]})]}),e.jsxs(f,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(a,{type:"button",variant:"outline",onClick:C,disabled:c,children:[e.jsx(v,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsx(a,{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white",children:c?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 ml-2"}),i?"تحديث":"إضافة"]})})]})]})]})})}function Me({open:s,onOpenChange:t,medication:a}){const{deleteMedication:l,isLoading:i}=le();return a?e.jsx(b,{open:s,onOpenChange:()=>{i||t(!1)},children:e.jsxs(w,{dir:"rtl",className:"sm:max-w-[425px]",children:[e.jsxs(y,{children:[e.jsxs(C,{className:"flex items-center gap-2 text-right",children:[e.jsx(k,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الدواء"]}),e.jsxs(S,{className:"text-right space-y-2",children:[e.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الدواء التالي؟"}),e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:a.name})]}),a.instructions&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["التعليمات: ",a.instructions]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الدواء نهائياً من النظام. إذا كان هذا الدواء مرتبط بوصفات طبية موجودة، فقد يؤثر ذلك على سجلات المرضى."})]})]}),e.jsxs(F,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(P,{disabled:i,children:"إلغاء"}),e.jsx(D,{onClick:async()=>{if(a)try{await l(a.id),me.success("تم حذف الدواء بنجاح"),t(!1)}catch(e){console.error("Error deleting medication:",e),me.error("فشل في حذف الدواء")}},disabled:i,className:"bg-red-600 hover:bg-red-700 text-white",children:i?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}function Ee({open:s,onOpenChange:t,prescription:i,onEdit:n,onPrint:r}){if(!i)return null;return e.jsx(m,{open:s,onOpenChange:t,children:e.jsxs(h,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(o,{children:[e.jsxs(j,{className:"flex items-center gap-2 text-right",children:[e.jsx(ke,{className:"w-5 h-5 text-green-600"}),"تفاصيل الوصفة الطبية"]}),e.jsxs(p,{className:"text-right",children:["عرض تفاصيل الوصفة الطبية للمريض ",i.patient?.full_name]})]}),e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs(_,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs(M,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(ke,{className:"w-5 h-5 text-green-600"}),"معلومات الوصفة"]})}),e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"رقم الوصفة:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",className:"font-mono",children:["PRX-",i.id.slice(-6)]}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>{const e=`PRX-${i.id.slice(-6)}`;navigator.clipboard.writeText(e)},className:"h-6 w-6 p-0",title:"نسخ رقم الوصفة",children:e.jsx(De,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الوصفة:"}),e.jsx("span",{className:"text-sm font-medium",children:l(i.prescription_date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الإنشاء:"}),e.jsx("span",{className:"text-sm",children:l(i.created_at)})]}),i.updated_at!==i.created_at&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"آخر تحديث:"}),e.jsx("span",{className:"text-sm",children:l(i.updated_at)})]})]})]})})]}),e.jsxs(_,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs(M,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),"معلومات المريض"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"اسم المريض:"}),e.jsx("span",{className:"font-medium text-lg",children:i.patient?.full_name||"غير محدد"})]}),i.appointment&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الموعد المرتبط:"}),e.jsx(L,{variant:"secondary",className:"font-medium",children:i.appointment.title})]})]})})]}),e.jsxs(_,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs(M,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-600"}),"الأدوية الموصوفة (",i.medications?.length||0,")"]})}),e.jsx(E,{children:i.medications&&i.medications.length>0?e.jsx("div",{className:"space-y-3",children:i.medications.map((s,t)=>e.jsx("div",{className:"border rounded-lg p-4 bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-950/20 dark:to-yellow-950/20",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0 font-bold",children:t+1}),e.jsx("h4",{className:"font-bold text-lg text-orange-800 dark:text-orange-200",children:s.medication_name})]}),s.dose&&e.jsxs("div",{className:"flex items-center gap-2 mr-10",children:[e.jsx(ge,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الجرعة:"}),e.jsx("span",{className:"font-medium text-orange-700 dark:text-orange-300",children:s.dose})]}),s.medication_instructions&&e.jsx("div",{className:"mr-10 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-md border-r-4 border-blue-400",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"تعليمات الاستخدام:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:s.medication_instructions})]})]})})]})})},t))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"لا توجد أدوية موصوفة في هذه الوصفة"})]})})]}),i.notes&&e.jsxs(_,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs(M,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(ke,{className:"w-5 h-5 text-purple-600"}),"ملاحظات الطبيب"]})}),e.jsx(E,{children:e.jsx("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg border-r-4 border-purple-400",children:e.jsx("p",{className:"text-purple-800 dark:text-purple-200 leading-relaxed",children:i.notes})})})]})]}),e.jsxs(f,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(a,{variant:"outline",onClick:()=>t(!1),children:[e.jsx(v,{className:"w-4 h-4 ml-2"}),"إغلاق"]}),r&&e.jsxs(a,{variant:"outline",onClick:()=>{r&&r(i)},children:[e.jsx(Se,{className:"w-4 h-4 ml-2"}),"طباعة"]}),n&&e.jsxs(a,{onClick:()=>{n&&(n(i),t(!1))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(fe,{className:"w-4 h-4 ml-2"}),"تعديل الوصفة"]})]})]})})}function Le({prescriptions:t,onEdit:m,onDelete:h}){const{isLoading:o}=R(),[j,p]=s.useState(1),[u,N]=s.useState(10),[g,f]=s.useState(!1),[v,b]=s.useState(null),[w,y]=s.useState(!1),[C,k]=s.useState(null),S=e=>{b(e),f(!0)},F=t.length,P=Math.ceil(F/u),D=(j-1)*u,_=t.slice(D,D+u),O=e=>{p(e)};return o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الوصفات الطبية..."})]})}):0===t.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية بعد"}),e.jsxs(a,{onClick:()=>m(null),children:[e.jsx(ke,{className:"w-4 h-4 ml-2"}),"إنشاء وصفة طبية جديدة"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(he,{className:"table-center-all",children:[e.jsx(oe,{children:e.jsxs(je,{children:[e.jsx(pe,{className:"text-center w-[60px]",children:"رقم"}),e.jsx(pe,{className:"text-center",children:"اسم المريض"}),e.jsx(pe,{className:"text-center",children:"الموعد"}),e.jsx(pe,{className:"text-center",children:"عدد الأدوية"}),e.jsx(pe,{className:"text-center",children:"تاريخ الوصفة"}),e.jsx(pe,{className:"text-center",children:"ملاحظات"}),e.jsx(pe,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),e.jsx(ue,{children:_.map((s,t)=>e.jsxs(je,{className:"hover:bg-muted/50",children:[e.jsx(Ne,{className:"font-medium text-center",children:D+t+1}),e.jsx(Ne,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.patient?.full_name||"غير محدد"})]})}),e.jsx(Ne,{className:"text-center",children:s.appointment?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:s.appointment.title})]}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا يوجد موعد"})}),e.jsx(Ne,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-purple-600"}),e.jsxs(L,{variant:"secondary",children:[s.medications?.length||0," دواء"]})]})}),e.jsx(Ne,{className:"text-center",children:e.jsx("div",{className:"text-sm",children:l(s.prescription_date)})}),e.jsx(Ne,{className:"text-center",children:e.jsx("div",{className:"max-w-xs mx-auto",children:s.notes?e.jsx(A,{children:e.jsxs(I,{children:[e.jsx(Q,{asChild:!0,children:e.jsx("div",{className:"text-sm text-muted-foreground cursor-help",children:s.notes})}),e.jsx(q,{children:e.jsx("p",{className:"max-w-xs",children:s.notes})})]})}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد ملاحظات"})})}),e.jsx(Ne,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{k(e),y(!0)})(s),className:"action-btn-view action-btn-icon",title:"عرض التفاصيل",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>S(s),className:"action-btn-print action-btn-icon",title:"طباعة الوصفة",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{m(e)})(s),className:"action-btn-warning action-btn-icon",title:"تعديل الوصفة",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{h(e)})(s),className:"action-btn-delete action-btn-icon",title:"حذف الوصفة",children:e.jsx(ve,{className:"w-4 h-4"})})]})})]},s.id))})]}),P>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(i,{value:`${u}`,onValueChange:e=>{N(parseInt(e)),p(1)},children:[e.jsx(n,{className:"h-8 w-[70px]",children:e.jsx(r,{placeholder:u})}),e.jsx(c,{side:"top",children:[5,10,20,30,50].map(s=>e.jsx(d,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",j," من ",P]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(a,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>O(1),disabled:1===j,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(be,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>O(j-1),disabled:1===j,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(x,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>O(j+1),disabled:j===P,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(ye,{className:"h-4 w-4"})]}),e.jsxs(a,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>O(P),disabled:j===P,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(we,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",D+1," إلى ",Math.min(D+u,F)," من ",F," نتيجة"]})]}),e.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["إجمالي الوصفات: ",t.length]}),e.jsxs("span",{children:["إجمالي الأدوية: ",t.reduce((e,s)=>e+(s.medications?.length||0),0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"سجل الوصفات الطبية"})]})]})})]}),v&&e.jsx(Ce,{open:g,onOpenChange:f,prescription:v}),C&&e.jsx(Ee,{open:w,onOpenChange:y,prescription:C,onEdit:e=>{y(!1),m(e)},onPrint:e=>{y(!1),S(e)}})]})}function ze({open:s,onOpenChange:t,prescription:a}){const{deletePrescription:i,isLoading:n}=R();return a?e.jsx(b,{open:s,onOpenChange:()=>{n||t(!1)},children:e.jsxs(w,{dir:"rtl",className:"sm:max-w-[500px]",children:[e.jsxs(y,{children:[e.jsxs(C,{className:"flex items-center gap-2 text-right",children:[e.jsx(k,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الوصفة الطبية"]}),e.jsxs(S,{className:"text-right space-y-4",children:[e.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الوصفة الطبية التالية؟"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(ke,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:"تفاصيل الوصفة الطبية"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"المريض: "}),a.patient?.full_name||"غير محدد"]})]}),a.appointment&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"الموعد: "}),a.appointment.title]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"تاريخ الوصفة: "}),l(a.prescription_date)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-medium",children:["الأدوية (",a.medications?.length||0,"):"]})]}),a.medications&&a.medications.length>0?e.jsx("div",{className:"space-y-1 mr-6",children:a.medications.map((s,t)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium",children:s.medication_name}),s.dose&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["الجرعة: ",s.dose]})]},t))}):e.jsx("div",{className:"text-sm text-muted-foreground mr-6",children:"لا توجد أدوية مرفقة"})]}),a.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"الملاحظات:"}),e.jsx("div",{className:"text-sm text-muted-foreground bg-white p-2 rounded border",children:a.notes})]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الوصفة الطبية نهائياً من النظام مع جميع الأدوية المرفقة بها. هذا قد يؤثر على السجل الطبي للمريض."})]})]}),e.jsxs(F,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(P,{disabled:n,children:"إلغاء"}),e.jsx(D,{onClick:async()=>{if(a)try{await i(a.id),me.success("تم حذف الوصفة الطبية بنجاح"),t(!1)}catch(e){console.error("Error deleting prescription:",e),me.error("فشل في حذف الوصفة الطبية")}},disabled:n,className:"bg-red-600 hover:bg-red-700 text-white",children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}function Te(){const{medications:t,loadMedications:l,isLoading:x}=le(),{prescriptions:m,filteredPrescriptions:h,totalPrescriptions:o,recentPrescriptions:j,loadPrescriptions:p,setSearchQuery:u,setPatientFilter:g,setDateRangeFilter:f,clearFilters:b,isLoading:w}=R(),{patients:y,loadPatients:C}=H(),k=ce({data:m,dateField:"prescription_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[S,F]=s.useState("prescriptions"),[P,D]=s.useState(""),[L,z]=s.useState(!1),[$,V]=s.useState(!1),[A,I]=s.useState(!1),[Q,q]=s.useState(null),[B,xe]=s.useState(null),[he,oe]=s.useState(!1),[je,pe]=s.useState(!1),[ue,Ne]=s.useState(null),[fe,ve]=s.useState(null),[be,we]=s.useState("all"),[ye,Ce]=s.useState({start:"",end:""});X(),s.useEffect(()=>{l(),p(),C()},[l,p,C]);const Se=(e,s)=>{const t={...ye,[e]:s};Ce(t),f(t)};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground text-right",children:"الأدوية والوصفات الطبية"}),e.jsx("p",{className:"text-muted-foreground mt-2 text-right",children:"إدارة الأدوية والوصفات الطبية للمرضى"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(a,{variant:"outline",onClick:async()=>{try{await Promise.all([l(),p(),C()]),me.success("تم تحديث البيانات بنجاح")}catch(e){me.error("فشل في تحديث البيانات")}},disabled:x||w,children:[e.jsx(G,{className:"w-4 h-4 ml-2 "+(x||w?"animate-spin":"")}),"تحديث"]}),e.jsxs(a,{onClick:"medications"===S?()=>{q(null),V(!0)}:()=>{Ne(null),oe(!0)},children:[e.jsx(Fe,{className:"w-4 h-4 ml-2"}),"medications"===S?"إضافة دواء":"إضافة وصفة طبية"]})]})]}),e.jsx(de,{value:k.timeFilter,onChange:k.handleFilterChange,onClear:k.resetFilter,title:"فلترة زمنية - الوصفات الطبية",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",dir:"rtl",children:[e.jsxs(_,{className:ne("blue"),children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-right",children:"إجمالي الأدوية"}),e.jsx(ge,{className:re("blue")})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:t.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"الأدوية المتاحة في النظام"})]})]}),e.jsxs(_,{className:ne("green"),children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"إجمالي الوصفات":"الوصفات المفلترة"}),e.jsx(ke,{className:re("green")})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?m.length:k.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"وصفات إجمالية":"وصفات في الفترة المحددة"}),k.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(k.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(k.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(_,{className:ne("purple"),children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-right",children:"الوصفات الحديثة"}),e.jsx(T,{className:re("purple")})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:j}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"آخر 30 يوماً"})]})]}),e.jsxs(_,{className:ne("yellow"),children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-right",children:"المرضى النشطون"}),e.jsx(J,{className:re("yellow")})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:y.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"المرضى المسجلون"})]})]})]}),e.jsxs(_,{children:[e.jsx(O,{dir:"rtl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-right",children:"البحث والفلاتر"}),e.jsx(K,{className:"text-right",children:"البحث في الأدوية والوصفات الطبية"})]}),e.jsxs(a,{variant:"outline",onClick:()=>z(!L),children:[e.jsx(Pe,{className:"w-4 h-4 ml-2"}),L?"إخفاء الفلاتر":"إظهار الفلاتر",e.jsx(U,{className:"w-4 h-4 mr-2 transition-transform "+(L?"rotate-180":"")})]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(N,{placeholder:"medications"===S?"البحث في الأدوية...":"البحث في الوصفات الطبية...",value:P,onChange:e=>{D(e.target.value),"prescriptions"===S&&u(e.target.value)},className:"pr-10 text-right",dir:"rtl"}),P&&e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>{D(""),"prescriptions"===S&&u("")},className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:e.jsx(v,{className:"w-3 h-3"})})]}),"prescriptions"===S&&e.jsx(te,{open:L,onOpenChange:z,children:e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"فلترة حسب المريض"}),e.jsxs(i,{value:be,onValueChange:e=>{we(e),g(e)},children:[e.jsx(n,{className:"text-right",dir:"rtl",children:e.jsx(r,{placeholder:"اختر مريض"})}),e.jsxs(c,{children:[e.jsx(d,{value:"all",children:"جميع المرضى"}),y.map(s=>e.jsx(d,{value:s.id,children:s.full_name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"من تاريخ"}),e.jsx(N,{type:"date",value:ye.start,onChange:e=>Se("start",e.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"إلى تاريخ"}),e.jsx(N,{type:"date",value:ye.end,onChange:e=>Se("end",e.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(a,{variant:"outline",onClick:()=>{we("all"),Ce({start:"",end:""}),u(""),b()},children:[e.jsx(v,{className:"w-4 h-4 ml-2"}),"مسح الفلاتر"]})})]})})]})})]}),e.jsxs(Z,{value:S,onValueChange:F,className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-between",dir:"rtl",children:e.jsxs(W,{className:"grid w-fit grid-cols-2",children:[e.jsxs(ee,{value:"prescriptions",className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"الوصفات الطبية"]}),e.jsxs(ee,{value:"medications",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"إدارة الأدوية"]})]})}),e.jsx(se,{value:"prescriptions",className:"space-y-4",dir:"rtl",children:e.jsxs(_,{children:[e.jsxs(O,{dir:"rtl",children:[e.jsxs(M,{className:"flex items-center gap-2 text-right",children:[e.jsx(ke,{className:"w-5 h-5"}),"الوصفات الطبية"]}),e.jsx(K,{className:"text-right",children:"إدارة جميع الوصفات الطبية للمرضى"})]}),e.jsx(E,{children:e.jsx(Le,{prescriptions:h,onEdit:e=>{Ne(e),oe(!0)},onDelete:e=>{ve(e),pe(!0)}})})]})}),e.jsx(se,{value:"medications",className:"space-y-4",dir:"rtl",children:e.jsxs(_,{children:[e.jsxs(O,{dir:"rtl",children:[e.jsxs(M,{className:"flex items-center gap-2 text-right",children:[e.jsx(ge,{className:"w-5 h-5"}),"إدارة الأدوية"]}),e.jsx(K,{className:"text-right",children:"إدارة معلومات الأدوية المتاحة"})]}),e.jsx(E,{children:e.jsx(_e,{medications:t,onEdit:e=>{q(e),V(!0)},onDelete:e=>{xe(e),I(!0)},searchQuery:P})})]})})]}),e.jsx(Oe,{open:$,onOpenChange:()=>{V(!1),q(null)},editingMedication:Q}),e.jsx(Me,{open:A,onOpenChange:()=>{I(!1),xe(null)},medication:B}),e.jsx(ie,{open:he,onOpenChange:()=>{oe(!1),Ne(null)},editingPrescription:ue}),e.jsx(ze,{open:je,onOpenChange:()=>{pe(!1),ve(null)},prescription:fe})]})}export{Te as default};
