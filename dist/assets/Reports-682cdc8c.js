import{j as e}from"./ui-cacc1eea.js";import{r as t}from"./vendor-696af5bd.js";import{aj as s,aH as a,r as n,K as r,aI as l,aJ as i,q as c,aK as d,aL as o,B as m,at as x,u as h,aM as u,C as p,j as g,a3 as f,k as j,v as y,a4 as v,a5 as N,l as b,L as w,I as $,w as F,a6 as _,Z as D,S as k,m as A,n as C,o as S,aN as E,p as P,a8 as M,F as T,a9 as R,a0 as O,aO as I,aP as L,aQ as z,aR as B,Q as V,ar as q,b as Y,aS as K,aT as W,aU as H,aV as G,ag as U,aG as X,M as Z,c as J,$ as Q,a as ee,e as te,as as se,_ as ae,s as ne,R as re,aW as le,d as ie,aX as ce,aY as de,A as oe,aZ as me,a_ as xe}from"./index-3a8dc84c.js";import{T as he,a as ue,b as pe,c as ge}from"./tabs-952e3ebd.js";import{u as fe,a as je,e as ye,b as ve,c as Ne,v as be,d as we,f as $e,g as Fe,h as _e}from"./chartDataHelpers-a79b834e.js";import{u as De}from"./expensesStore-f3f1428b.js";import{u as ke,C as Ae}from"./clinicNeedsStore-c3c0792a.js";import{u as Ce}from"./labOrderStore-b969024d.js";import{g as Se,a as Ee}from"./cardStyles-c77ef46a.js";import{C as Pe}from"./currency-display-e01ebf49.js";import{E as Me}from"./excel-37615a09.js";import{C as Te,a as Re,b as Oe}from"./collapsible-d3d2b240.js";import{U as Ie}from"./unlock-51cfe0e8.js";import{P as Le}from"./pdfService-844f6d4e.js";import{E as ze}from"./exportService-1536567b.js";import{U as Be}from"./users-5a609aa2.js";import{D as Ve}from"./upload-4df8a268.js";import{P as qe}from"./pie-chart-ac153dee.js";import{R as Ye,P as Ke,a as We,C as He,T as Ge,B as Ue,b as Xe,X as Ze,Y as Je,d as Qe,A as et,e as tt,L as st,f as at,g as nt}from"./charts-b4389b44.js";import{B as rt}from"./bar-chart-3-2a89747c.js";import{T as lt}from"./trending-up-5cd3f2a0.js";import{T as it}from"./trending-down-0dc1e939.js";import{n as ct,X as dt,a as ot}from"./notificationService-09cb27cc.js";import{u as mt,T as xt}from"./useTimeFilteredStats-1c30c8be.js";import{P as ht}from"./package-557fa287.js";import{C as ut}from"./calculator-63fcb348.js";import{P as pt}from"./plus-1eab3b5b.js";import{Z as gt}from"./zap-6d3cd988.js";import{T as ft,a as jt,b as yt,c as vt,d as Nt,e as bt}from"./table-20957d0a.js";import{B as wt}from"./building-2-acc8549f.js";import{F as $t}from"./file-text-861b9f90.js";import{F as Ft}from"./filter-f006659c.js";import"./pdf-991f41f6.js";import"./utils-ec524415.js";import"./index-a46c293c.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=s("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Dt=s("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),kt=s("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),At=s("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Ct=s("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */class St extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ReportsErrorBoundary caught an error:",{error:a(e),errorInfo:a(t),componentStack:a(t.componentStack)}),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-600 text-lg font-semibold mb-4",children:"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±"}),e.jsx("div",{className:"text-red-500 text-sm mb-4 text-center",children:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"}),!1]}):this.props.children}}const Et=St;class Pt{static validatePaymentCalculations(e){const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},s=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,s)=>e+("partial"===s.status&&void 0!==s.amount_paid?t(s.amount_paid):t(s.amount)),0),a=e.filter(e=>"completed"===e.status).reduce((e,s)=>e+t(s.amount),0),n=e.filter(e=>"partial"===e.status).reduce((e,s)=>e+(void 0!==s.amount_paid?t(s.amount_paid):t(s.amount)),0),r=e.filter(e=>"pending"===e.status).reduce((e,s)=>{const a=t(s.amount),n=t(s.total_amount_due);return e+(0===a&&n>0?n:a)},0),l=e.filter(e=>{if("pending"!==e.status)return!1;const t=new Date(e.payment_date),s=new Date;return s.setDate(s.getDate()-30),t<s}).reduce((e,s)=>{const a=t(s.amount),n=t(s.total_amount_due);return e+(0===a&&n>0?n:a)},0),i=a+n;return Math.abs(s-i)>.01&&console.warn("Payment calculation mismatch:",{totalRevenue:s,calculatedTotal:a+n,completedAmount:a,partialAmount:n,difference:s-i}),{totalRevenue:Math.round(100*s)/100,completedAmount:Math.round(100*a)/100,partialAmount:Math.round(100*n)/100,pendingAmount:Math.round(100*r)/100,overdueAmount:Math.round(100*l)/100,isValid:Math.abs(s-i)<=.01}}static validateAppointmentStats(e){const t=e.length,s=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,n=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,l=s+a+n+r,i=t-l;0!==i&&console.warn("Appointment status calculation mismatch:",{total:t,calculatedTotal:l,otherStatuses:i,statusBreakdown:{completed:s,cancelled:a,noShow:n,scheduled:r}});return{total:t,completed:s,cancelled:a,noShow:n,scheduled:r,attendanceRate:t>0?Math.round(s/t*100):0,isValid:0===i}}static validateInventoryStats(e){const t=e.length,s=e.reduce((e,t)=>e+(t.unit_price||0)*(t.quantity||0),0),a=e.filter(e=>(e.quantity||0)<=(e.minimum_stock||0)&&(e.quantity||0)>0).length,n=e.filter(e=>0===(e.quantity||0)).length,r=e.filter(e=>(e.quantity||0)>(e.minimum_stock||0)).length,l=a+n+r;return l!==t&&console.warn("Inventory calculation mismatch:",{totalItems:t,calculatedTotal:l,breakdown:{lowStockItems:a,outOfStockItems:n,inStockItems:r}}),{totalItems:t,totalValue:Math.round(100*s)/100,lowStockItems:a,outOfStockItems:n,inStockItems:r,isValid:l===t}}static validateAllData(e){const t=this.validatePaymentCalculations(e.payments),s=this.validateAppointmentStats(e.appointments),a=this.validateInventoryStats(e.inventory),n=t.isValid&&s.isValid&&a.isValid;return n||console.error("Data validation failed:",{payments:t.isValid,appointments:s.isValid,inventory:a.isValid}),{payments:t,appointments:s,inventory:a,isAllValid:n}}static compareFilteredData(e,t,s){const a=e.length,n=t.length,r=a>0?n/a*100:0;return console.log(`Filter comparison for ${s}:`,{original:a,filtered:n,ratio:`${Math.round(r)}%`,isFiltered:n<a}),{originalCount:a,filteredCount:n,filterRatio:Math.round(r),isFiltered:n<a}}}const Mt={all:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",today:"Ø§Ù„ÙŠÙˆÙ…",yesterday:"Ø£Ù…Ø³",this_week:"Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",last_week:"Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ",this_month:"Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±",last_month:"Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ",this_quarter:"Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹",last_quarter:"Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ",this_year:"Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…",last_year:"Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠ",last_30_days:"Ø¢Ø®Ø± 30 ÙŠÙˆÙ…",last_90_days:"Ø¢Ø®Ø± 90 ÙŠÙˆÙ…",custom:"ÙØªØ±Ø© Ù…Ø®ØµØµØ©"};class Tt{static calculateFinancialStats(e,t,s,a,n){const r=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},l=Array.isArray(e)?e.filter(e=>e&&"object"==typeof e):[],i=Array.isArray(t)?t.filter(e=>e&&"object"==typeof e):[],c=Array.isArray(s)?s.filter(e=>e&&"object"==typeof e):[],d=Array.isArray(a)?a.filter(e=>e&&"object"==typeof e):[],o=Array.isArray(n)?n.filter(e=>e&&"object"==typeof e):[];console.log("ğŸ” calculateFinancialStats called with validated data:",{paymentsCount:l.length,labOrdersCount:i.length,clinicNeedsCount:c.length,inventoryItemsCount:d.length,expensesCount:o.length});const m=r(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+r(t.amount),0)),x=r(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+r(t.amount),0)),h=m+x,u=r(e.filter(e=>("partial"===e.status||"pending"===e.status)&&(e.treatment_remaining_balance||e.remaining_balance)).reduce((e,t)=>{const s=r(t.treatment_remaining_balance),a=r(t.remaining_balance);return e+(s||a)},0)),p=e.filter(e=>"pending"===e.status).reduce((e,t)=>{const s=r(t.amount),a=r(t.total_amount_due);let n=s;if(t.tooth_treatment_id){n=r(t.treatment_total_cost)||a}else 0===s&&a>0&&(n=a);return e+n},0);let g=0,f=0,j=0,y=0,v=0;t&&Array.isArray(t)&&(g=r(t.reduce((e,t)=>e+r(t.paid_amount||0),0)),f=r(t.reduce((e,t)=>e+r(t.remaining_balance||0),0))),s&&Array.isArray(s)&&(j=r(s.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0)),y=r(s.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0))),a&&Array.isArray(a)&&(v=r(a.reduce((e,t)=>e+r(t.cost_per_unit||0)*r(t.quantity||0),0)));let N=0,b=[];if(o&&o.length>0){N=r(o.filter(e=>"paid"===e.status).reduce((e,t)=>e+r(t.amount),0));const e={salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"},t={};o.filter(e=>"paid"===e.status).forEach(e=>{const s=e.expense_type||"other",a=r(e.amount);t[s]=(t[s]||0)+a}),b=Object.entries(t).map(([t,s])=>({type:e[t]||t,amount:r(s),percentage:N>0?r(s)/N*100:0}))}const w=r(g+j+v+N),$=r(h-w),F=$>=0,_=h>0?r($/h*100):0;console.log("ğŸ’° Financial calculations verification:",{totalRevenue:r(h),totalExpenses:r(w),netProfit:r($),profitMargin:r(_),breakdown:{labOrdersTotal:r(g),clinicNeedsTotal:r(j),inventoryExpenses:r(v),clinicExpensesTotal:r(N)}});const D=new Date;return D.setDate(D.getDate()-30),{completedPayments:m,partialPayments:x,totalRevenue:h,remainingBalances:u,pendingAmount:p,labOrdersTotal:g,labOrdersRemaining:f,clinicNeedsTotal:j,clinicNeedsRemaining:y,inventoryExpenses:v,clinicExpensesTotal:N,expensesByType:b,totalExpenses:w,netProfit:F?$:0,lossAmount:F?0:Math.abs($),profitMargin:r(_),isProfit:F,totalTransactions:e.length,completedTransactions:e.filter(e=>"completed"===e.status).length,partialTransactions:e.filter(e=>"partial"===e.status).length,pendingTransactions:e.filter(e=>"pending"===e.status).length}}static filterAllDataByDateRange(e,t){const s=e=>{if(!e)return!1;const s=new Date(e);let a;return a=e.includes("T")||e.includes(" ")?s:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),a>=t.startDate&&a<=t.endDate};return{patients:e.patients,appointments:e.appointments.filter(e=>s(e.start_time)||s(e.created_at)),payments:e.payments.filter(e=>s(e.payment_date)||s(e.created_at)),inventory:e.inventory.filter(e=>s(e.created_at)||s(e.updated_at)),treatments:e.treatments?.filter(e=>s(e.start_date||"")||s(e.created_at||""))||[],prescriptions:e.prescriptions?.filter(e=>s(e.created_at))||[],labOrders:e.labOrders?.filter(e=>s(e.order_date)||s(e.created_at))||[],clinicNeeds:e.clinicNeeds?.filter(e=>s(e.created_at))||[]}}static calculateAllAspectsStats(e,t){const s=this.calculateFinancialStats(e.payments,e.labOrders,e.clinicNeeds,e.inventory,e.expenses),a=this.calculateDetailedAppointmentStats(e.appointments),r=this.calculateTreatmentStats(e.treatments),l=this.calculatePrescriptionStats(e.prescriptions),i=this.calculateLabOrderStats(e.labOrders),c=this.calculateClinicNeedsStats(e.clinicNeeds),d=this.calculateInventoryStats(e.inventory);return{dateRange:{start:n(t.startDate.toISOString()),end:n(t.endDate.toISOString()),period:`${n(t.startDate.toISOString())} - ${n(t.endDate.toISOString())}`},totalPatients:e.patients.length,totalAppointments:e.appointments.length,totalPayments:e.payments.length,totalTreatments:e.treatments.length,totalPrescriptions:e.prescriptions.length,totalLabOrders:e.labOrders.length,totalClinicNeeds:e.clinicNeeds.length,totalInventoryItems:e.inventory.length,...s,...a,...r,...l,...i,...c,...d}}static calculateAppointmentStats(e){const t=e.length,s=e.filter(e=>"completed"===e.status).length;return{total:t,completed:s,cancelled:e.filter(e=>"cancelled"===e.status).length,noShow:e.filter(e=>"no-show"===e.status).length,scheduled:e.filter(e=>"scheduled"===e.status).length,attendanceRate:t>0?Math.round(s/t*100):0}}static calculateDetailedAppointmentStats(e){const t=this.calculateAppointmentStats(e),s=e.reduce((e,t)=>{if(t.start_time){const s=new Date(t.start_time).getHours();e[s]=(e[s]||0)+1}return e},{}),a=Object.entries(s).reduce((e,[t,s])=>s>e.count?{hour:parseInt(t),count:s}:e,{hour:0,count:0}),n=e.reduce((e,t)=>{if(t.start_time){const s=["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"][new Date(t.start_time).getDay()];e[s]=(e[s]||0)+1}return e},{});return{...t,peakHour:a.hour?`${a.hour}:00 (${a.count} Ù…ÙˆØ§Ø¹ÙŠØ¯)`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",dayDistribution:n,averagePerDay:e.length>0?Math.round(e.length/7):0}}static calculateTreatmentStats(e){const t=e.length,s=e.filter(e=>"completed"===e.treatment_status).length,a=e.filter(e=>"planned"===e.treatment_status).length,n=e.filter(e=>"in_progress"===e.treatment_status).length,r=e.filter(e=>"cancelled"===e.treatment_status).length,l=e.reduce((e,t)=>{const s=t.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{}),i=e.reduce((e,t)=>{const s=t.tooth_number?.toString()||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{});return{totalTreatments:t,completedTreatments:s,plannedTreatments:a,inProgressTreatments:n,cancelledTreatments:r,completionRate:t>0?Math.round(s/t*100):0,treatmentTypes:l,teethTreated:i,mostTreatedTooth:Object.entries(i).reduce((e,[t,s])=>s>e.count?{tooth:t,count:s}:e,{tooth:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",count:0})}}static calculatePrescriptionStats(e){const t=e.length;e.reduce((e,t)=>e,{});const s=new Set(e.map(e=>e.patient_id)).size;return{totalPrescriptions:t,patientsWithPrescriptions:s,averagePrescriptionsPerPatient:s>0?Math.round(t/s*100)/100:0}}static calculateLabOrderStats(e){const t=e.length,s=e.filter(e=>"Ø¢Ø¬Ù„"===e.status).length,a=e.filter(e=>"Ù…ÙƒØªÙ…Ù„"===e.status).length,n=e.filter(e=>"Ù…Ù„ØºÙŠ"===e.status).length,r=e.reduce((e,t)=>e+(t.cost||0),0),l=e.reduce((e,t)=>e+(t.paid_amount||0),0),i=e.reduce((e,t)=>e+(t.remaining_balance||0),0),c=e.reduce((e,t)=>{const s=t.lab?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{});return{totalLabOrders:t,pendingLabOrders:s,completedLabOrders:a,cancelledLabOrders:n,labOrdersCompletionRate:t>0?Math.round(a/t*100):0,totalLabCost:r,totalLabPaid:l,totalLabRemaining:i,labFrequency:c,mostUsedLab:Object.entries(c).reduce((e,[t,s])=>s>e.count?{lab:t,count:s}:e,{lab:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",count:0})}}static calculateClinicNeedsStats(e){const t=e.length,s=e.filter(e=>"pending"===e.status).length,a=e.filter(e=>"ordered"===e.status).length,n=e.filter(e=>"received"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,l=e.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),i=e.reduce((e,t)=>{const s=t.priority||"medium";return e[s]=(e[s]||0)+1,e},{}),c=e.reduce((e,t)=>{const s=t.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{});return{totalClinicNeeds:t,pendingNeeds:s,orderedNeeds:a,receivedNeeds:n,cancelledNeeds:r,needsCompletionRate:t>0?Math.round(n/t*100):0,totalNeedsValue:l,priorityAnalysis:i,categoryAnalysis:c,urgentNeeds:i.urgent||0,highPriorityNeeds:i.high||0}}static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static calculateInventoryStats(e){const t=e.length,s=e.reduce((e,t)=>{const s=t.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{});return{totalInventoryItems:t,totalInventoryValue:e.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0),lowStockItems:e.filter(e=>(e.quantity||0)<=(e.minimum_quantity||0)).length,inventoryByCategory:s}}static groupByStatus(e,t){return e.reduce((e,s)=>{const a=s[t]||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[a]=(e[a]||0)+1,e},{})}static groupByMethod(e){return e.reduce((e,t)=>{const s=t.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{})}static groupByCategory(e){return e.reduce((e,t)=>{const s=t.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return e[s]=(e[s]||0)+1,e},{})}static generateComprehensiveCSV(e){const t=this.calculateFinancialStats(e.payments),s=this.calculateAppointmentStats(e.appointments),a=this.calculateInventoryStats(e.inventory);let i="\ufeff";if(i+="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©\n",i+=`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${this.formatGregorianDate(new Date)}\n`,i+=`ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡,${(new Date).toLocaleTimeString("ar-SA")}\n\n`,i+="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©\n",i+=`ÙÙ„ØªØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯,${e.filterInfo.appointmentFilter}\n`,i+=`ÙÙ„ØªØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª,${e.filterInfo.paymentFilter}\n`,i+=`ÙÙ„ØªØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,${e.filterInfo.inventoryFilter}\n\n`,i+="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰,${e.patients.length}\n`,i+=`Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±,${this.getNewPatientsThisMonth(e.patients)}\n`,i+=`Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†,${this.getActivePatients(e.patients,e.appointments)}\n`,i+=`Ù…ØªÙˆØ³Ø· Ø¹Ù…Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰,${this.calculateAverageAge(e.patients)}\n`,i+=`ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³,${this.getGenderDistribution(e.patients)}\n\n`,i+="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ù…ÙÙ„ØªØ±Ø©)\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯,${s.total}\n`,i+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${s.completed}\n`,i+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©,${s.cancelled}\n`,i+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©,${s.scheduled}\n`,i+=`Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±,${s.attendanceRate}%\n\n`,i+="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ù…ÙÙ„ØªØ±Ø©)\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª,${r(t.totalRevenue)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${r(t.completedAmount)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${r(t.partialAmount)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©,${r(t.pendingAmount)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©,${r(t.overdueAmount)}\n`,t.totalRemainingFromPartialPayments>0&&(i+=`Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${r(t.totalRemainingFromPartialPayments)}\n`),i+=`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ­Ù‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ,${r(t.outstandingBalance)}\n`,i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª,${t.totalTransactions}\n`,i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª,${r(t.totalExpenses||0)}\n`,i+=`ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­,${r(t.netProfit||0)}\n`,i+=`Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­,${(t.profitMargin||0).toFixed(2)}%\n`,i+=`Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø­ÙŠØ©,${(t.netProfit||0)>=0?"Ø±Ø¨Ø­":"Ø®Ø³Ø§Ø±Ø©"}\n\n`,t.expensesByType&&t.expensesByType.length>0&&(i+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹\n",i+="Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©\n",t.expensesByType.forEach(e=>{i+=`"${e.type}","${r(e.amount)}","${e.percentage.toFixed(2)}%"\n`}),i+="\n"),i+="ØªÙˆØ²ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹\n",i+="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ù…Ø¨Ù„Øº,Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª\n",Object.entries(t.paymentMethodStats).forEach(([e,t])=>{i+=`"${e}","${r(t.amount)}","${t.count}"\n`}),i+="\n",i+="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù…ÙÙ„ØªØ±Ø©)\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±,${a.totalItems}\n`,i+=`Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©,${r(a.totalValue)}\n`,i+=`Ø¹Ù†Ø§ØµØ± Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,${a.lowStockItems}\n`,i+=`Ø¹Ù†Ø§ØµØ± Ù†ÙØ¯Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,${a.outOfStockItems}\n`,i+=`Ø¹Ù†Ø§ØµØ± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©,${a.expiredItems}\n`,i+=`Ø¹Ù†Ø§ØµØ± Ù‚Ø±ÙŠØ¨Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (30 ÙŠÙˆÙ…),${a.nearExpiryItems}\n\n`,e.appointments.length>0&&(i+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©\n",i+="Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙˆÙ‚Øª,Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶,Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯,Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬,Ø§Ù„ØªÙƒÙ„ÙØ©,Ø§Ù„Ø­Ø§Ù„Ø©,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.appointments.forEach(e=>{const t=n(e.start_time),s=new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),a=e.patient?.full_name||e.patient?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=e.title||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",c=e.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d=e.cost?r(e.cost):"0",o=this.getStatusInArabic(e.status),m=e.notes||"";i+=`"${t}","${s}","${a}","${l}","${c}","${d}","${o}","${m}"\n`}),i+="\n"),e.payments.length>0&&(i+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©\n",i+="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹,Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„ÙˆØµÙ,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹,Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ,Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ø­Ø§Ù„Ø©,Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.payments.forEach(e=>{const t=n(e.payment_date),s=e.patient?.full_name||e.patient?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=e.description||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";let c,d,o;if("partial"===e.status){const t=Number(e.total_amount_due||e.amount)||0,s=Number(e.amount_paid||e.amount)||0;c=r(t),d=r(s),o=r(Math.max(0,t-s))}else e.appointment_id&&e.treatment_total_cost?(c=r(Number(e.treatment_total_cost)||0),d=r(Number(e.treatment_total_paid||e.amount)||0),o=r(Number(e.treatment_remaining_balance||0))):(c=r(Number(e.amount)||0),d=r(Number(e.amount)||0),o=r(0));const m=this.getPaymentMethodInArabic(e.payment_method),x=l(e.status),h=e.receipt_number||"",u=e.notes||"";i+=`"${t}","${s}","${a}","${c}","${d}","${o}","${m}","${x}","${h}","${u}"\n`}),i+="\n"),e.inventory.length>0&&(i+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ÙÙ„ØªØ±\n",i+="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù,Ø§Ù„ÙˆØµÙ,Ø§Ù„ÙØ¦Ø©,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„ÙˆØ­Ø¯Ø©,Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰,ØªÙƒÙ„ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø©,Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©,Ø§Ù„Ù…ÙˆØ±Ø¯,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡,Ø§Ù„Ø­Ø§Ù„Ø©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡\n",e.inventory.forEach(e=>{const t=e.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",s=e.description||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=e.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=e.quantity||0,c=e.unit||"Ù‚Ø·Ø¹Ø©",d=e.minimum_stock||0,o=r(e.cost_per_unit||0),m=r((e.cost_per_unit||0)*(e.quantity||0)),x=e.supplier||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",h=e.expiry_date?n(e.expiry_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",u=this.getInventoryStatusInArabic(e.quantity||0,e.minimum_stock||0),p=n(e.created_at);i+=`"${t}","${s}","${a}","${l}","${c}","${d}","${o}","${m}","${x}","${h}","${u}","${p}"\n`}),i+="\n"),e.patients.length>0){i+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰ (Ø£Ø­Ø¯Ø« 50 Ù…Ø±ÙŠØ¶)\n",i+="#,Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ø¹Ù…Ø±,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ©,Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©,Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†,ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„,Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª,Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n";[...e.patients].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,50).forEach(t=>{const s=t.serial_number||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=t.full_name||t.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=t.phone||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",c=t.age||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d="male"===t.gender?"Ø°ÙƒØ±":"female"===t.gender?"Ø£Ù†Ø«Ù‰":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o=t.patient_condition||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",m=t.allergies||"Ù„Ø§ ÙŠÙˆØ¬Ø¯",x=t.email||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",h=t.address||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",u=n(t.created_at),p=t.notes||"Ù„Ø§ ÙŠÙˆØ¬Ø¯",g=e.appointments.filter(e=>e.patient_id===t.id),f=e.payments.filter(e=>e.patient_id===t.id),j=g.length>0?n(g.sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime())[0].start_time):"Ù„Ø§ ÙŠÙˆØ¬Ø¯",y=g.length;let v=0,N=0,b=0,w=0;g.forEach(e=>{if(e.cost){const t=f.filter(t=>t.appointment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);b+=e.cost,w+=t}});f.filter(e=>!e.appointment_id).forEach(e=>{w+=e.amount||0,e.total_amount_due&&(b+=e.total_amount_due)}),v+=w,N+=Math.max(0,b-w),i+=`"${s}","${a}","${l}","${c}","${d}","${o}","${m}","${x}","${h}","${u}","${j}","${y}","${r(v)}","${r(N)}","${p}"\n`}),i+="\n"}i+="Ù…Ù„Ø®Øµ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø·Ø¨ÙŠØ¨\n",i+=`Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙˆØ¹Ø¯,${s.total>0?r(t.totalRevenue/s.total):"0"}\n`,i+=`Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©,${this.calculateDailyAverage(e.payments,t.totalRevenue)}\n`,i+=`Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${t.totalTransactions>0?Math.round(t.completedTransactions/t.totalTransactions*100):0}%\n`,i+=`Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${t.totalTransactions>0?Math.round(t.partialTransactions/t.totalTransactions*100):0}%\n`,i+=`Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù„ØºØ§Ø¡,${s.total>0?Math.round(s.cancelled/s.total*100):0}%\n`,i+=`Ù…ØªÙˆØ³Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶,${e.patients.length>0?Math.round(s.total/e.patients.length*100)/100:0}\n`,i+=`Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶,${e.patients.length>0?r(t.totalRevenue/e.patients.length):"0"}\n\n`,i+="ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©\n";const c=e.appointments.reduce((e,t)=>e+(t.cost||0),0),d=c>0?Math.round(t.totalRevenue/c*100):0;i+=`Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„,${d}%\n`;const o=this.analyzeTreatmentTypes(e.appointments);i+=`Ø£ÙƒØ«Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø·Ù„Ø¨Ø§Ù‹,${o.mostCommon}\n`,i+=`Ø£Ø¹Ù„Ù‰ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ù‚ÙŠÙ…Ø©,${o.highestValue}\n`;const m=this.analyzeAppointmentTimes(e.appointments);i+=`Ø£ÙƒØ«Ø± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ø²Ø¯Ø­Ø§Ù…Ø§Ù‹,${m.peakHour}\n`,i+=`Ø£ÙƒØ«Ø± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ø²Ø¯Ø­Ø§Ù…Ø§Ù‹,${m.peakDay}\n`;const x=this.analyzePatients(e.patients,e.appointments,e.payments);return i+=`Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø²ÙŠØ§Ø±Ø©,${x.mostFrequent}\n`,i+=`Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¥Ù†ÙØ§Ù‚Ø§Ù‹,${x.highestSpender}\n`,i+="\nØªÙˆØµÙŠØ§Øª Ù„Ù„Ø·Ø¨ÙŠØ¨\n",s.attendanceRate<80&&(i+=`ØªÙˆØµÙŠØ©,ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± - Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ${s.attendanceRate}% Ù…Ù†Ø®ÙØ¶Ø©\n`),d<90&&(i+=`ØªÙˆØµÙŠØ©,ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„ - Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ${d}% Ù…Ù†Ø®ÙØ¶Ø©\n`),t.partialTransactions>t.completedTransactions&&(i+=`ØªÙˆØµÙŠØ©,Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© - ${t.partialTransactions} Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø²Ø¦ÙŠØ© Ù…Ù‚Ø§Ø¨Ù„ ${t.completedTransactions} Ù…ÙƒØªÙ…Ù„Ø©\n`),a.lowStockItems>0&&(i+=`ØªÙˆØµÙŠØ©,ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - ${a.lowStockItems} ØµÙ†Ù Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†\n`),a.expiredItems>0&&(i+=`ØªÙˆØµÙŠØ©,Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© - ${a.expiredItems} ØµÙ†Ù Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©\n`),a.nearExpiryItems>0&&(i+=`ØªÙˆØµÙŠØ©,Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ Ù‚Ø±ÙŠØ¨Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ - ${a.nearExpiryItems} ØµÙ†Ù ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…\n`),s.cancelled>.2*s.completed&&(i+=`ØªÙˆØµÙŠØ©,ØªÙ‚Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ - ${s.cancelled} Ù…ÙˆØ¹Ø¯ Ù…Ù„ØºÙŠ Ù…Ù† Ø£ØµÙ„ ${s.total}\n`),t.overdueAmount>.1*t.totalRevenue&&(i+=`ØªÙˆØµÙŠØ©,Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© - ${r(t.overdueAmount)} Ù…Ø¨Ù„Øº Ù…ØªØ£Ø®Ø±\n`),i}static getStatusInArabic(e){return{scheduled:"Ù…Ø¬Ø¯ÙˆÙ„",completed:"Ù…ÙƒØªÙ…Ù„",cancelled:"Ù…Ù„ØºÙŠ","no-show":"Ù„Ù… ÙŠØ­Ø¶Ø±",confirmed:"Ù…Ø¤ÙƒØ¯",pending:"Ø¢Ø¬Ù„"}[e]||e}static getPaymentMethodInArabic(e){return{cash:"Ù†Ù‚Ø¯ÙŠ",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",credit_card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†",debit_card:"Ø¨Ø·Ø§Ù‚Ø© Ø®ØµÙ…"}[e]||e}static getInventoryStatusInArabic(e,t){return 0===e?"Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":e<=t?"Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":"Ù…ØªÙˆÙØ±"}static calculateDailyAverage(e,t){if(0===e.length)return"0";const s=new Set(e.map(e=>e.payment_date.split("T")[0])).size;if(0===s)return"0";return r(t/s)}static calculateAge(e){try{const t=new Date(e),s=new Date;let a=s.getFullYear()-t.getFullYear();const n=s.getMonth()-t.getMonth();return(n<0||0===n&&s.getDate()<t.getDate())&&a--,a.toString()}catch(t){return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}}static calculateAverageAge(e){if(0===e.length)return"0";const t=e.reduce((e,t)=>e+("number"==typeof t.age?t.age:0),0)/e.length;return Math.round(t).toString()}static getGenderDistribution(e){if(0===e.length)return"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";const t=e.filter(e=>"male"===e.gender).length,s=e.filter(e=>"female"===e.gender).length;return`Ø°ÙƒÙˆØ±: ${t} (${Math.round(t/e.length*100)}%) - Ø¥Ù†Ø§Ø«: ${s} (${Math.round(s/e.length*100)}%)`}static getNewPatientsThisMonth(e){const t=(new Date).toISOString().slice(0,7);return e.filter(e=>e.created_at.startsWith(t)).length}static getActivePatients(e,t){const s=new Date;s.setMonth(s.getMonth()-3);return new Set(t.filter(e=>new Date(e.start_time)>=s).map(e=>e.patient_id)).size}static analyzeTreatmentTypes(e){const t={};e.forEach(e=>{const s=e.title||e.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=this.getTreatmentNameInArabic(s);t[a]||(t[a]={count:0,totalValue:0}),t[a].count++,t[a].totalValue+=e.cost||0});const s=Object.entries(t).sort((e,t)=>t[1].count-e[1].count),a=Object.entries(t).sort((e,t)=>t[1].totalValue-e[1].totalValue);return{mostCommon:s.length>0?`${s[0][0]} (${s[0][1].count} Ù…Ø±Ø©)`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯",highestValue:a.length>0?`${a[0][0]} (${r(a[0][1].totalValue)})`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯"}}static analyzeAppointmentTimes(e){const t={},s={};e.forEach(e=>{const a=new Date(e.start_time),n=a.getHours(),r=a.toLocaleDateString("ar-SA",{weekday:"long"});t[n]=(t[n]||0)+1,s[r]=(s[r]||0)+1});const a=Object.entries(t).sort((e,t)=>t[1]-e[1])[0],n=Object.entries(s).sort((e,t)=>t[1]-e[1])[0];return{peakHour:a?`${a[0]}:00 (${a[1]} Ù…ÙˆØ¹Ø¯)`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯",peakDay:n?`${n[0]} (${n[1]} Ù…ÙˆØ¹Ø¯)`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯"}}static analyzePatients(e,t,s){const a={};e.forEach(e=>{const n=t.filter(t=>t.patient_id===e.id),r=s.filter(t=>t.patient_id===e.id).reduce((e,t)=>e+("partial"===t.status&&void 0!==t.amount_paid?Number(t.amount_paid):Number(t.amount)),0);a[e.id]={name:e.full_name||e.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",appointmentCount:n.length,totalPayments:r}});const n=Object.values(a).sort((e,t)=>t.appointmentCount-e.appointmentCount),l=Object.values(a).sort((e,t)=>t.totalPayments-e.totalPayments);return{mostFrequent:n.length>0?`${n[0].name} (${n[0].appointmentCount} Ù…ÙˆØ¹Ø¯)`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯",highestSpender:l.length>0?`${l[0].name} (${r(l[0].totalPayments)})`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯"}}static async exportComprehensiveReport(e){try{const t=function(e,t,s){const a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"today":const e=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);return{startDate:n,endDate:e};case"yesterday":const r=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1),l=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return{startDate:r,endDate:l};case"this_week":const i=new Date(n);return i.setDate(n.getDate()-n.getDay()),{startDate:i,endDate:a};case"last_week":const c=new Date(n);c.setDate(n.getDate()-n.getDay()-7);const d=new Date(c);return d.setDate(c.getDate()+6),d.setHours(23,59,59,999),{startDate:c,endDate:d};case"this_month":return{startDate:new Date(n.getFullYear(),n.getMonth(),1),endDate:a};case"last_month":const o=new Date(n.getFullYear(),n.getMonth()-1,1),m=new Date(n.getFullYear(),n.getMonth(),0);return m.setHours(23,59,59,999),{startDate:o,endDate:m};case"this_quarter":return{startDate:new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3),1),endDate:a};case"last_quarter":const x=new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3)-3,1),h=new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3),0);return h.setHours(23,59,59,999),{startDate:x,endDate:h};case"this_year":return{startDate:new Date(n.getFullYear(),0,1),endDate:a};case"last_year":const u=new Date(n.getFullYear()-1,0,1),p=new Date(n.getFullYear()-1,11,31);return p.setHours(23,59,59,999),{startDate:u,endDate:p};case"last_30_days":return{startDate:new Date(n.getFullYear(),n.getMonth(),n.getDate()-30),endDate:new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)};case"last_90_days":return{startDate:new Date(n.getFullYear(),n.getMonth(),n.getDate()-90),endDate:new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)};case"custom":return t&&s?{startDate:new Date(t+"T00:00:00"),endDate:new Date(s+"T23:59:59.999")}:{startDate:new Date(0),endDate:a};default:return{startDate:new Date(0),endDate:a}}}(e.timePeriod,e.customStartDate,e.customEndDate),s=this.filterAllDataByDateRange(e,t);e.expenses&&(s.expenses=e.expenses.filter(e=>{if(!e.payment_date)return!1;const s=new Date(e.payment_date);return s>=t.startDate&&s<=t.endDate}));const a=function(e){return console.log("ğŸ” Validating data before export..."),Pt.validateAllData(e).isAllValid?(console.log("âœ… Data validation passed! Export will contain accurate values."),e.filterInfo&&console.log("ğŸ“Š Filter information:",e.filterInfo),!0):(console.error("âŒ Data validation failed! Export may contain incorrect values."),!1)}({payments:s.payments,appointments:s.appointments,inventory:s.inventory,filterInfo:{appointmentFilter:Mt[e.timePeriod],paymentFilter:Mt[e.timePeriod],inventoryFilter:Mt[e.timePeriod]}});if(!a)throw new Error("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");const n=this.calculateAllAspectsStats(s,t);this.generateEnhancedComprehensiveCSV({patients:e.patients,appointments:s.appointments,payments:s.payments,inventory:s.inventory,treatments:s.treatments,prescriptions:s.prescriptions,labOrders:s.labOrders,clinicNeeds:s.clinicNeeds,timePeriod:e.timePeriod,stats:n});await this.exportComprehensiveReportToExcel({patients:e.patients,appointments:s.appointments,payments:s.payments,inventory:s.inventory,treatments:s.treatments,prescriptions:s.prescriptions,labOrders:s.labOrders,clinicNeeds:s.clinicNeeds,expenses:s.expenses||[],timePeriod:e.timePeriod,stats:n,dateRange:t})}catch(t){throw console.error("Error exporting comprehensive report:",t),new Error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„")}}static calculateComprehensiveStats(e){const t=this.calculateFinancialStats(e.filteredPayments,e.labOrders,e.clinicNeeds,e.filteredInventory,e.expenses);return{totalPatients:e.patients.length,totalAppointments:e.filteredAppointments.length,totalPayments:e.filteredPayments.length,totalInventoryItems:e.filteredInventory.length,totalLabOrders:e.labOrders?.length||0,totalClinicNeeds:e.clinicNeeds?.length||0,...t,appointmentsByStatus:this.groupByStatus(e.filteredAppointments,"status"),paymentsByMethod:this.groupByMethod(e.filteredPayments),inventoryByCategory:this.groupByCategory(e.filteredInventory)}}static generateEnhancedComprehensiveCSV(e){let t="\ufeff";return t+="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„ Ù„Ù„Ø¹ÙŠØ§Ø¯Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨\n",t+=`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${this.formatGregorianDate(new Date)}\n`,t+=`ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${(new Date).toLocaleTimeString("ar-SA")}\n`,t+=`Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©,${Mt[e.timePeriod]}\n`,e.stats.dateRange&&(t+=`Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®,${e.stats.dateRange.period}\n`),t+="\n",t+="=== Ù…Ù„Ø®Øµ Ø¹Ø§Ù… Ø´Ø§Ù…Ù„ ===\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰,${e.stats.totalPatients}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalAppointments}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalPayments}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalTreatments}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙØ§Øª (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalPrescriptions}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø± (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalLabOrders}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ù…ÙÙ„ØªØ±Ø©),${e.stats.totalClinicNeeds}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,${e.stats.totalInventoryItems}\n\n`,t+="ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø´Ø§Ù…Ù„\n",t+="=================================\n\n",t+="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª\n",t+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${r(e.stats.completedPayments||0)}\n`,t+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${r(e.stats.partialPayments||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª,${r(e.stats.totalRevenue||0)}\n`,t+=`Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${r(e.stats.remainingBalances||0)}\n`,t+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©,${r(e.stats.pendingAmount||0)}\n\n`,t+="Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù„Ù„Ù…Ø®Ø§Ø¨Ø±,${r(e.stats.labOrdersTotal||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ù…Ø®Ø§Ø¨Ø±,${r(e.stats.labOrdersRemaining||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù„Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†,${r(e.stats.clinicNeedsTotal||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${r(e.stats.clinicNeedsRemaining||0)}\n`,t+=`Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ,${r(e.stats.inventoryExpenses||0)}\n`,t+=`Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©,${r(e.stats.clinicExpensesTotal||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª,${r(e.stats.totalExpenses||0)}\n\n`,t+="Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©\n",e.stats.isProfit?(t+=`ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­,${r(e.stats.netProfit||0)}\n`,t+=`Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­,${(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="Ø§Ù„Ø­Ø§Ù„Ø©,Ø±Ø¨Ø­\n"):(t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø³Ø§Ø±Ø©,${r(e.stats.lossAmount||0)}\n`,t+=`Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø©,${Math.abs(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="Ø§Ù„Ø­Ø§Ù„Ø©,Ø®Ø³Ø§Ø±Ø©\n"),t+="\n",t+="ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ\n",t+="========================\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯,${e.stats.total||0}\n`,t+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${e.stats.completed||0}\n`,t+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©,${e.stats.cancelled||0}\n`,t+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©,${e.stats.scheduled||0}\n`,t+=`Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØºØ§Ø¦Ø¨Ø©,${e.stats.noShow||0}\n`,t+=`Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±,${e.stats.attendanceRate||0}%\n`,e.stats.peakHour&&(t+=`Ø£ÙƒØ«Ø± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ø²Ø¯Ø­Ø§Ù…Ø§Ù‹,${e.stats.peakHour}\n`),t+=`Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙŠÙˆÙ…ÙŠØ§Ù‹,${e.stats.averagePerDay||0}\n\n`,t+="ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ\n",t+="========================\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª,${e.stats.totalTreatments||0}\n`,t+=`Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${e.stats.completedTreatments||0}\n`,t+=`Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø©,${e.stats.plannedTreatments||0}\n`,t+=`Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°,${e.stats.inProgressTreatments||0}\n`,t+=`Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©,${e.stats.cancelledTreatments||0}\n`,t+=`Ù…Ø¹Ø¯Ù„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª,${e.stats.completionRate||0}%\n`,e.stats.mostTreatedTooth&&(t+=`Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø¹Ù„Ø§Ø¬Ø§Ù‹,Ø§Ù„Ø³Ù† Ø±Ù‚Ù… ${e.stats.mostTreatedTooth.tooth} (${e.stats.mostTreatedTooth.count} Ø¹Ù„Ø§Ø¬)\n`),t+="\n",t+="ØªÙˆØ²ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª\n",e.stats.treatmentTypes&&"object"==typeof e.stats.treatmentTypes?Object.entries(e.stats.treatmentTypes).forEach(([e,s])=>{const a=this.getTreatmentNameInArabic(e);t+=`${a},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©\n",e.stats.teethTreated&&"object"==typeof e.stats.teethTreated?Object.entries(e.stats.teethTreated).forEach(([e,s])=>{t+=`Ø§Ù„Ø³Ù† Ø±Ù‚Ù… ${e},${s} Ø¹Ù„Ø§Ø¬\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",e.treatments&&e.treatments.length>0&&e.treatments.length<=100&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©\n",t+="Ø§Ù„Ù…Ø±ÙŠØ¶,Ø±Ù‚Ù… Ø§Ù„Ø³Ù†,Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬,Ø§Ù„ÙØ¦Ø©,Ø§Ù„Ø­Ø§Ù„Ø©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„,Ø§Ù„ØªÙƒÙ„ÙØ©,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.treatments.forEach(s=>{const a=e.patients.find(e=>e.id===s.patient_id),l=a?a.full_name||a.name||`${a.first_name||""} ${a.last_name||""}`.trim():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",i=s.start_date?n(s.start_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",c=s.completion_date?n(s.completion_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d=s.cost?r(s.cost):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o=(s.notes||"").replace(/,/g,"Ø›"),m=this.getTreatmentNameInArabic(s.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"),x=this.getCategoryNameInArabic(s.treatment_category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"),h=this.getStatusLabelInArabic(s.treatment_status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");t+=`"${l}",${s.tooth_number||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"},"${m}","${x}","${h}",${i},${c},${d},"${o}"\n`}),t+="\n"),t+="ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØµÙØ§Øª\n",t+="===============\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙØ§Øª,${e.stats.totalPrescriptions||0}\n`,t+=`Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… ÙˆØµÙØ§Øª,${e.stats.patientsWithPrescriptions||0}\n`,t+=`Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØµÙØ§Øª Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶,${e.stats.averagePrescriptionsPerPatient||0}\n\n`,e.prescriptions&&e.prescriptions.length>0&&e.prescriptions.length<=50&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©\n",t+="ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙØ©,Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„Ù…ÙˆØ¹Ø¯,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.prescriptions.forEach(s=>{const a=s.prescription_date?n(s.prescription_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";let r=s.patient_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=s.appointment_title||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";if("ØºÙŠØ± Ù…Ø­Ø¯Ø¯"===r){const t=e.patients.find(e=>e.id===s.patient_id);r=t?t.full_name||t.name||`${t.first_name||""} ${t.last_name||""}`.trim():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}if("ØºÙŠØ± Ù…Ø­Ø¯Ø¯"===l){const t=e.appointments.find(e=>e.id===s.appointment_id);l=t?t.title||t.description||"Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠ":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}const i=(s.notes||"").replace(/,/g,"Ø›");t+=`${a},"${r}","${l}","${i}"\n`}),t+="\n"),t+="ØªØ­Ù„ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±\n",t+="==================\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±,${e.stats.totalLabOrders||0}\n`,t+=`Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©,${e.stats.pendingLabOrders||0}\n`,t+=`Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${e.stats.completedLabOrders||0}\n`,t+=`Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©,${e.stats.cancelledLabOrders||0}\n`,t+=`Ù…Ø¹Ø¯Ù„ Ø¥Ù†Ø¬Ø§Ø² Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±,${e.stats.labOrdersCompletionRate||0}%\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø®Ø§Ø¨Ø±,${r(e.stats.totalLabCost||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„Ù„Ù…Ø®Ø§Ø¨Ø±,${r(e.stats.totalLabPaid||0)}\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ù…Ø®Ø§Ø¨Ø±,${r(e.stats.totalLabRemaining||0)}\n`,e.stats.mostUsedLab&&(t+=`Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø®Ø§Ø¨Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹,${e.stats.mostUsedLab.lab} (${e.stats.mostUsedLab.count} Ø·Ù„Ø¨)\n`),t+="\n",t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø¨Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©\n",e.stats.labFrequency&&"object"==typeof e.stats.labFrequency?Object.entries(e.stats.labFrequency).forEach(([e,s])=>{t+=`${e},${s} Ø·Ù„Ø¨\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",e.labOrders&&e.labOrders.length>0&&e.labOrders.length<=50&&(t+="ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©\n",t+="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨,Ø§Ù„Ù…Ø®ØªØ¨Ø±,Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„ØªÙƒÙ„ÙØ©,Ø§Ù„Ù…Ø¯ÙÙˆØ¹,Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.labOrders.forEach(s=>{const a=s.order_date?n(s.order_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=s.lab_name||s.laboratory||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",i=e.patients.find(e=>e.id===s.patient_id),c=i?i.full_name||i.name||`${i.first_name||""} ${i.last_name||""}`.trim():"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d=s.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o=s.cost?r(s.cost):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",m=s.paid_amount?r(s.paid_amount):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",x=s.remaining_balance?r(s.remaining_balance):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",h=(s.notes||"").replace(/,/g,"Ø›");t+=`${a},"${l}","${c}",${d},${o},${m},${x},"${h}"\n`}),t+="\n"),t+="ØªØ­Ù„ÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©\n",t+="=====================\n",t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${e.stats.totalClinicNeeds||0}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©,${e.stats.pendingNeeds||0}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©,${e.stats.orderedNeeds||0}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©,${e.stats.receivedNeeds||0}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©,${e.stats.cancelledNeeds||0}\n`,t+=`Ù…Ø¹Ø¯Ù„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${e.stats.needsCompletionRate||0}%\n`,t+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${r(e.stats.totalNeedsValue||0)}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©,${e.stats.urgentNeeds||0}\n`,t+=`Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©,${e.stats.highPriorityNeeds||0}\n\n`,t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª\n",e.stats.priorityAnalysis&&"object"==typeof e.stats.priorityAnalysis?Object.entries(e.stats.priorityAnalysis).forEach(([e,s])=>{t+=`${"urgent"===e?"Ø¹Ø§Ø¬Ù„":"high"===e?"Ø¹Ø§Ù„ÙŠ":"medium"===e?"Ù…ØªÙˆØ³Ø·":"low"===e?"Ù…Ù†Ø®ÙØ¶":e},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",t+="ØªÙˆØ²ÙŠØ¹ ÙØ¦Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª\n",e.stats.categoryAnalysis&&"object"==typeof e.stats.categoryAnalysis?Object.entries(e.stats.categoryAnalysis).forEach(([e,s])=>{t+=`${e},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",e.clinicNeeds&&e.clinicNeeds.length>0&&e.clinicNeeds.length<=50&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©\n",t+="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨,Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù,Ø§Ù„ÙØ¦Ø©,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø³Ø¹Ø±,Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©,Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©,Ø§Ù„Ø­Ø§Ù„Ø©,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.clinicNeeds.forEach(e=>{const s=e.created_at?n(e.created_at):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=e.item_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",l=e.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",i=e.quantity||0,c=e.price?r(e.price):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d=(e.quantity||0)*(e.price||0),o=r(d),m="urgent"===e.priority?"Ø¹Ø§Ø¬Ù„":"high"===e.priority?"Ø¹Ø§Ù„ÙŠ":"medium"===e.priority?"Ù…ØªÙˆØ³Ø·":"low"===e.priority?"Ù…Ù†Ø®ÙØ¶":e.priority||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",x="pending"===e.status?"Ø¢Ø¬Ù„":"ordered"===e.status?"Ù…Ø·Ù„ÙˆØ¨":"received"===e.status?"Ù…Ø³ØªÙ„Ù…":"cancelled"===e.status?"Ù…Ù„ØºÙŠ":e.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",h=(e.notes||"").replace(/,/g,"Ø›");t+=`${s},"${a}","${l}",${i},${c},${o},"${m}","${x}","${h}"\n`}),t+="\n"),t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©\n",e.stats.appointmentsByStatus&&"object"==typeof e.stats.appointmentsByStatus?Object.entries(e.stats.appointmentsByStatus).forEach(([e,s])=>{t+=`${e},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹\n",e.stats.paymentsByMethod&&"object"==typeof e.stats.paymentsByMethod?Object.entries(e.stats.paymentsByMethod).forEach(([e,s])=>{t+=`${e},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",t+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©\n",e.stats.inventoryByCategory&&"object"==typeof e.stats.inventoryByCategory?Object.entries(e.stats.inventoryByCategory).forEach(([e,s])=>{t+=`${e},${s}\n`}):t+="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©\n",t+="\n",e.payments.length>0&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©\n",t+="Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„,Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„Ù…Ø¨Ù„Øº,Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ø­Ø§Ù„Ø©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹,Ø§Ù„ÙˆØµÙ\n",e.payments.forEach(s=>{const a=e.patients.find(e=>e.id===s.patient_id)?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";t+=`"${s.receipt_number||`#${s.id.slice(-6)}`}","${a}","${r(s.amount)}","${s.payment_method}","${s.status}","${n(s.payment_date)}","${s.description||"-"}"\n`}),t+="\n"),e.appointments.length>0&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©\n",t+="Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙˆÙ‚Øª,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„ØªÙƒÙ„ÙØ©\n",e.appointments.forEach(s=>{const a=e.patients.find(e=>e.id===s.patient_id)?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";t+=`"${a}","${s.title||"-"}","${n(s.start_time)}","${i(s.start_time)}","${s.status}","${r(s.cost||0)}"\n`}),t+="\n"),e.inventory.length>0&&(t+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ÙÙ„ØªØ±\n",t+="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬,Ø§Ù„ÙØ¦Ø©,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø³Ø¹Ø±,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡,Ø§Ù„Ø­Ø§Ù„Ø©\n",e.inventory.forEach(e=>{t+=`"${e.name}","${e.category||"-"}","${e.quantity}","${r(e.price||0)}","${e.expiry_date?n(e.expiry_date):"-"}","${e.status||"-"}"\n`})),t}static getTreatmentNameInArabic(e){return c(e)}static getCategoryNameInArabic(e){return d(e)}static getStatusLabelInArabic(e){return o(e)}static formatGregorianDate(e){if(!e||isNaN(e.getTime()))return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}static async exportComprehensiveReportToExcel(e){const t=new Me.Workbook;t.creator="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",t.created=new Date,t.modified=new Date,t.title="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„",t.description="ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",await this.createSummarySheet(t,e),await this.createPatientsSheet(t,e),await this.createAppointmentsSheet(t,e),await this.createPaymentsSheet(t,e),await this.createInventorySheet(t,e),await this.createLabOrdersSheet(t,e),await this.createClinicNeedsSheet(t,e),await this.createExpensesSheet(t,e),await this.createProfitLossSheet(t,e);const s=`Ø§Ù„ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø´Ø§Ù…Ù„_Ø§Ù„Ù…ÙØµÙ„_${Mt[e.timePeriod]}_${(new Date).toISOString().split("T")[0]}`,a=await t.xlsx.writeBuffer(),n=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a"),l=URL.createObjectURL(n);r.setAttribute("href",l),r.setAttribute("download",`${s}.xlsx`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),console.log("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„ Ø¨Ù†Ø¬Ø§Ø­")}static async createSummarySheet(e,t){try{console.log("Creating summary sheet with data:",t);const s=e.addWorksheet("Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…");s.mergeCells("A1:H1");const a=s.getCell("A1");a.value="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„ - Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†",a.font={size:18,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},s.getCell("A3").value=`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${n(new Date)}`,s.getCell("A3").font={size:12,italic:!0};const l=t.timePeriod&&Mt[t.timePeriod]?Mt[t.timePeriod]:t.timePeriod||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";s.getCell("A4").value=`Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: ${l}`,s.getCell("A4").font={size:12,italic:!0};let i=6;const c=Array.isArray(t.patients)?t.patients:[],d=Array.isArray(t.appointments)?t.appointments:[],o=Array.isArray(t.payments)?t.payments:[],m=Array.isArray(t.inventory)?t.inventory:[],x=Array.isArray(t.labOrders)?t.labOrders:[],h=Array.isArray(t.clinicNeeds)?t.clinicNeeds:[],u=Array.isArray(t.expenses)?t.expenses:[];console.log("Data arrays lengths:",{patients:c.length,appointments:d.length,payments:o.length,inventory:m.length,labOrders:x.length,clinicNeeds:h.length,expenses:u.length});const p=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰",c.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",d.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",o.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",m.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",x.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",h.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",u.length]];s.getCell(`A${i}`).value="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©",s.getCell(`A${i}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},i+=2,Array.isArray(p)&&p.forEach(([e,t])=>{s.getCell(`A${i}`).value=e,s.getCell(`B${i}`).value=t,s.getCell(`A${i}`).font={bold:!0};["A","B"].forEach(e=>{const t=s.getCell(`${e}${i}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},t.alignment={horizontal:"right",vertical:"middle"}}),i++}),i+=2,s.getCell(`A${i}`).value="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©",s.getCell(`A${i}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},i+=2;const g=t.stats||{},f=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",r(g.totalRevenue||0)],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©",r(g.completedPayments||0)],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©",r(g.partialPayments||0)],["Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¢Ø¬Ù„Ø©",r(g.pendingAmount||0)],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",r(g.totalExpenses||0)],["ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©",r(g.netProfit||0)]];Array.isArray(f)&&f.forEach(([e,t])=>{s.getCell(`A${i}`).value=e,s.getCell(`B${i}`).value=t,s.getCell(`A${i}`).font={bold:!0};["A","B"].forEach(e=>{const t=s.getCell(`${e}${i}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},t.alignment={horizontal:"right",vertical:"middle"}}),i++}),s.getColumn("A").width=30,s.getColumn("B").width=20,console.log("Summary sheet created successfully")}catch(s){throw console.error("Error creating summary sheet:",s),s}}static async createPatientsSheet(e,t){const s=e.addWorksheet("Ø§Ù„Ù…Ø±Ø¶Ù‰");s.mergeCells("A1:G1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"};let r=3;const l=t.patients||[],i=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰",l.length],["Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø°ÙƒÙˆØ±",l.filter(e=>"male"===e.gender).length],["Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¥Ù†Ø§Ø«",l.filter(e=>"female"===e.gender).length],["Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù…Ø±",l.length>0?Math.round(l.reduce((e,t)=>e+(t.age||0),0)/l.length):0]];s.getCell(`A${r}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰",s.getCell(`A${r}`).font={size:14,bold:!0},r+=2,i.forEach(([e,t])=>{s.getCell(`A${r}`).value=e,s.getCell(`B${r}`).value=t,r++}),r+=2,s.getCell(`A${r}`).value="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰",s.getCell(`A${r}`).font={size:14,bold:!0},r+=2;["Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ","Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„","Ø§Ù„Ø¬Ù†Ø³","Ø§Ù„Ø¹Ù…Ø±","Ø§Ù„Ù‡Ø§ØªÙ","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ","ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„"].forEach((e,t)=>{const a=s.getCell(r,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),r++,l.forEach((e,t)=>{[e.serial_number||"",e.full_name||"","male"===e.gender?"Ø°ÙƒØ±":"female"===e.gender?"Ø£Ù†Ø«Ù‰":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.age||"",e.phone||"",e.email||"",e.created_at?n(e.created_at):""].forEach((e,a)=>{const n=s.getCell(r,a+1);n.value=e,n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},n.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),r++}),s.columns.forEach(e=>{e.width=15})}static async createAppointmentsSheet(e,t){const s=e.addWorksheet("Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯");s.mergeCells("A1:H1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=Array.isArray(t.appointments)?t.appointments:[],c=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",i.length],["Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©",i.filter(e=>"completed"===e.status).length],["Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©",i.filter(e=>"cancelled"===e.status).length],["Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©",i.filter(e=>"scheduled"===e.status).length]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,c.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„ÙˆÙ‚Øª","Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶","Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬","Ø§Ù„ØªÙƒÙ„ÙØ©","Ø§Ù„Ø­Ø§Ù„Ø©","Ø§Ù„Ø·Ø¨ÙŠØ¨","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,Array.isArray(i)&&i.forEach((e,t)=>{[e.start_time?n(e.start_time):"",e.start_time?new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"",e.patient?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.title||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.cost?r(e.cost):"0",this.getStatusInArabic(e.status),e.doctor_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.notes||""].forEach((e,a)=>{const n=s.getCell(l,a+1);n.value=e,n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},n.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),l++}),s.columns.forEach(e=>{e.width=15})}static async createPaymentsSheet(e,t){const s=e.addWorksheet("Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª");s.mergeCells("A1:I1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=Array.isArray(t.payments)?t.payments:[],c=i.reduce((e,t)=>e+(t.amount||0),0),d=i.filter(e=>"completed"===e.status),o=i.filter(e=>"partial"===e.status),m=i.filter(e=>"pending"===e.status),x=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",i.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",r(c)],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©",d.length],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©",o.length],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©",m.length]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,x.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹","Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶","Ø§Ù„ÙˆØµÙ","Ø§Ù„Ù…Ø¨Ù„Øº","Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹","Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ø­Ø§Ù„Ø©","Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,Array.isArray(i)&&i.forEach((e,t)=>{let a,i,c;"partial"===e.status?(a=Number(e.total_amount_due||e.amount)||0,i=Number(e.amount_paid||e.amount)||0,c=Math.max(0,a-i)):e.appointment_id&&e.appointment_total_cost?(a=Number(e.appointment_total_cost)||0,i=Number(e.appointment_total_paid||e.amount)||0,c=Number(e.appointment_remaining_balance||0)):(a=Number(e.amount)||0,i=Number(e.amount)||0,c=0);[e.payment_date?n(e.payment_date):"",e.patient?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.description||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",r(a),r(i),r(c),e.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",this.getPaymentStatusInArabic(e.status),e.receipt_number||""].forEach((e,a)=>{const n=s.getCell(l,a+1);n.value=e,n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},n.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),a>=3&&a<=5&&(n.font={bold:!0},n.fill||(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),l++}),s.columns.forEach(e=>{e.width=15})}static async createInventorySheet(e,t){const s=e.addWorksheet("Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");s.mergeCells("A1:F1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=Array.isArray(t.inventory)?t.inventory:[],c=i.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),d=i.filter(e=>(e.quantity||0)<=5).length,o=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±",i.length],["Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©",r(c)],["Ø¹Ù†Ø§ØµØ± Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",d],["Ø¹Ù†Ø§ØµØ± Ù†ÙØ¯Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",i.filter(e=>0===(e.quantity||0)).length]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,o.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬","Ø§Ù„ÙØ¦Ø©","Ø§Ù„ÙƒÙ…ÙŠØ©","Ø§Ù„ØªÙƒÙ„ÙØ©","Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©","ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,Array.isArray(i)&&i.forEach((e,t)=>{[e.name||"",e.category||"",e.quantity||0,r(e.cost||0),r((e.cost||0)*(e.quantity||0)),e.expiry_date?n(e.expiry_date):""].forEach((a,n)=>{const r=s.getCell(l,n+1);r.value=a,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),2===n&&(e.quantity||0)<=5&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},r.font={bold:!0,color:{argb:"FFDC2626"}})}),l++}),s.columns.forEach(e=>{e.width=15})}static async createLabOrdersSheet(e,t){const s=e.addWorksheet("Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª");s.mergeCells("A1:H1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=Array.isArray(t.labOrders)?t.labOrders:[],c=i.reduce((e,t)=>e+(t.cost||0),0),d=i.reduce((e,t)=>e+(t.paid_amount||0),0),o=c-d,m=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",i.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©",r(c)],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹",r(d)],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ",r(o)]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,m.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨","Ø§Ù„Ù…Ø®ØªØ¨Ø±","Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶","Ø§Ù„Ø®Ø¯Ù…Ø©","Ø§Ù„ØªÙƒÙ„ÙØ©","Ø§Ù„Ù…Ø¯ÙÙˆØ¹","Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","Ø§Ù„Ø­Ø§Ù„Ø©"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,Array.isArray(i)&&i.forEach((e,a)=>{const i=(Array.isArray(t.patients)?t.patients:[]).find(t=>t.id===e.patient_id);[e.order_date?n(e.order_date):"",e.lab?.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",i?.full_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.service_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",r(e.cost||0),r(e.paid_amount||0),r((e.cost||0)-(e.paid_amount||0)),e.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"].forEach((e,t)=>{const n=s.getCell(l,t+1);n.value=e,n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},n.alignment={horizontal:"right",vertical:"middle"},a%2==0&&(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),t>=4&&t<=6&&(n.font={bold:!0},n.fill||(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),l++}),s.columns.forEach(e=>{e.width=15})}static async createClinicNeedsSheet(e,t){const s=e.addWorksheet("Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©");s.mergeCells("A1:H1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),c=t.clinicNeeds.filter(e=>"urgent"===e.priority).length,d=t.clinicNeeds.filter(e=>"pending"===e.status).length,o=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª",t.clinicNeeds.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©",r(i)],["Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©",c],["Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©",d]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,o.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨","Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù","Ø§Ù„ÙØ¦Ø©","Ø§Ù„ÙƒÙ…ÙŠØ©","Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹","Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©","Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©","Ø§Ù„Ø­Ø§Ù„Ø©"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,t.clinicNeeds.forEach((e,t)=>{[e.created_at?n(e.created_at):"",e.name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.quantity||0,r(e.price||0),r((e.price||0)*(e.quantity||0)),{urgent:"Ø¹Ø§Ø¬Ù„",high:"Ø¹Ø§Ù„ÙŠ",medium:"Ù…ØªÙˆØ³Ø·",low:"Ù…Ù†Ø®ÙØ¶"}[e.priority]||e.priority||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",{pending:"Ø¢Ø¬Ù„",ordered:"ØªÙ… Ø§Ù„Ø·Ù„Ø¨",received:"ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"}[e.status]||e.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"].forEach((a,n)=>{const r=s.getCell(l,n+1);r.value=a,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),"urgent"===e.priority&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},r.font={bold:!0,color:{argb:"FFDC2626"}})}),l++}),s.columns.forEach(e=>{e.width=15})}static async createExpensesSheet(e,t){const s=e.addWorksheet("Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©");s.mergeCells("A1:G1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"};let l=3;const i=t.expenses.reduce((e,t)=>e+(t.amount||0),0),c=t.expenses.filter(e=>"paid"===e.status),d=t.expenses.filter(e=>"pending"===e.status),o=[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",t.expenses.length],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº",r(i)],["Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©",c.length],["Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©",d.length]];s.getCell(`A${l}`).value="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2,o.forEach(([e,t])=>{s.getCell(`A${l}`).value=e,s.getCell(`B${l}`).value=t,l++}),l+=2,s.getCell(`A${l}`).value="ØªÙØ§ØµÙŠÙ„ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",s.getCell(`A${l}`).font={size:14,bold:!0},l+=2;["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹","Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ","Ø§Ù„Ù†ÙˆØ¹","Ø§Ù„Ù…Ø¨Ù„Øº","Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù…ÙˆØ±Ø¯","Ø§Ù„Ø­Ø§Ù„Ø©"].forEach((e,t)=>{const a=s.getCell(l,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),l++,t.expenses.forEach((e,t)=>{[e.payment_date?n(e.payment_date):"",e.expense_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",{salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"}[e.expense_type]||e.expense_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",r(e.amount||0),{cash:"Ù†Ù‚Ø¯Ø§Ù‹",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",check:"Ø´ÙŠÙƒ",credit_card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†"}[e.payment_method]||e.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",e.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯","paid"===e.status?"Ù…Ø¯ÙÙˆØ¹":"Ø¢Ø¬Ù„"].forEach((e,a)=>{const n=s.getCell(l,a+1);n.value=e,n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},n.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),3===a&&(n.font={bold:!0},n.fill||(n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),l++}),s.columns.forEach(e=>{e.width=15})}static async createProfitLossSheet(e,t){const s=e.addWorksheet("Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±");s.mergeCells("A1:H1");const a=s.getCell("A1");a.value="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C3AED"}},a.alignment={horizontal:"center",vertical:"middle"};let n=3;const l=t.payments.reduce((e,t)=>e+(t.amount||0),0),i=t.labOrders.reduce((e,t)=>e+(t.cost||0),0),c=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),d=t.inventory.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),o=t.expenses.reduce((e,t)=>e+(t.amount||0),0),m=i+c+d+o,x=l-m,h=x>=0,u=l>0?x/l*100:0;s.getCell(`A${n}`).value="Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±",s.getCell(`A${n}`).font={size:14,bold:!0,color:{argb:"FF7C3AED"}},n+=2;[["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",r(l)],["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",r(m)],["ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©",r(Math.abs(x))],["Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­",`${u.toFixed(2)}%`],["Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©",h?"Ø±Ø¨Ø­":"Ø®Ø³Ø§Ø±Ø©"]].forEach(([e,t])=>{s.getCell(`A${n}`).value=e,s.getCell(`B${n}`).value=t,s.getCell(`A${n}`).font={bold:!0},"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©"===e&&(s.getCell(`B${n}`).font={bold:!0,color:{argb:h?"FF10B981":"FFEF4444"}}),n++}),n+=2,s.getCell(`A${n}`).value="ØªÙØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",s.getCell(`A${n}`).font={size:14,bold:!0,color:{argb:"FF10B981"}},n+=2;const p=t.payments.filter(e=>"completed"===e.status),g=t.payments.filter(e=>"partial"===e.status),f=t.payments.filter(e=>"pending"===e.status);[["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©",`${p.length} (${r(p.reduce((e,t)=>e+(t.amount||0),0))})`],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©",`${g.length} (${r(g.reduce((e,t)=>e+(t.amount||0),0))})`],["Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©",`${f.length} (${r(f.reduce((e,t)=>e+(t.amount||0),0))})`]].forEach(([e,t])=>{s.getCell(`A${n}`).value=e,s.getCell(`B${n}`).value=t,n++}),n+=2,s.getCell(`A${n}`).value="ØªÙØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",s.getCell(`A${n}`).font={size:14,bold:!0,color:{argb:"FFEF4444"}},n+=2;[["ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª",r(i)],["Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",r(c)],["ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",r(d)],["Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©",r(o)]].forEach(([e,t])=>{s.getCell(`A${n}`).value=e,s.getCell(`B${n}`).value=t,n++}),s.getColumn("A").width=30,s.getColumn("B").width=20}static getPaymentStatusInArabic(e){return{completed:"Ù…ÙƒØªÙ…Ù„",partial:"Ø¬Ø²Ø¦ÙŠ",pending:"Ø¢Ø¬Ù„",overdue:"Ù…ØªØ£Ø®Ø±",cancelled:"Ù…Ù„ØºÙŠ"}[e]||e}static filterByDateRange(e,t,s){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),n=new Date(t.end);return n.setHours(23,59,59,999),e.filter(e=>{const t=new Date(e[s]);return t>=a&&t<=n})}}function Rt({isActive:s=!0,lastUpdate:a,className:n=""}){const[r,l]=t.useState(!1);t.useEffect(()=>{const e=()=>{l(!0),setTimeout(()=>l(!1),1e3)},t=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[]);return s?e.jsx(m,{variant:r?"default":"secondary",className:`flex items-center gap-1 ${n} ${r?"bg-green-500 text-white dark:bg-green-600":"bg-green-100 text-green-800 dark:bg-green-600/20 dark:text-green-400"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{className:"text-xs",children:"ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:a?(e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/1e3),a=Math.floor(s/60),n=Math.floor(a/60);if(s<60)return"Ø§Ù„Ø¢Ù†";if(a<60)return`Ù…Ù†Ø° ${a} Ø¯Ù‚ÙŠÙ‚Ø©`;if(n<24)return`Ù…Ù†Ø° ${n} Ø³Ø§Ø¹Ø©`;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})(a):"Ù…ØªØµÙ„"})]})}):e.jsxs(m,{variant:"secondary",className:`flex items-center gap-1 ${n}`,children:[e.jsx(At,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"ØºÙŠØ± Ù…ØªØµÙ„"})]})}function Ot(){const{toast:s}=h(),[a,n]=t.useState(!1),[r,l]=t.useState(""),[i,c]=t.useState(""),[d,o]=t.useState(""),[m,x]=t.useState(""),[V,q]=t.useState(""),[Y,K]=t.useState(!1),[W,H]=t.useState(!1),[G,U]=t.useState(!1),[X,Z]=t.useState(!1),[J,Q]=t.useState(""),[ee,te]=t.useState(!1);t.useEffect(()=>{n(u())},[]);const se=()=>{l(""),c(""),o(""),x(""),q(""),Q(""),K(!1),H(!1),U(!1)},ae=async e=>{if(e.preventDefault(),!a||r.trim())if(i.trim())if(d.trim())if(a&&i===r)Q("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø®ØªÙ„ÙØ© Ø¹Ù† Ø§Ù„Ø­Ø§Ù„ÙŠØ©");else if(i===d)if(I(i)){Z(!0),Q("");try{let e=!1;if(a)e=await L(r.trim(),i.trim()),e&&s({title:"ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­",description:"Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©",variant:"default"});else{if(!m||!V.trim())return Q("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ Ø£Ù…Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡"),void Z(!1);const t=E.find(e=>e.id===m);if(!t)return Q("Ø³Ø¤Ø§Ù„ Ø£Ù…Ø§Ù†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­"),void Z(!1);const a={password:i.trim(),securityQuestion:t,securityAnswer:V.trim()};e=await z(a),e&&(s({title:"ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­",description:"Ø³ÙŠØªÙ… Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",variant:"default"}),n(!0))}e?se():Q(a?"ÙØ´Ù„ ÙÙŠ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©.":"ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")}catch(t){Q(t.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±")}finally{Z(!1)}}else Q("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©. ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙˆØ­Ø±Ù Ø£Ùˆ Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯");else Q("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©");else Q("ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©");else Q("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©");else Q("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©")};return e.jsx(p,{className:"w-full",dir:"rtl",children:e.jsxs(Te,{open:ee,onOpenChange:te,children:[e.jsx(Re,{asChild:!0,children:e.jsx(g,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:a?e.jsx(f,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}):e.jsx(Ie,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†"}),e.jsx(y,{className:"text-right",children:a?"ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±":"Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ø­Ù…Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:ee?"Ø¥ØºÙ„Ø§Ù‚":"ÙØªØ­"}),ee?e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(N,{className:"w-4 h-4 text-muted-foreground"})]})]})})}),e.jsx(Oe,{children:e.jsx(b,{children:e.jsxs("form",{onSubmit:ae,onKeyDown:e=>{"Enter"!==e.key||X||ae(e)},className:"space-y-4",children:[a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"currentPassword",className:"text-right block",children:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{id:"currentPassword",type:Y?"text":"password",value:r,onChange:e=>l(e.target.value),placeholder:"Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©",className:"pr-10 text-right",disabled:X}),e.jsx(F,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>K(!Y),disabled:X,children:Y?e.jsx(_,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"newPassword",className:"text-right block",children:a?"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{id:"newPassword",type:W?"text":"password",value:i,onChange:e=>c(e.target.value),placeholder:a?"Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©":"Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±",className:"pr-10 text-right",disabled:X}),e.jsx(F,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>H(!W),disabled:X,children:W?e.jsx(_,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"confirmPassword",className:"text-right block",children:"ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{id:"confirmPassword",type:G?"text":"password",value:d,onChange:e=>o(e.target.value),placeholder:"Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",className:"pr-10 text-right",disabled:X}),e.jsx(F,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>U(!G),disabled:X,children:G?e.jsx(_,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-right block",children:"Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†ÙŠ (Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙÙŠ Ø­Ø§Ù„ Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)"}),e.jsxs(k,{value:m,onValueChange:x,disabled:X,children:[e.jsx(A,{className:"text-right",children:e.jsx(C,{placeholder:"Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„ Ø£Ù…Ø§Ù†ÙŠ"})}),e.jsx(S,{children:E.map(t=>e.jsx(P,{value:t.id,className:"text-right",children:t.question},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"securityAnswer",className:"text-right block",children:"Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†ÙŠ"}),e.jsx($,{id:"securityAnswer",type:"text",value:V,onChange:e=>q(e.target.value),placeholder:"Ø£Ø¯Ø®Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø®ØªØ§Ø±",className:"text-right",disabled:X})]})]}),J&&e.jsxs(M,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(R,{className:"text-right",children:J})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:"}),e.jsx("p",{children:"â€¢ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 4 Ø£Ø­Ø±Ù"}),e.jsx("p",{children:"â€¢ Ø­Ø±Ù Ø£Ùˆ Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:se,disabled:X,className:"w-full sm:w-auto",children:"Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†"}),a&&e.jsx(F,{type:"button",variant:"destructive",onClick:async()=>{if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ Ø³ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.")){Z(!0);try{B(),n(!1),se(),s({title:"ØªÙ… Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",description:"ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±",variant:"default"})}catch(e){console.error("Error disabling password:",e),s({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",variant:"destructive"})}finally{Z(!1)}}},disabled:X,className:"w-full sm:w-auto",children:"Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"}),e.jsx(F,{type:"submit",disabled:X||!i.trim()||!d.trim()||(a?!r.trim():!m||!V.trim()),className:"w-full sm:w-auto",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 ml-2"}),a?"Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª":"Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"]})})]})]})})})]})})}function It(){const{patientReports:s,isLoading:a,isExporting:r,generateReport:l,exportReport:i,currentFilter:c,setFilter:d,clearCache:o}=fe(),{currency:u,settings:f}=V(),{toast:v}=h(),{isDarkMode:N}=q(),{patients:_,loadPatients:D}=Y(),[E,M]=t.useState(""),[T,R]=t.useState("all"),[O,I]=t.useState("all");t.useEffect(()=>{l("patients"),D()},[l,D]),je("patients");const L=({title:t,value:s,icon:a,color:n="blue",trend:r,description:l})=>e.jsxs(p,{className:Se(n),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsx(a,{className:`h-4 w-4 ${Ee(n)}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:s}),r&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(r.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(r.value),"%"]}),r.isPositive?e.jsx(lt,{className:"h-3 w-3"}):e.jsx(it,{className:"h-3 w-3"})]}),l&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:l})]})]}),z=s?.patientsList?.filter(e=>{const t=`${e.first_name} ${e.last_name}`.toLowerCase().includes(E.toLowerCase())||e.phone?.includes(E)||e.email?.toLowerCase().includes(E.toLowerCase()),s="all"===T||(()=>{if(!e.date_of_birth)return"unknown"===T;const t=(new Date).getFullYear()-new Date(e.date_of_birth).getFullYear();switch(T){case"child":return t<18;case"adult":return t>=18&&t<60;case"senior":return t>=60;default:return!0}})();return t&&s&&"all"===O})||[];return a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰..."})]})}):s?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø±Ø¶Ù‰"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{o(),await l("patients"),v({title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"})}catch(e){console.error("Error refreshing patient reports:",e),v({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"})}},disabled:a,children:[e.jsx(x,{className:"w-4 h-4 ml-2 "+(a?"animate-spin":"")}),a?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...":"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{if(_&&0!==_.length)try{await ze.exportPatientsToExcel(_),v({title:"ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­",description:`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙƒÙ…Ù„Ù Excel Ù…Ø¹ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ù…ÙŠÙ„ (${_.length} Ù…Ø±ÙŠØ¶)`})}catch(e){console.error("Error exporting Excel:",e),v({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±",description:"ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"})}else v({title:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª",description:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø¶Ù‰ Ù„Ù„ØªØµØ¯ÙŠØ±",variant:"destructive"})},disabled:r,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:async()=>{try{if(!_||0===_.length)return void v({title:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª",description:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø¶Ù‰ Ù„Ù„ØªØµØ¯ÙŠØ±",variant:"destructive"});const e=_.length,t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),a=_.filter(e=>new Date(e.created_at)>=s).length,n={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let l=0,i=0;_.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;l+=t,i++,t<13?n.children++:t<20?n.teens++:t<60?n.adults++:n.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const c={totalPatients:e,newPatientsThisMonth:a,activePatients:e,averageAge:i>0?Math.round(l/i):0,patients:_,ageDistribution:[{ageGroup:"Ø£Ø·ÙØ§Ù„ (0-12)",count:n.children},{ageGroup:"Ù…Ø±Ø§Ù‡Ù‚ÙˆÙ† (13-19)",count:n.teens},{ageGroup:"Ø¨Ø§Ù„ØºÙˆÙ† (20-59)",count:n.adults},{ageGroup:"ÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù† (60+)",count:n.seniors}],genderDistribution:[{gender:"Ø°ÙƒÙˆØ±",count:r.male},{gender:"Ø¥Ù†Ø§Ø«",count:r.female}],registrationTrend:[],filterInfo:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†",dataCount:e};await Le.exportPatientReport(c,f),v({title:"ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­",description:`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙƒÙ…Ù„Ù PDF (${e} Ù…Ø±ÙŠØ¶)`})}catch(e){console.error("Error exporting PDF:",e),v({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±",description:"ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ…Ù„Ù PDF. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"})}},disabled:r,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),r?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...":"ØªØµØ¯ÙŠØ± PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(L,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰",value:s?.totalPatients||0,icon:Be,color:"blue",description:"Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†"}),e.jsx(L,{title:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯",value:s?.newPatients||0,icon:Dt,color:"green",description:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø¯ÙŠØ«Ø§Ù‹"}),e.jsx(L,{title:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†",value:s?.activePatients||0,icon:K,color:"emerald",description:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø¯ÙŠØ«Ø©"}),e.jsx(L,{title:"Ø§Ù„Ù…Ø±Ø¶Ù‰ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†",value:s?.inactivePatients||0,icon:kt,color:"red",description:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø¯ÙŠØ«Ø©"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø±ÙŠ"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø¹Ù…Ø±ÙŠØ© (",s.totalPatients," Ù…Ø±ÙŠØ¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsxs(b,{children:[(()=>{const t=ye(s.ageDistribution);W("categorical",N),W("primary",N);const a=H("demographics",N,t.length),n=G(N);return 0===t.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙˆØ²ÙŠØ¹ Ø¹Ù…Ø±ÙŠ Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:n.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:t,cx:"50%",cy:"50%",labelLine:!1,label:({ageGroup:e,count:t,percent:s})=>t>0?`${e}: ${t} (${(100*s).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:N?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:t.map((t,s)=>e.jsx(He,{fill:a[s%a.length]},`age-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…Ø±ÙŠØ¶`,"Ø§Ù„Ø¹Ø¯Ø¯"],labelFormatter:e=>`Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©: ${e}`,contentStyle:n.tooltip})]})})})(),(()=>{const t=ye(s.ageDistribution),a=H("demographics",N,t.length);return t.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:t.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a[n%a.length]}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.ageGroup,": ",t.count," (",Math.round(t.count/s.totalPatients*100),"%)"]})]},`age-legend-${n}`))})})()]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³ (",s.totalPatients," Ù…Ø±ÙŠØ¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsxs(b,{children:[(()=>{const t=ve(s.genderDistribution),a=H("demographics",N,2),n=W("primary",N),r=G(N);return 0===t.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙˆØ²ÙŠØ¹ Ø¬Ù†Ø³ Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:r.responsive.desktop.height,children:e.jsxs(Ue,{data:t,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:r.bar.barCategoryGap,children:[e.jsx(Xe,{strokeDasharray:r.grid.strokeDasharray,stroke:r.grid.stroke,strokeOpacity:r.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"gender",tick:{fontSize:14,fill:N?"#9ca3af":"#6b7280"},axisLine:{stroke:N?"#4b5563":"#d1d5db"},tickLine:{stroke:N?"#4b5563":"#d1d5db"}}),e.jsx(Je,{tick:{fontSize:14,fill:N?"#9ca3af":"#6b7280"},axisLine:{stroke:N?"#4b5563":"#d1d5db"},tickLine:{stroke:N?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],allowDecimals:!1,tickFormatter:e=>`${Math.round(e)} Ù…Ø±ÙŠØ¶`}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…Ø±ÙŠØ¶`,"Ø§Ù„Ø¹Ø¯Ø¯"],labelFormatter:e=>`Ø§Ù„Ø¬Ù†Ø³: ${e}`,contentStyle:r.tooltip}),e.jsx(Qe,{dataKey:"count",fill:n[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:t.map((t,s)=>e.jsx(He,{fill:a[s%a.length]},`cell-${s}`))})]})})})(),(()=>{const t=ve(s.genderDistribution);return t.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:t.map((t,a)=>e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.gender}),e.jsxs("div",{className:"font-semibold",children:[t.count," Ù…Ø±ÙŠØ¶ (",Math.round(t.count/s.totalPatients*100),"%)"]})]},`gender-summary-${a}`))})})()]})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„"})]}),e.jsxs(y,{children:["Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø´Ù‡Ø±ÙŠØ§Ù‹ (",s.registrationTrend?.length||0," ÙØªØ±Ø©)"]})]}),e.jsxs(b,{children:[(()=>{const t=s.registrationTrend||[],a=W("primary",N);H("medical",N,1);const n=G(N);return 0===t.length?e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(lt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ØªØ¬Ø§Ù‡ ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:n.responsive.large.height,children:e.jsxs(et,{data:t,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Xe,{strokeDasharray:n.grid.strokeDasharray,stroke:n.grid.stroke,strokeOpacity:n.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"period",tick:{fontSize:12,fill:N?"#9ca3af":"#6b7280"},axisLine:{stroke:N?"#4b5563":"#d1d5db"},tickLine:{stroke:N?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(Je,{tick:{fontSize:12,fill:N?"#9ca3af":"#6b7280"},axisLine:{stroke:N?"#4b5563":"#d1d5db"},tickLine:{stroke:N?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} Ù…Ø±ÙŠØ¶`}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…Ø±ÙŠØ¶`,"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†"],labelFormatter:e=>`Ø§Ù„ÙØªØ±Ø©: ${e}`,contentStyle:n.tooltip}),e.jsx(tt,{type:"monotone",dataKey:"count",stroke:a[0],fill:a[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})})})(),(()=>{const t=s.registrationTrend||[];return t.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ø¹Ù„Ù‰ ÙØªØ±Ø©"}),e.jsxs("div",{className:"font-semibold",children:[Math.max(...t.map(e=>e.count))," Ù…Ø±ÙŠØ¶"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ù…ØªÙˆØ³Ø· Ø´Ù‡Ø±ÙŠ"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(t.reduce((e,t)=>e+t.count,0)/t.length)," Ù…Ø±ÙŠØ¶"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†"}),e.jsxs("div",{className:"font-semibold",children:[t.reduce((e,t)=>e+t.count,0)," Ù…Ø±ÙŠØ¶"]})]})]})})()]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsx("span",{children:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰"})]}),e.jsx(y,{children:"Ù‚Ø§Ø¦Ù…Ø© ØªÙØµÙŠÙ„ÙŠØ© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",dir:"rtl",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{htmlFor:"search",children:"Ø§Ù„Ø¨Ø­Ø«"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{id:"search",placeholder:"Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ...",value:E,onChange:e=>M(e.target.value),className:"pl-10",dir:"rtl"})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"age-filter",children:"Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©"}),e.jsxs(k,{value:T,onValueChange:R,children:[e.jsx(A,{className:"w-40",dir:"rtl",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ø±"}),e.jsx(P,{value:"child",children:"Ø£Ø·ÙØ§Ù„ (Ø£Ù‚Ù„ Ù…Ù† 18)"}),e.jsx(P,{value:"adult",children:"Ø¨Ø§Ù„ØºÙŠÙ† (18-59)"}),e.jsx(P,{value:"senior",children:"ÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù† (60+)"}),e.jsx(P,{value:"unknown",children:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"status-filter",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsxs(k,{value:O,onValueChange:I,children:[e.jsx(A,{className:"w-32",dir:"rtl",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"Ø§Ù„ÙƒÙ„"}),e.jsx(P,{value:"active",children:"Ù†Ø´Ø·"}),e.jsx(P,{value:"inactive",children:"ØºÙŠØ± Ù†Ø´Ø·"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-center-all",dir:"rtl",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"#"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"Ø§Ù„Ø¹Ù…Ø±"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"Ø§Ù„Ø­Ø§Ù„Ø©"})]})}),e.jsx("tbody",{children:z.map((t,s)=>e.jsxs("tr",{className:"hover:bg-muted/50 "+(s%2==0?"bg-background":"bg-muted/30"),children:[e.jsx("td",{className:"p-3 font-medium text-center",children:s+1}),e.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:t.full_name?t.full_name.charAt(0):(t.first_name||"").charAt(0)}),e.jsx("span",{className:"arabic-enhanced",children:t.full_name||`${t.first_name||""} ${t.last_name||""}`.trim()})]})}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-sm",children:t.phone||"-"}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-lg",children:t.email||"-"}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:n(t.created_at)}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:t.age||(t.date_of_birth?(new Date).getFullYear()-new Date(t.date_of_birth).getFullYear():"-")}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(m,{variant:"secondary",className:"arabic-enhanced",children:"Ù†Ø´Ø·"})})]},t.id))})]})}),0===z.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«"})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}),e.jsx("p",{className:"text-muted-foreground",children:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰"})]})}function Lt(){const{currency:s,settings:a}=V(),{inventoryReports:r,isLoading:l,isExporting:i,generateReport:c,exportReport:d,clearCache:o}=fe(),{isDarkMode:h}=q(),{items:u,loadItems:f}=X(),[v,N]=t.useState(""),[_,E]=t.useState("all"),[M,R]=t.useState("all"),O=mt({data:u,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});je("inventory"),t.useEffect(()=>{c("inventory"),f()},[c,f]);const I=W("categorical",h),L=W("primary",h),z=G(h),B=({title:t,value:s,icon:a,color:n,trend:r,description:l})=>e.jsx(p,{className:Se(n),dir:"rtl",children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse justify-end",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s}),r&&e.jsxs("div",{className:"flex items-center text-sm "+(r.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(r.value),"%"]}),r.isPositive?e.jsx(lt,{className:"w-4 h-4"}):e.jsx(it,{className:"w-4 h-4"})]})]})]}),e.jsx("div",{className:`p-3 rounded-full ${Ee(n)}`,children:e.jsx(a,{className:"w-6 h-6"})})]}),l&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:l})]})}),Y=r?.stockAlerts?.filter(e=>{const t=e.name.toLowerCase().includes(v.toLowerCase())||e.category?.toLowerCase().includes(v.toLowerCase()),s="all"===_||e.category===_,a="all"===M||(()=>{const t=new Date,s=e.expiry_date&&new Date(e.expiry_date)<t,a=e.expiry_date&&(()=>{const s=new Date(e.expiry_date),a=Math.ceil((s.getTime()-t.getTime())/864e5);return a<=30&&a>0})(),n=e.quantity<=e.minimum_stock&&e.quantity>0,r=0===e.quantity;switch(M){case"low_stock":return n;case"out_of_stock":return r;case"expired":return s;case"expiring_soon":return a;default:return!0}})();return t&&s&&a})||[];r?.expiryAlerts?.filter(e=>{const t=e.name.toLowerCase().includes(v.toLowerCase())||e.category?.toLowerCase().includes(v.toLowerCase()),s="all"===_||e.category===_;return t&&s});const K=Array.from(new Set([...r?.stockAlerts?.map(e=>e.category).filter(Boolean)||[],...r?.expiryAlerts?.map(e=>e.category).filter(Boolean)||[]]));return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ht,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†..."})]})}):r?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{await c("inventory");const e=new CustomEvent("showToast",{detail:{title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",type:"success"}});window.dispatchEvent(e)}catch(e){const t=new CustomEvent("showToast",{detail:{title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",type:"error"}});window.dispatchEvent(t)}},disabled:l,children:[e.jsx(x,{className:"w-4 h-4 ml-2 "+(l?"animate-spin":"")}),"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{const e=O.filteredData;if(0!==e.length)try{const t=e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),s=e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,a=e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,r=e.filter(e=>0===e.quantity).length,l={"Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª":O.timeFilter.startDate&&O.timeFilter.endDate?`Ù…Ù† ${O.timeFilter.startDate} Ø¥Ù„Ù‰ ${O.timeFilter.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±":e.length,"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©":t,"Ø¹Ù†Ø§ØµØ± Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":s,"Ø¹Ù†Ø§ØµØ± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©":a,"Ø¹Ù†Ø§ØµØ± Ù†ÙØ¯Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†":r,"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±":n(new Date)},i="\ufeff"+["Ø§Ù„Ù…Ø¤Ø´Ø±,Ø§Ù„Ù‚ÙŠÙ…Ø©",...Object.entries(l).map(([e,t])=>`"${e}","${t}"`)].join("\n");await ExportService.convertCSVToExcel(i,"inventory",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­! (${e.length} Ø¹Ù†ØµØ±)`)}catch(t){console.error("Error exporting CSV:",t),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†")}else ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²ÙˆÙ† Ù„Ù„ØªØµØ¯ÙŠØ±")},disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:async()=>{try{const e=O.filteredData;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²ÙˆÙ† Ù„Ù„ØªØµØ¯ÙŠØ±");const t={...r,totalItems:e.length,totalValue:e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),lowStockItems:e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,expiredItems:e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,outOfStockItems:e.filter(e=>0===e.quantity).length,inventoryItems:e,filterInfo:O.timeFilter.startDate&&O.timeFilter.endDate?`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ${O.timeFilter.startDate} Ø¥Ù„Ù‰ ${O.timeFilter.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",dataCount:e.length};await Le.exportInventoryReport(t,a),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙƒÙ…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­ (${e.length} Ø¹Ù†ØµØ±)`)}catch(e){console.error("Error exporting PDF:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ…Ù„Ù PDF")}},disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± PDF"]})]})]}),e.jsx(xt,{value:O.timeFilter,onChange:O.handleFilterChange,onClear:O.resetFilter,title:"ÙÙ„ØªØ±Ø© Ø²Ù…Ù†ÙŠØ© - Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(B,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±",value:O.filteredData.length,icon:ht,color:"blue",description:"Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",trend:O.trend}),e.jsx(B,{title:"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©",value:e.jsx(Pe,{amount:O.filteredData.reduce((e,t)=>e+t.unit_price*t.quantity,0),currency:s}),icon:lt,color:"green",description:"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"}),e.jsx(B,{title:"Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶",value:O.filteredData.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,icon:T,color:"yellow",description:"Ø¹Ù†Ø§ØµØ± ØªØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙˆÙŠÙ†"}),e.jsx(B,{title:"Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©",value:O.filteredData.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,icon:Z,color:"red",description:"Ø¹Ù†Ø§ØµØ± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©"})]}),e.jsx(y,{children:"ØªÙˆØ²ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª"})]}),e.jsx(b,{children:e.jsx(Ye,{width:"100%",height:z.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:r.itemsByCategory.filter(e=>e.count>0),cx:"50%",cy:"50%",labelLine:!1,label:({category:e,count:t,percent:s})=>t>0?`${e}: ${t} (${(100*s).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:h?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,isAnimationActive:!1,animationDuration:0,children:r.itemsByCategory.filter(e=>e.count>0).map((t,s)=>e.jsx(He,{fill:I[s%I.length]},`cell-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[e,"Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±"],labelFormatter:e=>`Ø§Ù„ÙØ¦Ø©: ${e}`,contentStyle:z.tooltip})]})})})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯"})]}),e.jsx(y,{children:"ØªÙˆØ²ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†"})]}),e.jsx(b,{children:e.jsx(Ye,{width:"100%",height:z.responsive.desktop.height,children:e.jsxs(Ue,{data:r.itemsBySupplier.filter(e=>e.count>0).slice(0,8),margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(Xe,{strokeDasharray:z.grid.strokeDasharray,stroke:z.grid.stroke,strokeOpacity:z.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"supplier",tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"},interval:0}),e.jsx(Je,{tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"]}),e.jsx(Ge,{formatter:(e,t)=>[e,"Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±"],labelFormatter:e=>`Ø§Ù„Ù…ÙˆØ±Ø¯: ${e}`,contentStyle:z.tooltip}),e.jsx(Qe,{dataKey:"count",fill:L[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,isAnimationActive:!1,animationDuration:0})]})})})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"})]}),e.jsx(y,{children:"Ù…Ø¹Ø¯Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø´Ù‡Ø±ÙŠØ§Ù‹"})]}),e.jsx(b,{children:e.jsx(Ye,{width:"100%",height:z.responsive.desktop.height,children:e.jsxs(et,{data:r.usageTrend,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Xe,{strokeDasharray:z.grid.strokeDasharray,stroke:z.grid.stroke,strokeOpacity:z.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"period",tick:{fontSize:12,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"}}),e.jsx(Je,{tick:{fontSize:12,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"}}),e.jsx(Ge,{formatter:(e,t)=>[e,"Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"],labelFormatter:e=>`Ø§Ù„ÙØªØ±Ø©: ${e}`,contentStyle:z.tooltip}),e.jsx(tt,{type:"monotone",dataKey:"usage",stroke:L[3],fill:L[3],fillOpacity:.3,strokeWidth:3,isAnimationActive:!1,animationDuration:0})]})})})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"})]}),e.jsx(y,{children:"Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡Ùƒ"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{htmlFor:"search",children:"Ø§Ù„Ø¨Ø­Ø«"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{id:"search",placeholder:"Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙØ¦Ø©...",value:v,onChange:e=>N(e.target.value),className:"pr-10"})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"category-filter",children:"Ø§Ù„ÙØ¦Ø©"}),e.jsxs(k,{value:_,onValueChange:E,children:[e.jsx(A,{className:"w-40",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª"}),K.map(t=>e.jsx(P,{value:t,children:t},t))]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"alert-filter",children:"Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡"}),e.jsxs(k,{value:M,onValueChange:R,children:[e.jsx(A,{className:"w-40",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"}),e.jsx(P,{value:"low_stock",children:"Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶"}),e.jsx(P,{value:"out_of_stock",children:"Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"}),e.jsx(P,{value:"expired",children:"Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©"}),e.jsx(P,{value:"expiring_soon",children:"ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-center-all",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-3 font-medium",children:"#"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ø§Ù„ÙØ¦Ø©"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{children:Y.map((t,s)=>{const a=new Date,r=t.expiry_date&&new Date(t.expiry_date)<a,l=t.expiry_date&&(()=>{const e=new Date(t.expiry_date),s=Math.ceil((e.getTime()-a.getTime())/864e5);return s<=30&&s>0})(),i=t.quantity<=t.minimum_stock&&t.quantity>0;let c="",d="";return 0===t.quantity?(c="Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",d="destructive"):r?(c="Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©",d="destructive"):i?(c="Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶",d="warning"):l&&(c="ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹",d="warning"),e.jsxs("tr",{className:s%2==0?"bg-background":"bg-muted/50",children:[e.jsx("td",{className:"p-3 font-medium text-center",children:s+1}),e.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:t.name}),e.jsx("td",{className:"p-3 text-muted-foreground text-center table-cell-wrap-truncate-sm",children:t.category||"-"}),e.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[t.quantity," ",t.unit||"Ù‚Ø·Ø¹Ø©"]}),e.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[t.minimum_stock," ",t.unit||"Ù‚Ø·Ø¹Ø©"]}),e.jsx("td",{className:"p-3 text-muted-foreground text-center",children:t.expiry_date?n(t.expiry_date):"-"}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(m,{variant:d,children:c})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(F,{variant:"ghost",size:"sm",children:e.jsx(D,{className:"w-4 h-4"})})})]},t.id)})})]})}),0===Y.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ht,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:0===r?.stockAlerts?.length?"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ† - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø©":"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª: ",r?.stockAlerts?.length||0]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ht,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}),e.jsx("p",{className:"text-muted-foreground",children:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"}),e.jsxs(F,{onClick:()=>c("inventory"),className:"mt-4",variant:"outline",children:[e.jsx(x,{className:"w-4 h-4 ml-2"}),"Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„"]})]})}function zt(){const{appointmentReports:s,isLoading:a,isExporting:n,generateReport:r,clearCache:l}=fe(),{appointments:i,loadAppointments:c}=J(),{settings:d}=V(),{isDarkMode:o}=q(),m=mt({data:i,dateField:"start_time",initialFilter:{preset:"all",startDate:"",endDate:""}});je("appointments"),t.useEffect(()=>{r("appointments"),c()},[r,c]);const h=(()=>{const e=m.filteredData.length>0?m.filteredData:i,t=e.length,s=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,n=e.filter(e=>"scheduled"===e.status).length,r=e.filter(e=>"no_show"===e.status).length,l=t>0?Math.round(s/t*1e3)/10:0,c=t>0?Math.round(a/t*1e3)/10:0;return{total:t,completed:s,cancelled:a,pending:n,noShow:r,attendanceRate:l.toFixed(1),cancellationRate:c.toFixed(1),appointmentsByStatus:[],appointmentTrend:[]}})();W("categorical",o);const u=W("primary",o),f=H("status",o,8),v=G(o),N=(()=>{try{const e=[{name:"Ù…ÙƒØªÙ…Ù„",value:h.completed,color:f[0]},{name:"Ù…Ø¬Ø¯ÙˆÙ„",value:h.pending,color:f[4]},{name:"Ù…Ù„ØºÙŠ",value:h.cancelled,color:f[2]},{name:"Ù„Ù… ÙŠØ­Ø¶Ø±",value:h.noShow,color:f[3]}].map(e=>({...e,percentage:h.total>0?Math.round(e.value/h.total*100):0}));return Ne(e)}catch(e){return console.error("Appointment Reports: Error processing status data:",e),[]}})(),w=(()=>{try{if(s?.appointmentTrend&&s.appointmentTrend.length>0)return s.appointmentTrend.map(e=>({month:e.period,count:e.count,formattedCount:`${e.count} Ù…ÙˆØ¹Ø¯`}));be(i,"start_time")||console.warn("Appointment Reports: Invalid date data detected");const e=i.reduce((e,t)=>{try{if(!t||!t.start_time)return e;const s=new Date(t.start_time);if(isNaN(s.getTime())||s.getFullYear()<1900||s.getFullYear()>2100)return console.warn("Invalid appointment start_time:",t.start_time),e;const a=s.getMonth(),n=s.getFullYear(),r=`${["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"][a]} ${n}`;return e[r]=(e[r]||0)+1,e}catch(s){return console.warn("Error processing appointment date:",t.start_time,s),e}},{}),t=Object.entries(e).map(([e,t])=>({month:["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"].find(t=>e.includes(t))||e.split(" ")[0],fullMonth:e,count:t,formattedCount:`${t} Ù…ÙˆØ¹Ø¯`})).sort((e,t)=>{const s=["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"],a=s.findIndex(t=>e.fullMonth.includes(t)),n=s.findIndex(e=>t.fullMonth.includes(e));if(a!==n)return a-n;return(parseInt(e.fullMonth.split(" ")[1])||0)-(parseInt(t.fullMonth.split(" ")[1])||0)}).filter(e=>e.count>0);return we(t)?t:(console.warn("Appointment Reports: Invalid monthly chart data"),[])}catch(e){return console.error("Appointment Reports: Error processing monthly data:",e),[]}})();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{l(),await r("appointments"),await c();const e=new CustomEvent("showToast",{detail:{title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing appointment reports:",e);const t=new CustomEvent("showToast",{detail:{title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",type:"error"}});window.dispatchEvent(t)}},disabled:a,children:[e.jsx(x,{className:"w-4 h-4 ml-2 "+(a?"animate-spin":"")}),"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{const e=m.filteredData.length>0?m.filteredData:i;if(0!==e.length)try{const t=m.timeFilter.startDate&&m.timeFilter.endDate?`Ù…Ù† ${m.timeFilter.startDate} Ø¥Ù„Ù‰ ${m.timeFilter.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",s={};e.forEach(e=>{const t=e.treatment_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";s[t]=(s[t]||0)+1});const a=Object.entries(s).map(([e,t])=>({treatment:e,count:t})).sort((e,t)=>t.count-e.count),n={totalAppointments:h.total,completedAppointments:h.completed,cancelledAppointments:h.cancelled,scheduledAppointments:h.pending,noShowAppointments:h.noShow,attendanceRate:parseFloat(h.attendanceRate),cancellationRate:parseFloat(h.cancellationRate),appointmentsByStatus:N.map(e=>({status:e.name,count:e.value,percentage:h.total>0?e.value/h.total*100:0})),appointmentsByTreatment:a,appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],appointmentsList:e,filterInfo:t,dataCount:e.length},r="\ufeff"+ze.generateAppointmentCSV(n,{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"});await ze.convertCSVToExcel(r,"appointments",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­! (${e.length} Ù…ÙˆØ¹Ø¯)`)}catch(t){console.error("Error exporting CSV:",t),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯")}else ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ù„ØªØµØ¯ÙŠØ±")},disabled:n,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:async()=>{try{const e=m.filteredData.length>0?m.filteredData:i;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ù„ØªØµØ¯ÙŠØ±");const t={totalAppointments:h.total,completedAppointments:h.completed,cancelledAppointments:h.cancelled,noShowAppointments:h.noShow,attendanceRate:parseFloat(h.attendanceRate),cancellationRate:parseFloat(h.cancellationRate),appointmentsByStatus:N.map(e=>({status:e.name,count:e.value,percentage:h.total>0?e.value/h.total*100:0})),peakHours:[],monthlyTrend:w,filterInfo:m.timeFilter.startDate&&m.timeFilter.endDate?`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ${m.timeFilter.startDate} Ø¥Ù„Ù‰ ${m.timeFilter.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",dataCount:e.length};await Le.exportAppointmentReport(t,d),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙƒÙ…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­ (${e.length} Ù…ÙˆØ¹Ø¯)`)}catch(e){console.error("Error exporting PDF:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ…Ù„Ù PDF")}},disabled:n,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± PDF"]})]})]}),e.jsx(xt,{value:m.timeFilter,onChange:m.handleFilterChange,onClear:m.resetFilter,title:"ÙÙ„ØªØ±Ø© Ø²Ù…Ù†ÙŠØ© - Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",dir:"rtl",children:[e.jsxs(p,{className:Se("purple"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"}),e.jsx(Z,{className:`h-4 w-4 ${Ee("purple")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:i.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©"})]})]}),e.jsxs(p,{className:Se("blue"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===m.timeFilter.preset||!m.timeFilter.startDate&&!m.timeFilter.endDate?"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©":"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx(Be,{className:`h-4 w-4 ${Ee("blue")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:"all"===m.timeFilter.preset||!m.timeFilter.startDate&&!m.timeFilter.endDate?i.length:m.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===m.timeFilter.preset||!m.timeFilter.startDate&&!m.timeFilter.endDate?"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯":"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"}),m.trend&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(m.trend.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(m.trend.changePercent),"%"]}),m.trend.isPositive?e.jsx(lt,{className:"h-3 w-3"}):e.jsx(it,{className:"h-3 w-3"})]})]})]}),e.jsxs(p,{className:Se("emerald"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©"}),e.jsx(O,{className:`h-4 w-4 ${Ee("emerald")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.completed}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±: ",h.attendanceRate,"%"]})]})]}),e.jsxs(p,{className:Se("orange"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©"}),e.jsx(dt,{className:`h-4 w-4 ${Ee("orange")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.cancelled}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡: ",h.cancellationRate,"%"]})]})]}),e.jsxs(p,{className:Se("cyan"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©"}),e.jsx(Q,{className:`h-4 w-4 ${Ee("cyan")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.pending}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ°"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (",h.total," Ù…ÙˆØ¹Ø¯ Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsxs(b,{children:[0===N.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:v.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:N,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:o?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:N.map((t,s)=>e.jsx(He,{fill:t.color},`appointment-status-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…ÙˆØ¹Ø¯`,"Ø§Ù„Ø¹Ø¯Ø¯"],labelFormatter:e=>`Ø§Ù„Ø­Ø§Ù„Ø©: ${e}`,contentStyle:v.tooltip})]})}),N.length>0&&e.jsxs("div",{className:"mt-6 flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"text-sm font-medium text-foreground mb-2",children:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-md",children:N.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:t.color}}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-foreground",children:t.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.value," Ù…ÙˆØ¹Ø¯ (",t.percentage,"%)"]})]})]},`status-legend-${s}`))})]})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©"})]}),e.jsxs(y,{children:["Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± (",w.length," Ø´Ù‡Ø±)"]})]}),e.jsxs(b,{children:[0===w.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø´Ù‡Ø±ÙŠØ© Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:v.responsive.desktop.height,children:e.jsxs(Ue,{data:w,margin:{top:20,right:30,left:20,bottom:70},barCategoryGap:v.bar.barCategoryGap,children:[e.jsx(Xe,{strokeDasharray:v.grid.strokeDasharray,stroke:v.grid.stroke,strokeOpacity:v.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"month",tick:{fontSize:12,fill:o?"#9ca3af":"#6b7280"},axisLine:{stroke:o?"#4b5563":"#d1d5db"},tickLine:{stroke:o?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:100,dy:15}),e.jsx(Je,{tick:{fontSize:14,fill:o?"#9ca3af":"#6b7280"},axisLine:{stroke:o?"#4b5563":"#d1d5db"},tickLine:{stroke:o?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} Ù…ÙˆØ¹Ø¯`}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…ÙˆØ¹Ø¯`,"Ø§Ù„Ø¹Ø¯Ø¯"],labelFormatter:e=>`Ø§Ù„Ø´Ù‡Ø±: ${e}`,contentStyle:v.tooltip}),e.jsx(Qe,{dataKey:"count",fill:u[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),w.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ø¹Ù„Ù‰ Ø´Ù‡Ø±"}),e.jsxs("div",{className:"font-semibold",children:[Math.max(...w.map(e=>e.count))," Ù…ÙˆØ¹Ø¯"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ù…ØªÙˆØ³Ø· Ø´Ù‡Ø±ÙŠ"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(w.reduce((e,t)=>e+t.count,0)/w.length)," Ù…ÙˆØ¹Ø¯"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ù‚Ù„ Ø´Ù‡Ø±"}),e.jsxs("div",{className:"font-semibold",children:[Math.min(...w.map(e=>e.count))," Ù…ÙˆØ¹Ø¯"]})]})]})]})]})]})]})}function Bt(e){const t=[],s=[];if(null==e)return t.push("Amount is null or undefined"),{isValid:!1,errors:t,warnings:s,sanitizedValue:0};const a=Number(e);if(isNaN(a))return t.push(`Invalid amount: ${e} cannot be converted to number`),{isValid:!1,errors:t,warnings:s,sanitizedValue:0};if(!isFinite(a))return t.push(`Amount is not finite: ${a}`),{isValid:!1,errors:t,warnings:s,sanitizedValue:0};a<0&&s.push(`Negative amount detected: ${a}`),a>1e6&&s.push(`Very large amount detected: ${a}`);return{isValid:!0,errors:t,warnings:s,sanitizedValue:Math.round(100*a)/100}}function Vt(e){if(!Array.isArray(e))return console.error("Payments is not an array:",e),{validPayments:[],invalidPayments:[],totalErrors:1,totalWarnings:0};const t=[],s=[];let a=0,n=0;return e.forEach((e,r)=>{const l=function(e){const t=[],s=[];if(!e)return t.push("Payment object is null or undefined"),{isValid:!1,errors:t,warnings:s};if(e.id||t.push("Payment ID is missing"),e.patient_id||t.push("Patient ID is missing"),e.payment_date){const s=new Date(e.payment_date);isNaN(s.getTime())&&t.push(`Invalid payment date: ${e.payment_date}`)}else t.push("Payment date is missing");e.payment_method||s.push("Payment method is missing"),e.status||s.push("Payment status is missing");const a=Bt(e.amount);return a.isValid||t.push(...a.errors),s.push(...a.warnings),{isValid:0===t.length,errors:t,warnings:s}}(e);if(a+=l.errors.length,n+=l.warnings.length,l.isValid){const s=Bt(e.amount);t.push({...e,amount:s.sanitizedValue||0})}else console.warn(`Invalid payment at index ${r}:`,l.errors),s.push({payment:e,errors:l.errors,warnings:l.warnings})}),{validPayments:t,invalidPayments:s,totalErrors:a,totalWarnings:n}}function qt(e){return Bt(e).sanitizedValue||0}function Yt(e){const t={},s=[];return e&&"object"==typeof e?(Object.entries(e).forEach(([e,a])=>{if(!e.match(/^\d{4}-\d{2}$/))return void s.push(`Invalid month format: ${e}`);const n=Bt(a);n.isValid?t[e]=n.sanitizedValue||0:s.push(`Invalid amount for month ${e}: ${a}`)}),{validData:t,errors:s}):(s.push("Monthly data is not a valid object"),{validData:t,errors:s})}function Kt(e){const t={},s=[];if(!e||"object"!=typeof e)return s.push("Payment method stats is not a valid object"),{validStats:t,errors:s};const a=["cash","card","bank_transfer","check","insurance"];return Object.entries(e).forEach(([e,n])=>{a.includes(e)||"unknown"===e||console.warn(`Unknown payment method: ${e}`);const r=Bt(n);r.isValid?t[e]=r.sanitizedValue||0:s.push(`Invalid amount for payment method ${e}: ${n}`)}),{validStats:t,errors:s}}class Wt{static validateAmount(e){if(null==e)return{isValid:!0,value:0};const t=Number(e);return isNaN(t)?{isValid:!1,value:0,error:`Invalid amount: ${e}`}:isFinite(t)?t<0?{isValid:!1,value:0,error:`Amount cannot be negative: ${e}`}:{isValid:!0,value:Math.round(100*t)/100}:{isValid:!1,value:0,error:`Amount is not finite: ${e}`}}static validatePayments(e){const t=[],s=[];let a=0,n=0,r=0,l=0,i=0;if(!Array.isArray(e))return t.push("Payments data is not an array"),{isValid:!1,errors:t,warnings:s,calculations:{totalRevenue:0,completedAmount:0,partialAmount:0,pendingAmount:0,overdueAmount:0}};e.forEach((e,c)=>{if(!e||"object"!=typeof e)return void t.push(`Payment at index ${c} is invalid`);const d=this.validateAmount(e.amount);if(!d.isValid)return void t.push(`Payment ${e.id||c}: ${d.error}`);const o=d.value;switch(e.status){case"completed":n+=o,a+=o;break;case"partial":const t=this.validateAmount(e.amount_paid||e.amount);t.isValid&&(r+=t.value,a+=t.value);break;case"pending":l+=o;break;case"overdue":i+=o;break;default:s.push(`Payment ${e.id||c}: Unknown status '${e.status}'`)}});const c=n+r;return Math.abs(a-c)>.01&&s.push(`Revenue calculation mismatch: ${a} vs ${c}`),{isValid:0===t.length,errors:t,warnings:s,calculations:{totalRevenue:Math.round(100*a)/100,completedAmount:Math.round(100*n)/100,partialAmount:Math.round(100*r)/100,pendingAmount:Math.round(100*l)/100,overdueAmount:Math.round(100*i)/100}}}static validateExpenses(e){const t=[],s=[];let a=0,n=0,r=0;const l={};return Array.isArray(e)?(e.forEach((e,s)=>{if(!e||"object"!=typeof e)return void t.push(`Expense at index ${s} is invalid`);const i=this.validateAmount(e.amount);if(!i.isValid)return void t.push(`Expense ${e.id||s}: ${i.error}`);const c=i.value;"paid"===e.status?(n+=c,a+=c):"pending"===e.status&&(r+=c);const d=e.expense_type||"other";l[d]=(l[d]||0)+c}),{isValid:0===t.length,errors:t,warnings:s,calculations:{totalExpenses:Math.round(100*a)/100,paidExpenses:Math.round(100*n)/100,pendingExpenses:Math.round(100*r)/100,expensesByType:l}}):(t.push("Expenses data is not an array"),{isValid:!1,errors:t,warnings:s,calculations:{totalExpenses:0,paidExpenses:0,pendingExpenses:0,expensesByType:{}}})}static validateInventory(e){const t=[],s=[];let a=0,n=0,r=0;if(!Array.isArray(e))return t.push("Inventory data is not an array"),{isValid:!1,errors:t,warnings:s,calculations:{totalValue:0,totalItems:0,lowStockItems:0,expiredItems:0}};const l=new Date;return e.forEach((e,i)=>{if(!e||"object"!=typeof e)return void t.push(`Inventory item at index ${i} is invalid`);const c=this.validateAmount(e.quantity),d=this.validateAmount(e.cost_per_unit||0);if(!c.isValid)return void t.push(`Item ${e.id||i}: Invalid quantity`);d.isValid||s.push(`Item ${e.id||i}: Invalid price`);const o=c.value,m=d.value;if(a+=o*m,o<=(e.minimum_stock||0)&&o>0&&n++,e.expiry_date){new Date(e.expiry_date)<l&&r++}}),{isValid:0===t.length,errors:t,warnings:s,calculations:{totalValue:Math.round(100*a)/100,totalItems:e.length,lowStockItems:n,expiredItems:r}}}static validateAllFinancialData(e){const t=[],s=[],a=this.validatePayments(e.payments);t.push(...a.errors),s.push(...a.warnings);let n={calculations:{totalExpenses:0}};e.expenses&&(n=this.validateExpenses(e.expenses),t.push(...n.errors),s.push(...n.warnings));let r={calculations:{totalValue:0}};e.inventory&&(r=this.validateInventory(e.inventory),t.push(...r.errors),s.push(...r.warnings)),e.labOrders&&e.labOrders.forEach((e,a)=>{const n=this.validateAmount(e.paid_amount||0),r=this.validateAmount(e.cost||0);n.isValid||t.push(`Lab order ${a+1}: Invalid paid amount - ${n.error}`),r.isValid||t.push(`Lab order ${a+1}: Invalid cost - ${r.error}`),n.value>r.value&&s.push(`Lab order ${a+1}: Paid amount (${n.value}) exceeds cost (${r.value})`)}),e.clinicNeeds&&e.clinicNeeds.forEach((e,a)=>{const n=this.validateAmount(e.quantity||0),r=this.validateAmount(e.price||0);n.isValid||t.push(`Clinic need ${a+1}: Invalid quantity - ${n.error}`),r.isValid||t.push(`Clinic need ${a+1}: Invalid price - ${r.error}`),n.value<=0&&s.push(`Clinic need ${a+1}: Zero or negative quantity`)});let l=n.calculations.totalExpenses;if(e.inventory){l+=e.inventory.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0).value*this.validateAmount(t.quantity||0).value,0)}if(e.labOrders){l+=e.labOrders.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0).value,0)}if(e.clinicNeeds){l+=e.clinicNeeds.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity||0).value*this.validateAmount(t.price||0).value,0)}const i=a.calculations.totalRevenue,c=i-l,d=i>0?c/i*100:0;return i<0&&t.push("Total revenue cannot be negative"),l<0&&t.push("Total expenses cannot be negative"),{isValid:0===t.length,errors:t,warnings:s,calculations:{totalRevenue:Math.round(100*i)/100,totalExpenses:Math.round(100*l)/100,netProfit:Math.round(100*c)/100,profitMargin:Math.round(100*d)/100}}}}function Ht(){const{payments:s}=ee(),{expenses:a}=De(),{inventoryItems:n}=X(),{labOrders:r}=Ce(),{clinicNeeds:l}=ke(),{currentCurrency:i}=te(),[c,d]=t.useState(null),[o,h]=t.useState(!1),u=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},f=async()=>{h(!0);try{const e=Wt.validateAllFinancialData({payments:s,expenses:a,inventory:n,labOrders:r,clinicNeeds:l}),t=Tt.calculateFinancialStats(s,r,l,n,a),i=u(a.filter(e=>"paid"===e.status).reduce((e,t)=>e+u(t.amount),0)),c=Array.isArray(n)?n:[],o=u(c.reduce((e,t)=>e+u(t.cost_per_unit||0)*u(t.quantity||0),0)),m=Array.isArray(l)?l:[],x=u(m.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+u(t.quantity)*u(t.price),0)),h=Array.isArray(r)?r:[],p=i+o+x+u(h.reduce((e,t)=>e+u(t.paid_amount||0),0)),g=u(s.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+u(t.amount),0)),f=g-p,j=g>0?f/g*100:0,y={revenueMatch:Math.abs(g-t.totalRevenue)<.01,expensesMatch:Math.abs(p-t.totalExpenses)<.01,profitMatch:Math.abs(f-(t.netProfit||t.lossAmount))<.01},v=e.isValid&&y.revenueMatch&&y.expensesMatch&&y.profitMatch;d({isAccurate:v,totalRevenue:g,totalExpenses:p,netProfit:f,profitMargin:j,dataIntegrity:{paymentsValid:s.length>0,expensesValid:a.length>=0,inventoryValid:n.length>=0,labOrdersValid:r.length>=0,clinicNeedsValid:l.length>=0},errors:e.errors,warnings:e.warnings,lastVerified:new Date})}catch(e){console.error("Error during financial verification:",e),d({isAccurate:!1,totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0,dataIntegrity:{paymentsValid:!1,expensesValid:!1,inventoryValid:!1,labOrdersValid:!1,clinicNeedsValid:!1},errors:[`Verification failed: ${e}`],warnings:[],lastVerified:new Date})}finally{h(!1)}};t.useEffect(()=>{f()},[s,a,n,r,l]);const v=t=>t?e.jsx(O,{className:"h-4 w-4 text-green-500"}):e.jsx(dt,{className:"h-4 w-4 text-red-500"});return e.jsxs(p,{className:"w-full",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5"}),"Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ù‚Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ"]}),e.jsx(y,{children:"ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© 100% ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©"})]}),e.jsxs(F,{onClick:f,disabled:o,size:"sm",children:[o?e.jsx(x,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(x,{className:"h-4 w-4 mr-2"}),"ÙØ­Øµ Ø§Ù„Ø¢Ù†"]})]})}),e.jsx(b,{className:"space-y-6",children:c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(c.isAccurate),e.jsxs("span",{className:"font-medium",children:["Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ: ",(N=c.isAccurate,e.jsx(m,{variant:N?"default":"destructive",children:N?"ØµØ­ÙŠØ­":"Ø®Ø·Ø£"}))]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Ø¢Ø®Ø± ÙØ­Øµ: ",c.lastVerified.toLocaleString("ar-SA")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:e.jsx(Pe,{amount:c.totalRevenue,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:e.jsx(Pe,{amount:c.totalExpenses,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­"}),e.jsx("div",{className:"text-2xl font-bold "+(c.netProfit>=0?"text-green-600":"text-red-600"),children:e.jsx(Pe,{amount:c.netProfit,currency:i})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: ",c.profitMargin.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[v(c.dataIntegrity.paymentsValid),e.jsx("span",{className:"text-sm",children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[v(c.dataIntegrity.expensesValid),e.jsx("span",{className:"text-sm",children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[v(c.dataIntegrity.inventoryValid),e.jsx("span",{className:"text-sm",children:"Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[v(c.dataIntegrity.labOrdersValid),e.jsx("span",{className:"text-sm",children:"Ø§Ù„Ù…Ø®ØªØ¨Ø±"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[v(c.dataIntegrity.clinicNeedsValid),e.jsx("span",{className:"text-sm",children:"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª"})]})]})]}),c.errors.length>0&&e.jsxs(M,{variant:"destructive",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-medium mb-2",children:"Ø£Ø®Ø·Ø§Ø¡ Ù…ÙƒØªØ´ÙØ©:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.errors.map((t,s)=>e.jsx("li",{className:"text-sm",children:t},s))})]})]}),c.warnings.length>0&&e.jsxs(M,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-medium mb-2",children:"ØªØ­Ø°ÙŠØ±Ø§Øª:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.warnings.map((t,s)=>e.jsx("li",{className:"text-sm",children:t},s))})]})]})]})})]});var N}const Gt=t.forwardRef(({className:t,value:s=0,max:a=100,...n},r)=>{const l=Math.min(Math.max(s/a*100,0),100);return e.jsx("div",{ref:r,className:se("relative h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",t),...n,children:e.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300 ease-in-out rounded-full",style:{width:`${l}%`}})})});function Ut(){const{payments:s}=ee(),{expenses:a}=De(),{inventoryItems:n}=X(),{labOrders:r}=Ce(),{clinicNeeds:l}=ke(),{currentCurrency:i}=te(),[c,d]=t.useState(null),[o,h]=t.useState(!1),u=async()=>{h(!0);try{const e=Date.now(),t=[],i=[],c=[];let o=100;const m=Array.isArray(s)?s:[],x=Array.isArray(a)?a:[],h=Array.isArray(n)?n:[],u=Array.isArray(r)?r:[],p=Array.isArray(l)?l:[];0===m.length&&(i.push("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…"),o-=20),0===x.length&&(i.push("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø³Ø¬Ù„Ø©"),o-=10);const g=Wt.validateAllFinancialData({payments:m,expenses:x,inventory:h,labOrders:u,clinicNeeds:p});let f=g.isValid?100:70;g.isValid||(t.push(...g.errors),f-=10*g.errors.length),g.warnings.length>0&&(i.push(...g.warnings),f-=5*g.warnings.length);const j=Tt.calculateFinancialStats(s,r,l,n,a),y=j.totalRevenue,v=j.totalExpenses,N=j.isProfit?j.netProfit:-j.lossAmount,b=j.profitMargin,w=Date.now()-e;let $=100;w>1e3&&($-=20,i.push("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ³ØªØºØ±Ù‚ ÙˆÙ‚ØªØ§Ù‹ Ø£Ø·ÙˆÙ„ Ù…Ù† Ø§Ù„Ù…ØªÙˆÙ‚Ø¹"));let F=100;const _=new Date(Date.now()-36e5),D=s.filter(e=>new Date(e.payment_date)>_);s.length>0&&0===D.length&&(F-=10,i.push("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø­Ø¯ÙŠØ«Ø© ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©")),v>y&&c.push("Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - ÙŠÙÙ†ØµØ­ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©"),b<10&&c.push("Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ù…Ù†Ø®ÙØ¶ - ÙŠÙÙ†ØµØ­ Ø¨ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©"),0===n.length&&c.push("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");const k=Math.round((o+f+F+$)/4),A={overallHealth:Math.max(0,Math.min(100,k)),dataIntegrity:Math.max(0,Math.min(100,o)),calculationAccuracy:Math.max(0,Math.min(100,f)),realTimeSync:Math.max(0,Math.min(100,F)),performanceScore:Math.max(0,Math.min(100,$))};d({isHealthy:k>=80&&0===t.length,lastUpdated:new Date,metrics:A,issues:t,warnings:i,recommendations:c,financialSummary:{totalRevenue:y,totalExpenses:v,netProfit:N,profitMargin:b},dataStats:{paymentsCount:s.length,expensesCount:a.length,inventoryCount:n.length,labOrdersCount:r.length,clinicNeedsCount:l.length}})}catch(e){console.error("Error analyzing system health:",e),d({isHealthy:!1,lastUpdated:new Date,metrics:{overallHealth:0,dataIntegrity:0,calculationAccuracy:0,realTimeSync:0,performanceScore:0},issues:[`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…: ${e}`],warnings:[],recommendations:["ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"],financialSummary:{totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0},dataStats:{paymentsCount:0,expensesCount:0,inventoryCount:0,labOrdersCount:0,clinicNeedsCount:0}})}finally{h(!1)}};t.useEffect(()=>{u()},[s,a,n,r,l]);const f=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600";return e.jsxs(p,{className:"w-full",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ"]}),e.jsx(y,{children:"Ù…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù„ØµØ­Ø© ÙˆØ£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&(v=c.isHealthy,e.jsx(m,{variant:v?"default":"destructive",children:v?"ØµØ­ÙŠ":"ÙŠØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡"})),e.jsxs(F,{onClick:u,disabled:o,size:"sm",variant:"outline",children:[o?e.jsx(x,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(x,{className:"h-4 w-4 mr-2"}),"ØªØ­Ø¯ÙŠØ«"]})]})]})}),e.jsx(b,{className:"space-y-6",children:c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center p-6 border rounded-lg",children:[e.jsxs("div",{className:`text-4xl font-bold ${f(c.metrics.overallHealth)}`,children:[c.metrics.overallHealth,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø¸Ø§Ù…"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ",c.lastUpdated.toLocaleString("ar-SA")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"}),e.jsxs("span",{className:f(c.metrics.dataIntegrity),children:[c.metrics.dataIntegrity,"%"]})]}),e.jsx(Gt,{value:c.metrics.dataIntegrity,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ø¯Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª"}),e.jsxs("span",{className:f(c.metrics.calculationAccuracy),children:[c.metrics.calculationAccuracy,"%"]})]}),e.jsx(Gt,{value:c.metrics.calculationAccuracy,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ"}),e.jsxs("span",{className:f(c.metrics.realTimeSync),children:[c.metrics.realTimeSync,"%"]})]}),e.jsx(Gt,{value:c.metrics.realTimeSync,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ø§Ù„Ø£Ø¯Ø§Ø¡"}),e.jsxs("span",{className:f(c.metrics.performanceScore),children:[c.metrics.performanceScore,"%"]})]}),e.jsx(Gt,{value:c.metrics.performanceScore,className:"h-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:e.jsx(Pe,{amount:c.financialSummary.totalRevenue,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_t,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsx("div",{className:"text-xl font-bold text-red-600",children:e.jsx(Pe,{amount:c.financialSummary.totalExpenses,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.financialSummary.netProfit>=0?e.jsx(pt,{className:"h-4 w-4 text-green-600"}):e.jsx(_t,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­"})]}),e.jsx("div",{className:"text-xl font-bold "+(c.financialSummary.netProfit>=0?"text-green-600":"text-red-600"),children:e.jsx(Pe,{amount:c.financialSummary.netProfit,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.financialSummary.profitMargin>=0?e.jsx(lt,{className:"h-4 w-4 text-green-600"}):e.jsx(it,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­"})]}),e.jsxs("div",{className:"text-xl font-bold "+(c.financialSummary.profitMargin>=0?"text-green-600":"text-red-600"),children:[c.financialSummary.profitMargin.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.dataStats.paymentsCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ù…Ø¯ÙÙˆØ¹Ø§Øª"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.dataStats.expensesCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.dataStats.inventoryCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ù…Ø®Ø²ÙˆÙ†"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.dataStats.labOrdersCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ù…Ø®ØªØ¨Ø±"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.dataStats.clinicNeedsCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª"})]})]}),c.issues.length>0&&e.jsxs(M,{variant:"destructive",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-medium mb-2",children:"Ù…Ø´Ø§ÙƒÙ„ ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.issues.map((t,s)=>e.jsx("li",{className:"text-sm",children:t},s))})]})]}),c.warnings.length>0&&e.jsxs(M,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-medium mb-2",children:"ØªØ­Ø°ÙŠØ±Ø§Øª:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.warnings.map((t,s)=>e.jsx("li",{className:"text-sm",children:t},s))})]})]}),c.recommendations.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/50 border border-blue-200 dark:border-blue-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gt,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:"ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ø³ÙŠÙ†:"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-700 dark:text-blue-300",children:c.recommendations.map((t,s)=>e.jsx("li",{children:t},s))})]})]})})]});var v}Gt.displayName="Progress";const Xt=t.memo(function(){const{financialReports:s,isLoading:a,isExporting:l,generateReport:i,clearCache:c}=fe(),{payments:d,totalRevenue:o,pendingAmount:m,overdueAmount:h,paymentMethodStats:u,monthlyRevenue:f,loadPayments:v}=ee(),{expenses:N,analytics:w,loadExpenses:$}=De(),{inventoryItems:_,loadItems:D}=X(),{labOrders:k,loadLabOrders:A}=Ce(),{clinicNeeds:C,loadNeeds:S}=ke(),{currentCurrency:E,formatAmount:P}=te(),{settings:M}=V(),{isDarkMode:T}=q(),R=mt({data:d,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),O=mt({data:N,dateField:"payment_date",initialFilter:R.timeFilter});je("financial"),t.useEffect(()=>{i("financial"),v(),$(),D(),A(),S()},[i,v,$,D,A,S]),t.useEffect(()=>{const e=Array.isArray(d)?d:[],t=Array.isArray(N)?N:[],s=Array.isArray(_)?_:[];if(e.length>0||t.length>0||s.length>0)try{(function(e){const t=Wt.validateAllFinancialData(e);return t.isValid?(t.warnings.length>0&&console.warn("âš ï¸ Financial validation warnings:",t.warnings),console.log("âœ… Financial validation passed with 100% accuracy"),!0):(console.error("âŒ Financial validation failed:",t.errors),!1)})({payments:e,expenses:t,inventory:s})||console.warn("âš ï¸ Financial data validation issues detected. Please check the data integrity.")}catch(a){console.error("Error validating financial data:",a)}},[d,N,_]),t.useEffect(()=>{const e=Array.isArray(d)?d:[];if(e.length>0)try{const t=Vt(e);t.totalErrors>0&&console.warn(`Found ${t.totalErrors} errors in ${t.invalidPayments.length} payments`),t.totalWarnings>0&&console.warn(`Found ${t.totalWarnings} warnings in payment data`)}catch(t){console.error("Error validating payments:",t)}},[d]);const I=(()=>{const e=R||{filteredData:[],timeFilter:{preset:"all"}},t=Array.isArray(d)?d:[],a=Vt(Array.isArray(e.filteredData)&&e.filteredData.length>0?e.filteredData:t).validPayments;if(s&&"all"===e.timeFilter.preset&&(!e.timeFilter.startDate||!e.timeFilter.endDate))return{totalRevenue:qt(s.totalRevenue),totalPaid:qt(s.totalPaid),totalPending:qt(s.totalPending),totalOverdue:qt(s.totalOverdue),revenueByPaymentMethod:s.revenueByPaymentMethod||{},revenueTrend:s.revenueTrend||[],recentTransactions:s.recentTransactions||[],outstandingPayments:s.outstandingPayments||[]};const n=a.filter(e=>"completed"===e.status),r=a.filter(e=>"pending"===e.status),l=a.filter(e=>"failed"===e.status),i=a.filter(e=>"refunded"===e.status),c=n.reduce((e,t)=>e+(t.amount||0),0),o=r.reduce((e,t)=>e+(t.amount||0),0),m=a.filter(e=>"overdue"===e.status).reduce((e,t)=>e+(t.amount||0),0);Yt(f||{});const x=Kt(u||{}),h=a.length,p=h>0?Math.round(n.length/h*1e3)/10:0,g=n.length>0&&c>0?Math.round(c/n.length*100)/100:0;return{totalRevenue:qt(c),totalPaid:qt(c),totalPending:qt(o),totalOverdue:qt(m),revenueByPaymentMethod:x.validStats,revenueTrend:[],recentTransactions:[],outstandingPayments:[],totalTransactions:h,completedCount:n.length,pendingCount:r.length,failedCount:l.length,refundedCount:i.length,successRate:isNaN(p)?"0.0":p.toFixed(1),averageTransaction:isNaN(g)?"0.00":g.toFixed(2),validatedPayments:a}})();I.totalTransactions||(d||[]).length,I.completedCount||(d||[]).filter(e=>"completed"===e.status).length,I.pendingCount||(d||[]).filter(e=>"pending"===e.status).length,I.failedCount||(d||[]).filter(e=>"failed"===e.status).length,I.refundedCount||(d||[]).filter(e=>"refunded"===e.status).length,I.successRate,I.averageTransaction;const L=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},z=O||{filteredData:[]},B=Array.isArray(N)?N:[],Y=Array.isArray(z.filteredData)&&z.filteredData.length>0?z.filteredData:B,K=Wt.validateExpenses(Y),U=K.calculations.totalExpenses,Z=L((_||[]).reduce((e,t)=>e+L(t.cost_per_unit||0)*L(t.quantity||0),0)),J=L((C||[]).filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+L(t.quantity)*L(t.price),0)),se=L((k||[]).reduce((e,t)=>e+L(t.paid_amount||0),0)),ae=U+Z+J+se;!K.isValid&&Y.length;const ie=Wt.validateAmount(I.totalRevenue-ae).value,ce=I.totalRevenue>0?ie/I.totalRevenue*100:0,de=Wt.validateAllFinancialData({payments:d||[],expenses:Y||[],inventory:_||[],labOrders:k||[],clinicNeeds:C||[]});de.isValid,de.warnings.length;const oe=Tt.calculateFinancialStats(d,k,C,_,Y);Math.abs(I.totalRevenue-oe.totalRevenue),Math.abs(ae-oe.totalExpenses),Math.abs(ie-oe.netProfit),t.useEffect(()=>{const e=R||{timeFilter:{preset:"all"}},t=O||{timeFilter:{preset:"all"},handleFilterChange:()=>{}};e.timeFilter!==t.timeFilter&&t.handleFilterChange&&t.handleFilterChange(e.timeFilter)},[R?.timeFilter,O?.timeFilter]),t.useEffect(()=>{const e=e=>{v(),$(),D(),A(),S()},t=["payments-changed","clinic-expenses-changed","inventory-changed","lab-orders-changed","clinic-needs-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[v,$,D,A,S]);const me=(()=>{const e={salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"},t={};return Y.filter(e=>"paid"===e.status).forEach(e=>{const s=e.expense_type||"other",a=L(e.amount);t[s]=(t[s]||0)+a}),Object.entries(t).map(([t,s])=>({name:e[t]||t,value:s,percentage:ae>0?s/ae*100:0}))})();W("categorical",T);const xe=W("primary",T),he=H("financial",T,8),ue=H("status",T,8),pe=G(T),ge=(()=>{try{const e={cash:"Ù†Ù‚Ø¯Ø§Ù‹",card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",check:"Ø´ÙŠÙƒ",insurance:"ØªØ£Ù…ÙŠÙ†"},t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},s=d||[],a=R?.filteredData?.length>0?R.filteredData:s;if(0===a.length)return[];const n={};a.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const s=e.payment_method||"cash",a=t(e.amount);console.log(`Payment method calculation - Payment ${e.id}: Method=${s}, Amount=${a}, Status=${e.status}`),a>0&&(n[s]=(n[s]||0)+a)}),console.log("Payment method calculated stats:",n);const l=Object.entries(n).filter(([e,t])=>t>0).map(([s,n])=>({method:e[s]||s,amount:t(n),formattedAmount:r(n,E),count:a.filter(e=>e.payment_method===s&&("completed"===e.status||"partial"===e.status)).length})).sort((e,t)=>t.amount-e.amount);return console.log("Payment method final data:",l),console.log("Payment method total:",l.reduce((e,t)=>e+t.amount,0)),$e(l)}catch(e){return console.error("Financial Reports: Error processing payment method data:",e),[]}})(),ye=(()=>{try{const e=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},t=d||[],s=R?.filteredData?.length>0?R.filteredData:t;if(0===s.length)return[];console.log("Processing monthly revenue for",s.length,"payments"),console.log("Sample payments:",s.slice(0,3)),console.log("All payment amounts:",s.map(e=>({id:e.id,amount:e.amount,status:e.status,date:e.payment_date})));const a={};s.filter(e=>"completed"===e.status||"partial"===e.status).forEach(t=>{try{const s=new Date(t.payment_date||t.created_at||t.date);if(isNaN(s.getTime()))return void console.warn("Invalid payment date for payment:",t.id,t.payment_date);const n=s.toISOString().slice(0,7),r=e(t.amount);console.log(`Payment ${t.id}: Date=${t.payment_date}, Month=${n}, Amount=${r}, Status=${t.status}`),r>0&&(a[n]=(a[n]||0)+r,console.log(`Added ${r} to month ${n}, total now: ${a[n]}`))}catch(s){console.warn("Error processing payment date:",t.payment_date,s)}}),console.log("Calculated monthly revenue:",a);const n=Object.entries(a);if(1===n.length){const[e,t]=n[0],s=new Date(e+"-01"),r=new Date(s);r.setMonth(r.getMonth()-1);const l=r.toISOString().slice(0,7);a[l]=0;const i=new Date(s);i.setMonth(i.getMonth()+1);const c=i.toISOString().slice(0,7);a[c]=0}const l=Object.entries(a).filter(([e,t])=>e.match(/^\d{4}-\d{2}$/)).map(([t,s])=>{const a=new Date(t+"-01");return{month:`${["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"][a.getMonth()]} ${a.getFullYear()}`,revenue:e(s),formattedRevenue:r(e(s),E),originalMonth:t}}).sort((e,t)=>e.originalMonth.localeCompare(t.originalMonth)).map(({originalMonth:e,...t})=>t);return console.log("Final monthly revenue data:",l),l}catch(e){return console.error("Financial Reports: Error processing monthly revenue data:",e),[]}})(),ve=(()=>{try{const e=d||[],t=R?.filteredData?.length>0?R.filteredData:e;if(0===t.length)return[];const s=t.filter(e=>"completed"===e.status).length,a=t.filter(e=>"partial"===e.status).length,n=t.filter(e=>"pending"===e.status).length,r=t.filter(e=>"failed"===e.status).length,l=t.filter(e=>"refunded"===e.status).length,i=t.length,c=[{name:"Ù…ÙƒØªÙ…Ù„",value:s,color:ue[0]||"#10b981"},{name:"Ø¬Ø²Ø¦ÙŠ",value:a,color:ue[1]||"#f59e0b"},{name:"Ø¢Ø¬Ù„",value:n,color:ue[2]||"#6b7280"},{name:"ÙØ§Ø´Ù„",value:r,color:ue[3]||"#ef4444"},{name:"Ù…Ø³ØªØ±Ø¯",value:l,color:ue[4]||"#8b5cf6"}].filter(e=>e.value>0).map(e=>({...e,percentage:i>0?Math.round(e.value/i*100):0}));return Fe(c)}catch(e){return console.error("Financial Reports: Error processing status data:",e),[]}})();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ"})]}),R.filteredData.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["â€¢ ",R.filteredData.length," Ù…Ø¹Ø§Ù…Ù„Ø©",R.timeFilter.startDate&&R.timeFilter.endDate&&" (Ù…ÙÙ„ØªØ±Ø©)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{c(),await i("financial"),await v();const e=new CustomEvent("showToast",{detail:{title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing financial reports:",e);const t=new CustomEvent("showToast",{detail:{title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",type:"error"}});window.dispatchEvent(t)}},disabled:a,children:[e.jsx(x,{className:"w-4 h-4 ml-2 "+(a?"animate-spin":"")}),"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{const e=R.filteredData.length>0?R.filteredData:d;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø§Ù„ÙŠØ© Ù„Ù„ØªØµØ¯ÙŠØ±");const t=await async function(e,t,s){const a=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},l=Tt.calculateFinancialStats(e,[],[],[],s);let i="\ufeff";i+="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„\n",i+="===================\n\n",i+="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±\n",i+="================\n",i+=`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${n((new Date).toISOString())}\n`,i+=`ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${(new Date).toLocaleTimeString("ar-SA")}\n`,t.startDate&&t.endDate?i+=`Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©,Ù…Ù† ${t.startDate} Ø¥Ù„Ù‰ ${t.endDate}\n`:i+="Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©,Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n",i+=`Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª,${e.length}\n\n`,i+="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n",i+="============================\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª,${r(l.totalRevenue)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${r(l.completedPayments)}\n`,i+=`Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${r(l.partialPayments)}\n`,i+=`Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©,${r(l.remainingBalances)}\n`,i+=`Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¢Ø¬Ù„Ø©,${r(l.pendingAmount)}\n`,i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª,${r(l.totalExpenses||0)}\n`,i+=`ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­,${r(l.netProfit||0)}\n`,i+=`Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­,${(l.profitMargin||0).toFixed(2)}%\n`,i+=`Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø­ÙŠØ©,${(l.netProfit||0)>=0?"Ø±Ø¨Ø­":"Ø®Ø³Ø§Ø±Ø©"}\n\n`,i+="ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±\n",i+="====================\n",i+=`ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­,${r(l.netProfit||0)}\n`,i+=`Ù…Ø¨Ù„Øº Ø§Ù„Ø®Ø³Ø§Ø±Ø©,${r(l.lossAmount||0)}\n`,i+=`Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­,${(l.profitMargin||0).toFixed(2)}%\n`,i+=`Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­,${l.isProfit?"Ø±Ø¨Ø­":"Ø®Ø³Ø§Ø±Ø©"}\n`,i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª,${r(l.totalExpenses||0)}\n\n`,i+="ØªÙØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª\n",i+="================\n",i+=`Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±,${r(l.labOrdersTotal||0)}\n`,i+=`Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…Ø®Ø§Ø¨Ø±,${r(l.labOrdersRemaining||0)}\n`,i+=`Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${r(l.clinicNeedsTotal||0)}\n`,i+=`Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª,${r(l.clinicNeedsRemaining||0)}\n`,i+=`Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,${r(l.inventoryExpenses||0)}\n\n`,i+="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª\n",i+="==================\n",i+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª,${l.totalTransactions}\n`,i+=`Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©,${l.completedTransactions}\n`,i+=`Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©,${JSON.stringify(l.partialTransactions)}\n`,i+=`Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©,${l.pendingTransactions}\n\n`,i+="ØªØ­Ù„ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹\n",i+="================\n";const c={};if(e.forEach(e=>{const t=e.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",s="cash"===t?"Ù†Ù‚Ø¯ÙŠ":"card"===t?"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†":"bank_transfer"===t?"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ":"check"===t?"Ø´ÙŠÙƒ":"insurance"===t?"ØªØ£Ù…ÙŠÙ†":t;let n=0;"completed"===e.status?n=a(e.amount):"partial"===e.status&&void 0!==e.amount_paid&&(n=a(e.amount_paid)),n>0&&(c[s]=(c[s]||0)+n)}),Object.entries(c).forEach(([e,t])=>{const s=l.totalRevenue>0?(t/l.totalRevenue*100).toFixed(2):"0.00";i+=`${e},${r(t)} (${s}%)\n`}),i+="\n",l.expensesByType&&l.expensesByType.length>0&&(i+="ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹\n",i+="==========================\n",i+="Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©\n",l.expensesByType.forEach(e=>{i+=`"${e.type}",${r(e.amount)},${e.percentage.toFixed(2)}%\n`}),i+="\n"),s&&s.length>0){const e=s.filter(e=>"paid"===e.status).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime()).slice(0,20);if(e.length>0){i+="Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Ø¢Ø®Ø± 20 Ù…ØµØ±ÙˆÙ)\n",i+="===================================\n",i+="Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„Ù…Ø¨Ù„Øº,Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ù…ÙˆØ±Ø¯,Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n";const t={salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"},s={cash:"Ù†Ù‚Ø¯Ø§Ù‹",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",check:"Ø´ÙŠÙƒ",credit_card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†"};e.forEach(e=>{const a=(e.expense_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯").replace(/,/g,"Ø›"),l=t[e.expense_type]||e.expense_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",c=r(e.amount||0),d=s[e.payment_method]||e.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o=e.payment_date?n(e.payment_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",m=(e.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯").replace(/,/g,"Ø›"),x=e.receipt_number||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",h=(e.notes||"").replace(/,/g,"Ø›");i+=`"${a}","${l}",${c},"${d}",${o},"${m}","${x}","${h}"\n`}),i+="\n"}}return e.length<=100&&(i+="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©\n",i+="=========================\n",i+="Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„,Ø§Ù„Ù…Ø±ÙŠØ¶,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹,Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ø­Ø§Ù„Ø©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹,Ø§Ù„ÙˆØµÙ,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n",e.forEach(e=>{const t=e.receipt_number||`#${e.id?.slice(-6)||"N/A"}`,s=e.patient?.full_name||e.patient_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",a=r(e.amount||0),l=e.amount_paid?r(e.amount_paid):a,c="cash"===e.payment_method?"Ù†Ù‚Ø¯ÙŠ":"card"===e.payment_method?"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†":"bank_transfer"===e.payment_method?"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ":"check"===e.payment_method?"Ø´ÙŠÙƒ":"insurance"===e.payment_method?"ØªØ£Ù…ÙŠÙ†":e.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",d="completed"===e.status?"Ù…ÙƒØªÙ…Ù„":"partial"===e.status?"Ø¬Ø²Ø¦ÙŠ":"pending"===e.status?"Ø¢Ø¬Ù„":"failed"===e.status?"ÙØ§Ø´Ù„":"refunded"===e.status?"Ù…Ø³ØªØ±Ø¯":e.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o=e.payment_date?n(e.payment_date):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",m=(e.description||"").replace(/,/g,"Ø›"),x=(e.notes||"").replace(/,/g,"Ø›");i+=`"${t}","${s}",${a},${l},"${c}","${d}",${o},"${m}","${x}"\n`})),i}(e,R.timeFilter,Y);await ze.convertCSVToExcel(t,"comprehensive-financial",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! (${e.length} Ù…Ø¹Ø§Ù…Ù„Ø©)`)}catch(e){console.error("Error exporting comprehensive financial CSV:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„")}},disabled:l,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Excel Ø´Ø§Ù…Ù„"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:async()=>{try{const e=R.filteredData.length>0?R.filteredData:d;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø§Ù„ÙŠØ© Ù„Ù„ØªØµØ¯ÙŠØ±");const t=await async function(e,t,s,a,n,r){const l=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},i=Tt.calculateFinancialStats(e,s,a,n,r),c=r?r.filter(e=>"paid"===e.status).reduce((e,t)=>e+l(t.amount),0):0,d=r?(()=>{const e={salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"},t={};return r.filter(e=>"paid"===e.status).forEach(e=>{const s=e.expense_type||"other",a=l(e.amount);t[s]=(t[s]||0)+a}),Object.entries(t).map(([t,s])=>({type:e[t]||t,amount:l(s),percentage:c>0?l(s)/c*100:0}))})():[],o=(i.totalExpenses||0)+c,m=i.totalRevenue-o,x=i.totalRevenue>0?m/i.totalRevenue*100:0,h={};return e.forEach(e=>{const t=e.payment_method||"unknown",s=l(e.amount);s>0&&("completed"===e.status||"partial"===e.status)&&(h[t]=(h[t]||0)+s)}),console.log("Payment method stats calculation:",{paymentsLength:e.length,paymentMethodStats:h}),{totalRevenue:i.totalRevenue,totalPaid:i.completedPayments+i.partialPayments,totalPending:i.pendingAmount,totalOverdue:i.remainingBalances,completedPayments:e.filter(e=>"completed"===e.status).length,partialPayments:e.filter(e=>"partial"===e.status).length,pendingPayments:e.filter(e=>"pending"===e.status).length,failedPayments:e.filter(e=>"failed"===e.status).length,netProfit:m,lossAmount:m<0?Math.abs(m):0,profitMargin:x,isProfit:m>=0,totalExpenses:o,labOrdersTotal:i.labOrdersTotal||0,labOrdersRemaining:i.labOrdersRemaining||0,clinicNeedsTotal:i.clinicNeedsTotal||0,clinicNeedsRemaining:i.clinicNeedsRemaining||0,inventoryExpenses:i.inventoryExpenses||0,clinicExpensesTotal:c,expensesByType:d,revenueByPaymentMethod:Object.entries(h).map(([e,t])=>({method:"cash"===e?"Ù†Ù‚Ø¯ÙŠ":"card"===e?"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†":"bank_transfer"===e?"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ":"check"===e?"Ø´ÙŠÙƒ":"insurance"===e?"ØªØ£Ù…ÙŠÙ†":e,amount:l(t),percentage:i.totalRevenue>0?l(t)/i.totalRevenue*100:0})),filterInfo:t.startDate&&t.endDate?`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ù…Ù† ${t.startDate} Ø¥Ù„Ù‰ ${t.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©",dataCount:e.length,totalTransactions:e.length,successRate:e.length>0?(e.filter(e=>"completed"===e.status||"partial"===e.status).length/e.length*100).toFixed(1):"0.0",averageTransaction:e.length>0?(i.totalRevenue/e.length).toFixed(2):"0.00",payments:e.map(e=>({id:e.id,receipt_number:e.receipt_number||`#${e.id?.slice(-6)||"N/A"}`,patient_name:e.patient?.full_name||e.patient_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",amount:e.amount,amount_paid:e.amount_paid,payment_method:e.payment_method,status:e.status,payment_date:e.payment_date,description:e.description,notes:e.notes})),expenses:r?r.filter(e=>"paid"===e.status).map(e=>({id:e.id,expense_name:e.expense_name,amount:e.amount,expense_type:e.expense_type,category:e.category,payment_method:e.payment_method,payment_date:e.payment_date,description:e.description,vendor:e.vendor,receipt_number:e.receipt_number,notes:e.notes})):[]}}(e,R.timeFilter,k,C,_,Y);await Le.exportComprehensiveFinancialReport(t,M);let s=`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ÙƒÙ…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­! (${e.length} Ù…Ø¹Ø§Ù…Ù„Ø©)`;R.timeFilter.startDate&&R.timeFilter.endDate&&(s+=` - Ù…ÙÙ„ØªØ± Ù…Ù† ${R.timeFilter.startDate} Ø¥Ù„Ù‰ ${R.timeFilter.endDate}`),s+=` - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: $${t.totalRevenue.toFixed(2)}`,ct.exportSuccess(s)}catch(e){console.error("Error exporting comprehensive financial PDF:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ÙƒÙ…Ù„Ù PDF")}},disabled:l,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± PDF Ø´Ø§Ù…Ù„"]})]})]}),e.jsx(xt,{value:R.timeFilter,onChange:R.handleFilterChange,onClear:R.resetFilter,title:"ÙÙ„ØªØ±Ø© Ø²Ù…Ù†ÙŠØ© - Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª",defaultOpen:!1}),e.jsx(Ut,{}),e.jsx(Ht,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsxs(p,{className:Se("green"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"}),e.jsx(ne,{className:`h-4 w-4 ${Ee("green")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:R?.financialStats?.totalRevenue||o||0,currency:E})}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Ù…Ù† ",(R?.filteredData||[]).filter(e=>"completed"===e.status||"partial"===e.status).length," Ù…Ø¹Ø§Ù…Ù„Ø©"]}),R?.trend&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(R.trend.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(R.trend.changePercent||0),"%"]}),R.trend.isPositive?e.jsx(lt,{className:"h-3 w-3"}):e.jsx(it,{className:"h-3 w-3"})]})]})]}),e.jsxs(p,{className:Se("red"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsx(_t,{className:`h-4 w-4 ${Ee("red")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:ae,currency:E})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right space-y-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©:"}),e.jsx(Pe,{amount:U,currency:E})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:"}),e.jsx(Pe,{amount:Z,currency:E})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:"}),e.jsx(Pe,{amount:J,currency:E})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±:"}),e.jsx(Pe,{amount:se,currency:E})]}),e.jsx("div",{className:"border-t pt-1 mt-2 font-medium",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:"}),e.jsx(Pe,{amount:ae,currency:E})]})})]})]})]}),e.jsxs(p,{className:Se(ie>=0?"green":"red"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­"}),ie>=0?e.jsx(pt,{className:`h-4 w-4 ${Ee("green")}`}):e.jsx(_t,{className:`h-4 w-4 ${Ee("red")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:ie,currency:E})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]})]}),e.jsxs(p,{className:Se("yellow"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©"}),e.jsx(Q,{className:`h-4 w-4 ${Ee("yellow")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:m+h+(R?.financialStats?.totalRemainingBalance||0),currency:E})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ø¢Ø¬Ù„Ø© ÙˆÙ…ØªØ£Ø®Ø±Ø© ÙˆÙ…ØªØ¨Ù‚ÙŠØ©"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",dir:"rtl",children:[e.jsxs(p,{className:Se(ce>=0?"green":"red"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­"}),e.jsx(rt,{className:`h-4 w-4 ${Ee(ce>=0?"green":"red")}`})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground text-right",children:[ce.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"})]})]}),e.jsxs(p,{className:Se("purple"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"}),e.jsx(re,{className:`h-4 w-4 ${Ee("purple")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:(R?.filteredData||[]).length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø§Ù„ÙŠØ©"})]})]}),e.jsxs(p,{className:Se("teal"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©"}),e.jsx(ne,{className:`h-4 w-4 ${Ee("teal")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:(()=>{const e=R||{filteredData:[],financialStats:{totalRevenue:0}},t=Array.isArray(d)?d:[],s=Array.isArray(e.filteredData)&&e.filteredData.length>0?e.filteredData:t,a=e.financialStats?.totalRevenue||0;return s.length>0?a/s.length:0})(),currency:E})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (",R.filteredData.length," Ù…Ø¹Ø§Ù…Ù„Ø©)",R.timeFilter.startDate&&R.timeFilter.endDate&&" ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"]})]}),e.jsxs(b,{children:[0===ve.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:pe.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:ve,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:s})=>t>0?`${e}: ${t} (${(100*s).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:T?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:ve.map((t,s)=>e.jsx(He,{fill:t.color},`payment-status-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[`${e} Ù…Ø¹Ø§Ù…Ù„Ø©`,"Ø§Ù„Ø¹Ø¯Ø¯"],labelFormatter:e=>`Ø§Ù„Ø­Ø§Ù„Ø©: ${e}`,contentStyle:pe.tooltip})]})}),ve.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:ve.map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",t.value," (",t.percentage,"%)"]})]},`status-legend-${s}`))})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹"})]}),e.jsxs(y,{children:["Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (",r((()=>{const e=ge.reduce((e,t)=>e+t.amount,0);return console.log("Payment method total calculation:",{paymentMethodData:ge,total:e,financialStatsTotal:R.financialStats.totalRevenue}),e})(),E)," Ø¥Ø¬Ù…Ø§Ù„ÙŠ)",R.timeFilter.startDate&&R.timeFilter.endDate&&" ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"]})]}),e.jsxs(b,{children:[0===ge.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:pe.responsive.desktop.height,children:e.jsxs(Ue,{data:ge,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:pe.bar.barCategoryGap,children:[e.jsx(Xe,{strokeDasharray:pe.grid.strokeDasharray,stroke:pe.grid.stroke,strokeOpacity:pe.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"method",tick:{fontSize:14,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(Je,{tick:{fontSize:14,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"},tickFormatter:e=>le(e,"currency",E),domain:[0,"dataMax + 100"]}),e.jsx(Ge,{formatter:(e,t,s)=>[r(Number(e),E),"Ø§Ù„Ù…Ø¨Ù„Øº",`${s.payload.count} Ù…Ø¹Ø§Ù…Ù„Ø©`],labelFormatter:e=>`Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${e}`,contentStyle:pe.tooltip}),e.jsx(Qe,{dataKey:"amount",fill:xe[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),ge.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-2 text-sm",children:ge.slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{className:"font-medium",children:t.method}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:t.formattedAmount}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.count," Ù…Ø¹Ø§Ù…Ù„Ø©"]})]})]},`method-summary-${s}`))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ (",P(ae)," Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsxs(b,{children:[0===me.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¯ÙÙˆØ¹Ø©"})]})}):e.jsx(Ye,{width:"100%",height:pe.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:me,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percentage:s})=>t>0?`${e}: ${P(t)} (${s.toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:T?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:me.map((t,s)=>e.jsx(He,{fill:he[s%he.length]},`expense-type-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[P(Number(e)),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>`Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${e}`,contentStyle:pe.tooltip})]})}),me.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:me.map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:he[s%he.length]}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(Pe,{amount:t.value})," (",t.percentage.toFixed(1),"%)"]})]},`expense-legend-${s}`))})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsx(y,{children:"Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­"})]}),e.jsx(b,{children:e.jsx(Ye,{width:"100%",height:pe.responsive.desktop.height,children:e.jsxs(Ue,{data:[{name:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",value:I.totalRevenue,type:"revenue"},{name:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",value:ae,type:"expenses"},{name:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­",value:ie,type:"profit"}],margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:pe.bar.barCategoryGap,children:[e.jsx(Xe,{strokeDasharray:pe.grid.strokeDasharray,stroke:pe.grid.stroke,strokeOpacity:pe.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"name",tick:{fontSize:14,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"}}),e.jsx(Je,{tick:{fontSize:14,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"},tickFormatter:e=>le(e,"currency",E)}),e.jsx(Ge,{formatter:(e,t,s)=>[P(Number(e)),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>e,contentStyle:pe.tooltip}),e.jsx(Qe,{dataKey:"value",fill:e=>"revenue"===e?.type?W("financial",T)[0]:"expenses"===e?.type?W("financial",T)[1]:e?.value>=0?W("financial",T)[0]:W("financial",T)[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:[{name:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",value:I.totalRevenue,type:"revenue"},{name:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",value:ae,type:"expenses"},{name:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­",value:ie,type:"profit"}].map((t,s)=>e.jsx(He,{fill:"revenue"===t.type?W("financial",T)[0]:"expenses"===t.type?W("financial",T)[1]:t.value>=0?W("financial",T)[0]:W("financial",T)[1]},`profit-loss-${s}`))})]})})})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©"})]}),e.jsxs(y,{children:["ØªØ·ÙˆØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø± (",ye.length," Ø´Ù‡Ø±)"]})]}),e.jsxs(b,{children:[0===ye.length?e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(lt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø´Ù‡Ø±ÙŠØ© Ù…ØªØ§Ø­Ø©"}),e.jsx("p",{className:"text-sm mt-2",children:0===R.filteredData.length?"Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª":`ÙŠÙˆØ¬Ø¯ ${R.filteredData.length} Ù…Ø¯ÙÙˆØ¹Ø© ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø±ÙŠØ© ØµØ§Ù„Ø­Ø©`})]})}):e.jsx(Ye,{width:"100%",height:pe.responsive.large.height,children:e.jsxs(et,{data:ye,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Xe,{strokeDasharray:pe.grid.strokeDasharray,stroke:pe.grid.stroke,strokeOpacity:pe.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"month",tick:{fontSize:12,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(Je,{tick:{fontSize:12,fill:T?"#9ca3af":"#6b7280"},axisLine:{stroke:T?"#4b5563":"#d1d5db"},tickLine:{stroke:T?"#4b5563":"#d1d5db"},tickFormatter:e=>le(e,"currency",E),domain:[0,"dataMax + 100"]}),e.jsx(Ge,{formatter:e=>[r(Number(e),E),"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"],labelFormatter:e=>`Ø§Ù„Ø´Ù‡Ø±: ${e}`,contentStyle:pe.tooltip}),e.jsx(tt,{type:"monotone",dataKey:"revenue",stroke:xe[0],fill:xe[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})}),ye.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ø¹Ù„Ù‰ Ø´Ù‡Ø±"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=ye.map(e=>e.revenue).filter(e=>e>0);return e.length>0?r(Math.max(...e),E):r(0,E)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ù…ØªÙˆØ³Ø· Ø´Ù‡Ø±ÙŠ"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=ye.map(e=>e.revenue).filter(e=>e>0);return e.length>0?r(e.reduce((e,t)=>e+t,0)/e.length,E):r(0,E)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ù‚Ù„ Ø´Ù‡Ø±"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=ye.map(e=>e.revenue).filter(e=>e>0);return e.length>0?r(Math.min(...e),E):r(0,E)})()})]})]})]})]}),R.filteredData.length>0&&e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"})]}),e.jsxs(y,{children:["Ø¢Ø®Ø± ",Math.min(10,R.filteredData.length)," Ù…Ø¯ÙÙˆØ¹Ø§Øª",R.timeFilter.startDate&&R.timeFilter.endDate&&` ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ù…Ù† ${R.timeFilter.startDate} Ø¥Ù„Ù‰ ${R.timeFilter.endDate}`]})]}),e.jsxs(b,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ù…Ø±ÙŠØ¶"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„ØªØ§Ø±ÙŠØ®"})]})}),e.jsx("tbody",{children:R.filteredData.sort((e,t)=>new Date(t.payment_date||t.created_at).getTime()-new Date(e.payment_date||e.created_at).getTime()).slice(0,10).map((t,s)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"font-mono text-sm",children:t.receipt_number||`#${t.id?.slice(-6)||"N/A"}`})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"font-medium",children:t.patient?.full_name||t.patient_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(Pe,{amount:"pending"===t.status?t.total_amount_due&&t.total_amount_due>0?t.total_amount_due:t.remaining_balance&&t.remaining_balance>0?t.remaining_balance:t.amount||0:t.amount||0,currency:E})}),"partial"===t.status&&e.jsxs("div",{className:"text-xs space-y-0.5",children:[t.amount_paid&&e.jsxs("div",{className:"text-blue-600 dark:text-blue-400",children:["Ù…Ø¯ÙÙˆØ¹: ",e.jsx(Pe,{amount:t.amount_paid,currency:E})]}),(t.appointment_remaining_balance||t.remaining_balance)&&e.jsxs("div",{className:"text-orange-600 dark:text-orange-400",children:["Ù…ØªØ¨Ù‚ÙŠ: ",e.jsx(Pe,{amount:t.appointment_remaining_balance||t.remaining_balance||0,currency:E})]})]}),"pending"===t.status&&t.total_amount_due&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø·Ù„ÙˆØ¨: ",e.jsx(Pe,{amount:t.total_amount_due,currency:E})]})]})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm",children:{cash:"Ù†Ù‚Ø¯Ø§Ù‹",card:"Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†",bank_transfer:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",check:"Ø´ÙŠÙƒ",insurance:"ØªØ£Ù…ÙŠÙ†"}[t.payment_method]||t.payment_method||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{completed:"text-green-600 bg-green-50 dark:bg-green-900/20",partial:"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20",pending:"text-gray-600 bg-gray-50 dark:bg-card/20",failed:"text-red-600 bg-red-50 dark:bg-red-900/20",refunded:"text-purple-600 bg-purple-50 dark:bg-purple-900/20"}[t.status]||"text-gray-600 bg-gray-50"}`,children:{completed:"Ù…ÙƒØªÙ…Ù„",partial:"Ø¬Ø²Ø¦ÙŠ",pending:"Ø¢Ø¬Ù„",failed:"ÙØ§Ø´Ù„",refunded:"Ù…Ø³ØªØ±Ø¯"}[t.status]||t.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:n(t.payment_date||t.created_at)})})]},t.id||s))})]})}),R.filteredData.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ø¹Ø±Ø¶ 10 Ù…Ù† Ø£ØµÙ„ ",R.filteredData.length," Ù…Ø¯ÙÙˆØ¹Ø©"]})})]})]})]})}),Zt=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316"];function Jt({title:t,value:s,icon:a,color:n,description:r,trend:l}){return e.jsxs(p,{className:Se(n),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsx(a,{className:`h-4 w-4 ${Ee(n)}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right mb-1",children:s}),r&&e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:r}),l&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(l.isPositive?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.jsx(lt,{className:"h-3 w-3 ml-1 "+(l.isPositive?"":"rotate-180")}),e.jsxs("span",{children:[Math.abs(l.value),"%"]})]})]})]})}function Qt(){const{treatmentReports:s,isLoading:l,isExporting:i,generateReport:h,clearCache:u}=fe(),{toothTreatments:f,loadToothTreatments:y}=ie(),{patients:v,loadPatients:N}=Y(),{currency:w,settings:$}=V();q();const _=e=>{if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)||!isFinite(t)?0:t}if("object"==typeof e&&null!==e){if(e instanceof Date)return e.getTime();if(void 0!==e.value)return _(e.value);if(void 0!==e.amount)return _(e.amount);if(void 0!==e.count)return _(e.count);const t=Number(e);return isNaN(t)||!isFinite(t)?0:t}return 0},{refreshTreatmentNames:D}=ce(),k=mt({data:f,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});je("treatments"),t.useEffect(()=>{h("treatments"),y(),N(),D()},[h,y,N,D]);const A=t.useMemo(()=>{const e=k.filteredData;if(!e||0===e.length)return{totalTreatments:0,completedTreatments:0,plannedTreatments:0,inProgressTreatments:0,cancelledTreatments:0,totalRevenue:0,averageTreatmentCost:0,completionRate:0,treatmentsByStatus:[],treatmentsByCategory:[],treatmentsByType:[],revenueByCategory:[],pendingTreatments:[],overdueTreatments:[]};const t=e.length,s=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"planned"===e.status).length,n=e.filter(e=>"in-progress"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,l=e.reduce((e,t)=>e+(t.cost||0),0),i=t>0?l/t:0,m=t>0?Math.round(s/t*100):0,x=e.reduce((e,t)=>{const s=o(t.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");return e[s]=(e[s]||0)+1,e},{}),h=Object.entries(x).map(([e,s])=>({status:e,count:s,percentage:t>0?Math.round(s/t*100):0})),u=e.reduce((e,t)=>{const s=d(t.treatment_category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");return e[s]=(e[s]||0)+1,e},{}),p=Object.entries(u).map(([e,s])=>({category:e,count:s,percentage:t>0?Math.round(s/t*100):0})),g=e.reduce((e,t)=>{const s=c(t.treatment_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");return e[s]=(e[s]||0)+1,e},{}),f=Object.entries(g).map(([e,s])=>({type:e,count:s,percentage:t>0?Math.round(s/t*100):0})),j=Object.entries(e.reduce((e,t)=>{const s=d(t.treatment_category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");return e[s]||(e[s]={revenue:0,count:0}),e[s].revenue+=t.cost||0,e[s].count+=1,e},{})).map(([e,t])=>({category:e,revenue:t.revenue,count:t.count})),y=e.filter(e=>"planned"===e.status||"in-progress"===e.status).map(e=>({...e,patient_name:v.find(t=>t.id===e.patient_id)?.full_name||`${v.find(t=>t.id===e.patient_id)?.first_name||""} ${v.find(t=>t.id===e.patient_id)?.last_name||""}`.trim()||`Ù…Ø±ÙŠØ¶ ${e.patient_id}`})),N=new Date;N.setDate(N.getDate()-30);const b=y.filter(e=>new Date(e.created_at)<N);return{totalTreatments:t,completedTreatments:s,plannedTreatments:a,inProgressTreatments:n,cancelledTreatments:r,totalRevenue:l,averageTreatmentCost:i,completionRate:m,treatmentsByStatus:h,treatmentsByCategory:p,treatmentsByType:f,revenueByCategory:j,pendingTreatments:y,overdueTreatments:b}},[k.filteredData,v]),C=t.useCallback(async()=>{try{u(),await h("treatments"),await y(),await N(),ct.success("ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­")}catch(e){console.error("Error refreshing treatment reports:",e),ct.error("ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª")}},[u,h,y,N]),S=t.useCallback(async()=>{try{const e=k.filteredData.length>0?k.filteredData:f;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ø§Ø¬Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");const t={};v.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});const s=e.map(e=>({...e,patient_name:t[e.patient_id]||`Ù…Ø±ÙŠØ¶ ${e.patient_id}`}));await ze.exportTreatmentsToCSV(s),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! (${e.length} Ø¹Ù„Ø§Ø¬)`)}catch(e){console.error("Error exporting CSV:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª")}},[k.filteredData,f,v]),E=t.useCallback(async()=>{try{const e=k.filteredData.length>0?k.filteredData:f;if(0===e.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ø§Ø¬Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");const t={};v.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});e.map(e=>({...e,patient_name:t[e.patient_id]||`Ù…Ø±ÙŠØ¶ ${e.patient_id}`}));const s={...A,filterInfo:k.timeFilter.startDate&&k.timeFilter.endDate?`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ${k.timeFilter.startDate} Ø¥Ù„Ù‰ ${k.timeFilter.endDate}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",dataCount:e.length};await Le.exportTreatmentReport(s,$),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª ÙƒÙ…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­ (${e.length} Ø¹Ù„Ø§Ø¬)`)}catch(e){console.error("Error exporting PDF:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª ÙƒÙ…Ù„Ù PDF")}},[k,f,v,A,$]);return l?e.jsx("div",{className:"flex items-center justify-center h-64",dir:"rtl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª..."})]})}):s?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª"})}),e.jsx("p",{className:"text-muted-foreground",children:"ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{onClick:C,disabled:l,variant:"outline",size:"sm",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(x,{className:"w-4 h-4 ml-2 "+(l?"animate-spin":"")}),"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:S,disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:E,disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± PDF"]})]})]}),e.jsx(xt,{value:k.timeFilter,onChange:k.handleFilterChange,onClear:k.resetFilter,title:"ÙÙ„ØªØ±Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Jt,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª",value:_(A.totalTreatments).toFixed(0),icon:ae,color:"blue",description:"Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø¹Ù„Ø§Ø¬Ø§Øª",trend:k.trend}),e.jsx(Jt,{title:"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©",value:_(A.completedTreatments).toFixed(0),icon:O,color:"green",description:`Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${_(A.completionRate).toFixed(1)}%`}),e.jsx(Jt,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",value:e.jsx(Pe,{amount:A.totalRevenue,currency:w}),icon:ne,color:"green",description:`Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©: ${r(A.averageTreatmentCost,w)}`}),e.jsx(Jt,{title:"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©",value:_(A.pendingTreatments.length).toFixed(0),icon:Q,color:"yellow",description:`Ù…ØªØ£Ø®Ø±Ø©: ${_(A.overdueTreatments.length).toFixed(0)}`})]}),e.jsxs(he,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-4",children:[e.jsx(pe,{value:"overview",children:"Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©"}),e.jsx(pe,{value:"analysis",children:"Ø§Ù„ØªØ­Ù„ÙŠÙ„"}),e.jsx(pe,{value:"performance",children:"Ø§Ù„Ø£Ø¯Ø§Ø¡"}),e.jsx(pe,{value:"details",children:"Ø§Ù„ØªÙØ§ØµÙŠÙ„"})]}),e.jsx(ge,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬"]})}),e.jsx(b,{children:0===A.treatmentsByStatus.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ke,{children:[e.jsx(We,{data:A.treatmentsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({status:e,percentage:t})=>`${a(e)}: ${_(t).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",isAnimationActive:!1,animationDuration:0,children:A.treatmentsByStatus.map((t,s)=>e.jsx(He,{fill:Zt[s%Zt.length]},`cell-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[`${_(e).toFixed(0)}`,`${a(t)}`],labelFormatter:e=>`Ø§Ù„Ø­Ø§Ù„Ø©: ${a(e)}`})]})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5"}),"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©"]})}),e.jsx(b,{children:0===A.treatmentsByCategory.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¦Ø§Øª Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ue,{data:A.treatmentsByCategory,children:[e.jsx(Xe,{strokeDasharray:"3 3"}),e.jsx(Ze,{dataKey:"category",tickFormatter:e=>a(e),tick:{fontSize:12},interval:0,angle:-45,textAnchor:"end",height:80}),e.jsx(Je,{}),e.jsx(Ge,{formatter:e=>[_(e).toFixed(0),"Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª"],labelFormatter:e=>`Ø§Ù„ÙØ¦Ø©: ${a(e)}`}),e.jsx(Qe,{dataKey:"count",fill:"#3b82f6",radius:[4,4,0,0],isAnimationActive:!1,animationDuration:0})]})})})]})]})}),e.jsx(ge,{value:"analysis",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:A.revenueByCategory&&0!==A.revenueByCategory.length?A.revenueByCategory.map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[e.jsx("span",{className:"font-medium text-right",children:t.category}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:e.jsx(Pe,{amount:t.revenue,currency:w})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.count," Ø¹Ù„Ø§Ø¬"]})]})]},s)):e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØªØ§Ø­Ø©"})]})})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Ø£Ø´Ù‡Ø± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:Array.isArray(s.mostPopularTreatments)?s.mostPopularTreatments.slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:a(t.name)}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"font-bold",children:[_(t.count)," Ù…Ø±Ø©"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(Pe,{amount:_(t.revenue),currency:w})})]})]},s)):e.jsx("div",{className:"text-center text-muted-foreground py-4",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø´Ù‡Ø± Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"})})})]})]})}),e.jsx(ge,{value:"performance",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ"})}),e.jsx(b,{children:s.treatmentTrend&&Array.isArray(s.treatmentTrend)&&0!==s.treatmentTrend.length?e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(st,{data:s.treatmentTrend,children:[e.jsx(Xe,{strokeDasharray:"3 3"}),e.jsx(Ze,{dataKey:"period",tickFormatter:e=>a(e)}),e.jsx(Je,{}),e.jsx(Ge,{formatter:(e,t)=>[`${_(e).toFixed(0)}`,`${a(t)}`],labelFormatter:e=>`Ø§Ù„ÙØªØ±Ø©: ${a(e)}`}),e.jsx(at,{type:"monotone",dataKey:"completed",stroke:"#10b981",name:"Ù…ÙƒØªÙ…Ù„",strokeWidth:2,dot:{fill:"#10b981",strokeWidth:2,r:4},isAnimationActive:!1,animationDuration:0}),e.jsx(at,{type:"monotone",dataKey:"planned",stroke:"#3b82f6",name:"Ù…Ø®Ø·Ø·",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2,r:4},isAnimationActive:!1,animationDuration:0})]})}):e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(lt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"})]})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡"})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²"}),e.jsxs(m,{variant:"secondary",children:[_(s.completionRate).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²"}),e.jsxs(m,{variant:"secondary",children:[Math.round(_(s.averageCompletionTime))," ÙŠÙˆÙ…"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©"}),e.jsx(m,{variant:"secondary",children:_(s.patientsWithMultipleTreatments)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶"}),e.jsx(m,{variant:"secondary",children:_(s.averageTreatmentsPerPatient).toFixed(1)})]})]})})]})]})}),e.jsx(ge,{value:"details",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© (",A.pendingTreatments.length,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===A.pendingTreatments.length?e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ø¬Ø§Øª Ø¢Ø¬Ù„Ø©"})]})}):e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬"}),e.jsx(vt,{className:"text-right",children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ØªØ§Ø±ÙŠØ®"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ØªÙƒÙ„ÙØ©"})]})}),e.jsx(Nt,{children:A.pendingTreatments.slice(0,10).map(t=>e.jsxs(yt,{children:[e.jsx(bt,{className:"text-right",children:c(t.treatment_type)}),e.jsx(bt,{className:"text-right",children:a(t.patient_name)}),e.jsx(bt,{className:"text-right",children:e.jsx(m,{variant:"planned"===t.treatment_status?"secondary":"default",children:o(t.treatment_status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯")})}),e.jsx(bt,{className:"text-right",children:t.created_at?n(t.created_at):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.cost||0,currency:w})})]},t.id))})]})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-red-500"}),"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© (",A.overdueTreatments.length,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===A.overdueTreatments.length?e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),e.jsx("p",{className:"text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ£Ø®Ø±Ø©"})]})}):e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬"}),e.jsx(vt,{className:"text-right",children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶"}),e.jsx(vt,{className:"text-right",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ØªÙƒÙ„ÙØ©"})]})}),e.jsx(Nt,{children:A.overdueTreatments.slice(0,10).map(t=>{const s=t.created_at?Math.ceil(((new Date).getTime()-new Date(t.created_at).getTime())/864e5):0;return e.jsxs(yt,{children:[e.jsx(bt,{className:"text-right",children:c(t.treatment_type)}),e.jsx(bt,{className:"text-right",children:a(t.patient_name)}),e.jsx(bt,{className:"text-right",children:t.created_at?n(t.created_at):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}),e.jsx(bt,{className:"text-right",children:e.jsxs(m,{variant:"destructive",children:[s," ÙŠÙˆÙ…"]})}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.cost||0,currency:w})})]},t.id)})})]})})})]})]})})]})]}):e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ø§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"}),e.jsxs(F,{onClick:C,className:"mt-4",children:[e.jsx(x,{className:"h-4 w-4 ml-2"}),"ØªØ­Ø¯ÙŠØ«"]})]})}const es={pending:"#f59e0b",ordered:"#3b82f6",received:"#10b981",cancelled:"#ef4444",urgent:"#dc2626",high:"#f59e0b",medium:"#3b82f6",low:"#10b981"},ts={pending:"Ø¢Ø¬Ù„",ordered:"Ù…Ø·Ù„ÙˆØ¨",received:"Ù…Ø³ØªÙ„Ù…",cancelled:"Ù…Ù„ØºÙŠ"},ss={urgent:"Ø¹Ø§Ø¬Ù„",high:"Ø¹Ø§Ù„ÙŠ",medium:"Ù…ØªÙˆØ³Ø·",low:"Ù…Ù†Ø®ÙØ¶"};function as(){const{clinicNeedsReports:s,isLoading:a,isExporting:r,generateReport:l,clearCache:i}=fe(),{needs:c,loadNeeds:d}=ke(),{currency:o,settings:h}=V(),{isDarkMode:u}=q(),f=mt({data:c,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});je("clinicNeeds"),t.useEffect(()=>{l("clinicNeeds"),d()},[l,d]);const v=t.useMemo(()=>{const e=f.filteredData;if(!e||0===e.length)return{totalNeeds:0,totalValue:0,pendingCount:0,orderedCount:0,receivedCount:0,cancelledCount:0,urgentCount:0,completionRate:0,urgencyRate:0,averageNeedValue:0,needsByStatus:[],needsByPriority:[],needsByCategory:[],topExpensiveNeeds:[]};const t=e.length,s=e.reduce((e,t)=>e+t.price*t.quantity,0),a=t>0?s/t:0,n=e.filter(e=>"pending"===e.status).length,r=e.filter(e=>"ordered"===e.status).length,l=e.filter(e=>"received"===e.status).length,i=e.filter(e=>"cancelled"===e.status).length,c=e.filter(e=>"urgent"===e.priority).length,d=t>0?l/t*100:0,o=t>0?c/t*100:0,m=[{name:ts.pending,value:n,color:es.pending},{name:ts.ordered,value:r,color:es.ordered},{name:ts.received,value:l,color:es.received},{name:ts.cancelled,value:i,color:es.cancelled}].filter(e=>e.value>0),x={urgent:e.filter(e=>"urgent"===e.priority).length,high:e.filter(e=>"high"===e.priority).length,medium:e.filter(e=>"medium"===e.priority).length,low:e.filter(e=>"low"===e.priority).length},h=[{name:ss.urgent,value:x.urgent,color:es.urgent},{name:ss.high,value:x.high,color:es.high},{name:ss.medium,value:x.medium,color:es.medium},{name:ss.low,value:x.low,color:es.low}].filter(e=>e.value>0),u=new Map;e.forEach(e=>{const t=e.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",s=u.get(t)||{count:0,value:0};u.set(t,{count:s.count+1,value:s.value+e.price*e.quantity})});return{totalNeeds:t,totalValue:s,pendingCount:n,orderedCount:r,receivedCount:l,cancelledCount:i,urgentCount:c,completionRate:d,urgencyRate:o,averageNeedValue:a,needsByStatus:m,needsByPriority:h,needsByCategory:Array.from(u.entries()).map(([e,t])=>({category:e,count:t.count,value:t.value})).sort((e,t)=>t.value-e.value),topExpensiveNeeds:e.map(e=>({need_name:e.need_name,value:e.price*e.quantity,quantity:e.quantity,price:e.price})).sort((e,t)=>t.value-e.value).slice(0,10)}},[f.filteredData]);if(a)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©..."})]})});const N=v;return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Ae,{className:"w-6 h-6 text-primary"}),"ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{i(),await l("clinicNeeds"),await d(),ot.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ±")},disabled:a,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(x,{className:"w-4 h-4 "+(a?"animate-spin":"")}),e.jsx("span",{children:"ØªØ­Ø¯ÙŠØ«"})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{const e=f.filteredData;if(!e||0===e.length)return void ot.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");const t=`clinic-needs-report${"all"!==f.filter.preset?`_${f.filter.preset}_${f.filter.startDate||""}_${f.filter.endDate||""}`:""}`;await ze.exportClinicNeedsToCSV(e,t),ot.success(`ØªÙ… ØªØµØ¯ÙŠØ± ${e.length} Ø§Ø­ØªÙŠØ§Ø¬ Ø¨Ù†Ø¬Ø§Ø­`)}catch(e){console.error("Error exporting CSV:",e),ot.error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}},disabled:r,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:"CSV"})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:async()=>{try{if(!f.filteredData||0===f.filteredData.length)return void ot.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");const e={...N,needsList:f.filteredData,filterInfo:"all"!==f.filter.preset?`Ø§Ù„ÙØªØ±Ø©: ${f.filter.preset} (${f.filter.startDate||""} - ${f.filter.endDate||""})`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",dataCount:f.filteredData.length};await Le.exportClinicNeedsReport(e,{title:"ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",currency:o,isDarkMode:u}),ot.success("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­")}catch(e){console.error("Error exporting PDF:",e),ot.error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±")}},disabled:r,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:"PDF"})]})]})]}),e.jsx(xt,{value:f.filter,onChange:f.setFilter,className:"w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsxs(p,{className:Se("blue"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª"}),e.jsx(Ae,{className:`h-4 w-4 ${Ee("blue")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:N.totalNeeds}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ø§Ø­ØªÙŠØ§Ø¬ Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…"})]})]}),e.jsxs(p,{className:Se("green"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©"}),e.jsx(ne,{className:`h-4 w-4 ${Ee("green")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:N.totalValue,currency:o})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù‚ÙŠÙ…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª"})]})]}),e.jsxs(p,{className:Se("orange"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©"}),e.jsx(Q,{className:`h-4 w-4 ${Ee("orange")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:N.pendingCount}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø·Ù„Ø¨"})]})]}),e.jsxs(p,{className:Se("red"),dir:"rtl",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©"}),e.jsx(T,{className:`h-4 w-4 ${Ee("red")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:N.urgentCount}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"ØªØ­ØªØ§Ø¬ Ø§Ù‡ØªÙ…Ø§Ù… ÙÙˆØ±ÙŠ"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (",N.totalNeeds," Ø§Ø­ØªÙŠØ§Ø¬ Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsx(b,{children:0===N.needsByStatus.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ke,{children:[e.jsx(We,{data:N.needsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:s})=>`${e}: ${t} (${(100*s).toFixed(1)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:N.needsByStatus.map((t,s)=>e.jsx(He,{fill:t.color},`cell-${s}`))}),e.jsx(Ge,{}),e.jsx(nt,{})]})})})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©"})]}),e.jsx(y,{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©"})]}),e.jsx(b,{children:0===N.needsByPriority.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ue,{data:N.needsByPriority,children:[e.jsx(Xe,{strokeDasharray:"3 3"}),e.jsx(Ze,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Ge,{}),e.jsx(Qe,{dataKey:"value",fill:"#8884d8",children:N.needsByPriority.map((t,s)=>e.jsx(He,{fill:t.color},`cell-${s}`))})]})})})]})]}),e.jsxs(he,{defaultValue:"categories",className:"w-full",dir:"rtl",children:[e.jsxs(ue,{className:"grid w-full grid-cols-4",children:[e.jsx(pe,{value:"categories",children:"Ø§Ù„ÙØ¦Ø§Øª"}),e.jsx(pe,{value:"expensive",children:"Ø§Ù„Ø£ØºÙ„Ù‰ Ø³Ø¹Ø±Ø§Ù‹"}),e.jsx(pe,{value:"pending",children:"Ø§Ù„Ø¢Ø¬Ù„Ø©"}),e.jsx(pe,{value:"urgent",children:"Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©"})]}),e.jsx(ge,{value:"categories",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-5 w-5"}),"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© (",N.needsByCategory.length," ÙØ¦Ø©)"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ø§Ù„ÙØ¦Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ø¹Ø¯Ø¯"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©"}),e.jsx(vt,{className:"text-right",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚ÙŠÙ…Ø©"})]})}),e.jsx(Nt,{children:N.needsByCategory.map((t,s)=>e.jsxs(yt,{children:[e.jsx(bt,{className:"font-medium text-right",children:t.category}),e.jsx(bt,{className:"text-right",children:t.count}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.value,currency:o})}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.value/t.count,currency:o})})]},s))})]})})})]})}),e.jsx(ge,{value:"expensive",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø£ØºÙ„Ù‰ Ø³Ø¹Ø±Ø§Ù‹ (Ø£Ø¹Ù„Ù‰ 10)"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ÙƒÙ…ÙŠØ©"}),e.jsx(vt,{className:"text-right",children:"Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©"})]})}),e.jsx(Nt,{children:N.topExpensiveNeeds.map((t,s)=>e.jsxs(yt,{children:[e.jsx(bt,{className:"font-medium text-right",children:t.need_name}),e.jsx(bt,{className:"text-right",children:t.quantity}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.price,currency:o})}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.value,currency:o})})]},s))})]})})})]})}),e.jsx(ge,{value:"pending",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© (",N.pendingCount,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ÙØ¦Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ù‚ÙŠÙ…Ø©"}),e.jsx(vt,{className:"text-right",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"})]})}),e.jsx(Nt,{children:f.filteredData.filter(e=>"pending"===e.status).slice(0,10).map(t=>e.jsxs(yt,{children:[e.jsx(bt,{className:"font-medium text-right",children:t.need_name}),e.jsx(bt,{className:"text-right",children:t.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}),e.jsx(bt,{className:"text-right",children:e.jsx(m,{variant:"urgent"===t.priority?"destructive":"secondary",children:ss[t.priority]})}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.price*t.quantity,currency:o})}),e.jsx(bt,{className:"text-right",children:n(t.created_at)})]},t.id))})]})})})]})}),e.jsx(ge,{value:"urgent",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© (",N.urgentCount,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(yt,{children:[e.jsx(vt,{className:"text-right",children:"Ø§Ø³Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„ÙØ¦Ø©"}),e.jsx(vt,{className:"text-right",children:"Ø§Ù„Ù‚ÙŠÙ…Ø©"}),e.jsx(vt,{className:"text-right",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"})]})}),e.jsx(Nt,{children:f.filteredData.filter(e=>"urgent"===e.priority).slice(0,10).map(t=>e.jsxs(yt,{children:[e.jsx(bt,{className:"font-medium text-right",children:t.need_name}),e.jsx(bt,{className:"text-right",children:e.jsx(m,{variant:"received"===t.status?"default":"secondary",children:ts[t.status]})}),e.jsx(bt,{className:"text-right",children:t.category||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}),e.jsx(bt,{className:"text-right",children:e.jsx(Pe,{amount:t.price*t.quantity,currency:o})}),e.jsx(bt,{className:"text-right",children:n(t.created_at)})]},t.id))})]})})})]})})]})]})}function ns(){const{expenses:s,analytics:a,loadExpenses:l}=De(),{currentCurrency:i,formatAmount:c}=te();V();const{isDarkMode:d}=q(),o=mt({data:s,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}});je("financial");const m=t.useCallback(e=>{console.log("ğŸ”„ Expense data changed:",e.detail),l()},[l]);t.useEffect(()=>(window.addEventListener("clinic-expenses-changed",m),()=>{window.removeEventListener("clinic-expenses-changed",m)}),[m]),t.useEffect(()=>{l()},[l]);const h=W("categorical",d),u=W("primary",d),f=G(d),v=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},N=t.useMemo(()=>o||{filteredData:[]},[o]),w=t.useMemo(()=>Array.isArray(N.filteredData)&&N.filteredData.length>0?N.filteredData:s.filter(e=>"paid"===e.status),[N,s]),$=t.useMemo(()=>{const e=w.reduce((e,t)=>e+v(t.amount),0),t=w.length,a=t>0?e/t:0,n={};w.forEach(e=>{const t=e.expense_type||"other";n[t]=(n[t]||0)+v(e.amount)});const r={};w.forEach(e=>{const t=e.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";r[t]=(r[t]||0)+v(e.amount)});const l={};w.forEach(e=>{try{const t=new Date(e.payment_date);if(!isNaN(t.getTime())){const s=t.toISOString().slice(0,7);l[s]=(l[s]||0)+v(e.amount)}}catch(t){console.warn("Invalid expense date:",e.payment_date)}});const i=s||[],c=i.filter(e=>"pending"===e.status),d=i.filter(e=>"overdue"===e.status),m=o?.filteredData?.filter(e=>"pending"===e.status)||c,x=o?.filteredData?.filter(e=>"overdue"===e.status)||d,h={paid:w.filter(e=>"paid"===e.status).length,pending:m.length,overdue:x.length};return{totalAmount:e,totalExpenses:t,averageAmount:a,expensesByType:n,expensesByVendor:r,monthlyExpenses:l,statusBreakdown:h}},[w,s]),_=t.useMemo(()=>Object.entries($.expensesByType).map(([e,t])=>({name:"salary"===e?"Ø±ÙˆØ§ØªØ¨":"utilities"===e?"Ù…Ø±Ø§ÙÙ‚":"rent"===e?"Ø¥ÙŠØ¬Ø§Ø±":"maintenance"===e?"ØµÙŠØ§Ù†Ø©":"supplies"===e?"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª":"insurance"===e?"ØªØ£Ù…ÙŠÙ†":"other"===e?"Ø£Ø®Ø±Ù‰":e,value:v(t),percentage:$.totalAmount>0?v(t)/$.totalAmount*100:0})),[$]),D=t.useMemo(()=>Object.entries($.expensesByVendor).sort(([,e],[,t])=>v(t)-v(e)).slice(0,10).map(([e,t])=>({vendor:e.length>20?e.substring(0,20)+"...":e,amount:v(t),percentage:$.totalAmount>0?v(t)/$.totalAmount*100:0})),[$]),k=t.useMemo(()=>Object.entries($.monthlyExpenses).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{const s=new Date(e+"-01");return{month:`${["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"][s.getMonth()]} ${s.getFullYear()}`,amount:v(t),originalMonth:e}}),[$]),A=t.useCallback(async()=>{try{if(0===w.length)return void ct.noDataToExport("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØµØ±ÙˆÙØ§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");await ze.exportClinicExpensesToExcel(w),ct.exportSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ${w.length} Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel!`)}catch(e){console.error("Error exporting expense reports:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª")}},[w]),C=t.useCallback(async()=>{try{await l();const e=new CustomEvent("showToast",{detail:{title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing expense reports:",e);const t=new CustomEvent("showToast",{detail:{title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",type:"error"}});window.dispatchEvent(t)}},[l]);return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø©"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ"})]}),w.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["â€¢ ",w.length," Ù…ØµØ±ÙˆÙ",o.timeFilter?.startDate&&o.timeFilter?.endDate&&" (Ù…ÙÙ„ØªØ±Ø©)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(x,{className:"w-4 h-4 ml-2"}),"ØªØ­Ø¯ÙŠØ«"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:A,disabled:0===w.length,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),"ØªØµØ¯ÙŠØ± Excel"]})]})]}),e.jsx(xt,{value:o.timeFilter,onChange:o.handleFilterChange,onClear:o.resetFilter,title:"ÙÙ„ØªØ±Ø© Ø²Ù…Ù†ÙŠØ© - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(p,{className:Se("red"),children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsx(ne,{className:`h-4 w-4 ${Ee("red")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:$.totalAmount,currency:i})}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Ù…Ù† ",$.totalExpenses," Ù…ØµØ±ÙˆÙ"]})]})]}),e.jsxs(p,{className:Se("blue"),children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØµØ±ÙˆÙ"}),e.jsx(rt,{className:`h-4 w-4 ${Ee("blue")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(Pe,{amount:$.averageAmount,currency:i})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ"})]})]}),e.jsxs(p,{className:Se("green"),children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©"}),e.jsx(O,{className:`h-4 w-4 ${Ee("green")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:$.statusBreakdown.paid}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø§Ù„Ø¯ÙØ¹"})]})]}),e.jsxs(p,{className:Se("yellow"),children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium text-muted-foreground text-right",children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©"}),e.jsx(Q,{className:`h-4 w-4 ${Ee("yellow")}`})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:$.statusBreakdown.pending+$.statusBreakdown.overdue}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø£Ùˆ Ù…ØªØ£Ø®Ø±Ø©"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ (",c($.totalAmount)," Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"]})]}),e.jsxs(b,{children:[0===_.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹"})]})}):e.jsx(Ye,{width:"100%",height:f.responsive.desktop.height,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:_,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:d?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:_.map((t,s)=>e.jsx(He,{fill:h[s%h.length]},`expense-type-${s}`))}),e.jsx(Ge,{formatter:(e,t)=>[c(Number(e)),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>`Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${e}`,contentStyle:{backgroundColor:d?"#1f2937":"#ffffff",border:"1px solid "+(d?"#374151":"#d1d5db"),borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500"}})]})}),_.length>0&&e.jsxs("div",{className:"mt-6 flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"text-sm font-medium text-foreground mb-2",children:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-md",children:_.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:h[s%h.length]}}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-foreground",children:t.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx(Pe,{amount:t.value})," (",t.percentage.toFixed(1),"%)"]})]})]},`type-legend-${s}`))})]})]})]}),e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(wt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø£ÙƒØ¨Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†"})]}),e.jsx(y,{children:"Ø£ÙƒØ¨Ø± 10 Ù…ÙˆØ±Ø¯ÙŠÙ† Ø­Ø³Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsx(b,{children:0===D.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(wt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ±Ø¯ÙŠÙ†"})]})}):e.jsx(Ye,{width:"100%",height:f.responsive.desktop.height,children:e.jsxs(Ue,{data:D,margin:{top:20,right:30,left:20,bottom:20},layout:"horizontal",children:[e.jsx(Xe,{strokeDasharray:f.grid.strokeDasharray,stroke:f.grid.stroke,strokeOpacity:f.grid.strokeOpacity}),e.jsx(Ze,{type:"number",tick:{fontSize:12,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},tickFormatter:e=>le(e,"currency",i)}),e.jsx(Je,{type:"category",dataKey:"vendor",tick:{fontSize:12,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},width:120}),e.jsx(Ge,{formatter:(e,t)=>[c(Number(e)),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>`Ø§Ù„Ù…ÙˆØ±Ø¯: ${e}`,contentStyle:{backgroundColor:d?"#1f2937":"#ffffff",border:"1px solid "+(d?"#374151":"#d1d5db"),borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500"}}),e.jsx(Qe,{dataKey:"amount",fill:u[2],radius:[0,4,4,0]})]})})})]})]}),k.length>0&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©"})]}),e.jsxs(y,{children:["ØªØ·ÙˆØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø± (",k.length," Ø´Ù‡Ø±)"]})]}),e.jsxs(b,{children:[e.jsx(Ye,{width:"100%",height:f.responsive.large.height,children:e.jsxs(et,{data:k,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Xe,{strokeDasharray:f.grid.strokeDasharray,stroke:f.grid.stroke,strokeOpacity:f.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"month",tick:{fontSize:12,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(Je,{tick:{fontSize:12,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},tickFormatter:e=>le(e,"currency",i),domain:[0,"dataMax + 100"]}),e.jsx(Ge,{formatter:e=>[r(Number(e),i),"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"],labelFormatter:e=>`Ø§Ù„Ø´Ù‡Ø±: ${e}`,contentStyle:{backgroundColor:d?"#1f2937":"#ffffff",border:"1px solid "+(d?"#374151":"#d1d5db"),borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500"}}),e.jsx(tt,{type:"monotone",dataKey:"amount",stroke:u[3],fill:u[3],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})}),k.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ø¹Ù„Ù‰ Ø´Ù‡Ø±"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=k.map(e=>e.amount).filter(e=>e>0);return e.length>0?r(Math.max(...e),i):r(0,i)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ù…ØªÙˆØ³Ø· Ø´Ù‡Ø±ÙŠ"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=k.map(e=>e.amount).filter(e=>e>0);return e.length>0?r(e.reduce((e,t)=>e+t,0)/e.length,i):r(0,i)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ø£Ù‚Ù„ Ø´Ù‡Ø±"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=k.map(e=>e.amount).filter(e=>e>0);return e.length>0?r(Math.min(...e),i):r(0,i)})()})]})]})]})]}),w.length>0&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©"})]}),e.jsxs(y,{children:["Ø¢Ø®Ø± ",Math.min(10,w.length)," Ù…ØµØ±ÙˆÙ",o.timeFilter?.startDate&&o.timeFilter?.endDate&&` ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ù…Ù† ${o.timeFilter.startDate} Ø¥Ù„Ù‰ ${o.timeFilter.endDate}`]})]}),e.jsxs(b,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ù†ÙˆØ¹"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø§Ù„Ù…ÙˆØ±Ø¯"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹"})]})}),e.jsx("tbody",{children:w.sort((e,t)=>new Date(t.payment_date||t.created_at).getTime()-new Date(e.payment_date||e.created_at).getTime()).slice(0,10).map((t,s)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/50 transition-colors",children:[e.jsxs("td",{className:"p-3 text-right",children:[e.jsx("div",{className:"font-medium",children:t.expense_name||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}),t.description&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 max-w-xs truncate",children:t.description})]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm",children:{salary:"Ø±ÙˆØ§ØªØ¨",utilities:"Ù…Ø±Ø§ÙÙ‚",rent:"Ø¥ÙŠØ¬Ø§Ø±",maintenance:"ØµÙŠØ§Ù†Ø©",supplies:"Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",insurance:"ØªØ£Ù…ÙŠÙ†",other:"Ø£Ø®Ø±Ù‰"}[t.expense_type]||t.expense_type||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("div",{className:"font-semibold",children:e.jsx(Pe,{amount:t.amount,currency:i})})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm",children:t.vendor||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{paid:"text-green-600 bg-green-50 dark:bg-green-900/20",pending:"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20",overdue:"text-red-600 bg-red-50 dark:bg-red-900/20",cancelled:"text-gray-600 bg-gray-50 dark:bg-gray-900/20"}[t.status]||"text-gray-600 bg-gray-50"}`,children:{paid:"Ù…Ø¯ÙÙˆØ¹",pending:"Ø¢Ø¬Ù„",overdue:"Ù…ØªØ£Ø®Ø±",cancelled:"Ù…Ù„ØºÙŠ"}[t.status]||t.status||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:n(t.payment_date||t.created_at)})})]},t.id||s))})]})}),w.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ø¹Ø±Ø¶ 10 Ù…Ù† Ø£ØµÙ„ ",w.length," Ù…ØµØ±ÙˆÙ"]})})]})]})]})}class rs{static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static filterByDateRange(e,t,s){const a=t.start||t.startDate,n=t.end||t.endDate;if(!a&&!n)return e;return e.filter(e=>{const t=e[s];if(!t)return!1;const r=new Date(t);let l,i=null,c=null;a&&(i=new Date(a),i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0)),n&&(c=new Date(n),c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59,999)),l=t.includes("T")||t.includes(" ")?r:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);return(!i||l>=i)&&(!c||l<=c)})}static calculateRevenueStats(e){const t=this.validateAmount(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)),s=this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0));return{completedPayments:t,totalRevenue:t+s,partialPayments:s,remainingBalances:this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>{const s=this.validateAmount(t.total_amount_due||t.treatment_total_cost||t.appointment_total_cost||0),a=this.validateAmount(t.amount_paid||t.treatment_total_paid||t.appointment_total_paid||t.amount||0),n=Math.max(0,s-a);return 0===s?e+this.validateAmount(t.remaining_balance||t.treatment_remaining_balance||t.appointment_remaining_balance||0):e+n},0)),pendingAmount:this.validateAmount(e.filter(e=>"pending"===e.status).reduce((e,t)=>{const s=this.validateAmount(t.amount),a=this.validateAmount(t.total_amount_due);let n=s;if(t.tooth_treatment_id){n=this.validateAmount(t.treatment_total_cost)||a}else 0===s&&a>0?n=a:t.remaining_balance&&t.remaining_balance>0&&(n=this.validateAmount(t.remaining_balance));return e+n},0))}}static calculateExpenseStats(e,t,s,a){return{labOrdersTotal:this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0),0)),labOrdersRemaining:this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.remaining_balance||0),0)),clinicNeedsTotal:this.validateAmount(t.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),clinicNeedsRemaining:this.validateAmount(t.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),inventoryExpenses:this.validateAmount(s.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0)),clinicExpensesTotal:a?this.validateAmount(a.filter(e=>"paid"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)):0}}static calculateProfitLoss(e,t){const s=e-t,a=s>=0,n=a?0:Math.abs(s),r=e>0?s/e*100:0;return{totalIncome:e,totalExpenses:t,netProfit:a?s:0,profitMargin:this.validateAmount(r),lossAmount:n,isProfit:a}}static generateComprehensiveProfitLossReport(e,t,s,a,n,r,l,i){const c=l?.dateRange?this.filterByDateRange(e,l.dateRange,"payment_date"):e,d=l?.dateRange?this.filterByDateRange(t,l.dateRange,"order_date"):t,o=l?.dateRange?this.filterByDateRange(s,l.dateRange,"created_at"):s,m=l?.dateRange?this.filterByDateRange(r,l.dateRange,"created_at"):r,x=l?.dateRange?this.filterByDateRange(a,l.dateRange,"created_at"):a,h=l?.dateRange&&i?this.filterByDateRange(i,l.dateRange,"payment_date"):i,u=this.calculateRevenueStats(c),p=this.calculateExpenseStats(d,o,x,h),g=u.totalRevenue,f=p.labOrdersTotal+p.clinicNeedsTotal+p.inventoryExpenses+p.clinicExpensesTotal;return{revenue:u,expenses:p,calculations:this.calculateProfitLoss(g,f),details:{totalPatients:n.length,totalAppointments:m.length,totalLabOrders:d.length,totalClinicNeeds:o.length,totalInventoryItems:x.length,totalExpenses:h?h.length:0,averageRevenuePerPatient:n.length>0?g/n.length:0,averageRevenuePerAppointment:m.length>0?g/m.length:0},filterInfo:{dateRange:l?.dateRange?`${l.dateRange.start||l.dateRange.startDate||"Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"} - ${l.dateRange.end||l.dateRange.endDate||"Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}`:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",totalRecords:e.length+t.length+s.length+r.length+a.length+(i?i.length:0),filteredRecords:c.length+d.length+o.length+m.length+x.length+(h?h.length:0)}}}}function ls(){const{payments:s}=ee(),{expenses:n}=De(),{labOrders:r}=Ce(),{needs:l}=ke(),{items:i}=X(),{patients:c}=Y(),{appointments:d}=J(),{currency:o,settings:x}=V(),{isDarkMode:h}=q(),[u,f]=t.useState(null),[v,N]=t.useState("this_month"),[_,D]=t.useState(""),[E,M]=t.useState(""),[T,R]=t.useState(!1),[O,I]=t.useState(!1),L=t.useMemo(()=>({payments:s,clinicExpenses:n,labOrders:r,clinicNeeds:l,inventoryItems:i,patients:c,appointments:d}),[s,n,r,l,i,c,d]),z=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,B=t.useMemo(()=>((e,t,s)=>{const a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"all":default:return null;case"today":return{start:z(n),end:z(n)};case"yesterday":const e=new Date(n);return e.setDate(e.getDate()-1),{start:z(e),end:z(e)};case"this_week":const a=new Date(n);return a.setDate(n.getDate()-n.getDay()),{start:z(a),end:z(n)};case"last_week":const r=new Date(n);r.setDate(n.getDate()-n.getDay()-1);const l=new Date(r);return l.setDate(r.getDate()-6),{start:z(l),end:z(r)};case"this_month":const i=new Date(n.getFullYear(),n.getMonth(),1);return{start:z(i),end:z(n)};case"last_month":const c=new Date(n.getFullYear(),n.getMonth()-1,1),d=new Date(n.getFullYear(),n.getMonth(),0);return{start:z(c),end:z(d)};case"this_quarter":const o=new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3),1);return{start:z(o),end:z(n)};case"last_quarter":const m=new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3)-3,1),x=new Date(n.getFullYear(),3*Math.floor(n.getMonth()/3),0);return{start:z(m),end:z(x)};case"this_year":const h=new Date(n.getFullYear(),0,1);return{start:z(h),end:z(n)};case"last_year":const u=new Date(n.getFullYear()-1,0,1),p=new Date(n.getFullYear()-1,11,31);return{start:z(u),end:z(p)};case"last_30_days":const g=new Date(n);return g.setDate(n.getDate()-30),{start:z(g),end:z(n)};case"last_90_days":const f=new Date(n);return f.setDate(n.getDate()-90),{start:z(f),end:z(n)};case"custom":return t&&s?{start:t,end:s}:null}})(v,_,E),[v,_,E]),K=t.useCallback(async()=>{R(!0);try{const e=B?{dateRange:B}:void 0,t=rs.generateComprehensiveProfitLossReport(L.payments,L.labOrders,L.clinicNeeds,L.inventoryItems,L.patients,L.appointments,e,L.clinicExpenses);f(t)}catch(e){}finally{R(!1)}},[L,B]),W=t.useCallback(async()=>{if(u){I(!0);try{await ze.exportProfitLossToExcel({reportData:u,...L,filter:B,currency:o}),ct.success("ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­")}catch(e){ct.error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel")}finally{I(!1)}}else ct.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±")},[u,L,B,o]),H=t.useCallback(async()=>{if(u){I(!0);try{await Le.exportProfitLossReport({reportData:u,...L,filter:B,currency:o},x),ct.success("ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± Ø¥Ù„Ù‰ PDF Ø¨Ù†Ø¬Ø§Ø­")}catch(e){ct.error("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ PDF")}finally{I(!1)}}else ct.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±")},[u,L,B,o,x]);t.useEffect(()=>{K()},[K]);const G=t.useMemo(()=>({primary:h?"#3b82f6":"#2563eb",secondary:h?"#10b981":"#059669",warning:h?"#f59e0b":"#d97706",danger:h?"#ef4444":"#dc2626",purple:h?"#8b5cf6":"#7c3aed",teal:h?"#14b8a6":"#0d9488"}),[h]),U=t.useMemo(()=>{if(!u)return[];const{revenue:e}=u;return[{name:"Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©",value:e.completedPayments,color:G.secondary,percentage:e.totalRevenue>0?(e.completedPayments/e.totalRevenue*100).toFixed(1):"0"},{name:"Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø¬Ø²Ø¦ÙŠØ©",value:e.partialPayments,color:G.warning,percentage:e.totalRevenue>0?(e.partialPayments/e.totalRevenue*100).toFixed(1):"0"},{name:"Ù…Ø¨Ø§Ù„Øº Ø¢Ø¬Ù„Ø©",value:e.pendingAmount||0,color:G.danger,percentage:e.totalRevenue>0?((e.pendingAmount||0)/e.totalRevenue*100).toFixed(1):"0"},{name:"Ù…Ø¨Ø§Ù„Øº Ù…ØªØ¨Ù‚ÙŠØ©",value:e.remainingBalances,color:G.purple,percentage:e.totalRevenue>0?(e.remainingBalances/e.totalRevenue*100).toFixed(1):"0"}].filter(e=>e.value>0)},[u,G]),Q=t.useMemo(()=>{if(!u)return[];const{expenses:e,calculations:t}=u;return[{name:"Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±",value:e.labOrdersTotal,color:G.primary,percentage:t.totalExpenses>0?(e.labOrdersTotal/t.totalExpenses*100).toFixed(1):"0"},{name:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©",value:e.clinicNeedsTotal,color:G.secondary,percentage:t.totalExpenses>0?(e.clinicNeedsTotal/t.totalExpenses*100).toFixed(1):"0"},{name:"ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",value:e.inventoryExpenses,color:G.warning,percentage:t.totalExpenses>0?(e.inventoryExpenses/t.totalExpenses*100).toFixed(1):"0"},{name:"Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©",value:e.clinicExpensesTotal||0,color:G.danger,percentage:t.totalExpenses>0?((e.clinicExpensesTotal||0)/t.totalExpenses*100).toFixed(1):"0"}].filter(e=>e.value>0)},[u,G]),te=t.useMemo(()=>{if(!u)return[];const{revenue:e,calculations:t}=u;return[{name:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",value:e.totalRevenue,type:"revenue"},{name:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª",value:t.totalExpenses,type:"expenses"},{name:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­",value:t.isProfit?t.netProfit:-t.lossAmount,type:"profit"}]},[u]),se=t.useMemo(()=>{if(!u)return e.jsx("div",{children:"Loading charts..."});const{revenue:t,expenses:n,calculations:r,details:l,filterInfo:i}=u,c={tooltip:{backgroundColor:h?"#1f2937":"#ffffff",border:"1px solid "+(h?"#374151":"#e5e7eb"),borderRadius:"8px",color:h?"#f9fafb":"#111827"},grid:{strokeDasharray:"3 3",stroke:h?"#374151":"#e5e7eb",strokeOpacity:.5}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (",U.length," ÙØ¦Ø©)"]})]}),e.jsxs(b,{children:[0===U.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:U,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:h?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:U.map((t,s)=>e.jsx(He,{fill:t.color},`revenue-${s}`))}),e.jsx(Ge,{formatter:e=>[Number(e).toLocaleString("ar-EG",{style:"currency",currency:o}),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>`Ù†ÙˆØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: ${e}`,contentStyle:c.tooltip})]})}),U.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:U.map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(Pe,{amount:t.value,currency:o})," (",t.percentage,"%)"]})]},`revenue-legend-${s}`))})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ (",Q.length," ÙØ¦Ø©)"]})]}),e.jsxs(b,{children:[0===Q.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ke,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(We,{data:Q,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:h?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:Q.map((t,s)=>e.jsx(He,{fill:t.color},`expense-${s}`))}),e.jsx(Ge,{formatter:e=>[Number(e).toLocaleString("ar-EG",{style:"currency",currency:o}),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>`Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${e}`,contentStyle:c.tooltip})]})}),Q.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:Q.map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(Pe,{amount:t.value,currency:o})," (",t.percentage,"%)"]})]},`expense-legend-${s}`))})]})]})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsx(y,{children:"Ù…Ù‚Ø§Ø±Ù†Ø© Ø´Ø§Ù…Ù„Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©"})]}),e.jsxs(b,{children:[e.jsx(Ye,{width:"100%",height:400,children:e.jsxs(Ue,{data:te,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(Xe,{strokeDasharray:c.grid.strokeDasharray,stroke:c.grid.stroke,strokeOpacity:c.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"name",tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"}}),e.jsx(Je,{tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"},tickFormatter:e=>Math.abs(e)>=1e3?`${(e/1e3).toFixed(0)}k`:a(e)}),e.jsx(Ge,{formatter:e=>[Number(e).toLocaleString("ar-EG",{style:"currency",currency:o}),"Ø§Ù„Ù…Ø¨Ù„Øº"],labelFormatter:e=>e,contentStyle:c.tooltip}),e.jsx(Qe,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:100,isAnimationActive:!1,animationDuration:0,children:te.map((t,s)=>e.jsx(He,{fill:"revenue"===t.type?G.secondary:"expenses"===t.type?G.danger:t.value>=0?G.secondary:G.danger},`comparison-${s}`))})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"}),e.jsx("div",{className:"font-semibold text-green-700 dark:text-green-300",children:e.jsx(Pe,{amount:t.totalRevenue,currency:o})})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400",children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsx("div",{className:"font-semibold text-red-700 dark:text-red-300",children:e.jsx(Pe,{amount:r.totalExpenses,currency:o})})]}),e.jsxs("div",{className:"text-center p-3 rounded "+(r.isProfit?"bg-blue-50 dark:bg-blue-950/50":"bg-orange-50 dark:bg-orange-950/50"),children:[e.jsx("div",{className:"text-xs "+(r.isProfit?"text-blue-600 dark:text-blue-400":"text-orange-600 dark:text-orange-400"),children:r.isProfit?"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­":"ØµØ§ÙÙŠ Ø§Ù„Ø®Ø³Ø§Ø±Ø©"}),e.jsx("div",{className:"font-semibold "+(r.isProfit?"text-blue-700 dark:text-blue-300":"text-orange-700 dark:text-orange-300"),children:e.jsx(Pe,{amount:r.isProfit?r.netProfit:r.lossAmount,currency:o})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª"})]}),e.jsxs(y,{children:["ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (",s.length," Ù…Ø¯ÙÙˆØ¹Ø©)"]})]}),e.jsx(b,{children:(()=>{const t=[{name:"Ù…ÙƒØªÙ…Ù„Ø©",value:s.filter(e=>"completed"===e.status).length,color:G.secondary,amount:s.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"Ø¬Ø²Ø¦ÙŠØ©",value:s.filter(e=>"partial"===e.status).length,color:G.warning,amount:s.filter(e=>"partial"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"Ø¢Ø¬Ù„Ø©",value:s.filter(e=>"pending"===e.status).length,color:G.danger,amount:s.filter(e=>"pending"===e.status).reduce((e,t)=>e+(t.total_amount_due||t.amount||0),0)}].filter(e=>e.value>0);return 0===t.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…ØªØ§Ø­Ø©"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{width:"100%",height:300,children:e.jsxs(Ue,{data:t,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(Xe,{strokeDasharray:c.grid.strokeDasharray,stroke:c.grid.stroke,strokeOpacity:c.grid.strokeOpacity}),e.jsx(Ze,{dataKey:"name",tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"}}),e.jsx(Je,{tick:{fontSize:14,fill:h?"#9ca3af":"#6b7280"},axisLine:{stroke:h?"#4b5563":"#d1d5db"},tickLine:{stroke:h?"#4b5563":"#d1d5db"}}),e.jsx(Ge,{formatter:(e,t,s)=>[`${e} Ù…Ø¯ÙÙˆØ¹Ø©`,"Ø§Ù„Ø¹Ø¯Ø¯",Number(s?.payload?.amount??0).toLocaleString("ar-EG",{style:"currency",currency:o})],labelFormatter:e=>`Ø§Ù„Ø­Ø§Ù„Ø©: ${e}`,contentStyle:c.tooltip}),e.jsx(Qe,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:80,children:t.map((t,s)=>e.jsx(He,{fill:t.color},`status-${s}`))})]})}),e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 text-sm",children:t.map((t,s)=>e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.name}),e.jsxs("div",{className:"font-semibold",children:[t.value," Ù…Ø¯ÙÙˆØ¹Ø©"]}),e.jsx("div",{className:"text-xs",children:e.jsx(Pe,{amount:t.amount,currency:o})})]},`status-summary-${s}`))})]})})()})]}),e.jsxs(p,{dir:"rtl",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©"})]}),e.jsx(y,{children:"ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",children:e.jsxs("span",{className:r.isProfit?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[r.profitMargin.toFixed(1),"%"]})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ"}),e.jsx("span",{className:r.isProfit?"text-green-600":"text-red-600",children:r.isProfit?"Ø±Ø¨Ø­":"Ø®Ø³Ø§Ø±Ø©"})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-300 "+(r.isProfit?"bg-green-500":"bg-red-500"),style:{width:`${Math.min(Math.abs(r.profitMargin),100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsxs("div",{className:"font-semibold text-blue-700 dark:text-blue-300",children:[t.totalRevenue>0?(r.totalExpenses/t.totalRevenue*100).toFixed(1):"0","%"]})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400",children:"ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªÙƒÙ„ÙØ©"}),e.jsxs("div",{className:"font-semibold text-purple-700 dark:text-purple-300",children:[r.totalExpenses>0?(t.totalRevenue/r.totalExpenses*100).toFixed(0):"0","%"]})]}),e.jsxs("div",{className:"p-3 bg-teal-50 dark:bg-teal-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-teal-600 dark:text-teal-400",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©"}),e.jsx("div",{className:"font-semibold text-teal-700 dark:text-teal-300",children:e.jsx(Pe,{amount:s.length>0?t.totalRevenue/s.length:0,currency:o})})]}),e.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¢Ø¬Ù„Ø©"}),e.jsx("div",{className:"font-semibold text-orange-700 dark:text-orange-300",children:e.jsx(Pe,{amount:t.pendingAmount||0,currency:o})})]})]})]})})]})]})]})},[u,U,Q,te,G,o,h,s]);if(T||!u)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ut,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„..."})]})});const{revenue:ae,expenses:ne,calculations:le,details:ie,filterInfo:ce}=u;return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(ut,{className:"w-6 h-6"}),"Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["ØªØ­Ù„ÙŠÙ„ Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ ÙŠØ±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© - ",ce.dateRange]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:H,disabled:O||!u,children:[e.jsx(Ve,{className:"w-4 h-4 ml-2"}),O?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...":"ØªØµØ¯ÙŠØ± PDF"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:W,disabled:O||!u,children:[e.jsx($t,{className:"w-4 h-4 ml-2"}),O?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...":"ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„"]})]})]}),e.jsxs(p,{className:Se("blue"),children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-3",children:[e.jsx(Ft,{className:`w-5 h-5 ${Ee("blue")}`}),"ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±"]}),e.jsx(y,{children:"Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"period",children:"Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©"}),e.jsxs(k,{value:v,onValueChange:e=>N(e),children:[e.jsx(A,{children:e.jsx(C,{placeholder:"Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©"})}),e.jsx(S,{children:Object.entries(Mt).map(([t,s])=>e.jsx(P,{value:t,children:s},t))})]})]}),"custom"===v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"startDate",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"}),e.jsx($,{id:"startDate",type:"date",value:_,onChange:e=>D(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"endDate",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}),e.jsx($,{id:"endDate",type:"date",value:E,onChange:e=>M(e.target.value)})]})]})]})})]}),e.jsxs(p,{className:le.isProfit?Se("green"):Se("red"),children:[e.jsx(g,{children:e.jsx(j,{className:"flex items-center gap-3 text-xl",children:le.isProfit?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:`w-6 h-6 ${Ee("green")}`}),e.jsx("span",{children:"Ø±Ø¨Ø­"}),e.jsxs(m,{variant:"secondary",className:"bg-green-100 text-green-800",children:[le.profitMargin.toFixed(1),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:`w-6 h-6 ${Ee("red")}`}),e.jsx("span",{children:"Ø®Ø³Ø§Ø±Ø©"}),e.jsx(m,{variant:"destructive",children:"Ø®Ø³Ø§Ø±Ø©"})]})})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-3xl font-bold",children:le.isProfit?e.jsx(Pe,{amount:le.netProfit,currency:o}):e.jsx(Pe,{amount:le.lossAmount,currency:o})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:le.isProfit?`ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø¨Ù†Ø³Ø¨Ø© ${le.profitMargin.toFixed(1)}%`:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{className:Se("blue"),children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-3",children:[e.jsx(lt,{className:`w-5 h-5 ${Ee("blue")}`}),"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(Pe,{amount:ae.totalRevenue,currency:o})}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©"}),e.jsx(Pe,{amount:ae.completedPayments,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©"}),e.jsx(Pe,{amount:ae.partialPayments,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©"}),e.jsx(Pe,{amount:ae.remainingBalances,currency:o})]})]})]})]}),e.jsxs(p,{className:Se("red"),children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-3",children:[e.jsx(it,{className:`w-5 h-5 ${Ee("red")}`}),"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(Pe,{amount:le.totalExpenses,currency:o})}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±"}),e.jsx(Pe,{amount:ne.labOrdersTotal,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…Ø®Ø§Ø¨Ø±"}),e.jsx(Pe,{amount:ne.labOrdersRemaining,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"}),e.jsx(Pe,{amount:ne.clinicNeedsTotal,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª"}),e.jsx(Pe,{amount:ne.clinicNeedsRemaining,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"}),e.jsx(Pe,{amount:ne.inventoryExpenses,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©"}),e.jsx(Pe,{amount:ne.clinicExpensesTotal||0,currency:o})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(p,{className:Se("purple"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:`w-8 h-8 ${Ee("purple")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰"}),e.jsx("p",{className:"text-xl font-bold",children:ie.totalPatients})]})]})})}),e.jsx(p,{className:Se("orange"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:`w-8 h-8 ${Ee("orange")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"}),e.jsx("p",{className:"text-xl font-bold",children:ie.totalAppointments})]})]})})}),e.jsx(p,{className:Se("cyan"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(wt,{className:`w-8 h-8 ${Ee("cyan")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±"}),e.jsx("p",{className:"text-xl font-bold",children:ie.totalLabOrders})]})]})})}),e.jsx(p,{className:Se("indigo"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ht,{className:`w-8 h-8 ${Ee("indigo")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"}),e.jsx("p",{className:"text-xl font-bold",children:ie.totalClinicNeeds})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{className:"text-lg",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(Pe,{amount:ie.averageRevenuePerPatient,currency:o})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{className:"text-lg",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù…ÙˆØ¹Ø¯"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(Pe,{amount:ie.averageRevenuePerAppointment,currency:o})})})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{className:"text-lg",children:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: "}),e.jsx("span",{className:"font-medium",children:Mt[v]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: "}),e.jsx("span",{className:"font-medium",children:ce.dateRange})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: "}),e.jsx("span",{className:"font-medium",children:ce.totalRecords})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©: "}),e.jsx("span",{className:"font-medium",children:ce.filteredRecords})]})]})})]}),se]})}function is(){const{currency:s}=V(),{payments:a}=ee(),{expenses:n}=De(),{appointments:r}=J(),{items:l}=X(),{patients:i}=Y(),{needs:c,totalValue:d}=ke(),{labOrders:o}=Ce(),{toothTreatments:m}=ie(),{prescriptions:h}=xe(),{reportData:u,patientReports:f,appointmentReports:v,financialReports:N,inventoryReports:_,clinicNeedsReports:D,isLoading:E,isExporting:M,error:R,activeReportType:O,currentFilter:I,generateReport:L,generateAllReports:z,setActiveReportType:B,setFilter:q,exportReport:K,clearError:W}=fe(),[H,G]=t.useState("overview"),[U,Q]=t.useState("this_month"),[te,se]=t.useState(""),[le,ce]=t.useState(""),[oe,me]=t.useState(!1),je=e=>{if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)||!isFinite(t)?0:t}if("object"==typeof e&&null!==e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:t}return 0},ye=(e,t)=>Array.isArray(e)?e.reduce((e,s)=>e+je(t(s)),0):0,ve=(e,t)=>{if("all"===U)return e;const s=new Date;let a,n=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59);switch(U){case"today":a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0);break;case"this_week":const t=s.getDay();a=new Date(s.getTime()-24*t*60*60*1e3),a.setHours(0,0,0,0);break;case"this_month":a=new Date(s.getFullYear(),s.getMonth(),1,0,0,0);break;case"this_year":a=new Date(s.getFullYear(),0,1,0,0,0);break;case"last_week":const r=new Date(s.getTime()-24*s.getDay()*60*60*1e3);r.setHours(23,59,59,999),n=r,a=new Date(r.getTime()-5184e5),a.setHours(0,0,0,0);break;case"last_month":const l=0===s.getMonth()?11:s.getMonth()-1,i=0===s.getMonth()?s.getFullYear()-1:s.getFullYear();a=new Date(i,l,1,0,0,0),n=new Date(s.getFullYear(),s.getMonth(),0,23,59,59);break;case"last_year":a=new Date(s.getFullYear()-1,0,1,0,0,0),n=new Date(s.getFullYear()-1,11,31,23,59,59);break;case"last_30_days":a=new Date(s.getTime()-2592e6),a.setHours(0,0,0,0);break;case"last_90_days":a=new Date(s.getTime()-7776e6),a.setHours(0,0,0,0);break;case"custom":if(!te||!le)return e;a=new Date(te),n=new Date(le),n.setHours(23,59,59,999);break;default:return e}return e.filter(e=>{const s=new Date(e[t]);return s>=a&&s<=n})},Ne=ve(r,"start_time"),be=ve(a,"payment_date"),we=ve(l,"created_at"),$e=ve(c,"created_at"),Fe=ve(n,"payment_date"),Me=ye(be.filter(e=>{const t=e.status?.toLowerCase();return"pending"===t||"Ø¢Ø¬Ù„"===t||"unpaid"===t||!e.status&&je(e.amount)>0&&!e.amount_paid}),e=>{let t=je(e.amount);if(e.tooth_treatment_id){t=je(e.treatment_total_cost)||je(e.total_amount_due)}else 0===t&&je(e.total_amount_due)>0?t=je(e.total_amount_due):0===t&&je(e.remaining_balance)>0&&(t=je(e.remaining_balance));return t});t.useEffect(()=>{console.log("ğŸ”„ Loading initial reports..."),W(),z();(async()=>{try{const{loadAppointments:e}=J.getState(),{loadPayments:t}=ee.getState(),{loadItems:s}=X.getState(),{loadPatients:a}=Y.getState(),{loadNeeds:n}=ke.getState(),{loadLabOrders:r}=Ce.getState(),{loadToothTreatments:l}=ie.getState(),{loadPrescriptions:i}=xe.getState();console.log("ğŸ”„ Loading all data for comprehensive reports..."),await Promise.all([e(),t(),s(),a(),n(),r(),l(),i()]),console.log("âœ… All data loaded successfully for reports")}catch(e){console.error("âŒ Error loading data for reports:",e)}})()},[z,W]),t.useEffect(()=>{if(R){console.error("âŒ Reports error:",R);const e=new CustomEvent("showToast",{detail:{title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",description:R,type:"error"}});window.dispatchEvent(e)}},[R]);return _e(["overview"]),t.useEffect(()=>{const{startAutoRefresh:e,stopAutoRefresh:t}=fe.getState();return e(1),()=>{t()}},[]),t.useEffect(()=>{B(H)},[H,B]),e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª"}),e.jsx(Rt,{isActive:!0})]}),e.jsx("p",{className:"text-muted-foreground",children:"ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ÙØµÙ„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© - ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ"})]})}),e.jsx(Ot,{}),R&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 text-red-600 ml-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:R})]}),e.jsx(F,{variant:"ghost",size:"sm",onClick:W,className:"mr-auto",children:"Ø¥ØºÙ„Ø§Ù‚"})]})}),E&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-8 w-8 animate-spin text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±..."})]})}),e.jsxs(he,{value:H,onValueChange:async e=>{G(e),B(e);try{if("treatments"===e){const{loadToothTreatments:e}=ie.getState(),{loadPatients:t}=Y.getState();await Promise.all([e(),t()])}else if("clinicNeeds"===e){const{loadNeeds:e}=ke.getState();await e()}else if("inventory"===e){const{loadItems:e}=X.getState();await e()}else if("financial"===e){const{loadPayments:e}=ee.getState(),{loadLabOrders:t}=Ce.getState();await Promise.all([e(),t()])}else if("profitLoss"===e){const{loadPayments:e}=ee.getState(),{loadExpenses:t}=De.getState(),{loadLabOrders:s}=Ce.getState(),{loadNeeds:a}=ke.getState(),{loadItems:n}=X.getState();await Promise.all([e(),t(),s(),a(),n()])}else if("patients"===e){const{loadPatients:e}=Y.getState();await e()}else if("appointments"===e){const{loadAppointments:e}=J.getState();await e()}else if("expenses"===e){const{loadExpenses:e}=De.getState();await e()}"overview"!==e&&await L(e)}catch(t){console.error(`âŒ Error loading data for ${e} tab:`,t)}},className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-6",children:[e.jsxs(pe,{value:"overview",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„"})]}),e.jsxs(pe,{value:"profitLoss",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„Ù…Ø§Ù„ÙŠØ©"})]}),e.jsxs(pe,{value:"patients",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„Ù…Ø±Ø¶Ù‰"})]}),e.jsxs(pe,{value:"appointments",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"})]}),e.jsxs(pe,{value:"expenses",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]}),e.jsxs(pe,{value:"treatments",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª"})]})]}),e.jsx(ge,{value:"overview",className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(rt,{className:"w-6 h-6"}),"Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©"})]}),e.jsxs(F,{variant:"outline",onClick:async()=>{me(!0);try{console.log("ğŸ”„ Loading fresh data for comprehensive export...");const{loadAppointments:e}=J.getState(),{loadPayments:t}=ee.getState(),{loadExpenses:s}=De.getState(),{loadItems:d}=X.getState(),{loadPatients:x}=Y.getState(),{loadNeeds:u}=ke.getState(),{loadLabOrders:p}=Ce.getState(),{loadToothTreatments:g}=ie.getState(),{loadPrescriptions:f}=xe.getState();await Promise.all([e(),t(),s(),d(),x(),u(),p(),g(),f()]),console.log("âœ… All data loaded, starting filtered export..."),await Tt.exportComprehensiveReport({patients:i,appointments:r,payments:a,inventory:l,treatments:m||[],prescriptions:h||[],labOrders:o||[],clinicNeeds:c||[],expenses:n||[],timePeriod:U,customStartDate:"custom"===U?te:void 0,customEndDate:"custom"===U?le:void 0});let j="ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ÙØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!";j+=` (${Mt[U]})`;j+=` - ${r.length+a.length+(m?.length||0)+(h?.length||0)+(o?.length||0)+(c?.length||0)} Ø³Ø¬Ù„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ`,ct.exportSuccess(j)}catch(e){console.error("Error exporting comprehensive report:",e),ct.exportError("ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„")}finally{me(!1)}},disabled:oe,className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),oe?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...":"ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±"]})]}),e.jsxs(p,{className:Se("blue"),children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-3",children:[e.jsx(Ft,{className:`w-5 h-5 ${Ee("blue")}`}),"ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±"]}),e.jsx(y,{children:"Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"period",children:"Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©"}),e.jsxs(k,{value:U,onValueChange:e=>Q(e),children:[e.jsx(A,{children:e.jsx(C,{placeholder:"Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©"})}),e.jsx(S,{children:Object.entries(Mt).map(([t,s])=>e.jsx(P,{value:t,children:s},t))})]})]}),"custom"===U&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"startDate",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"}),e.jsx($,{id:"startDate",type:"date",value:te,onChange:e=>se(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"endDate",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}),e.jsx($,{id:"endDate",type:"date",value:le,onChange:e=>ce(e.target.value)})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(p,{className:Se("blue"),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${Se("blue")}`,children:e.jsx(Be,{className:`w-6 h-6 ${Ee("blue")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰"}),e.jsx("p",{className:"text-2xl font-bold",children:i.length})]})]})})}),e.jsx(p,{className:Se("purple"),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${Se("purple")}`,children:e.jsx(Z,{className:`w-6 h-6 ${Ee("purple")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("p",{className:"text-2xl font-bold",children:Ne.length})]})]})})}),e.jsx(p,{className:Se("green"),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${Se("green")}`,children:e.jsx(ne,{className:`w-6 h-6 ${Ee("green")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("p",{className:"text-xl font-bold",children:e.jsx(Pe,{amount:ye(be,e=>je(e.amount)),currency:s})})]})]})})}),e.jsx(p,{className:Se("orange"),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${Se("orange")}`,children:e.jsx(ht,{className:`w-6 h-6 ${Ee("orange")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("p",{className:"text-2xl font-bold",children:we.length})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5 text-green-500"}),"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50/80 dark:bg-green-950/50 border border-green-200/50 dark:border-green-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("span",{className:"text-lg font-bold text-green-700 dark:text-green-100",children:e.jsx(Pe,{amount:ye(be,e=>je(e.amount)),currency:s})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-yellow-50/80 dark:bg-yellow-950/50 border border-yellow-200/50 dark:border-yellow-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("span",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-100",children:e.jsx(Pe,{amount:je(Me),currency:s})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("span",{className:"text-lg font-bold text-orange-700 dark:text-orange-100",children:e.jsx(Pe,{amount:ye(be.filter(e=>"partial"===e.status),e=>{const t=je(e.total_amount_due)||je(e.amount),s=je(e.amount_paid)||je(e.amount);return Math.max(0,t-s)}),currency:s})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50/80 dark:bg-red-950/50 border border-red-200/50 dark:border-red-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("span",{className:"text-lg font-bold text-red-700 dark:text-red-100",children:e.jsx(Pe,{amount:ye(Fe,e=>je(e.amount)),currency:s})})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-500"}),"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©"]})}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50/80 dark:bg-blue-950/50 border border-blue-200/50 dark:border-blue-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-100",children:Ne.filter(e=>"completed"===e.status).length}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-200 mt-1 font-medium",children:"Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ÙƒØªÙ…Ù„Ø© Ù…ÙÙ„ØªØ±Ø©"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50/80 dark:bg-purple-950/50 border border-purple-200/50 dark:border-purple-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-100",children:Ne.filter(e=>"scheduled"===e.status).length}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-200 mt-1 font-medium",children:"Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù…ÙÙ„ØªØ±Ø©"})]}),e.jsxs("div",{className:"text-center p-4 bg-emerald-50/80 dark:bg-emerald-950/50 border border-emerald-200/50 dark:border-emerald-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-100",children:$e.length}),e.jsx("div",{className:"text-xs text-emerald-600 dark:text-emerald-200 mt-1 font-medium",children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-100",children:Fe.length}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-200 mt-1 font-medium",children:"Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙÙ„ØªØ±Ø©"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(p,{className:Se("cyan"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:`w-6 h-6 ${Ee("cyan")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª"}),e.jsx("p",{className:"text-xl font-bold",children:m?.length||0})]})]})})}),e.jsx(p,{className:Se("indigo"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:`w-6 h-6 ${Ee("indigo")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ù„ÙˆØµÙØ§Øª"}),e.jsx("p",{className:"text-xl font-bold",children:h?.length||0})]})]})})}),e.jsx(p,{className:Se("purple"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(wt,{className:`w-6 h-6 ${Ee("purple")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø¨Ø±"}),e.jsx("p",{className:"text-xl font-bold",children:o?.length||0})]})]})})}),e.jsx(p,{className:Se("gray"),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:`w-6 h-6 ${Ee("gray")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©"}),e.jsx("p",{className:"text-xl font-bold",children:$e.length})]})]})})})]})]})}),e.jsx(ge,{value:"patients",dir:"rtl",children:e.jsx(Et,{children:e.jsx(It,{})})}),e.jsx(ge,{value:"appointments",dir:"rtl",children:e.jsx(Et,{children:e.jsx(zt,{})})}),e.jsx(ge,{value:"financial",dir:"rtl",children:e.jsx(Et,{children:e.jsx(Xt,{})})}),e.jsx(ge,{value:"treatments",dir:"rtl",children:e.jsx(Et,{children:e.jsx(Qt,{})})}),e.jsx(ge,{value:"inventory",dir:"rtl",children:e.jsx(Et,{children:e.jsx(Lt,{})})}),e.jsx(ge,{value:"clinicNeeds",dir:"rtl",children:e.jsx(Et,{children:e.jsx(as,{})})}),e.jsx(ge,{value:"expenses",dir:"rtl",children:e.jsx(Et,{children:e.jsx(ns,{})})}),e.jsx(ge,{value:"profitLoss",dir:"rtl",children:e.jsx(Et,{children:e.jsx(ls,{})})})]})]})}export{is as default};
