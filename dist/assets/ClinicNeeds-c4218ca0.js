import{j as e}from"./ui-cacc1eea.js";import{r as s}from"./vendor-696af5bd.js";import{u as a,C as r}from"./clinicNeedsStore-c3c0792a.js";import{aj as l,u as i,D as n,f as t,g as c,h as d,i as o,L as x,I as h,S as m,m as j,n as p,o as u,p as g,T as v,x as N,w as y,F as f,K as b,B as w,bp as C,a1 as _,$ as S,a0 as k,C as F,j as q,k as E,ah as D,l as O,ag as V,Q as P,s as $,v as L}from"./index-3a8dc84c.js";import{D as T,a as z,b as I,c as Q,d as B}from"./dropdown-menu-0651433f.js";import{g as R,a as A}from"./cardStyles-c77ef46a.js";import{T as M,a as H,b as J,c as K,d as G,e as U}from"./table-20957d0a.js";import{P as W}from"./package-557fa287.js";import{P as X}from"./pen-square-6c634feb.js";import{T as Y,D as Z}from"./upload-4df8a268.js";import{C as ee,a as se}from"./chevrons-right-9b995d31.js";import{C as ae}from"./chevron-left-343e35ff.js";import{F as re}from"./filter-f006659c.js";import{E as le}from"./exportService-1536567b.js";import{P as ie}from"./pdfService-844f6d4e.js";import{n as ne}from"./notificationService-09cb27cc.js";import{F as te}from"./file-text-861b9f90.js";import{P as ce}from"./plus-1eab3b5b.js";import"./utils-ec524415.js";import"./pdf-991f41f6.js";import"./charts-b4389b44.js";import"./index-a46c293c.js";import"./excel-37615a09.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=l("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),oe=({open:r,onOpenChange:l,editingNeed:f})=>{const{createNeed:b,updateNeed:w,isLoading:C,categories:_,suppliers:S,getNextSerialNumber:k}=a(),{toast:F}=i(),[q,E]=s.useState({need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),[D,O]=s.useState({});s.useEffect(()=>{E(f?{need_name:f.need_name,quantity:f.quantity,price:f.price,description:f.description||"",category:f.category||"",priority:f.priority,status:f.status,supplier:f.supplier||"",notes:f.notes||""}:{need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),O({})},[f,r]);const V=(e,s)=>{E(a=>({...a,[e]:s})),D[e]&&O(s=>({...s,[e]:""}))};return e.jsx(n,{open:r,onOpenChange:l,children:e.jsxs(t,{className:"sm:max-w-[600px]",dir:"rtl",children:[e.jsxs(c,{children:[e.jsx(d,{children:f?"تعديل الاحتياج":"إضافة احتياج جديد"}),e.jsx(o,{children:f?"قم بتعديل بيانات الاحتياج":"أدخل بيانات الاحتياج الجديد للعيادة"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return q.need_name.trim()||(e.need_name="اسم الاحتياج مطلوب"),q.quantity<=0&&(e.quantity="الكمية يجب أن تكون أكبر من صفر"),q.price<0&&(e.price="السعر لا يمكن أن يكون سالباً"),O(e),0===Object.keys(e).length})())try{if(f){const e={...q,serial_number:f.serial_number};await w(f.id,e),F({title:"تم التحديث بنجاح",description:"تم تحديث الاحتياج بنجاح"})}else{const e={...q,serial_number:k()};await b(e),F({title:"تم الإنشاء بنجاح",description:"تم إنشاء الاحتياج الجديد بنجاح"})}l(!1)}catch(s){F({title:"خطأ",description:"حدث خطأ أثناء حفظ الاحتياج",variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"need_name",children:"اسم الاحتياج *"}),e.jsx(h,{id:"need_name",value:q.need_name,onChange:e=>V("need_name",e.target.value),placeholder:"أدخل اسم الاحتياج",className:D.need_name?"border-red-500":""}),D.need_name&&e.jsx("p",{className:"text-sm text-red-500",children:D.need_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"quantity",children:"الكمية"}),e.jsx(h,{id:"quantity",type:"number",min:"1",value:q.quantity,onChange:e=>{const s=e.target.value;V("quantity",""===s?1:parseInt(s)||1)},onBlur:e=>{const s=parseInt(e.target.value)||1;V("quantity",s)},className:D.quantity?"border-red-500":""}),D.quantity&&e.jsx("p",{className:"text-sm text-red-500",children:D.quantity})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"price",children:"السعر"}),e.jsx(h,{id:"price",type:"number",min:"0",step:"0.1",value:q.price,onChange:e=>{const s=e.target.value;V("price",""===s?0:parseFloat(s)||0)},onBlur:e=>{const s=parseFloat(e.target.value)||0;V("price",s)},className:D.price?"border-red-500":""}),D.price&&e.jsx("p",{className:"text-sm text-red-500",children:D.price})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"الفئة"}),e.jsxs(m,{value:q.category,onValueChange:e=>V("category",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"اختر الفئة"})}),e.jsxs(u,{children:[e.jsx(g,{value:"أدوات طبية",children:"أدوات طبية"}),e.jsx(g,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),e.jsx(g,{value:"أجهزة",children:"أجهزة"}),e.jsx(g,{value:"أثاث",children:"أثاث"}),e.jsx(g,{value:"مواد تنظيف",children:"مواد تنظيف"}),e.jsx(g,{value:"أخرى",children:"أخرى"}),_.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(s=>e.jsx(g,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"priority",children:"الأولوية"}),e.jsxs(m,{value:q.priority,onValueChange:e=>V("priority",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"اختر الأولوية"})}),e.jsxs(u,{children:[e.jsx(g,{value:"urgent",children:"عاجل"}),e.jsx(g,{value:"high",children:"عالي"}),e.jsx(g,{value:"medium",children:"متوسط"}),e.jsx(g,{value:"low",children:"منخفض"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"status",children:"الحالة"}),e.jsxs(m,{value:q.status,onValueChange:e=>V("status",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"اختر الحالة"})}),e.jsxs(u,{children:[e.jsx(g,{value:"pending",children:"آجل"}),e.jsx(g,{value:"ordered",children:"مطلوب"}),e.jsx(g,{value:"received",children:"مستلم"}),e.jsx(g,{value:"cancelled",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"supplier",children:"المورد"}),e.jsx(h,{id:"supplier",value:q.supplier,onChange:e=>V("supplier",e.target.value),placeholder:"اسم المورد (اختياري)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"الوصف"}),e.jsx(v,{id:"description",value:q.description,onChange:e=>V("description",e.target.value),placeholder:"وصف تفصيلي للاحتياج (اختياري)",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"notes",children:"ملاحظات"}),e.jsx(v,{id:"notes",value:q.notes,onChange:e=>V("notes",e.target.value),placeholder:"ملاحظات إضافية (اختياري)",rows:2})]}),e.jsxs(N,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>l(!1),children:"إلغاء"}),e.jsx(y,{type:"submit",disabled:C,children:C?"جاري الحفظ...":f?"تحديث":"إضافة"})]})]})]})})},xe=({open:s,onOpenChange:r,need:l})=>{const{deleteNeed:x,isLoading:h}=a(),{toast:m}=i();return l?e.jsx(n,{open:s,onOpenChange:r,children:e.jsxs(t,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(f,{className:"w-5 h-5"}),"تأكيد الحذف"]}),e.jsx(o,{children:"هل أنت متأكد من حذف هذا الاحتياج؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"#:"}),e.jsx("span",{children:l.serial_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم الاحتياج:"}),e.jsx("span",{children:l.need_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"الكمية:"}),e.jsx("span",{children:l.quantity})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"السعر:"}),e.jsx("span",{children:b(l.price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"الإجمالي:"}),e.jsx("span",{className:"font-bold",children:b(l.price*l.quantity)})]})]})}),e.jsxs(N,{children:[e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"إلغاء"}),e.jsx(y,{variant:"destructive",onClick:async()=>{if(l)try{await x(l.id),m({title:"تم الحذف بنجاح",description:"تم حذف الاحتياج بنجاح"}),r(!1)}catch(e){m({title:"خطأ",description:"حدث خطأ أثناء حذف الاحتياج",variant:"destructive"})}},disabled:h,children:h?"جاري الحذف...":"حذف"})]})]})}):null},he=({needs:a,onEdit:r,onDelete:l,onReceiveAndDelete:i,isLoading:n=!1})=>{const[t,c]=s.useState(1),[d,o]=s.useState(10),x=a.length,h=Math.ceil(x/d),v=(t-1)*d,N=a.slice(v,v+d),F=e=>{c(e)},q=s=>{const a={pending:{label:"آجل",variant:"secondary",icon:S},ordered:{label:"مطلوب",variant:"default",icon:de},received:{label:"مستلم",variant:"default",icon:k},cancelled:{label:"ملغي",variant:"destructive",icon:f}}[s];if(!a)return null;const r=a.icon;return e.jsxs(w,{variant:a.variant,className:"flex items-center gap-1 w-fit",children:[e.jsx(r,{className:"w-3 h-3"}),a.label]})},E=s=>{const a={low:{label:"منخفض",variant:"secondary",color:"bg-gray-100 text-gray-800"},medium:{label:"متوسط",variant:"default",color:"bg-blue-100 text-blue-800"},high:{label:"عالي",variant:"default",color:"bg-orange-100 text-orange-800"},urgent:{label:"عاجل",variant:"destructive",color:"bg-red-100 text-red-800"}}[s];return a?e.jsx(w,{variant:a.variant,className:`${a.color} w-fit`,children:a.label}):null};return n?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===a.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد احتياجات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على أي احتياجات مطابقة للبحث"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(M,{children:[e.jsx(H,{children:e.jsxs(J,{children:[e.jsx(K,{className:"text-center",children:"#"}),e.jsx(K,{className:"text-right",children:"اسم الاحتياج"}),e.jsx(K,{className:"text-right",children:"الكمية"}),e.jsx(K,{className:"text-right",children:"السعر"}),e.jsx(K,{className:"text-right",children:"الإجمالي"}),e.jsx(K,{className:"text-right",children:"الفئة"}),e.jsx(K,{className:"text-right",children:"الأولوية"}),e.jsx(K,{className:"text-right",children:"الحالة"}),e.jsx(K,{className:"text-right",children:"المورد"}),e.jsx(K,{className:"text-right",children:"الإجراءات"})]})}),e.jsx(G,{children:N.map((s,a)=>e.jsxs(J,{className:"hover:bg-muted/50",children:[e.jsx(U,{className:"font-medium text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:v+a+1})}),e.jsx(U,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.need_name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1 max-w-xs truncate",children:s.description})]})}),e.jsx(U,{children:e.jsx("span",{className:"font-medium",children:s.quantity})}),e.jsx(U,{children:e.jsx("span",{className:"font-medium",children:b(s.price)})}),e.jsx(U,{children:e.jsx("span",{className:"font-bold text-primary",children:b(s.price*s.quantity)})}),e.jsx(U,{children:s.category&&e.jsx(w,{variant:"outline",className:"w-fit",children:s.category})}),e.jsx(U,{children:E(s.priority)}),e.jsx(U,{children:q(s.status)}),e.jsx(U,{children:s.supplier&&e.jsx("span",{className:"text-sm",children:s.supplier})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-2",children:["received"!==s.status&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>i(s),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"تأكيد الاستلام وتحديث الحالة إلى مستلم",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>r(s),className:"h-8 w-8 p-0",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>l(s),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},s.id))})]}),h>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(m,{value:`${d}`,onValueChange:e=>{o(parseInt(e)),c(1)},children:[e.jsx(j,{className:"h-8 w-[70px]",children:e.jsx(p,{placeholder:d})}),e.jsx(u,{side:"top",children:[5,10,20,30,50].map(s=>e.jsx(g,{value:`${s}`,children:s},s))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",t," من ",h]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(y,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>F(1),disabled:1===t,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(ee,{className:"h-4 w-4"})]}),e.jsxs(y,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>F(t-1),disabled:1===t,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(_,{className:"h-4 w-4"})]}),e.jsxs(y,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>F(t+1),disabled:t===h,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(ae,{className:"h-4 w-4"})]}),e.jsxs(y,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>F(h),disabled:t===h,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(se,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",v+1," إلى ",Math.min(v+d,x)," من ",x," نتيجة"]})]})]})},me=({searchQuery:s,onSearchChange:a,filters:r,onFilterChange:l,categories:i,suppliers:n,onClearFilters:t})=>{const c=s||r.category||r.priority||r.status;return e.jsxs(F,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"البحث والتصفية"]}),c&&e.jsxs(y,{variant:"outline",size:"sm",onClick:t,className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),"مسح الفلاتر"]})]})}),e.jsxs(O,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(h,{placeholder:"البحث في الاحتياجات...",value:s,onChange:e=>a(e.target.value),className:"pr-10"})]}),e.jsxs(m,{value:r.category||"all",onValueChange:e=>l("category",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"الفئة"})}),e.jsxs(u,{children:[e.jsx(g,{value:"all",children:"جميع الفئات"}),e.jsx(g,{value:"أدوات طبية",children:"أدوات طبية"}),e.jsx(g,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),e.jsx(g,{value:"أجهزة",children:"أجهزة"}),e.jsx(g,{value:"أثاث",children:"أثاث"}),e.jsx(g,{value:"مواد تنظيف",children:"مواد تنظيف"}),e.jsx(g,{value:"أخرى",children:"أخرى"}),i.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(s=>e.jsx(g,{value:s,children:s},s))]})]}),e.jsxs(m,{value:r.priority||"all",onValueChange:e=>l("priority",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"الأولوية"})}),e.jsxs(u,{children:[e.jsx(g,{value:"all",children:"جميع الأولويات"}),e.jsx(g,{value:"urgent",children:"عاجل"}),e.jsx(g,{value:"high",children:"عالي"}),e.jsx(g,{value:"medium",children:"متوسط"}),e.jsx(g,{value:"low",children:"منخفض"})]})]}),e.jsxs(m,{value:r.status||"all",onValueChange:e=>l("status",e),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"الحالة"})}),e.jsxs(u,{children:[e.jsx(g,{value:"all",children:"جميع الحالات"}),e.jsx(g,{value:"pending",children:"آجل"}),e.jsx(g,{value:"ordered",children:"مطلوب"}),e.jsx(g,{value:"received",children:"مستلم"}),e.jsx(g,{value:"cancelled",children:"ملغي"})]})]})]}),c&&e.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["الفلاتر النشطة:",s&&e.jsxs("span",{className:"inline-block bg-primary/10 text-primary px-2 py-1 rounded mr-2 text-xs",children:['البحث: "',s,'"']}),r.category&&"all"!==r.category&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 text-xs",children:["الفئة: ",r.category]}),r.priority&&"all"!==r.priority&&e.jsxs("span",{className:"inline-block bg-orange-100 text-orange-800 px-2 py-1 rounded mr-2 text-xs",children:["الأولوية: ",je(r.priority)]}),r.status&&"all"!==r.status&&e.jsxs("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2 text-xs",children:["الحالة: ",pe(r.status)]})]})})]})]})},je=e=>({low:"منخفض",medium:"متوسط",high:"عالي",urgent:"عاجل"}[e]||e),pe=e=>({pending:"آجل",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e),ue=()=>{const{needs:l,filteredNeeds:n,isLoading:t,error:c,searchQuery:d,filters:o,categories:x,suppliers:h,totalNeeds:m,totalValue:j,pendingCount:p,orderedCount:u,receivedCount:g,urgentCount:v,loadNeeds:N,deleteNeed:w,updateNeed:C,setSearchQuery:_,setFilters:k,clearError:D}=a(),{settings:V}=P(),{toast:M}=i(),[H,J]=s.useState(!1),[K,G]=s.useState(!1),[U,X]=s.useState(null),[Y,ee]=s.useState(null);s.useEffect(()=>{N()},[N]);const se=({title:s,value:a,icon:r,color:l="blue"})=>e.jsx(F,{className:R(l),children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a})]}),e.jsx("div",{className:`text-2xl ${A(l)}`,children:r})]})})});return c?e.jsx("div",{className:"p-6",children:e.jsx(F,{children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsxs("p",{children:["حدث خطأ: ",c]}),e.jsx(y,{onClick:D,className:"mt-2",children:"إعادة المحاولة"})]})})})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(r,{className:"w-8 h-8 text-primary"}),"احتياجات العيادة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة احتياجات ومتطلبات العيادة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(y,{variant:"outline",children:[e.jsx(Z,{className:"w-4 h-4 ml-2"}),"تصدير"]})}),e.jsxs(I,{align:"end",className:"w-48",children:[e.jsxs(Q,{onClick:async()=>{if(0!==n.length)try{await le.exportClinicNeedsToCSV(n,`احتياجات_العيادة_${(new Date).toISOString().split("T")[0]}`),ne.exportSuccess(`تم تصدير ${n.length} احتياج بنجاح إلى ملف Excel!`)}catch(e){console.error("Error exporting clinic needs (Excel):",e),ne.exportError("فشل في تصدير بيانات الاحتياجات (Excel)")}else ne.noDataToExport("لا توجد بيانات احتياجات للتصدير")},className:"arabic-enhanced",children:[e.jsx(Z,{className:"w-4 h-4 ml-2"}),"تصدير Excel"]}),e.jsx(B,{}),e.jsxs(Q,{onClick:async()=>{if(0!==n.length)try{const e={totalNeeds:m,totalCost:j,pendingNeeds:p,orderedNeeds:u,receivedNeeds:g,totalRemaining:j-(g>0?n.filter(e=>"received"===e.status).reduce((e,s)=>e+s.quantity*s.price,0):0),clinicNeedsList:n,filterInfo:JSON.stringify(o),dataCount:n.length};await ie.exportClinicNeedsReport(e,V),ne.exportSuccess("تم تصدير احتياجات العيادة بنجاح إلى ملف PDF!")}catch(e){console.error("Error exporting clinic needs (PDF):",e),ne.exportError("فشل في تصدير بيانات الاحتياجات (PDF)")}else ne.noDataToExport("لا توجد بيانات احتياجات للتصدير")},className:"arabic-enhanced",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),e.jsxs(y,{onClick:()=>{X(null),J(!0)},className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"إضافة احتياج جديد"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(se,{title:"إجمالي المواد",value:m,icon:e.jsx(W,{}),color:"blue"}),e.jsx(se,{title:"إجمالي السعر",value:b(j),icon:e.jsx($,{}),color:"green"}),e.jsx(se,{title:"آجل",value:p,icon:e.jsx(S,{}),color:"yellow"}),e.jsx(se,{title:"عاجل",value:v,icon:e.jsx(f,{}),color:"red"})]}),e.jsx(me,{searchQuery:d,onSearchChange:_,filters:o,onFilterChange:(e,s)=>{k({...o,[e]:"all"===s?void 0:s})},categories:x,suppliers:h,onClearFilters:()=>{_(""),k({})}}),e.jsxs(F,{children:[e.jsxs(q,{children:[e.jsx(E,{children:"قائمة الاحتياجات"}),e.jsx(L,{children:"عرض جميع احتياجات العيادة مع إمكانية التعديل والحذف"})]}),e.jsx(O,{children:e.jsx(he,{needs:n,onEdit:e=>{X(e),J(!0)},onDelete:e=>{ee(e),G(!0)},onReceiveAndDelete:async e=>{try{const s={serial_number:e.serial_number,need_name:e.need_name,quantity:e.quantity,price:e.price,description:e.description,category:e.category,priority:e.priority,status:"received",supplier:e.supplier,notes:e.notes};await C(e.id,s),M({title:"تم تأكيد الاستلام",description:`تم تأكيد استلام "${e.need_name}" وتحديث حالته إلى مستلم`})}catch(s){M({title:"خطأ",description:"حدث خطأ أثناء تأكيد الاستلام",variant:"destructive"})}},isLoading:t})})]}),e.jsx(oe,{open:H,onOpenChange:()=>{J(!1),X(null)},editingNeed:U}),e.jsx(xe,{open:K,onOpenChange:()=>{G(!1),ee(null)},need:Y})]})};export{ue as default};
