import{_ as e}from"./pdf-991f41f6.js";import{j as t}from"./ui-cacc1eea.js";import{r as s}from"./vendor-696af5bd.js";import{aj as a,c as r,a as n,d as i,u as l,Q as c,aX as d,D as m,f as o,g as x,h,i as p,w as u,U as g,_ as j,M as f,s as N,C as y,j as b,k as v,l as _,B as w,r as P,F as T,b6 as D,K as S,b7 as I}from"./index-3a8dc84c.js";import{T as k,a as C,b as A,c as E}from"./tabs-952e3ebd.js";import{P as O}from"./pdfService-844f6d4e.js";import{P as z}from"./printer-5ab76652.js";import{F as B}from"./file-text-861b9f90.js";import{P as M}from"./pen-square-6c634feb.js";import{P as L}from"./phone-a8e6eab2.js";import{M as F}from"./mail-8c3a07ed.js";import{M as H}from"./map-pin-a7696fe0.js";import{P as $}from"./plus-1eab3b5b.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=a("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);class V{static async getPatientIntegratedData(e){try{const t=(await(window.electronAPI?.patients?.getAll?.())||[]).find(t=>t.id===e);if(!t)throw new Error("المريض غير موجود");const[s,a,r,n,i,l,c]=await Promise.all([this.getPatientAppointments(e),this.getPatientTreatments(e),this.getPatientPayments(e),this.getPatientPrescriptions(e),this.getPatientLabOrders(e),this.getPatientTimeline(e),this.getPatientTreatmentPlans(e)]);return{patient:t,appointments:s,treatments:a,payments:r,prescriptions:n,labOrders:i,timeline:l,treatmentPlans:c,stats:this.calculatePatientStats({appointments:s,treatments:a,payments:r,prescriptions:n,labOrders:i})}}catch(t){return console.error("خطأ في جلب البيانات المتكاملة للمريض:",t),null}}static async getPatientIntegratedDataOptimized(e){try{return this.getPatientIntegratedDataWithCaching(e)}catch(t){return console.error("خطأ في جلب البيانات المتكاملة المحسنة للمريض:",t),this.getPatientIntegratedData(e)}}static patientDataCache=new Map;static CACHE_TTL_MS=3e5;static async getPatientIntegratedDataWithCaching(e){const t=this.patientDataCache.get(e);if(t&&Date.now()-t.timestamp<this.CACHE_TTL_MS)return t.data;const s=await this.getPatientIntegratedData(e);return this.patientDataCache.set(e,{data:s,timestamp:Date.now()}),s}static clearPatientDataCache(e){e?this.patientDataCache.delete(e):this.patientDataCache.clear()}static async getPatientAppointments(e){try{return await(window.electronAPI?.appointments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب مواعيد المريض:",t),[]}}static async getPatientTreatments(e){try{return await(window.electronAPI?.toothTreatments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب علاجات المريض:",t),[]}}static async getPatientPayments(e){try{return await(window.electronAPI?.payments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب دفعات المريض:",t),[]}}static async getPatientPrescriptions(e){try{return await(window.electronAPI?.prescriptions?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب وصفات المريض:",t),[]}}static async getPatientLabOrders(e){try{return await(window.electronAPI?.labOrders?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب طلبات المختبر للمريض:",t),[]}}static async getPatientTimeline(e){try{return await(window.electronAPI?.patientTimeline?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب الجدول الزمني للمريض:",t),[]}}static async getPatientTreatmentPlans(e){try{return await(window.electronAPI?.treatmentPlans?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب خطط العلاج للمريض:",t),[]}}static calculatePatientStats(e){const{appointments:t,treatments:s,payments:a}=e,r=t.length,n=s.reduce((e,t)=>(e[t.treatment_status]=(e[t.treatment_status]||0)+1,e),{}),i=n.completed||0,l=(n.planned||0)+(n.in_progress||0),c=new Map,d=[];a.forEach(e=>{e.appointment_id?(c.has(e.appointment_id)||c.set(e.appointment_id,[]),c.get(e.appointment_id).push(e)):d.push(e)});let m=0,o=0;t.forEach(e=>{if(e.cost){const t=(c.get(e.id)||[]).reduce((e,t)=>e+(t.amount||0),0);o+=e.cost,m+=t}}),d.forEach(e=>{m+=e.amount||0,e.total_amount_due&&(o+=e.total_amount_due)});const x=Math.max(0,o-m),h=(new Date).getTime(),p=[],u=[];let g,j;t.forEach(e=>{"completed"===e.status?p.push(e):"scheduled"===e.status&&u.push(e)}),p.length>0&&(p.sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime()),g=p[0].start_time);const f=u.filter(e=>new Date(e.start_time).getTime()>h);return f.length>0&&(f.sort((e,t)=>new Date(e.start_time).getTime()-new Date(t.start_time).getTime()),j=f[0].start_time),{totalAppointments:r,completedTreatments:i,pendingTreatments:l,totalPaid:Math.round(100*m)/100,remainingBalance:Math.round(100*x)/100,lastVisit:g,nextAppointment:j}}static async createTimelineEvent(e){try{return await(window.electronAPI?.patientTimeline?.create?.(e))||null}catch(t){return console.error("خطأ في إنشاء حدث الجدول الزمني:",t),null}}static async linkPrescriptionToTreatment(e,t){try{return!!(await(window.electronAPI?.prescriptions?.update?.(e,{tooth_treatment_id:t})))}catch(s){return console.error("خطأ في ربط الوصفة بالعلاج:",s),!1}}static async linkLabOrderToTreatment(e,t,s){try{const a={tooth_treatment_id:t};s&&(a.appointment_id=s);return!!(await(window.electronAPI?.labOrders?.update?.(e,a)))}catch(a){return console.error("خطأ في ربط طلب المختبر بالعلاج:",a),!1}}static async generatePatientReport(e){const t=await this.getPatientIntegratedData(e);if(!t)throw new Error("لا يمكن جلب بيانات المريض");return{patient:t.patient,summary:t.stats,treatmentHistory:t.treatments,appointmentHistory:t.appointments,financialSummary:{totalPaid:t.stats.totalPaid,remainingBalance:t.stats.remainingBalance,paymentHistory:t.payments},prescriptionHistory:t.prescriptions,labOrderHistory:t.labOrders,timeline:t.timeline,treatmentPlans:t.treatmentPlans,generatedAt:(new Date).toISOString()}}}function J(e,t,s){const a=s.filter(t=>t.appointment_id===e),r=a.reduce((e,t)=>e+t.amount,0),n=Math.max(0,t-r),i=function(e,t,s){const a=function(e,t){return e?t.filter(t=>t.appointment_id===e&&("partial"===t.status||"completed"===t.status)).reduce((e,t)=>e+t.amount,0):0}(e,s);return a>=t?"completed":a>0?"partial":"pending"}(e,t,s);return{appointmentPayments:a,totalPaid:r,remainingBalance:n,status:i,appointmentCost:t,paymentCount:a.length}}const W=s.lazy(()=>e(()=>import("./index-3a8dc84c.js").then(e=>e.bC),["./index-3a8dc84c.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./pdf-991f41f6.js","./utils-ec524415.js","./charts-b4389b44.js","./index-d4f1f719.css"],import.meta.url)),q=s.lazy(()=>e(()=>import("./index-3a8dc84c.js").then(e=>e.bD),["./index-3a8dc84c.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./pdf-991f41f6.js","./utils-ec524415.js","./charts-b4389b44.js","./index-d4f1f719.css"],import.meta.url)),G=s.lazy(()=>e(()=>import("./AddPrescriptionDialog-e7062ace.js").then(e=>e.a),["./AddPrescriptionDialog-e7062ace.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./index-3a8dc84c.js","./pdf-991f41f6.js","./utils-ec524415.js","./charts-b4389b44.js","./index-d4f1f719.css","./notificationService-09cb27cc.js","./upload-4df8a268.js","./file-text-861b9f90.js","./plus-1eab3b5b.js","./pill-2f66511d.js"],import.meta.url)),K=s.lazy(()=>e(()=>import("./ComprehensivePendingInvoiceDialog-f22679a2.js"),["./ComprehensivePendingInvoiceDialog-f22679a2.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./index-3a8dc84c.js","./pdf-991f41f6.js","./utils-ec524415.js","./charts-b4389b44.js","./index-d4f1f719.css","./switch-3ea40783.js","./pdfService-844f6d4e.js","./qr-d6f50769.js","./file-text-861b9f90.js","./filter-f006659c.js","./calculator-63fcb348.js","./settings-39dd9f65.js","./printer-5ab76652.js","./upload-4df8a268.js"],import.meta.url));const Q=s.memo(function({patient:e,open:a,onOpenChange:Q,onEdit:U,onNavigateToTreatments:X,onNavigateToPayments:Z}){const[Y,ee]=s.useState("info"),[te,se]=s.useState([]),[ae,re]=s.useState([]),[ne,ie]=s.useState([]),[le,ce]=s.useState([]),[de,me]=s.useState([]),[oe,xe]=s.useState(!1),[he,pe]=s.useState(!1),[ue,ge]=s.useState(!1),[je,fe]=s.useState(!1),[Ne,ye]=s.useState(!1),[be,ve]=s.useState(!1),[_e,we]=s.useState(!1),[Pe,Te]=s.useState(!1),{appointments:De}=r(),{payments:Se}=n(),{toothTreatments:Ie,loadToothTreatmentsByPatient:ke}=i(),{toast:Ce}=l(),{settings:Ae}=c(),{refreshTreatmentNames:Ee}=d();if(s.useEffect(()=>{if(e&&a){xe(!0);const t=De.filter(t=>t.patient_id===e.id);se(t),xe(!1),pe(!0);const s=Se.filter(t=>t.patient_id===e.id);re(s),pe(!1),ge(!0),ke(e.id).then(()=>{const{toothTreatments:t}=i.getState(),s=t.filter(t=>t.patient_id===e.id);ie(s),ge(!1),Ee()}).catch(()=>{ge(!1)}),fe(!0),window.electronAPI?.prescriptions?.getByPatient?.(e.id).then(e=>{ce(e||[]),fe(!1)}).catch(e=>{fe(!1)}),window.electronAPI?.labOrders?.getByPatient?.(e.id).then(e=>{me(e||[])}).catch(()=>{})}},[e,a,De,Se,ke]),!e)return null;const Oe=()=>{e&&X&&(Q(!1),X("dental-treatments"),localStorage.setItem("selectedPatientForTreatment",JSON.stringify({selectedPatientId:e.id,patientName:e.full_name,showAddTreatmentGuidance:!0})))};return t.jsxs(m,{open:a,onOpenChange:Q,children:[t.jsxs(o,{className:"max-w-4xl max-h-[90vh] overflow-hidden",dir:"rtl",children:[t.jsx(x,{className:"text-right",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-right",children:[t.jsxs(h,{className:"text-xl arabic-enhanced text-right",children:["تفاصيل المريض - ",e.full_name]}),t.jsx(p,{className:"arabic-enhanced text-right",children:"معلومات شاملة عن المريض وسجلاته الطبية"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(u,{variant:"outline",size:"sm",onClick:async()=>{if(e)try{Ce({title:"جاري إعداد التقرير...",description:"يتم تجميع بيانات المريض وإعداد التقرير للطباعة"});const t=await V.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await O.exportIndividualPatientRecord(t,Ae),Ce({title:"تم إنشاء التقرير بنجاح",description:`تم إنشاء سجل المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient record:",t),Ce({title:"خطأ في إنشاء التقرير",description:"فشل في إنشاء سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},className:"flex items-center gap-2 text-green-600 hover:text-green-700 hover:bg-green-50",children:[t.jsx(z,{className:"w-4 h-4"}),"طباعة السجل"]}),t.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Te(!0),className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[t.jsx(B,{className:"w-4 h-4"}),"فاتورة الآجلات"]}),U&&t.jsxs(u,{variant:"outline",size:"sm",onClick:()=>U(e),className:"flex items-center gap-2",children:[t.jsx(M,{className:"w-4 h-4"}),"تعديل"]})]})]})}),t.jsxs(k,{value:Y,onValueChange:ee,className:"flex-1 overflow-hidden",dir:"rtl",children:[t.jsxs(C,{className:"grid w-full grid-cols-4 rtl-tabs",dir:"rtl",children:[t.jsxs(A,{value:"info",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[t.jsx(g,{className:"w-4 h-4"}),"معلومات المريض"]}),t.jsxs(A,{value:"treatments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[t.jsx(j,{className:"w-4 h-4"}),"العلاجات (",ne.length,")"]}),t.jsxs(A,{value:"appointments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[t.jsx(f,{className:"w-4 h-4"}),"المواعيد (",te.length,")"]}),t.jsxs(A,{value:"payments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[t.jsx(N,{className:"w-4 h-4"}),"المدفوعات (",ae.length,")"]})]}),t.jsxs("div",{className:"mt-4 overflow-y-auto max-h-[calc(90vh-200px)] dialog-rtl",dir:"rtl",children:[t.jsx(E,{value:"info",className:"space-y-4 dialog-rtl",dir:"rtl",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",dir:"rtl",children:[t.jsxs(y,{className:"card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-right",children:[t.jsx(g,{className:"w-5 h-5"}),"المعلومات الأساسية"]})}),t.jsxs(_,{className:"space-y-3 card-content",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs(w,{variant:"outline",children:["#",e.serial_number]}),t.jsx("span",{className:"text-muted-foreground",children:"#:"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium",children:e.full_name}),t.jsx("span",{className:"text-muted-foreground",children:"الاسم الكامل:"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(w,{variant:"male"===e.gender?"default":"secondary",children:"male"===e.gender?"ذكر":"أنثى"}),t.jsx("span",{className:"text-muted-foreground",children:"الجنس:"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{children:[e.age," سنة"]}),t.jsx("span",{className:"text-muted-foreground",children:"العمر:"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm",children:P(e.date_added||e.created_at)}),t.jsx("span",{className:"text-muted-foreground",children:"تاريخ الإضافة:"})]})]})]}),t.jsxs(y,{className:"card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-right",children:[t.jsx(L,{className:"w-5 h-5"}),"معلومات الاتصال"]})}),t.jsxs(_,{className:"space-y-3 card-content",dir:"rtl",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[e.phone?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.phone}),t.jsx(L,{className:"w-4 h-4 text-muted-foreground"})]}):t.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),t.jsx("span",{className:"text-muted-foreground",children:"رقم الهاتف:"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[e.email?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:e.email}),t.jsx(F,{className:"w-4 h-4 text-muted-foreground"})]}):t.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),t.jsx("span",{className:"text-muted-foreground",children:"البريد الإلكتروني:"})]}),t.jsxs("div",{className:"flex items-start justify-between",children:[e.address?t.jsxs("div",{className:"flex items-start gap-2 max-w-[200px]",children:[t.jsx("span",{className:"text-sm text-right",children:e.address}),t.jsx(H,{className:"w-4 h-4 text-muted-foreground mt-0.5"})]}):t.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),t.jsx("span",{className:"text-muted-foreground",children:"العنوان:"})]})]})]}),t.jsxs(y,{className:"md:col-span-2 card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-right",children:[t.jsx(R,{className:"w-5 h-5"}),"المعلومات الطبية"]})}),t.jsxs(_,{className:"space-y-4 card-content",dir:"rtl",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[t.jsx(B,{className:"w-4 h-4"}),"حالة المريض"]}),t.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.patient_condition})]}),e.allergies&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-orange-600 dark:text-orange-400 text-right",children:[t.jsx(T,{className:"w-4 h-4"}),"الحساسية"]}),t.jsx("div",{className:"text-sm bg-orange-50 dark:bg-yellow-900 border border-orange-200 dark:border-yellow-600 p-3 rounded-md text-orange-900 dark:text-yellow-100 text-right",children:e.allergies})]}),e.medical_conditions&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[t.jsx(R,{className:"w-4 h-4"}),"الحالات الطبية"]}),t.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.medical_conditions})]}),e.notes&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[t.jsx(B,{className:"w-4 h-4"}),"ملاحظات إضافية"]}),t.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.notes})]})]})]})]})}),t.jsxs(E,{value:"treatments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[t.jsx("h3",{className:"text-lg font-medium",children:"العلاجات السنية"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(u,{onClick:async()=>{if(e)try{Ce({title:"جاري إعداد تقرير العلاجات...",description:"يتم تجميع بيانات علاجات المريض وإعداد التقرير للطباعة"});const t=await V.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await O.exportPatientTreatments(t,Ae),Ce({title:"تم إنشاء تقرير العلاجات بنجاح",description:`تم إنشاء تقرير علاجات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient treatments:",t),Ce({title:"خطأ في إنشاء تقرير العلاجات",description:"فشل في إنشاء تقرير علاجات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[t.jsx(z,{className:"w-4 h-4"}),"طباعة العلاجات"]}),t.jsxs(u,{onClick:Oe,className:"flex items-center gap-2",size:"sm",children:[t.jsx($,{className:"w-4 h-4"}),"إضافة علاج"]})]})]}),ue?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"loading-spinner"})}):0===ne.length?t.jsx(y,{className:"card-rtl",children:t.jsx(_,{className:"pt-6 card-content",dir:"rtl",children:t.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[t.jsx(j,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد علاجات"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم تسجيل أي علاجات سنية لهذا المريض بعد"}),t.jsxs(u,{onClick:Oe,className:"flex items-center gap-2",size:"sm",children:[t.jsx($,{className:"w-4 h-4"}),"إضافة أول علاج"]})]})})}):t.jsxs(y,{className:"card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-foreground text-right",children:[t.jsx(j,{className:"w-5 h-5"}),"جدول العلاجات"]})}),t.jsxs(_,{className:"card-content",dir:"rtl",children:[t.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-muted",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"رقم السن"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"اسم السن"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العلاج الحالي"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),t.jsx("tbody",{className:"bg-background divide-y divide-border",children:ne.map((e,s)=>{const a=(e=>{const t=I.find(t=>t.value===e);if(t){const s={planned:"outline",in_progress:"secondary",completed:"default",cancelled:"destructive"};return{label:t.label,variant:s[e]||"outline"}}return{label:e,variant:"outline"}})(e.treatment_status);return t.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:s+1}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.tooth_number}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.tooth_name}),t.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:D(e.treatment_type)||"-"}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.cost?t.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:S(e.cost)}):t.jsx("span",{className:"text-muted-foreground",children:"-"})}),t.jsx("td",{className:"px-4 py-3 text-sm",children:t.jsx(w,{variant:a.variant,children:a.label})})]},e.id)})})]})}),ne.some(e=>e.notes)&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),ne.map(e=>e.notes&&t.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-xs font-medium text-foreground",children:["السن رقم ",e.tooth_number," - ",e.tooth_name]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:P(e.created_at)})]}),e.notes&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"ملاحظات: "}),t.jsx("span",{className:"text-xs text-foreground",children:e.notes})]})]},`details-${e.id}`))]})]})]})]}),t.jsxs(E,{value:"appointments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[t.jsx("h3",{className:"text-lg font-medium",children:"المواعيد"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(u,{onClick:async()=>{if(e)try{Ce({title:"جاري إعداد تقرير المواعيد...",description:"يتم تجميع بيانات مواعيد المريض وإعداد التقرير للطباعة"});const t=await V.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await O.exportPatientAppointments(t,Ae),Ce({title:"تم إنشاء تقرير المواعيد بنجاح",description:`تم إنشاء تقرير مواعيد المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient appointments:",t),Ce({title:"خطأ في إنشاء تقرير المواعيد",description:"فشل في إنشاء تقرير مواعيد المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[t.jsx(z,{className:"w-4 h-4"}),"طباعة المواعيد"]}),t.jsxs(u,{onClick:()=>{ye(!0)},className:"flex items-center gap-2",size:"sm",children:[t.jsx($,{className:"w-4 h-4"}),"إضافة موعد"]})]})]}),oe?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"loading-spinner"})}):0===te.length?t.jsx(y,{className:"card-rtl",children:t.jsx(_,{className:"pt-6 card-content",dir:"rtl",children:t.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[t.jsx(f,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مواعيد"}),t.jsx("p",{className:"text-muted-foreground",children:"لم يتم تحديد أي مواعيد لهذا المريض بعد"})]})})}):t.jsxs(y,{className:"card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-foreground text-right",children:[t.jsx(f,{className:"w-5 h-5"}),"جدول المواعيد"]})}),t.jsxs(_,{className:"card-content",dir:"rtl",children:[t.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-muted",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العنوان"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التاريخ"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الوقت"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),t.jsx("tbody",{className:"bg-background divide-y divide-border",children:te.map((e,s)=>{const a=(e=>({scheduled:{label:"مجدول",variant:"default"},completed:{label:"مكتمل",variant:"default"},cancelled:{label:"ملغي",variant:"destructive"},no_show:{label:"لم يحضر",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(e.status);return t.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:s+1}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.title}),t.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:P(e.start_time)}),t.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.cost?t.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:S(e.cost)}):t.jsx("span",{className:"text-muted-foreground",children:"-"})}),t.jsx("td",{className:"px-4 py-3 text-sm",children:t.jsx(w,{variant:a.variant,children:a.label})})]},e.id)})})]})}),te.some(e=>e.description)&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),te.map(e=>e.description&&t.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-foreground",children:e.title}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[P(e.start_time)," - ",new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),t.jsx("span",{className:"text-xs text-foreground",children:e.description})]})]},`desc-${e.id}`))]})]})]})]}),t.jsxs(E,{value:"payments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[t.jsx("h3",{className:"text-lg font-medium",children:"المدفوعات"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(u,{onClick:async()=>{if(e)try{Ce({title:"جاري إعداد تقرير المدفوعات...",description:"يتم تجميع بيانات مدفوعات المريض وإعداد التقرير للطباعة"});const t=await V.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await O.exportPatientPayments(t,Ae),Ce({title:"تم إنشاء تقرير المدفوعات بنجاح",description:`تم إنشاء تقرير مدفوعات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient payments:",t),Ce({title:"خطأ في إنشاء تقرير المدفوعات",description:"فشل في إنشاء تقرير مدفوعات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[t.jsx(z,{className:"w-4 h-4"}),"طباعة المدفوعات"]}),t.jsxs(u,{onClick:()=>{e&&Z?(Q(!1),Z("payments"),localStorage.setItem("selectedPatientForPayment",JSON.stringify({selectedPatientId:e.id,patientName:e.full_name,openAddDialog:!0}))):ve(!0)},className:"flex items-center gap-2",size:"sm",children:[t.jsx($,{className:"w-4 h-4"}),"إضافة دفعة"]})]})]}),he?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"loading-spinner"})}):0===ae.length?t.jsx(y,{className:"card-rtl",children:t.jsx(_,{className:"pt-6 card-content",dir:"rtl",children:t.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[t.jsx(N,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مدفوعات"}),t.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي مدفوعات لهذا المريض بعد"})]})})}):t.jsxs("div",{className:"space-y-4",dir:"rtl",children:[(()=>{!function(e,t,s){const a=t.filter(t=>t.patient_id===e),r=s.filter(t=>t.patient_id===e);let n=0,i=0;r.forEach(e=>{if(e.cost){const t=J(e.id,e.cost,a);i+=e.cost,n+=t.totalPaid}}),a.filter(e=>!e.appointment_id&&("partial"===e.status||"completed"===e.status)).forEach(e=>{n+=e.amount,e.total_amount_due&&(i+=e.total_amount_due)});let l=0;r.forEach(e=>{if(e.cost){const t=a.filter(t=>t.appointment_id===e.id&&"partial"===t.status);if(t.length>0){const s=t.reduce((e,t)=>e+t.amount,0);l+=Math.max(0,e.cost-s)}}}),a.filter(e=>!e.appointment_id&&"partial"===e.status).forEach(e=>{e.total_amount_due&&e.amount&&(l+=Math.max(0,e.total_amount_due-e.amount))});const c=a.filter(e=>e.tooth_treatment_id&&"partial"===e.status),d={};c.forEach(e=>{d[e.tooth_treatment_id]||(d[e.tooth_treatment_id]=[]),d[e.tooth_treatment_id].push(e)}),Object.values(d).forEach(e=>{const t=e.reduce((e,t)=>e+t.amount,0),s=e[0].treatment_total_cost||0;s>0&&(l+=Math.max(0,s-t))}),r.length,a.length,r.filter(e=>!!e.cost&&"completed"===J(e.id,e.cost,a).status).length}(e.id,Se,De);const s=ae.filter(e=>e.tooth_treatment_id),a=ae.filter(e=>e.appointment_id&&!e.tooth_treatment_id),r=ae.filter(e=>!e.appointment_id&&!e.tooth_treatment_id),n=s.reduce((e,t)=>e+(t.treatment_total_cost||0),0),i=s.reduce((e,t)=>e+t.amount,0),l=s.reduce((e,t)=>e+(t.treatment_remaining_balance||0),0),c=a.reduce((e,t)=>e+(t.appointment_total_cost||0),0),d=a.reduce((e,t)=>e+t.amount,0),m=a.reduce((e,t)=>e+(t.appointment_remaining_balance||0),0),o=r.reduce((e,t)=>e+(t.total_amount_due||0),0),x=r.reduce((e,t)=>e+t.amount,0),h=r.reduce((e,t)=>e+(t.remaining_balance||0),0),p=n+c+o,u=i+d+x,g=l+m+h,j=ae.filter(e=>"pending"===e.status),f=ae.filter(e=>"partial"===e.status),P=ae.filter(e=>"completed"===e.status);return t.jsxs(y,{className:"bg-gradient-to-r from-primary/5 to-primary/10 border-border card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-primary text-right",children:[t.jsx(N,{className:"w-5 h-5"}),"ملخص المدفوعات الشامل"]})}),t.jsx(_,{className:"card-content",dir:"rtl",children:t.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-muted",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"البيان"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"المبلغ"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التفاصيل"})]})}),t.jsxs("tbody",{className:"bg-background divide-y divide-border",children:[t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"الإجمالي المطلوب"}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 dark:text-blue-400",children:S(p)}),t.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",S(n)," | مواعيد: ",S(c)," | عام: ",S(o)]})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"المبلغ المدفوع"}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600 dark:text-green-400",children:S(u)}),t.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",S(i)," | مواعيد: ",S(d)," | عام: ",S(x)]})]}),t.jsxs("tr",{className:"bg-muted/50",children:[t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:"المبلغ المتبقي"}),t.jsxs("td",{className:"px-4 py-3 text-sm font-bold",children:[t.jsx("span",{className:g>0?"text-destructive":"text-green-600 dark:text-green-400",children:S(g)}),0===g&&t.jsx("span",{className:"mr-2 text-xs text-green-600 dark:text-green-400",children:"✓ مكتمل"})]}),t.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",S(l)," | مواعيد: ",S(m)," | عام: ",S(h)]})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"حالات الدفع"}),t.jsx("td",{className:"px-4 py-3 text-sm",children:t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs(w,{variant:"secondary",className:"text-xs",children:["مكتمل: ",P.length]}),t.jsxs(w,{variant:"outline",className:"text-xs",children:["جزئي: ",f.length]}),t.jsxs(w,{variant:"destructive",className:"text-xs",children:["آجل: ",j.length]})]})}),t.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["إجمالي المدفوعات: ",ae.length]})]})]})]})})})]})})(),t.jsxs(y,{className:"card-rtl",children:[t.jsx(b,{className:"card-header",children:t.jsxs(v,{className:"flex items-center gap-2 text-foreground text-right",children:[t.jsx(N,{className:"w-5 h-5"}),"تفاصيل المدفوعات الشاملة"]})}),t.jsxs(_,{className:"card-content",dir:"rtl",children:[t.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-muted",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"#"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"النوع"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"التفاصيل"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"تاريخ الدفع"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المبلغ المدفوع"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الإجمالي المطلوب"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المتبقي"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"طريقة الدفع"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الحالة"})]})}),t.jsx("tbody",{className:"bg-background divide-y divide-border",children:ae.map((e,s)=>{const a=(e=>({completed:{label:"مكتمل",variant:"default"},partial:{label:"جزئي",variant:"outline"},pending:{label:"آجل",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(e.status);let r="عام",n=e.description||"دفعة عامة",i=e.total_amount_due||0,l=e.remaining_balance||0;e.description&&(n=e.description.replace(/\[علاج:[^\]]+\]/g,"").trim(),n=n.replace(/^\s*-\s*/,"").trim());let c=e.notes;if(c&&(c=c.replace(/\[علاج:[^\]]+\]/g,"").trim(),c=c.replace(/^\s*-\s*/,"").trim()),e.tooth_treatment_id){r="علاج";const t=e.tooth_treatment?.treatment_type?D(e.tooth_treatment.treatment_type):"علاج سن";n&&"دفعة عامة"!==n||(n=t),e.tooth_treatment?.tooth_name&&(n+=` - ${e.tooth_treatment.tooth_name}`),i=e.treatment_total_cost||0,l=e.treatment_remaining_balance||0}else e.appointment_id&&(r="موعد",n=e.appointment?.title||n||"موعد طبي",i=e.appointment_total_cost||e.total_amount_due||0,l=e.appointment_remaining_balance||e.remaining_balance||0);return t.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[t.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:s+1}),t.jsx("td",{className:"px-3 py-2 text-xs",children:t.jsx(w,{variant:"علاج"===r?"default":"موعد"===r?"secondary":"outline",className:"text-xs",children:r})}),t.jsxs("td",{className:"px-3 py-2 text-xs text-foreground max-w-32",children:[t.jsx("div",{className:"truncate",title:n,children:n}),e.tooth_treatment?.tooth_number&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:["سن #",e.tooth_treatment.tooth_number]})]}),t.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:P(e.payment_date)}),t.jsx("td",{className:"px-3 py-2 text-xs font-bold text-green-600 dark:text-green-400",children:S(e.amount)}),t.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:i>0?S(i):"-"}),t.jsx("td",{className:"px-3 py-2 text-xs font-medium",children:void 0!==l?t.jsx("span",{className:l>0?"text-destructive":"text-green-600 dark:text-green-400",children:S(l)}):"-"}),t.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:"cash"===e.payment_method?"نقداً":"bank_transfer"===e.payment_method?"تحويل بنكي":e.payment_method}),t.jsx("td",{className:"px-3 py-2 text-xs",children:t.jsx(w,{variant:a.variant,className:"text-xs",children:a.label})})]},e.id)})})]})}),ae.some(e=>e.description||e.receipt_number)&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),ae.map(e=>(e.description||e.receipt_number)&&t.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("span",{className:"text-xs text-muted-foreground",children:[P(e.payment_date)," - ",S(e.amount)]})}),e.description&&t.jsxs("div",{className:"mb-1",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),t.jsx("span",{className:"text-xs text-foreground",children:e.description.replace(/\[علاج:[^\]]+\]/g,"").trim().replace(/^\s*-\s*/,"").trim()})]}),e.receipt_number&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"رقم الإيصال: "}),t.jsx("span",{className:"text-xs text-foreground",children:e.receipt_number})]})]},`details-${e.id}`))]})]})]})]})]}),t.jsxs(E,{value:"prescriptions",className:"space-y-4 dialog-rtl",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[t.jsx("h3",{className:"text-lg font-medium",children:"الوصفات الطبية"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(u,{onClick:async()=>{if(e)try{Ce({title:"جاري إعداد تقرير الوصفات...",description:"يتم تجميع بيانات وصفات المريض وإعداد التقرير للطباعة"});const t=await V.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await O.exportPatientPrescriptions(t,Ae),Ce({title:"تم إنشاء تقرير الوصفات بنجاح",description:`تم إنشاء تقرير وصفات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient prescriptions:",t),Ce({title:"خطأ في إنشاء تقرير الوصفات",description:"فشل في إنشاء تقرير وصفات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[t.jsx(z,{className:"w-4 h-4"}),"طباعة الوصفات"]}),t.jsxs(u,{onClick:()=>{we(!0)},className:"flex items-center gap-2",size:"sm",children:[t.jsx($,{className:"w-4 h-4"}),"إضافة وصفة"]})]})]}),je?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"loading-spinner"})}):0===le.length?t.jsx(y,{className:"card-rtl",children:t.jsx(_,{className:"pt-6 card-content",dir:"rtl",children:t.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[t.jsx(B,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية لهذا المريض بعد"})]})})}):t.jsx("div",{className:"space-y-4",dir:"rtl",children:le.map(e=>t.jsx(y,{className:"card-rtl",children:t.jsxs(_,{className:"pt-4 card-content",dir:"rtl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(B,{className:"w-4 h-4 text-blue-500"}),t.jsx("span",{className:"font-medium",children:"وصفة طبية"})]}),t.jsx(w,{variant:"outline",children:P(e.prescription_date)})]}),e.tooth_treatment&&t.jsxs("div",{className:"mb-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"مرتبطة بعلاج: "}),t.jsxs("span",{className:"text-sm font-medium",children:["السن رقم ",e.tooth_treatment.tooth_number," - ",e.tooth_treatment.treatment_type]})]}),e.notes&&t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.notes}),e.medications&&e.medications.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium",children:"الأدوية:"}),e.medications.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded",children:[t.jsx("span",{className:"text-sm",children:e.medication_name}),e.dose&&t.jsx("span",{className:"text-sm text-muted-foreground",children:e.dose})]},s))]})]})},e.id))})]})]})]})]}),t.jsx(s.Suspense,{fallback:null,children:t.jsx(W,{isOpen:Ne,onClose:()=>ye(!1),onSave:async t=>{try{const{createAppointment:s}=r.getState();await s(t),ye(!1);const a=De.filter(t=>t.patient_id===e.id);se(a),Ce({title:"تم بنجاح",description:"تم إضافة الموعد بنجاح"})}catch(s){Ce({title:"خطأ",description:"فشل في إضافة الموعد",variant:"destructive"})}},patients:[e],treatments:[],initialData:void 0,preSelectedPatientId:e.id})}),t.jsx(s.Suspense,{fallback:null,children:t.jsx(q,{open:be,onOpenChange:ve,preSelectedPatientId:e.id})}),t.jsx(s.Suspense,{fallback:null,children:t.jsx(G,{open:_e,onOpenChange:t=>{we(t),t||(fe(!0),window.electronAPI?.prescriptions?.getByPatient?.(e.id).then(e=>{ce(e||[]),fe(!1)}).catch(e=>{fe(!1)}))},preSelectedPatientId:e.id})}),t.jsx(s.Suspense,{fallback:null,children:t.jsx(K,{patient:e,open:Pe,onOpenChange:Te})})]})});export{V as P,Q as a};
