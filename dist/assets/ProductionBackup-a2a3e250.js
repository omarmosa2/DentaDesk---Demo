import{j as e}from"./ui-cacc1eea.js";import{r}from"./vendor-696af5bd.js";import{w as a,aF as s,C as t,l,au as d,j as o,k as c,L as i,T as n,B as x,M as m,$ as b}from"./index-3a8dc84c.js";import{F as g}from"./file-text-861b9f90.js";import{H as u}from"./hard-drive-04d0cddb.js";import{D as h,U as p,T as k}from"./upload-4df8a268.js";import"./pdf-991f41f6.js";import"./utils-ec524415.js";import"./charts-b4389b44.js";const j=()=>{const[j,w]=r.useState([]),[y,f]=r.useState({totalBackups:0,totalSize:"0 Bytes",withImages:0,databaseOnly:0,lastBackup:null}),[N,v]=r.useState(!1),[P,I]=r.useState(""),[D]=r.useState(!1),[A,C]=r.useState(""),F=(e,r="success")=>{const a=document.createElement("div");a.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm "+("success"===r?"bg-green-500 text-white":"error"===r?"bg-red-500 text-white":"bg-blue-500 text-white"),a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},3e3)};r.useEffect(()=>{(async()=>{try{console.log("Testing IPC connection...");const e=await(window.electronAPI?.test?.ping());console.log("IPC test result:",e),await(window.electronAPI?.["production-backup"]?.init()),await z(),await S()}catch(e){console.error("Failed to initialize production backup:",e),F("فشل في تهيئة نظام النسخ الاحتياطي","error")}})()},[]);const z=async()=>{try{v(!0);const e=await(window.electronAPI?.["production-backup"]?.list());e?.success&&w(e.data||[])}catch(e){console.error("Failed to load backups:",e),F("فشل في تحميل النسخ الاحتياطية","error")}finally{v(!1)}},S=async()=>{try{const e=await(window.electronAPI?.["production-backup"]?.stats());e?.success&&f(e.data)}catch(e){console.error("Failed to load stats:",e)}},$=async e=>{try{if(v(!0),e){const r=(new Date).toISOString().replace(/[:.]/g,"-"),a=`${e}/${`DentaDesk_Backup_${r}.db`}`;console.log("Creating backup at custom path:",a);const s=await(window.electronAPI?.["production-backup"]?.create({includeImages:D,description:P,customPath:a}));s?.success?(F(`تم إنشاء النسخة الاحتياطية بنجاح في: ${a}`,"success"),I(""),C(""),await z(),await S()):F(s?.error||"فشل في إنشاء النسخة الاحتياطية","error")}else{const e=await(window.electronAPI?.["production-backup"]?.create({includeImages:D,description:P}));e?.success?(F("تم إنشاء النسخة الاحتياطية بنجاح","success"),I(""),await z(),await S()):F(e?.error||"فشل في إنشاء النسخة الاحتياطية","error")}}catch(r){console.error("Failed to create backup:",r),F("فشل في إنشاء النسخة الاحتياطية","error")}finally{v(!1)}};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"نظام النسخ الاحتياطي"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"إدارة النسخ الاحتياطية"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(a,{onClick:z,variant:"outline",disabled:N,className:"dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800 dark:hover:border-gray-500",children:[N?e.jsx(s,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),"تحديث"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(t,{className:"shadow-md border-0 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 dark:border dark:border-blue-800/30",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-500 dark:bg-blue-600 rounded-full shadow-lg",children:e.jsx(d,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-blue-300 mb-1 mr-4",children:"إجمالي النسخ الاحتياطية"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mb-1 mr-4",children:y.totalBackups}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-blue-200 mb-1 mr-4",children:"نسخة احتياطية"})]})]})})}),e.jsx(t,{className:"shadow-md border-0 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 dark:border dark:border-green-800/30",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-500 dark:bg-green-600 rounded-full shadow-lg",children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-green-300 mb-1 mr-4",children:"الحجم الإجمالي"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mb-1 mr-4",children:y.totalSize}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-green-200 mb-1 mr-4",children:"مساحة محجوزة"})]})]})})})]}),e.jsxs(t,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 dark:border dark:border-gray-600",children:[e.jsxs(o,{className:"pb-4",children:[e.jsxs(c,{className:"flex items-center space-x-3 text-xl",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-gray-800 dark:text-white pr-3 ",children:"إنشاء نسخة احتياطية جديدة"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2 pr-3",children:"قم بإنشاء نسخة احتياطية من قاعدة البيانات لحماية بياناتك"})]}),e.jsxs(l,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{htmlFor:"description",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"وصف النسخة الاحتياطية (اختياري)"}),e.jsx(n,{id:"description",placeholder:"أدخل وصفاً للنسخة الاحتياطية...",value:P,onChange:e=>I(e.target.value),rows:3,className:"border-gray-200 focus:border-blue-500 focus:ring-blue-500 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:border-blue-400 dark:focus:ring-blue-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(a,{onClick:async()=>{try{if(!window.electronAPI?.files)return void F("نافذة الحفظ غير متاحة في هذا الوضع","error");let e;if(console.log("Opening save dialog..."),console.log("Available files API:",Object.keys(window.electronAPI.files||{})),console.log("window.electronAPI.files.selectDirectory:",typeof window.electronAPI.files.selectDirectory),window.electronAPI.files.selectDirectory)console.log("Using selectDirectory..."),console.log("Calling selectDirectory with options:",{title:"اختر مكان حفظ النسخة الاحتياطية",defaultPath:"DentaDesk_Backup"}),e=await window.electronAPI.files.selectDirectory({title:"اختر مكان حفظ النسخة الاحتياطية",defaultPath:"DentaDesk_Backup"}),console.log("selectDirectory result:",e);else{if(!window.electronAPI.files.saveFile)return void F("نافذة الحفظ غير متاحة","error");if(console.log("Using saveFile as fallback..."),e=await window.electronAPI.files.saveFile({title:"اختر مكان حفظ النسخة الاحتياطية",defaultPath:"DentaDesk_Backup.zip",filters:[{name:"ZIP Files",extensions:["zip"]},{name:"All Files",extensions:["*"]}]}),e&&!e.canceled&&e.filePath){const r=String(e.filePath),a=r.lastIndexOf("/"),s=r.lastIndexOf("\\"),t=Math.max(a,s);let l;l=t>0?r.substring(0,t):r,e.filePaths=[l]}}if(console.log("Dialog result:",e),e&&e.error)return void F(`خطأ في نافذة الحفظ: ${e.error}`,"error");e&&!e.canceled&&e.filePaths&&e.filePaths.length>0?(C(e.filePaths[0]),F("تم اختيار مكان الحفظ بنجاح","success")):e&&e.canceled&&console.log("User canceled the dialog")}catch(e){console.error("Failed to open save dialog:",e),F(`فشل في فتح نافذة الحفظ: ${e.message||"خطأ غير معروف"}`,"error")}},disabled:N,variant:"outline",className:"h-12 border-2 border-blue-200 text-blue-700 hover:bg-blue-50 hover:border-blue-300 font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200 dark:border-blue-600 dark:text-blue-300 dark:hover:bg-blue-900/20 dark:hover:border-blue-500",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),"اختر مكان الحفظ"]}),e.jsxs(a,{onClick:()=>$(),disabled:N,className:"h-12 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 dark:from-blue-700 dark:to-blue-800 dark:hover:from-blue-800 dark:hover:to-blue-900",children:[N?e.jsx(s,{className:"w-5 h-5 animate-spin mr-2"}):e.jsx(h,{className:"w-5 h-5 mr-2"}),"إنشاء في المجلد الافتراضي"]})]}),A&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl shadow-sm dark:from-blue-900/20 dark:to-indigo-900/20 dark:border-blue-800/30",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(g,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:"المسار المحدد:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-3 font-mono bg-white dark:bg-gray-800 px-3 py-2 rounded-lg border dark:border-gray-600",children:A}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mb-4",children:"سيتم إنشاء ملف النسخة الاحتياطية كملف .db في هذا المجلد"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(a,{onClick:()=>$(A),disabled:N,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200 dark:bg-blue-700 dark:hover:bg-blue-800",children:[N?e.jsx(s,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(h,{className:"w-4 h-4 mr-2"}),"إنشاء ملف .db في المسار المحدد"]}),e.jsx(a,{onClick:()=>{C("")},variant:"outline",size:"sm",className:"border-gray-300 text-gray-600 hover:bg-gray-50 rounded-lg dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:"إلغاء"})]})]})]})})]})]}),e.jsxs(t,{className:"shadow-lg border-0 dark:bg-gray-800 dark:border dark:border-gray-700",children:[e.jsxs(o,{className:" dark:from-gray-800 dark:to-gray-700 rounded-t-lg",children:[e.jsxs(c,{className:"flex items-center space-x-3 text-xl",children:[e.jsx("div",{className:"p-2 bg-gray-200 dark:bg-gray-600 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),e.jsx("span",{className:"text-gray-800 dark:text-white pr-3",children:"النسخ الاحتياطية المحفوظة"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:"إدارة واستعادة النسخ الاحتياطية المحفوظة"})]}),e.jsx(l,{children:N?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(s,{className:"w-6 h-6 animate-spin text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"mr-2 text-gray-600 dark:text-gray-300",children:"جاري التحميل..."})]}):0===j.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:e.jsx(g,{className:"w-10 h-10 text-gray-400 dark:text-gray-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-300 mb-2",children:"لا توجد نسخ احتياطية"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"قم بإنشاء نسخة احتياطية أولى لحماية بياناتك"}),e.jsxs(a,{onClick:()=>$(),className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-700 dark:hover:bg-blue-800",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"إنشاء نسخة احتياطية أولى"]})]}):e.jsx("div",{className:"space-y-4",children:j.map((r,s)=>e.jsx("div",{className:"border border-gray-200 dark:border-gray-600 rounded-xl p-6 hover:shadow-md hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 bg-white dark:bg-gray-700",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(d,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white",children:r.name}),e.jsx(x,{variant:"with_images"===r.type?"default":"secondary",className:"mt-1 dark:bg-gray-600 dark:text-gray-200",children:"with_images"===r.type?"مع الصور":"قاعدة بيانات"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 dark:text-gray-300 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 dark:bg-gray-600 px-3 py-2 rounded-lg",children:[e.jsx(m,{className:"w-4 h-4 text-blue-500 dark:text-blue-400"}),e.jsx("span",{className:"font-medium",children:r.createdDate||"غير محدد"})]},"date"),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 dark:bg-gray-600 px-3 py-2 rounded-lg",children:[e.jsx(u,{className:"w-4 h-4 text-green-500 dark:text-green-400"}),e.jsx("span",{className:"font-medium",children:r.formattedSize||"غير محدد"})]},"size"),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 dark:bg-gray-600 px-3 py-2 rounded-lg",children:[e.jsx(d,{className:"w-4 h-4 text-purple-500 dark:text-purple-400"}),e.jsxs("span",{className:"font-medium",children:["v",r.version||"1.0"]})]},"version"),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 dark:bg-gray-600 px-3 py-2 rounded-lg",children:[e.jsx(b,{className:"w-4 h-4 text-orange-500 dark:text-orange-400"}),e.jsx("span",{className:"font-medium",children:r.createdTime||"غير محدد"})]},"time")]}),r.description&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium",children:"الوصف:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:r.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx(a,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{if(!window.electronAPI?.files?.selectDirectory)return void F("نافذة التصدير غير متاحة في هذا الوضع","error");console.log("Opening export dialog...");const r=await window.electronAPI.files.selectDirectory({title:"اختر مكان تصدير النسخة الاحتياطية",defaultPath:`DentaDesk_Backup_${e.name}`});if(console.log("Export dialog result:",r),r&&r.error)return void F(`خطأ في نافذة التصدير: ${r.error}`,"error");if(r&&!r.canceled&&r.filePaths&&r.filePaths.length>0){const a=r.filePaths[0];console.log("Exporting to path:",a);const s=await(window.electronAPI?.["production-backup"]?.export(e.id,a));s?.success?F("تم تصدير النسخة الاحتياطية بنجاح","success"):F(s?.error||"فشل في تصدير النسخة الاحتياطية","error")}else r&&r.canceled&&console.log("User canceled the export dialog")}catch(r){console.error("Failed to export backup:",r),F(`فشل في تصدير النسخة الاحتياطية: ${r.message||"خطأ غير معروف"}`,"error")}})(r),disabled:N,className:"border-green-200 text-green-700 hover:bg-green-50 hover:border-green-300 dark:border-green-600 dark:text-green-400 dark:hover:bg-green-900/20 dark:hover:border-green-500",children:e.jsx(h,{className:"w-4 h-4"})}),e.jsx(a,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{v(!0);const r=await(window.electronAPI?.["production-backup"]?.restore(e));r?.success?(F("تم استعادة النسخة الاحتياطية بنجاح","success"),window.location.reload()):F(r?.error||"فشل في استعادة النسخة الاحتياطية","error")}catch(r){console.error("Failed to restore backup:",r),F("فشل في استعادة النسخة الاحتياطية","error")}finally{v(!1)}})(r.id),disabled:N,className:"border-blue-200 text-blue-700 hover:bg-blue-50 hover:border-blue-300 dark:border-blue-600 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:border-blue-500",children:e.jsx(p,{className:"w-4 h-4"})}),e.jsx(a,{size:"sm",variant:"destructive",onClick:()=>(async e=>{try{v(!0);const r=await(window.electronAPI?.["production-backup"]?.delete(e));r?.success?(F("تم حذف النسخة الاحتياطية","success"),await z(),await S()):F(r?.error||"فشل في حذف النسخة الاحتياطية","error")}catch(r){console.error("Failed to delete backup:",r),F("فشل في حذف النسخة الاحتياطية","error")}finally{v(!1)}})(r.id),disabled:N,className:"border-red-50 text-blue-900 hover:bg-red-50 hover:border-red-300 dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 dark:hover:border-red-500",children:e.jsx(k,{className:"w-4 h-4"})})]})]})},r.id||`backup-${s}`))})})]})]})};export{j as default};
