import{j as e,S as t,O as a,C as r,a as n,T as s,D as o,R as i,P as l,b as d,c,I as u,d as m,e as p,f as g,g as h,V as f,L as y,h as b,i as x,k as w,l as v,m as N,G as j,n as _,o as k,p as S,q as E,u as A,W as D,r as I,s as P,t as C,v as T,w as L,A as F,x as R,y as $,z as M,B as O,E as z,F as V,H as q,J as U,K as B,M as H,N as X,Q as W,U as G,X as K}from"./ui-cacc1eea.js";import{a as Y,r as Q,c as J}from"./vendor-696af5bd.js";import{_ as Z}from"./pdf-991f41f6.js";import{c as ee}from"./utils-ec524415.js";import{c as te}from"./charts-b4389b44.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ae={},re=Y;ae.createRoot=re.createRoot,ae.hydrateRoot=re.hydrateRoot;const ne=new Map,se=e=>{const t=ne.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},oe=e=>{var t,a;if(!e)return;const r=e.split("\n"),n=r.findIndex(e=>e.includes("api.setState"));if(n<0)return;const s=(null==(t=r[n+1])?void 0:t.trim())||"";return null==(a=/.+ (.+) .+/.exec(s))?void 0:a[1]},ie=(e,t={})=>(a,r,n)=>{const{enabled:s,anonymousActionType:o,store:i,...l}=t;let d;try{d=null!=s&&s&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(h){}if(!d)return e(a,r,n);const{connection:c,...u}=((e,t,a)=>{if(void 0===e)return{type:"untracked",connection:t.connect(a)};const r=ne.get(a.name);if(r)return{type:"tracked",store:e,...r};const n={connection:t.connect(a),stores:{}};return ne.set(a.name,n),{type:"tracked",store:e,...n}})(i,d,l);let m=!0;n.setState=(e,t,s)=>{const d=a(e,t);if(!m)return d;const u=void 0===s?{type:o||oe((new Error).stack)||"anonymous"}:"string"==typeof s?{type:s}:s;return void 0===i?(null==c||c.send(u,r()),d):(null==c||c.send({...u,type:`${i}/${u.type}`},{...se(l.name),[i]:n.getState()}),d)},n.devtools={cleanup:()=>{c&&"function"==typeof c.unsubscribe&&c.unsubscribe(),((e,t)=>{if(void 0===t)return;const a=ne.get(e);a&&(delete a.stores[t],0===Object.keys(a.stores).length&&ne.delete(e))})(l.name,i)}};const p=(...e)=>{const t=m;m=!1,a(...e),m=t},g=e(n.setState,r,n);if("untracked"===u.type?null==c||c.init(g):(u.stores[u.store]=n,null==c||c.init(Object.fromEntries(Object.entries(u.stores).map(([e,t])=>[e,e===u.store?g:t.getState()])))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){const e=n.dispatch;n.dispatch=(...t)=>{e(...t)}}return c.subscribe(e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):le(e.payload,e=>{if("__setState"===e.type){if(void 0===i)return void p(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format.\n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[i];if(null==t)return;return void(JSON.stringify(n.getState())!==JSON.stringify(t)&&p(t))}n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return p(g),void 0===i?null==c?void 0:c.init(n.getState()):null==c?void 0:c.init(se(l.name));case"COMMIT":return void 0===i?void(null==c||c.init(n.getState())):null==c?void 0:c.init(se(l.name));case"ROLLBACK":return le(e.state,e=>{if(void 0===i)return p(e),void(null==c||c.init(n.getState()));p(e[i]),null==c||c.init(se(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return le(e.state,e=>{void 0!==i?JSON.stringify(n.getState())!==JSON.stringify(e[i])&&p(e[i]):p(e)});case"IMPORT_STATE":{const{nextLiftedState:a}=e.payload,r=null==(t=a.computedStates.slice(-1)[0])?void 0:t.state;if(!r)return;return p(void 0===i?r:r[i]),void(null==c||c.send(null,a))}case"PAUSE_RECORDING":return m=!m}return}}),g},le=(e,t)=>{let a;try{a=JSON.parse(e)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}void 0!==a&&t(a)};function de(e,t){let a;try{a=e()}catch(r){return}return{getItem:e=>{var r;const n=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),s=null!=(r=a.getItem(e))?r:null;return s instanceof Promise?s.then(n):n(s)},setItem:(e,r)=>a.setItem(e,JSON.stringify(r,null==t?void 0:t.replacer)),removeItem:e=>a.removeItem(e)}}const ce=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>ce(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>ce(e)(a)}}},ue=(e,t)=>(a,r,n)=>{let s={storage:de(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const i=new Set,l=new Set;let d=s.storage;if(!d)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),a(...e)},r,n);const c=()=>{const e=s.partialize({...r()});return d.setItem(s.name,{state:e,version:s.version})},u=n.setState;n.setState=(e,t)=>{u(e,t),c()};const m=e((...e)=>{a(...e),c()},r,n);let p;n.getInitialState=()=>m;const g=()=>{var e,t;if(!d)return;o=!1,i.forEach(e=>{var t;return e(null!=(t=r())?t:m)});const n=(null==(t=s.onRehydrateStorage)?void 0:t.call(s,null!=(e=r())?e:m))||void 0;return ce(d.getItem.bind(d))(s.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===s.version)return[!1,e.state];if(s.migrate){const t=s.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[n,o]=e;if(p=s.merge(o,null!=(t=r())?t:m),a(p,!0),n)return c()}).then(()=>{null==n||n(p,void 0),p=r(),o=!0,l.forEach(e=>e(p))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{s={...s,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},s.skipHydration||g(),p||m},me=ee()(ie((e,t)=>({patients:[],selectedPatient:null,isLoading:!1,error:null,searchQuery:"",filteredPatients:[],loadPatients:async()=>{performance.now(),e({isLoading:!0,error:null});try{performance.now();const t=await(window.electronAPI?.patients?.getAll())||[];performance.now(),performance.now();e({patients:t,filteredPatients:t,isLoading:!1});performance.now()}catch(t){performance.now(),console.error("Error loading patients:",t),e({error:t instanceof Error?t.message:"Failed to load patients",isLoading:!1})}},createPatient:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.patients.create(a),{patients:n}=t(),s=[...n,r];e({patients:s,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-added",{detail:{patientId:r.id,patientName:r.full_name||"New Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"created",patientId:r.id,patientName:r.full_name||"New Patient"}})))}catch(r){e({error:r instanceof Error?r.message:"Failed to create patient",isLoading:!1})}},updatePatient:async(a,r)=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.patients.update(a,r),{patients:s,selectedPatient:o}=t(),i=s.map(e=>e.id===a?n:e);e({patients:i,selectedPatient:o?.id===a?n:o,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-updated",{detail:{patientId:a,patientName:n.full_name||"Updated Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"updated",patientId:a,patientName:n.full_name||"Updated Patient"}})))}catch(n){e({error:n instanceof Error?n.message:"Failed to update patient",isLoading:!1})}},deletePatient:async a=>{e({isLoading:!0,error:null});try{const{patients:r,selectedPatient:n}=t(),s=r.find(e=>e.id===a);if(await window.electronAPI.patients.delete(a)){const o=r.filter(e=>e.id!==a);return e({patients:o,selectedPatient:n?.id===a?null:n,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:a,patientName:s?s.full_name:"Unknown Patient"}})),{success:!0,patientName:s?s.full_name:"Unknown Patient"}}throw new Error("Failed to delete patient")}catch(r){throw e({error:r instanceof Error?r.message:"Failed to delete patient",isLoading:!1}),r}},setSelectedPatient:t=>{e({selectedPatient:t})},setSearchQuery:a=>{e({searchQuery:a}),t().filterPatients()},clearError:()=>{e({error:null})},searchPatients:async a=>{e({isLoading:!0,error:null});try{if(""===a.trim()){const{patients:r}=t();e({filteredPatients:r,searchQuery:a,isLoading:!1})}else{const t=await window.electronAPI.patients.search(a);e({filteredPatients:t,searchQuery:a,isLoading:!1})}}catch(r){e({error:r instanceof Error?r.message:"Search failed",isLoading:!1})}},filterPatients:()=>{const{patients:a,searchQuery:r}=t();if(""===r.trim())return void e({filteredPatients:a});const n=r.toLowerCase(),s=a.filter(e=>e.full_name.toLowerCase().includes(n)||(e.phone||"").toLowerCase().includes(n)||(e.email||"").toLowerCase().includes(n)||(e.serial_number||"").toLowerCase().includes(n));e({filteredPatients:s})},getPatientAppointments:async e=>{try{return await(window.electronAPI?.appointments?.getByPatient?.(e))||[]}catch(t){return console.error("Error fetching patient appointments:",t),[]}},getPatientPayments:async e=>{try{return await(window.electronAPI?.payments?.getByPatient?.(e))||[]}catch(t){return console.error("Error fetching patient payments:",t),[]}},getPatientStats:async e=>{try{const[r,n]=await Promise.all([t().getPatientAppointments(e),t().getPatientPayments(e)]),s=Math.max(0,r.length),o=Math.max(0,r.filter(e=>"completed"===e.status).length),i=Math.max(0,n.length),l=n.filter(e=>"completed"===e.status).reduce((e,t)=>e+("number"==typeof t.amount?t.amount:0),0);let d,c;if(r.length>0)try{const e=r.filter(e=>e.start_time&&!isNaN(new Date(e.start_time).getTime())).sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime());d=e.length>0?e[0].start_time:void 0}catch(a){console.warn("Error sorting appointments by date:",a)}if(n.length>0)try{const e=n.filter(e=>e.payment_date&&!isNaN(new Date(e.payment_date).getTime())).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime());c=e.length>0?e[0].payment_date:void 0}catch(a){console.warn("Error sorting payments by date:",a)}return{totalAppointments:s,completedAppointments:o,totalPayments:i,totalAmountPaid:Math.round(100*l)/100,lastAppointment:d,lastPayment:c}}catch(a){return console.error("Error calculating patient stats:",a),{totalAppointments:0,completedAppointments:0,totalPayments:0,totalAmountPaid:0}}}}),{name:"patient-store"})),pe=e=>{const t=ye(e),{conflictingClassGroups:a,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const a=e.split("-");return""===a[0]&&1!==a.length&&a.shift(),ge(a,t)||fe(e)},getConflictingClassGroupIds:(e,t)=>{const n=a[e]||[];return t&&r[e]?[...n,...r[e]]:n}}},ge=(e,t)=>{if(0===e.length)return t.classGroupId;const a=e[0],r=t.nextPart.get(a),n=r?ge(e.slice(1),r):void 0;if(n)return n;if(0===t.validators.length)return;const s=e.join("-");return t.validators.find(({validator:e})=>e(s))?.classGroupId},he=/^\[(.+)\]$/,fe=e=>{if(he.test(e)){const t=he.exec(e)[1],a=t?.substring(0,t.indexOf(":"));if(a)return"arbitrary.."+a}},ye=e=>{const{theme:t,classGroups:a}=e,r={nextPart:new Map,validators:[]};for(const n in a)be(a[n],r,n,t);return r},be=(e,t,a,r)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:xe(t,e)).classGroupId=a)}if("function"==typeof e)return we(e)?void be(e(r),t,a,r):void t.validators.push({validator:e,classGroupId:a});Object.entries(e).forEach(([e,n])=>{be(n,xe(t,e),a,r)})})},xe=(e,t)=>{let a=e;return t.split("-").forEach(e=>{a.nextPart.has(e)||a.nextPart.set(e,{nextPart:new Map,validators:[]}),a=a.nextPart.get(e)}),a},we=e=>e.isThemeGetter,ve=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,a=new Map,r=new Map;const n=(n,s)=>{a.set(n,s),t++,t>e&&(t=0,r=a,a=new Map)};return{get(e){let t=a.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(n(e,t),t):void 0},set(e,t){a.has(e)?a.set(e,t):n(e,t)}}},Ne=e=>{const{prefix:t,experimentalParseClassName:a}=e;let r=e=>{const t=[];let a,r=0,n=0,s=0;for(let l=0;l<e.length;l++){let o=e[l];if(0===r&&0===n){if(":"===o){t.push(e.slice(s,l)),s=l+1;continue}if("/"===o){a=l;continue}}"["===o?r++:"]"===o?r--:"("===o?n++:")"===o&&n--}const o=0===t.length?e:e.substring(s),i=je(o);return{modifiers:t,hasImportantModifier:i!==o,baseClassName:i,maybePostfixModifierPosition:a&&a>s?a-s:void 0}};if(t){const e=t+":",a=r;r=t=>t.startsWith(e)?a(t.substring(e.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:t,maybePostfixModifierPosition:void 0}}if(a){const e=r;r=t=>a({className:t,parseClassName:e})}return r},je=e=>e.endsWith("!")?e.substring(0,e.length-1):e.startsWith("!")?e.substring(1):e,_e=e=>{const t=Object.fromEntries(e.orderSensitiveModifiers.map(e=>[e,!0]));return e=>{if(e.length<=1)return e;const a=[];let r=[];return e.forEach(e=>{"["===e[0]||t[e]?(a.push(...r.sort(),e),r=[]):r.push(e)}),a.push(...r.sort()),a}},ke=/\s+/;function Se(){let e,t,a=0,r="";for(;a<arguments.length;)(e=arguments[a++])&&(t=Ee(e))&&(r&&(r+=" "),r+=t);return r}const Ee=e=>{if("string"==typeof e)return e;let t,a="";for(let r=0;r<e.length;r++)e[r]&&(t=Ee(e[r]))&&(a&&(a+=" "),a+=t);return a};function Ae(e,...t){let a,r,n,s=function(i){const l=t.reduce((e,t)=>t(e),e());return a=(e=>({cache:ve(e.cacheSize),parseClassName:Ne(e),sortModifiers:_e(e),...pe(e)}))(l),r=a.cache.get,n=a.cache.set,s=o,o(i)};function o(e){const t=r(e);if(t)return t;const s=((e,t)=>{const{parseClassName:a,getClassGroupId:r,getConflictingClassGroupIds:n,sortModifiers:s}=t,o=[],i=e.trim().split(ke);let l="";for(let d=i.length-1;d>=0;d-=1){const e=i[d],{isExternal:t,modifiers:c,hasImportantModifier:u,baseClassName:m,maybePostfixModifierPosition:p}=a(e);if(t){l=e+(l.length>0?" "+l:l);continue}let g=!!p,h=r(g?m.substring(0,p):m);if(!h){if(!g){l=e+(l.length>0?" "+l:l);continue}if(h=r(m),!h){l=e+(l.length>0?" "+l:l);continue}g=!1}const f=s(c).join(":"),y=u?f+"!":f,b=y+h;if(o.includes(b))continue;o.push(b);const x=n(h,g);for(let a=0;a<x.length;++a){const e=x[a];o.push(y+e)}l=e+(l.length>0?" "+l:l)}return l})(e,a);return n(e,s),s}return function(){return s(Se.apply(null,arguments))}}const De=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},Ie=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Pe=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Ce=/^\d+\/\d+$/,Te=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Le=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Fe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Re=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Me=e=>Ce.test(e),Oe=e=>!!e&&!Number.isNaN(Number(e)),ze=e=>!!e&&Number.isInteger(Number(e)),Ve=e=>e.endsWith("%")&&Oe(e.slice(0,-1)),qe=e=>Te.test(e),Ue=()=>!0,Be=e=>Le.test(e)&&!Fe.test(e),He=()=>!1,Xe=e=>Re.test(e),We=e=>$e.test(e),Ge=e=>!Ye(e)&&!at(e),Ke=e=>dt(e,pt,He),Ye=e=>Ie.test(e),Qe=e=>dt(e,gt,Be),Je=e=>dt(e,ht,Oe),Ze=e=>dt(e,ut,He),et=e=>dt(e,mt,We),tt=e=>dt(e,yt,Xe),at=e=>Pe.test(e),rt=e=>ct(e,gt),nt=e=>ct(e,ft),st=e=>ct(e,ut),ot=e=>ct(e,pt),it=e=>ct(e,mt),lt=e=>ct(e,yt,!0),dt=(e,t,a)=>{const r=Ie.exec(e);return!!r&&(r[1]?t(r[1]):a(r[2]))},ct=(e,t,a=!1)=>{const r=Pe.exec(e);return!!r&&(r[1]?t(r[1]):a)},ut=e=>"position"===e||"percentage"===e,mt=e=>"image"===e||"url"===e,pt=e=>"length"===e||"size"===e||"bg-size"===e,gt=e=>"length"===e,ht=e=>"number"===e,ft=e=>"family-name"===e,yt=e=>"shadow"===e,bt=Ae(()=>{const e=De("color"),t=De("font"),a=De("text"),r=De("font-weight"),n=De("tracking"),s=De("leading"),o=De("breakpoint"),i=De("container"),l=De("spacing"),d=De("radius"),c=De("shadow"),u=De("inset-shadow"),m=De("text-shadow"),p=De("drop-shadow"),g=De("blur"),h=De("perspective"),f=De("aspect"),y=De("ease"),b=De("animate"),x=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",at,Ye],w=()=>[at,Ye,l],v=()=>[Me,"full","auto",...w()],N=()=>[ze,"none","subgrid",at,Ye],j=()=>["auto",{span:["full",ze,at,Ye]},ze,at,Ye],_=()=>[ze,"auto",at,Ye],k=()=>["auto","min","max","fr",at,Ye],S=()=>["auto",...w()],E=()=>[Me,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...w()],A=()=>[e,at,Ye],D=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",st,Ze,{position:[at,Ye]}],I=()=>["auto","cover","contain",ot,Ke,{size:[at,Ye]}],P=()=>[Ve,rt,Qe],C=()=>["","none","full",d,at,Ye],T=()=>["",Oe,rt,Qe],L=()=>[Oe,Ve,st,Ze],F=()=>["","none",g,at,Ye],R=()=>["none",Oe,at,Ye],$=()=>["none",Oe,at,Ye],M=()=>[Oe,at,Ye],O=()=>[Me,"full",...w()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[qe],breakpoint:[qe],color:[Ue],container:[qe],"drop-shadow":[qe],ease:["in","out","in-out"],font:[Ge],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[qe],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[qe],shadow:[qe],spacing:["px",Oe],text:[qe],"text-shadow":[qe],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Me,Ye,at,f]}],container:["container"],columns:[{columns:[Oe,Ye,at,i]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:x()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:v()}],"inset-x":[{"inset-x":v()}],"inset-y":[{"inset-y":v()}],start:[{start:v()}],end:[{end:v()}],top:[{top:v()}],right:[{right:v()}],bottom:[{bottom:v()}],left:[{left:v()}],visibility:["visible","invisible","collapse"],z:[{z:[ze,"auto",at,Ye]}],basis:[{basis:[Me,"full","auto",i,...w()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Oe,Me,"auto","initial","none",Ye]}],grow:[{grow:["",Oe,at,Ye]}],shrink:[{shrink:["",Oe,at,Ye]}],order:[{order:[ze,"first","last","none",at,Ye]}],"grid-cols":[{"grid-cols":N()}],"col-start-end":[{col:j()}],"col-start":[{"col-start":_()}],"col-end":[{"col-end":_()}],"grid-rows":[{"grid-rows":N()}],"row-start-end":[{row:j()}],"row-start":[{"row-start":_()}],"row-end":[{"row-end":_()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":k()}],"auto-rows":[{"auto-rows":k()}],gap:[{gap:w()}],"gap-x":[{"gap-x":w()}],"gap-y":[{"gap-y":w()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:w()}],px:[{px:w()}],py:[{py:w()}],ps:[{ps:w()}],pe:[{pe:w()}],pt:[{pt:w()}],pr:[{pr:w()}],pb:[{pb:w()}],pl:[{pl:w()}],m:[{m:S()}],mx:[{mx:S()}],my:[{my:S()}],ms:[{ms:S()}],me:[{me:S()}],mt:[{mt:S()}],mr:[{mr:S()}],mb:[{mb:S()}],ml:[{ml:S()}],"space-x":[{"space-x":w()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":w()}],"space-y-reverse":["space-y-reverse"],size:[{size:E()}],w:[{w:[i,"screen",...E()]}],"min-w":[{"min-w":[i,"screen","none",...E()]}],"max-w":[{"max-w":[i,"screen","none","prose",{screen:[o]},...E()]}],h:[{h:["screen","lh",...E()]}],"min-h":[{"min-h":["screen","lh","none",...E()]}],"max-h":[{"max-h":["screen","lh",...E()]}],"font-size":[{text:["base",a,rt,Qe]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,at,Je]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ve,Ye]}],"font-family":[{font:[nt,Ye,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,at,Ye]}],"line-clamp":[{"line-clamp":[Oe,"none",at,Je]}],leading:[{leading:[s,...w()]}],"list-image":[{"list-image":["none",at,Ye]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",at,Ye]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:A()}],"text-color":[{text:A()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[Oe,"from-font","auto",at,Qe]}],"text-decoration-color":[{decoration:A()}],"underline-offset":[{"underline-offset":[Oe,"auto",at,Ye]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:w()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",at,Ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",at,Ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:D()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:I()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},ze,at,Ye],radial:["",at,Ye],conic:[ze,at,Ye]},it,et]}],"bg-color":[{bg:A()}],"gradient-from-pos":[{from:P()}],"gradient-via-pos":[{via:P()}],"gradient-to-pos":[{to:P()}],"gradient-from":[{from:A()}],"gradient-via":[{via:A()}],"gradient-to":[{to:A()}],rounded:[{rounded:C()}],"rounded-s":[{"rounded-s":C()}],"rounded-e":[{"rounded-e":C()}],"rounded-t":[{"rounded-t":C()}],"rounded-r":[{"rounded-r":C()}],"rounded-b":[{"rounded-b":C()}],"rounded-l":[{"rounded-l":C()}],"rounded-ss":[{"rounded-ss":C()}],"rounded-se":[{"rounded-se":C()}],"rounded-ee":[{"rounded-ee":C()}],"rounded-es":[{"rounded-es":C()}],"rounded-tl":[{"rounded-tl":C()}],"rounded-tr":[{"rounded-tr":C()}],"rounded-br":[{"rounded-br":C()}],"rounded-bl":[{"rounded-bl":C()}],"border-w":[{border:T()}],"border-w-x":[{"border-x":T()}],"border-w-y":[{"border-y":T()}],"border-w-s":[{"border-s":T()}],"border-w-e":[{"border-e":T()}],"border-w-t":[{"border-t":T()}],"border-w-r":[{"border-r":T()}],"border-w-b":[{"border-b":T()}],"border-w-l":[{"border-l":T()}],"divide-x":[{"divide-x":T()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":T()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:A()}],"border-color-x":[{"border-x":A()}],"border-color-y":[{"border-y":A()}],"border-color-s":[{"border-s":A()}],"border-color-e":[{"border-e":A()}],"border-color-t":[{"border-t":A()}],"border-color-r":[{"border-r":A()}],"border-color-b":[{"border-b":A()}],"border-color-l":[{"border-l":A()}],"divide-color":[{divide:A()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[Oe,at,Ye]}],"outline-w":[{outline:["",Oe,rt,Qe]}],"outline-color":[{outline:A()}],shadow:[{shadow:["","none",c,lt,tt]}],"shadow-color":[{shadow:A()}],"inset-shadow":[{"inset-shadow":["none",u,lt,tt]}],"inset-shadow-color":[{"inset-shadow":A()}],"ring-w":[{ring:T()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:A()}],"ring-offset-w":[{"ring-offset":[Oe,Qe]}],"ring-offset-color":[{"ring-offset":A()}],"inset-ring-w":[{"inset-ring":T()}],"inset-ring-color":[{"inset-ring":A()}],"text-shadow":[{"text-shadow":["none",m,lt,tt]}],"text-shadow-color":[{"text-shadow":A()}],opacity:[{opacity:[Oe,at,Ye]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Oe]}],"mask-image-linear-from-pos":[{"mask-linear-from":L()}],"mask-image-linear-to-pos":[{"mask-linear-to":L()}],"mask-image-linear-from-color":[{"mask-linear-from":A()}],"mask-image-linear-to-color":[{"mask-linear-to":A()}],"mask-image-t-from-pos":[{"mask-t-from":L()}],"mask-image-t-to-pos":[{"mask-t-to":L()}],"mask-image-t-from-color":[{"mask-t-from":A()}],"mask-image-t-to-color":[{"mask-t-to":A()}],"mask-image-r-from-pos":[{"mask-r-from":L()}],"mask-image-r-to-pos":[{"mask-r-to":L()}],"mask-image-r-from-color":[{"mask-r-from":A()}],"mask-image-r-to-color":[{"mask-r-to":A()}],"mask-image-b-from-pos":[{"mask-b-from":L()}],"mask-image-b-to-pos":[{"mask-b-to":L()}],"mask-image-b-from-color":[{"mask-b-from":A()}],"mask-image-b-to-color":[{"mask-b-to":A()}],"mask-image-l-from-pos":[{"mask-l-from":L()}],"mask-image-l-to-pos":[{"mask-l-to":L()}],"mask-image-l-from-color":[{"mask-l-from":A()}],"mask-image-l-to-color":[{"mask-l-to":A()}],"mask-image-x-from-pos":[{"mask-x-from":L()}],"mask-image-x-to-pos":[{"mask-x-to":L()}],"mask-image-x-from-color":[{"mask-x-from":A()}],"mask-image-x-to-color":[{"mask-x-to":A()}],"mask-image-y-from-pos":[{"mask-y-from":L()}],"mask-image-y-to-pos":[{"mask-y-to":L()}],"mask-image-y-from-color":[{"mask-y-from":A()}],"mask-image-y-to-color":[{"mask-y-to":A()}],"mask-image-radial":[{"mask-radial":[at,Ye]}],"mask-image-radial-from-pos":[{"mask-radial-from":L()}],"mask-image-radial-to-pos":[{"mask-radial-to":L()}],"mask-image-radial-from-color":[{"mask-radial-from":A()}],"mask-image-radial-to-color":[{"mask-radial-to":A()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[Oe]}],"mask-image-conic-from-pos":[{"mask-conic-from":L()}],"mask-image-conic-to-pos":[{"mask-conic-to":L()}],"mask-image-conic-from-color":[{"mask-conic-from":A()}],"mask-image-conic-to-color":[{"mask-conic-to":A()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:D()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:I()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",at,Ye]}],filter:[{filter:["","none",at,Ye]}],blur:[{blur:F()}],brightness:[{brightness:[Oe,at,Ye]}],contrast:[{contrast:[Oe,at,Ye]}],"drop-shadow":[{"drop-shadow":["","none",p,lt,tt]}],"drop-shadow-color":[{"drop-shadow":A()}],grayscale:[{grayscale:["",Oe,at,Ye]}],"hue-rotate":[{"hue-rotate":[Oe,at,Ye]}],invert:[{invert:["",Oe,at,Ye]}],saturate:[{saturate:[Oe,at,Ye]}],sepia:[{sepia:["",Oe,at,Ye]}],"backdrop-filter":[{"backdrop-filter":["","none",at,Ye]}],"backdrop-blur":[{"backdrop-blur":F()}],"backdrop-brightness":[{"backdrop-brightness":[Oe,at,Ye]}],"backdrop-contrast":[{"backdrop-contrast":[Oe,at,Ye]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Oe,at,Ye]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Oe,at,Ye]}],"backdrop-invert":[{"backdrop-invert":["",Oe,at,Ye]}],"backdrop-opacity":[{"backdrop-opacity":[Oe,at,Ye]}],"backdrop-saturate":[{"backdrop-saturate":[Oe,at,Ye]}],"backdrop-sepia":[{"backdrop-sepia":["",Oe,at,Ye]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":w()}],"border-spacing-x":[{"border-spacing-x":w()}],"border-spacing-y":[{"border-spacing-y":w()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",at,Ye]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Oe,"initial",at,Ye]}],ease:[{ease:["linear","initial",y,at,Ye]}],delay:[{delay:[Oe,at,Ye]}],animate:[{animate:["none",b,at,Ye]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[h,at,Ye]}],"perspective-origin":[{"perspective-origin":x()}],rotate:[{rotate:R()}],"rotate-x":[{"rotate-x":R()}],"rotate-y":[{"rotate-y":R()}],"rotate-z":[{"rotate-z":R()}],scale:[{scale:$()}],"scale-x":[{"scale-x":$()}],"scale-y":[{"scale-y":$()}],"scale-z":[{"scale-z":$()}],"scale-3d":["scale-3d"],skew:[{skew:M()}],"skew-x":[{"skew-x":M()}],"skew-y":[{"skew-y":M()}],transform:[{transform:[at,Ye,"","none","gpu","cpu"]}],"transform-origin":[{origin:x()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:O()}],"translate-x":[{"translate-x":O()}],"translate-y":[{"translate-y":O()}],"translate-z":[{"translate-z":O()}],"translate-none":["translate-none"],accent:[{accent:A()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:A()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",at,Ye]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":w()}],"scroll-mx":[{"scroll-mx":w()}],"scroll-my":[{"scroll-my":w()}],"scroll-ms":[{"scroll-ms":w()}],"scroll-me":[{"scroll-me":w()}],"scroll-mt":[{"scroll-mt":w()}],"scroll-mr":[{"scroll-mr":w()}],"scroll-mb":[{"scroll-mb":w()}],"scroll-ml":[{"scroll-ml":w()}],"scroll-p":[{"scroll-p":w()}],"scroll-px":[{"scroll-px":w()}],"scroll-py":[{"scroll-py":w()}],"scroll-ps":[{"scroll-ps":w()}],"scroll-pe":[{"scroll-pe":w()}],"scroll-pt":[{"scroll-pt":w()}],"scroll-pr":[{"scroll-pr":w()}],"scroll-pb":[{"scroll-pb":w()}],"scroll-pl":[{"scroll-pl":w()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",at,Ye]}],fill:[{fill:["none",...A()]}],"stroke-w":[{stroke:[Oe,rt,Qe,Je]}],stroke:[{stroke:["none",...A()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}}),xt=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];function wt(e){try{const[t,a]=e.split("-"),r=Number(a)-1;return r<0||r>11?(console.warn("Invalid month in string:",e),e):function(e,t){return t<0||t>11?(console.warn("Invalid month index:",t),`${e}`):`${xt[t]} ${e}`}(Number(t),r)}catch(t){return console.warn("Error parsing month string:",e,t),e}}const vt={calendar:{lastDay:"[أمس في] LT",sameDay:"[اليوم في] LT",nextDay:"[غداً في] LT",lastWeek:"dddd [الماضي في] LT",nextWeek:"dddd [في] LT",sameElse:"L"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},months:xt,monthsShort:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],weekdays:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],weekdaysShort:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],weekdaysMin:["ح","ن","ث","ر","خ","ج","س"],week:{dow:6,doy:12}};function Nt(...e){return bt(te(e))}const jt={USD:{code:"USD",symbol:"$",name:"US Dollar",nameAr:"دولار أمريكي",decimals:2,locale:"en-US",position:"before"},SAR:{code:"SAR",symbol:"ر.س",name:"Saudi Riyal",nameAr:"ريال سعودي",decimals:2,locale:"ar-SA",position:"after"},AED:{code:"AED",symbol:"د.إ",name:"UAE Dirham",nameAr:"درهم إماراتي",decimals:2,locale:"ar-AE",position:"after"},KWD:{code:"KWD",symbol:"د.ك",name:"Kuwaiti Dinar",nameAr:"دينار كويتي",decimals:3,locale:"ar-KW",position:"after"},EUR:{code:"EUR",symbol:"€",name:"Euro",nameAr:"يورو",decimals:2,locale:"en-EU",position:"before"},EGP:{code:"EGP",symbol:"ج.م",name:"Egyptian Pound",nameAr:"جنيه مصري",decimals:2,locale:"ar-EG",position:"after"},GBP:{code:"GBP",symbol:"£",name:"British Pound",nameAr:"جنيه إسترليني",decimals:2,locale:"en-GB",position:"before"},QAR:{code:"QAR",symbol:"ر.ق",name:"Qatari Riyal",nameAr:"ريال قطري",decimals:2,locale:"ar-QA",position:"after"},BHD:{code:"BHD",symbol:"د.ب",name:"Bahraini Dinar",nameAr:"دينار بحريني",decimals:3,locale:"ar-BH",position:"after"},OMR:{code:"OMR",symbol:"ر.ع",name:"Omani Rial",nameAr:"ريال عماني",decimals:3,locale:"ar-OM",position:"after"},SYP:{code:"SYP",symbol:"ل.س",name:"Syrian Pound",nameAr:"ليرة سورية",decimals:2,locale:"ar-SY",position:"after"},TRY:{code:"TRY",symbol:"₺",name:"Turkish Lira",nameAr:"ليرة تركية",decimals:2,locale:"tr-TR",position:"after"}},_t={$:"USD","$ أمريكي":"USD","ريال":"SAR","ريال سعودي":"SAR","درهم":"AED","درهم إماراتي":"AED","دينار":"KWD","دينار كويتي":"KWD","دولار":"USD","دولار أمريكي":"USD","يورو":"EUR","جنيه":"EGP","جنيه مصري":"EGP",SAR:"SAR",AED:"AED",KWD:"KWD",USD:"USD",EUR:"EUR",EGP:"EGP",GBP:"GBP",QAR:"QAR",BHD:"BHD",OMR:"OMR","ليرة":"SYP","ليرة سورية":"SYP",SYP:"SYP","ليرة تركية":"TRY","تركية":"TRY",TRY:"TRY"};function kt(e){return jt[_t[e]||e]||jt.USD}let St={USD_TO_SYP:12500,SYP_TO_USD:8e-5},Et="USD";function At(e){Et=e}function Dt(){return Et}function It(e,t,a){return t===a?e:"USD"===t&&"SYP"===a?e*Pt("USD_TO_SYP"):"SYP"===t&&"USD"===a?e*Pt("SYP_TO_USD"):(console.warn(`Currency conversion not supported: ${t} to ${a}`),e)}function Pt(e){return St[e]||1}function Ct(e,t){const a=Number(e);if(isNaN(a)||!isFinite(a)){console.warn("Invalid amount for currency formatting:",e);return Tt(0,kt(t||Dt()))}return Tt(a,kt(t||Dt()))}function Tt(e,t){const a=Number(e);if(isNaN(a)||!isFinite(a)){const e=`0.${"0".repeat(t.decimals)}`;return`${t.symbol}${e}`}try{const e=function(e,t,a){const r=`${e}-${t}-${a}`;Ft.has(r)||Ft.set(r,new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:a,maximumFractionDigits:a}));return Ft.get(r)}(t.locale,t.code,t.decimals);return e.format(a)}catch(r){console.warn(`Error formatting currency ${t.code}, using manual formatting`);try{const e=Rt("en-US",{minimumFractionDigits:t.decimals,maximumFractionDigits:t.decimals}).format(a);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}catch(n){const e=a.toFixed(t.decimals);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}}}const Lt=new Map,Ft=new Map;function Rt(e,t){const a=`${e}-${JSON.stringify(t)}`;return Lt.has(a)||Lt.set(a,new Intl.NumberFormat("en-US",t)),Lt.get(a)}function $t(e){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const a=t.getDate(),r=t.getMonth()+1,n=t.getFullYear(),s=a.toString().padStart(2,"0");return`${s}/${r.toString().padStart(2,"0")}/${n}`}catch(t){return console.warn("Error formatting date:",t,"Input:",e),"--"}}function Mt(e){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const a=t.getDate(),r=t.getMonth()+1,n=t.getFullYear(),s=a.toString().padStart(2,"0"),o=`${s}/${r.toString().padStart(2,"0")}/${n}`;return`${o} - ${t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}`}catch(t){return console.warn("Error formatting date time:",t,"Input:",e),"--"}}function Ot(e){if(!e)return"--";try{const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.warn("Error formatting time:",t,"Input:",e),"--"}}function zt(e=new Date){const t=new Date(e),a=t.getDay();return t.setDate(e.getDate()-a),t.setHours(0,0,0,0),t}function Vt(e){return wt(e)}function qt(e){switch(e){case"scheduled":return"bg-primary/10 text-primary border-primary/20";case"completed":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800";case"cancelled":return"bg-destructive/10 text-destructive border-destructive/20";default:return"bg-muted text-muted-foreground border-border"}}const Ut={primary:["#0ea5e9","#06b6d4","#3b82f6","#1e40af","#0284c7","#0369a1","#075985","#0c4a6e"],medical:["#10b981","#059669","#047857","#065f46","#064e3b","#22c55e","#16a34a","#15803d"],status:["#10b981","#f59e0b","#ef4444","#6b7280","#8b5cf6","#06b6d4","#f97316","#ec4899"],financial:["#059669","#dc2626","#d97706","#7c3aed","#0891b2","#be185d","#ea580c","#4338ca"],categorical:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#84cc16","#6366f1"],gradients:{blue:["#dbeafe","#3b82f6"],green:["#dcfce7","#10b981"],purple:["#f3e8ff","#8b5cf6"],orange:["#fed7aa","#f97316"],red:["#fecaca","#ef4444"],cyan:["#cffafe","#06b6d4"]},inventory:["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#6b7280"],demographics:["#3b82f6","#ec4899","#10b981","#f59e0b","#8b5cf6","#06b6d4","#f97316","#6b7280"],treatments:["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#06b6d4","#f97316","#ec4899"]};function Bt(e="primary",t=!1){const a=Ut[e];return Array.isArray(a)?t?a.map(e=>{const t=parseInt(e.slice(1,3),16),a=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),n=Math.min(255,Math.round(1.2*t)),s=Math.min(255,Math.round(1.2*a)),o=Math.min(255,Math.round(1.2*r));return`#${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}`}):a:[]}const Ht={responsive:{mobile:{width:"100%",height:280},tablet:{width:"100%",height:320},desktop:{width:"100%",height:380},large:{width:"100%",height:420}},grid:{strokeDasharray:"3 3",stroke:"#e5e7eb",strokeOpacity:.5},darkGrid:{strokeDasharray:"3 3",stroke:"#374151",strokeOpacity:.7},axis:{light:{tick:{fontSize:12,fill:"#6b7280",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#d1d5db",strokeWidth:1},tickLine:{stroke:"#d1d5db",strokeWidth:1}},dark:{tick:{fontSize:12,fill:"#9ca3af",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#4b5563",strokeWidth:1},tickLine:{stroke:"#4b5563",strokeWidth:1}}},tooltip:{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"},darkContentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",fontSize:"14px",fontWeight:"500",color:"#f9fafb",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"}},animation:{duration:800,easing:"ease-in-out",delay:0},pie:{outerRadius:120,innerRadius:50,paddingAngle:2,strokeWidth:2},bar:{radius:[4,4,0,0],minPointSize:5,maxBarSize:100,barCategoryGap:"20%"},line:{strokeWidth:3,dot:{strokeWidth:2,r:4},activeDot:{r:6,strokeWidth:2}},area:{strokeWidth:3,fillOpacity:.3}};function Xt(e=!1){return{...Ht,grid:e?Ht.darkGrid:Ht.grid,tooltip:e?Ht.tooltip.darkContentStyle:Ht.tooltip.contentStyle,axis:e?Ht.axis.dark:Ht.axis.light}}function Wt(e="primary",t=!1,a=1){const r=Bt(e,t);if(a>r.length){const e=[];for(let t=0;t<a;t++)e.push(r[t%r.length]);return e}return r.slice(0,a)}function Gt(e,t="number",a){const r=Number(e);if(isNaN(r)||!isFinite(r))switch(console.warn("Invalid value for chart formatting:",e),t){case"currency":const e=kt(a||Dt()),t=`0.${"0".repeat(e.decimals)}`;return`${e.symbol}${t}`;case"percentage":return"0%";default:return"0"}try{switch(t){case"currency":return Ct(r,a||Dt());case"percentage":const e=Math.round(10*r)/10;return`${isNaN(e)?0:e}%`;default:try{return r.toLocaleString("en-US",{maximumFractionDigits:2})}catch(n){return r.toFixed(2)}}}catch(s){return console.warn("Error formatting chart value:",s),r.toString()}}function Kt(e){const t=new Date,a=new Date(e);let r=t.getFullYear()-a.getFullYear();const n=t.getMonth()-a.getMonth();return(n<0||0===n&&t.getDate()<a.getDate())&&r--,r}class Yt{static listeners=new Map;static isInitialized=!1;static init(){this.isInitialized||(this.isInitialized=!0,setInterval(()=>{this.cleanupListeners()},6e4))}static addEventListener(e,t){this.init(),this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}static removeEventListener(e,t){this.listeners.has(e)&&(this.listeners.get(e).delete(t),0===this.listeners.get(e).size&&this.listeners.delete(e))}static emit(e,t){if(this.listeners.has(e)){Array.from(this.listeners.get(e)).forEach((a,r)=>{try{a(t)}catch(n){console.error(`❌ Error in event listener ${r} for '${e}':`,n)}})}this.emitWindowEvent(e,t)}static emitWindowEvent(e,t){if("undefined"!=typeof window)try{window.dispatchEvent(new CustomEvent(`alerts:${e}`,{detail:t}));[`alert:${e}`,`smart-alert:${e}`,e].forEach(e=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(a){console.warn(`Could not dispatch compat event '${e}':`,a)}})}catch(a){console.warn("Could not dispatch window events:",a)}}static cleanupListeners(){let e=0;this.listeners.forEach((t,a)=>{e+=t.size}),e>100&&console.warn(`🔔 AlertsEventSystem: High listener count detected (${e}). Consider cleanup.`)}static removeAllListeners(){this.listeners.clear()}static getListenerCount(e){return this.listeners.get(e)?.size||0}static getAllListenerCounts(){const e={};return this.listeners.forEach((t,a)=>{e[a]=t.size}),e}}class Qt{static formatAmount(e){try{let a=Dt();try{const e=window.electronAPI?.settings?.getCurrency?.();e&&(a=e)}catch(t){}return Ct(e,a)}catch(a){return console.warn("Error formatting currency in alerts:",a),Ct(e,Dt())}}static async getAllAlerts(){const e=Date.now();try{console.log("🔄 Starting to load all alerts...");let a=[];try{a=await(window.electronAPI?.smartAlerts?.getAll?.())||[],console.log("📋 Loaded saved alerts from database:",a.length)}catch(t){console.error("❌ Error loading saved alerts:",t)}try{await this.cleanupOutdatedAlerts()}catch(t){console.error("❌ Error during cleanup:",t)}let r=[];try{r=await this.generateSmartAlerts(),console.log("🔄 Generated new alerts from real data:",r.length)}catch(t){console.error("❌ Error generating alerts:",t)}const n=r.filter(e=>{const t=a.find(t=>t.id===e.id);return!t||(console.log("📋 Alert already exists, skipping generation:",e.id,"isRead:",t.isRead),!1)});console.log(`📊 Filtered alerts: ${r.length} generated, ${n.length} new to save`);for(const e of n)try{if(!e.id){console.warn("⚠️ Alert missing ID, skipping:",e.title);continue}await(window.electronAPI?.smartAlerts?.create?.(e))?console.log("💾 Saved new alert to database:",e.id,e.title):console.log("⚠️ Alert creation skipped (duplicate found):",e.title)}catch(t){console.error("Error saving alert to database:",t)}const s=[...a,...n],o=this.removeDuplicateAlerts(s);console.log(`📊 Final merge: ${a.length} saved + ${n.length} new = ${o.length} total`);try{await this.clearExpiredSnoozedAlerts()}catch(t){console.error("❌ Error clearing expired snoozed alerts:",t)}const i=this.sortAlertsByPriority(o),l=Date.now()-e;return console.log("✅ Final alerts count:",i.length),console.log("📊 Alert breakdown:",{total:i.length,unread:i.filter(e=>!e.isRead).length,undismissed:i.filter(e=>!e.isDismissed).length,actionRequired:i.filter(e=>e.actionRequired).length,byPriority:{high:i.filter(e=>"high"===e.priority).length,medium:i.filter(e=>"medium"===e.priority).length,low:i.filter(e=>"low"===e.priority).length},byType:i.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})}),console.log(`⏱️ Alert loading completed in ${l}ms`),i}catch(t){const a=Date.now()-e;return console.error(`❌ Error getting all alerts (${a}ms):`,t),[]}}static async generateSmartAlerts(){const e=[];try{console.log("🔄 Generating alerts from real data...");const t=await this.generateAppointmentAlerts();console.log("📅 Generated appointment alerts:",t.length),e.push(...t);const a=await this.generatePaymentAlerts();console.log("💰 Generated payment alerts:",a.length),e.push(...a);const r=await this.generateTreatmentAlerts();console.log("🦷 Generated treatment alerts:",r.length),e.push(...r);const n=await this.generatePrescriptionAlerts();console.log("💊 Generated prescription alerts:",n.length),e.push(...n);const s=await this.generateFollowUpAlerts();console.log("👤 Generated follow-up alerts:",s.length),e.push(...s);const o=await this.generateInventoryAlerts();console.log("📦 Generated inventory alerts:",o.length),e.push(...o);const i=await this.generateLabOrderAlerts();console.log("🧪 Generated lab order alerts:",i.length),e.push(...i);const l=await this.generateClinicNeedsAlerts();console.log("🏥 Generated clinic needs alerts:",l.length),e.push(...l),console.log("✅ Total generated alerts:",e.length)}catch(t){console.error("❌ Error generating smart alerts:",t)}return e}static async generateAppointmentAlerts(){const e=[];try{const t=await(window.electronAPI?.appointments?.getAll?.())||[];console.log("📅 Checking appointments for alerts:",t.length);const a=new Date,r=new Date(a);r.setDate(r.getDate()+1),t.forEach(t=>{if(!t.id)return void console.warn("Appointment missing ID, skipping");if(!t.start_time)return void console.warn("Appointment missing start_time:",t.id);const n=new Date(t.start_time);if(isNaN(n.getTime()))console.warn("Invalid appointment date:",t.start_time,"for appointment:",t.id);else{if(this.isSameDay(n,a)&&"scheduled"===t.status){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`appointment_today_${t.id}`,type:"appointment",priority:"high",title:`موعد اليوم - ${a}`,description:`موعد مجدول اليوم في ${this.formatTime(t.start_time)} - ${t.title||"موعد"}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{appointmentId:t.id},actionRequired:!0,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(this.isSameDay(n,r)&&"scheduled"===t.status){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`appointment_tomorrow_${t.id}`,type:"appointment",priority:"medium",title:`موعد غداً - ${a}`,description:`موعد مجدول غداً في ${this.formatTime(t.start_time)} - ${t.title||"موعد"}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{appointmentId:t.id},actionRequired:!1,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(n<a&&"scheduled"===t.status){const r=`appointment_overdue_${t.id}`,s=Math.floor((a.getTime()-n.getTime())/864e5),o=t.patient?.full_name||"مريض غير محدد",i=t.patient_id||null;e.push({id:r,type:"appointment",priority:"high",title:`موعد متأخر - ${o}`,description:`موعد متأخر منذ ${s} يوم - ${t.title||"موعد"}`,patientId:i,patientName:"مريض غير محدد"!==o?o:null,relatedData:{appointmentId:t.id},actionRequired:!0,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("scheduled"===t.status&&this.isSameDay(n,a)){const a=new Date(t.start_time),r=new Date,n=(a.getTime()-r.getTime())/36e5;if(n<=6&&n>=2){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`appointment_reminder_${t.id}`,type:"appointment",priority:"medium",title:`تذكير موعد - ${a}`,description:`موعد خلال ${Math.round(n)} ساعة - ${t.title||"موعد"}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{appointmentId:t.id},actionRequired:!1,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}}})}catch(t){console.error("Error generating appointment alerts:",t)}return e}static async generatePaymentAlerts(){const e=[];try{const t=await(window.electronAPI?.payments?.getAll?.())||[],a=new Date;t.forEach(t=>{if("pending"===t.status&&t.remaining_balance&&t.remaining_balance>0){if(!t.payment_date)return void console.warn("Payment missing payment_date:",t.id);const r=new Date(t.payment_date);if(isNaN(r.getTime()))return void console.warn("Invalid payment date:",t.payment_date,"for payment:",t.id);const n=Math.floor((a.getTime()-r.getTime())/864e5);if(n>0){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`payment_overdue_${t.id}`,type:"payment",priority:n>7?"high":"medium",title:`دفعة آجلة - ${a}`,description:`دفعة آجلة منذ ${n} يوم - المبلغ: ${this.formatAmount(t.remaining_balance)}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}if("partial"===t.status&&t.remaining_balance&&t.remaining_balance>0){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`payment_partial_${t.id}`,type:"payment",priority:"medium",title:`دفعة جزئية - ${a}`,description:`تم دفع ${this.formatAmount(t.amount)} من أصل ${this.formatAmount(t.amount+t.remaining_balance)} - المتبقي: ${this.formatAmount(t.remaining_balance)}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("failed"===t.status||"rejected"===t.status){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`payment_failed_${t.id}`,type:"payment",priority:"high",title:`دفعة مرفوضة - ${a}`,description:`دفعة بقيمة ${t.amount}$ تم رفضها - ${t.notes||"بحاجة لمراجعة"}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating payment alerts:",t)}return e}static async generateTreatmentAlerts(){const e=[];try{const t=await(window.electronAPI?.toothTreatments?.getAll?.())||[],a=new Date;t.forEach(t=>{if("planned"===t.treatment_status||"in_progress"===t.treatment_status){const r=new Date(t.created_at),n=Math.floor((a.getTime()-r.getTime())/864e5);n>14&&e.push({id:`treatment_pending_${t.id}`,type:"treatment",priority:n>30?"high":"medium",title:`علاج آجل - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} آجل منذ ${n} يوم`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("completed"===t.treatment_status&&t.notes&&t.notes.includes("متابعة")){const r=new Date(t.updated_at||t.created_at);Math.floor((a.getTime()-r.getTime())/864e5)>7&&e.push({id:`treatment_followup_${t.id}`,type:"treatment",priority:"medium",title:`متابعة علاج - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} يحتاج متابعة`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.treatment_type&&["تقويم","زراعة","علاج عصب","تركيب"].some(e=>t.treatment_type.includes(e))){const r=new Date(t.created_at),n=Math.floor((a.getTime()-r.getTime())/864e5);n>21&&"completed"!==t.treatment_status&&e.push({id:`treatment_complex_${t.id}`,type:"treatment",priority:"medium",title:`علاج معقد - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} قيد التنفيذ منذ ${n} يوم`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating treatment alerts:",t)}return e}static async generatePrescriptionAlerts(){const e=[];try{const t=await(window.electronAPI?.prescriptions?.getAll?.())||[],a=new Date;t.forEach(t=>{const r=new Date(t.prescription_date),n=Math.floor((a.getTime()-r.getTime())/864e5);if(n>30){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`prescription_old_${t.id}`,type:"prescription",priority:"medium",title:`وصفة قديمة - ${a}`,description:`وصفة صادرة منذ ${n} يوم - قد تحتاج تجديد`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.notes&&t.notes.includes("متابعة")&&n>7){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`prescription_followup_${t.id}`,type:"prescription",priority:"medium",title:`متابعة وصفة - ${a}`,description:`وصفة تحتاج متابعة منذ ${n} يوم - ${t.notes}`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null,daysSince:n},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.notes&&(t.notes.includes("مضاد حيوي")||t.notes.includes("مسكن قوي"))&&n>14){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`prescription_important_med_${t.id}`,type:"prescription",priority:"medium",title:`وصفة أدوية مهمة - ${a}`,description:`وصفة تحتوي على أدوية مهمة منذ ${n} يوم - تحتاج متابعة`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null,medicationType:"important"},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(!t.notes||""===t.notes.trim()){const a=t.patient?.full_name||"مريض غير محدد",r=t.patient_id||null;e.push({id:`prescription_no_notes_${t.id}`,type:"prescription",priority:"low",title:`وصفة بدون ملاحظات - ${a}`,description:`وصفة صادرة منذ ${n} يوم بدون ملاحظات - قد تحتاج توضيح`,patientId:r,patientName:"مريض غير محدد"!==a?a:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}});(await(window.electronAPI?.medications?.getAll?.())||[]).forEach(t=>{if(t.expiry_date){const r=new Date(t.expiry_date),n=Math.floor((r.getTime()-a.getTime())/864e5);n<=30&&n>=0&&e.push({id:`medication_expiry_warning_${t.id}`,type:"prescription",priority:n<=7?"high":"medium",title:`دواء قريب الانتهاء - ${t.name}`,description:`ينتهي خلال ${n} يوم - قد يؤثر على الوصفات الجديدة`,relatedData:{medicationId:t.id,medicationName:t.name,expiryDate:t.expiry_date,daysUntilExpiry:n},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}t.quantity<=(t.min_quantity||10)&&e.push({id:`medication_low_stock_${t.id}`,type:"prescription",priority:0===t.quantity?"high":"medium",title:`دواء منخفض في المخزون - ${t.name}`,description:`الكمية المتبقية: ${t.quantity} - قد يؤثر على الوصفات`,relatedData:{medicationId:t.id,medicationName:t.name,currentQuantity:t.quantity,minimumQuantity:t.min_quantity||10},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(t){console.error("Error generating prescription alerts:",t)}return e}static async generateFollowUpAlerts(){const e=[];try{const a=await(window.electronAPI?.appointments?.getAll?.())||[],r=new Date,n={};a.forEach(e=>{if("completed"===e.status&&e.patient_id){const t=new Date(e.start_time);(!n[e.patient_id]||t>n[e.patient_id])&&(n[e.patient_id]=t)}});for(const[s,o]of Object.entries(n)){const a=Math.floor((r.getTime()-o.getTime())/864e5);if(a>90)try{const t=await(window.electronAPI?.patients?.getById?.(s));t&&e.push({id:`follow_up_${s}`,type:"follow_up",priority:"low",title:`متابعة مطلوبة - ${t.full_name}`,description:`لم يزر المريض العيادة منذ ${a} يوم - قد يحتاج متابعة`,patientId:t.id,patientName:t.full_name,relatedData:{},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}catch(t){console.error("Error getting patient data for follow-up alert:",t)}}}catch(t){console.error("Error generating follow-up alerts:",t)}return e}static async createAlert(e){const t={...e,id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString()};try{return await(window.electronAPI?.smartAlerts?.create?.(t))?(Yt.emit("alert:created",{alert:t}),Yt.emit("alerts:changed"),t):(console.log("⚠️ Alert creation skipped (duplicate found):",t.title),t)}catch(a){throw console.error("Error creating alert:",a),a}}static async deleteAppointmentAlerts(e){try{console.log("🗑️ Deleting alerts for appointment:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByRelatedData?.("appointmentId",e))||0;console.log(`🗑️ Deleted ${t} alerts for appointment ${e}`),Yt.emit("alert:deleted",{type:"appointment",relatedId:e,count:t}),Yt.emit("alerts:changed")}catch(t){console.error("Error deleting appointment alerts:",t)}}static async deletePaymentAlerts(e){try{console.log("🗑️ Deleting alerts for payment:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByRelatedData?.("paymentId",e))||0;console.log(`🗑️ Deleted ${t} alerts for payment ${e}`),Yt.emit("alert:deleted",{type:"payment",relatedId:e,count:t}),Yt.emit("alerts:changed")}catch(t){console.error("Error deleting payment alerts:",t)}}static async deletePatientAlerts(e){try{console.log("🗑️ Deleting alerts for patient:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByPatient?.(e))||0;console.log(`🗑️ Deleted ${t} alerts for patient ${e}`),Yt.emit("alert:deleted",{type:"patient",relatedId:e,count:t}),Yt.emit("alerts:changed")}catch(t){console.error("Error deleting patient alerts:",t)}}static async deleteAlertsByType(e,t){try{console.log("🗑️ Deleting alerts by type:",e,"for patient:",t);const a=await(window.electronAPI?.smartAlerts?.deleteByType?.(e,t))||0;console.log(`🗑️ Deleted ${a} alerts of type ${e}${t?` for patient ${t}`:""}`),Yt.emit("alert:deleted",{type:e,patientId:t,count:a}),Yt.emit("alerts:changed")}catch(a){console.error("Error deleting alerts by type:",a)}}static async updateAlert(e,t){try{console.log("🔄 SmartAlertsService: updateAlert called",{alertId:e,updates:t});const a=await(window.electronAPI?.smartAlerts?.update?.(e,t));console.log("✅ Alert updated in database:",e,t,"Result:",a),console.log("📡 Emitting alert:updated event..."),Yt.emit("alert:updated",{alertId:e,updates:t}),console.log("📡 Emitting alerts:changed event..."),Yt.emit("alerts:changed"),console.log("✅ All events emitted successfully")}catch(a){throw console.error("❌ Error updating alert:",a),a}}static async deleteAlert(e){try{await(window.electronAPI?.smartAlerts?.delete?.(e)),console.log("✅ Alert deleted from database:",e),Yt.emit("alert:deleted",{alertId:e}),Yt.emit("alerts:changed")}catch(t){throw console.error("Error deleting alert:",t),t}}static addEventListener(e,t){Yt.addEventListener(e,t)}static removeEventListener(e,t){Yt.removeEventListener(e,t)}static emitEvent(e,t){Yt.emit(e,t)}static clearAllEventListeners(){Yt.removeAllListeners()}static async generateInventoryAlerts(){const e=[];try{const t=await(window.electronAPI?.inventory?.getAll?.())||[],a=new Date;t.forEach(t=>{if(t.expiry_date){const r=new Date(t.expiry_date),n=Math.floor((r.getTime()-a.getTime())/864e5);n<=30&&n>=0?e.push({id:`inventory_expiry_${t.id}`,type:"inventory",priority:n<=7?"high":"medium",title:`انتهاء صلاحية قريب - ${t.name}`,description:`ينتهي في ${n} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id},actionRequired:!0,dueDate:t.expiry_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}):n<0&&e.push({id:`inventory_expired_${t.id}`,type:"inventory",priority:"high",title:`منتهي الصلاحية - ${t.name}`,description:`انتهت الصلاحية منذ ${Math.abs(n)} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.quantity<=(t.min_quantity||5)&&e.push({id:`inventory_low_${t.id}`,type:"inventory",priority:0===t.quantity?"high":"medium",title:`مخزون منخفض - ${t.name}`,description:`الكمية المتبقية: ${t.quantity} - الحد الأدنى: ${t.min_quantity||5}`,relatedData:{inventoryId:t.id,currentQuantity:t.quantity,minimumQuantity:t.min_quantity||5},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),t.usage_rate&&t.usage_rate>0){const a=Math.floor(t.quantity/t.usage_rate);a<=7&&a>0&&e.push({id:`inventory_high_usage_${t.id}`,type:"inventory",priority:a<=3?"high":"medium",title:`استخدام مفرط - ${t.name}`,description:`سينفد خلال ${a} يوم بمعدل الاستخدام الحالي (${t.usage_rate}/يوم)`,relatedData:{inventoryId:t.id,usageRate:t.usage_rate,daysUntilEmpty:a,currentQuantity:t.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.last_used_date){const r=new Date(t.last_used_date),n=Math.floor((a.getTime()-r.getTime())/864e5);n>90&&e.push({id:`inventory_unused_${t.id}`,type:"inventory",priority:"low",title:`عنصر غير مستخدم - ${t.name}`,description:`لم يستخدم منذ ${n} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id,lastUsedDate:t.last_used_date,daysSinceLastUse:n,currentQuantity:t.quantity},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating inventory alerts:",t)}return e}static async clearExpiredSnoozedAlerts(){try{await(window.electronAPI?.smartAlerts?.clearExpiredSnoozed?.()),console.log("✅ Cleared expired snoozed alerts")}catch(e){console.error("Error clearing expired snoozed alerts:",e)}}static async clearDismissedAlerts(){try{await(window.electronAPI?.smartAlerts?.clearDismissed?.()),console.log("✅ Cleared dismissed alerts")}catch(e){console.error("Error clearing dismissed alerts:",e)}}static async cleanupOutdatedAlerts(){try{console.log("🧹 Cleaning up outdated alerts...");const t=await(window.electronAPI?.smartAlerts?.getAll?.())||[],a=new Date,r=new Date(a.getTime()-2592e5);let n=0;for(const s of t){let t=!1;if(s.isDismissed&&new Date(s.createdAt)<r&&(t=!0),"appointment"===s.type&&s.relatedData?.appointmentId)try{const e=(await(window.electronAPI?.appointments?.getAll?.())||[]).find(e=>e.id===s.relatedData?.appointmentId);if(!e||"completed"!==e.status&&"cancelled"!==e.status||(t=!0),e&&e.start_time){const r=new Date(e.start_time);a>new Date(r.getTime()+6048e5)&&(t=!0)}}catch(e){console.warn("Error checking appointment for alert cleanup:",e)}if("payment"===s.type&&s.relatedData?.paymentId)try{const e=(await(window.electronAPI?.payments?.getAll?.())||[]).find(e=>e.id===s.relatedData?.paymentId);e&&("completed"===e.status||e.remaining_balance<=0)&&(t=!0)}catch(e){console.warn("Error checking payment for alert cleanup:",e)}if(t)try{await(window.electronAPI?.smartAlerts?.delete?.(s.id)),n++}catch(e){console.warn("Error deleting outdated alert:",s.id,e)}}console.log(`🧹 Cleaned up ${n} outdated alerts`)}catch(e){console.error("Error during alert cleanup:",e)}}static removeDuplicateAlerts(e){const t=new Map,a=new Map;return e.forEach(e=>{const r=t.get(e.id);if(r){if(this.isAlertMoreComplete(e,r)){t.set(e.id,e);const r=this.generateContentKey(e);a.set(r,e)}}else{const r=this.generateContentKey(e),n=a.get(r);if(n){const s=new Date(n.createdAt).getTime();(new Date(e.createdAt).getTime()>s||this.isAlertMoreComplete(e,n))&&(t.delete(n.id),t.set(e.id,e),a.set(r,e))}else t.set(e.id,e),a.set(r,e)}}),Array.from(t.values())}static generateContentKey(e){return[e.type,e.patientId||"no-patient",e.title.replace(/\s+/g,"").toLowerCase(),e.relatedData?JSON.stringify(e.relatedData):"no-data"].join("|")}static isAlertMoreComplete(e,t){const a=new Date(e.createdAt).getTime(),r=new Date(t.createdAt).getTime();if(a>r)return!0;if(a<r)return!1;return this.calculateCompletenessScore(e)>this.calculateCompletenessScore(t)}static calculateCompletenessScore(e){let t=0;return e.patientId&&(t+=2),e.patientName&&(t+=1),e.relatedData&&Object.keys(e.relatedData).length>0&&(t+=3),e.dueDate&&(t+=1),e.actionRequired&&(t+=1),void 0!==e.isRead&&(t+=1),void 0!==e.isDismissed&&(t+=1),t}static sortAlertsByPriority(e){const t={high:1,medium:2,low:3};return e.sort((e,a)=>{if(e.isRead!==a.isRead)return e.isRead?1:-1;if(e.actionRequired!==a.actionRequired)return e.actionRequired?-1:1;const r=t[e.priority]-t[a.priority];if(0!==r)return r;if(e.dueDate&&a.dueDate){const t=new Date(e.dueDate).getTime()-new Date(a.dueDate).getTime();if(0!==t)return t}else{if(e.dueDate&&!a.dueDate)return-1;if(!e.dueDate&&a.dueDate)return 1}return new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime()})}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static async generateLabOrderAlerts(){const e=[];try{const t=await(window.electronAPI?.labOrders?.getAll?.())||[],a=new Date;t.forEach(t=>{if(t.expected_delivery_date&&"آجل"===t.status){const r=new Date(t.expected_delivery_date),n=Math.floor((a.getTime()-r.getTime())/864e5);n>0&&e.push({id:`lab_order_overdue_${t.id}`,type:"lab_order",priority:n>7?"high":"medium",title:`طلب مختبر متأخر - ${t.service_name}`,description:`متأخر ${n} يوم عن الموعد المتوقع${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,expectedDate:t.expected_delivery_date},actionRequired:!0,dueDate:t.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.remaining_balance>0&&e.push({id:`lab_order_payment_${t.id}`,type:"payment",priority:"medium",title:`دفعة مختبر آجلة - ${t.service_name}`,description:`المبلغ المتبقي: ${this.formatAmount(t.remaining_balance)}${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,remainingBalance:t.remaining_balance},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),t.expected_delivery_date&&"آجل"===t.status){const r=new Date(t.expected_delivery_date),n=Math.floor((r.getTime()-a.getTime())/864e5);n<=2&&n>=0&&e.push({id:`lab_order_due_soon_${t.id}`,type:"lab_order",priority:"low",title:`طلب مختبر قريب التسليم - ${t.service_name}`,description:`متوقع التسليم خلال ${n} يوم${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,expectedDate:t.expected_delivery_date},actionRequired:!1,dueDate:t.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating lab order alerts:",t)}return e}static async generateClinicNeedsAlerts(){const e=[];try{const t=await(window.electronAPI?.clinicNeeds?.getAll?.())||[],a=new Date;t.forEach(t=>{if("urgent"===t.priority&&"pending"===t.status){const r=new Date(t.created_at),n=Math.floor((a.getTime()-r.getTime())/864e5);e.push({id:`clinic_need_urgent_${t.id}`,type:"inventory",priority:"high",title:`احتياج عاجل آجل - ${t.need_name}`,description:`آجل منذ ${n} يوم - الكمية: ${t.quantity}`,relatedData:{clinicNeedId:t.id,needName:t.need_name,quantity:t.quantity,priority:t.priority},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("ordered"===t.status){const r=new Date(t.created_at),n=Math.floor((a.getTime()-r.getTime())/864e5);n>14&&e.push({id:`clinic_need_delayed_${t.id}`,type:"inventory",priority:"urgent"===t.priority?"high":"medium",title:`احتياج متأخر - ${t.need_name}`,description:`مطلوب منذ ${n} يوم - الكمية: ${t.quantity}`,relatedData:{clinicNeedId:t.id,needName:t.need_name,quantity:t.quantity,supplier:t.supplier},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}t.price>1e3&&"pending"===t.status&&e.push({id:`clinic_need_expensive_${t.id}`,type:"inventory",priority:"medium",title:`احتياج عالي التكلفة - ${t.need_name}`,description:`التكلفة: $${t.price} - يحتاج موافقة`,relatedData:{clinicNeedId:t.id,needName:t.need_name,price:t.price,quantity:t.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(t){console.error("Error generating clinic needs alerts:",t)}return e}static formatTime(e){try{if(!e)return"--";const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting time:",t),"--"}}}const Jt=ee()(ie((e,t)=>({appointments:[],selectedAppointment:null,isLoading:!1,error:null,calendarView:"month",selectedDate:new Date,calendarEvents:[],loadAppointments:async()=>{performance.now(),e({isLoading:!0,error:null});try{performance.now();const a=await window.electronAPI.appointments.getAll();performance.now();a.length;performance.now();e({appointments:a,isLoading:!1});performance.now();t().convertToCalendarEvents()}catch(a){performance.now(),console.error("🏪 Store: Failed to load appointments:",a),e({error:a instanceof Error?a.message:"Failed to load appointments",isLoading:!1})}},createAppointment:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.appointments.create(a),{appointments:n}=t(),s=[...n,r];e({appointments:s,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-added",{detail:{type:"created",appointmentId:r.id,appointment:r}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"created",appointmentId:r.id,appointment:r}})))}catch(r){e({error:r instanceof Error?r.message:"Failed to create appointment",isLoading:!1})}},updateAppointment:async(a,r)=>{e({isLoading:!0,error:null});try{console.log("🏪 Store: Updating appointment:",{id:a,appointmentData:r});try{await Qt.deleteAppointmentAlerts(a)}catch(n){console.warn("Could not delete old appointment alerts:",n)}const s=await window.electronAPI.appointments.update(a,r);console.log("🏪 Store: Received updated appointment:",s);const{appointments:o,selectedAppointment:i}=t(),l=o.map(e=>e.id===a?s:e);console.log("🏪 Store: Updated appointments array, found:",l.filter(e=>e.id===a).length),e({appointments:l,selectedAppointment:i?.id===a?s:i,isLoading:!1}),t().convertToCalendarEvents(),console.log("🏪 Store: Update completed successfully"),await t().loadAppointments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-updated",{detail:{type:"updated",appointmentId:a,appointment:s}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"updated",appointmentId:a,appointment:s}})))}catch(n){throw console.error("🏪 Store: Update failed:",n),e({error:n instanceof Error?n.message:"Failed to update appointment",isLoading:!1}),n}},deleteAppointment:async a=>{e({isLoading:!0,error:null});try{if(!(await window.electronAPI.appointments.delete(a)))throw new Error("Failed to delete appointment");{const{appointments:r,selectedAppointment:n}=t(),s=r.filter(e=>e.id!==a);e({appointments:s,selectedAppointment:n?.id===a?null:n,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-deleted",{detail:{type:"deleted",appointmentId:a}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"deleted",appointmentId:a}})))}}catch(r){e({error:r instanceof Error?r.message:"Failed to delete appointment",isLoading:!1})}},setSelectedAppointment:t=>{e({selectedAppointment:t})},setCalendarView:t=>{e({calendarView:t})},setSelectedDate:t=>{e({selectedDate:t})},clearError:()=>{e({error:null})},convertToCalendarEvents:()=>{const{appointments:a}=t(),r=a.map(e=>{const t=e.patient?.full_name||e.patient_name||e.patient_name||"مريض غير معروف";"مريض غير معروف"===t&&console.log("🗓️ Calendar: Missing patient data for appointment:",{id:e.id,patient_id:e.patient_id,patient:e.patient,patient_name:e.patient_name});const a=`${t} - ${new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`;return{id:e.id,title:a,start:new Date(e.start_time),end:new Date(e.end_time),resource:e}});e({calendarEvents:r})},getAppointmentsForDate:e=>{const{appointments:a}=t(),r=e.toISOString().split("T")[0];return a.filter(e=>new Date(e.start_time).toISOString().split("T")[0]===r)},getAppointmentsForDateRange:(e,a)=>{const{appointments:r}=t();return r.filter(t=>{const r=new Date(t.start_time);return r>=e&&r<=a})},markAsCompleted:async e=>{await t().updateAppointment(e,{status:"completed"})},markAsCancelled:async e=>{await t().updateAppointment(e,{status:"cancelled"})},markAsNoShow:async e=>{await t().updateAppointment(e,{status:"no_show"})}}),{name:"appointment-store"}));if("undefined"!=typeof window){let e=!1;const t=()=>{e||(e=!0,window.addEventListener("patient-deleted",e=>{const{patientId:t}=e.detail,a=Jt.getState(),{appointments:r,selectedAppointment:n}=a,s=r.filter(e=>e.patient_id!==t);Jt.setState({appointments:s,selectedAppointment:n?.patient_id===t?null:n}),a.convertToCalendarEvents(),console.log(`🗑️ Removed ${r.length-s.length} appointments for deleted patient ${t}`)}))};Jt.subscribe(()=>{t()})}const Zt=new class{level;isDev;constructor(){this.isDev="undefined"!=typeof window&&"localhost"===window.location?.hostname,this.level=this.isDev?0:3}shouldLog(e){return e>=this.level}formatMessage(e,t,...a){const r=`[${(new Date).toISOString()}] [${e}]`;return a.length>0?`${r} ${t} ${a.map(e=>"object"==typeof e?JSON.stringify(e,null,2):String(e)).join(" ")}`:`${r} ${t}`}debug(e,...t){this.shouldLog(0)}info(e,...t){this.shouldLog(1)&&console.info(this.formatMessage("INFO",e,...t))}warn(e,...t){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",e,...t))}error(e,...t){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",e,...t))}system(e,...t){this.isDev}security(e,...t){console.warn(`🔐 [SECURITY] ${e}`,...t)}performance(e,...t){this.isDev}user(e,...t){this.isDev}database(e,...t){this.isDev}api(e,...t){this.isDev}whatsapp(e,...t){this.isDev}license(e,...t){console.warn(`🔑 [LICENSE] ${e}`,...t)}auth(e,...t){console.warn(`🔐 [AUTH] ${e}`,...t)}payment(e,...t){this.isDev}appointment(e,...t){this.isDev}patient(e,...t){this.isDev}treatment(e,...t){this.isDev}lab(e,...t){this.isDev}inventory(e,...t){this.isDev}report(e,...t){this.isDev}settings(e,...t){this.isDev}ui(e,...t){this.isDev}search(e,...t){this.isDev}export(e,...t){this.isDev}import(e,...t){this.isDev}backup(e,...t){this.isDev}restore(e,...t){this.isDev}update(e,...t){this.isDev}delete(e,...t){this.isDev}create(e,...t){this.isDev}edit(e,...t){this.isDev}view(e,...t){this.isDev}print(e,...t){this.isDev}notification(e,...t){this.isDev}critical(e,...t){console.error(`🚨 [CRITICAL] ${e}`,...t)}warning(e,...t){console.warn(`⚠️ [WARNING] ${e}`,...t)}success(e,...t){this.isDev}failure(e,...t){console.error(`❌ [FAILURE] ${e}`,...t)}loading(e,...t){this.isDev}complete(e,...t){this.isDev}start(e,...t){this.isDev}stop(e,...t){this.isDev}retry(e,...t){this.isDev}cancel(e,...t){this.isDev}skip(e,...t){this.isDev}ignore(e,...t){this.isDev}bypass(e,...t){this.isDev}override(e,...t){this.isDev}fallback(e,...t){this.isDev}alternative(e,...t){this.isDev}default(e,...t){this.isDev}custom(e,t,...a){this.isDev}group(e,t){this.isDev&&(console.group(e),t(),console.groupEnd())}time(e){this.isDev&&console.time(e)}timeEnd(e){this.isDev&&console.timeEnd(e)}table(e){this.isDev&&console.table(e)}trace(e){this.isDev&&console.trace(e)}count(e){this.isDev&&console.count(e)}countReset(e){this.isDev&&console.countReset(e)}clear(){this.isDev&&console.clear()}assert(e,t){this.isDev&&console.assert(e,t)}dir(e){this.isDev&&console.dir(e)}dirxml(e){this.isDev&&console.dirxml(e)}profile(e){this.isDev&&console.profile(e)}profileEnd(e){this.isDev&&console.profileEnd(e)}markTimeline(e){this.isDev&&console.markTimeline(e)}timeline(e){this.isDev&&console.timeline(e)}timelineEnd(e){this.isDev&&console.timelineEnd(e)}groupCollapsed(e){this.isDev&&console.groupCollapsed(e)}groupEnd(){this.isDev&&console.groupEnd()}memory(){this.isDev&&console.memory()}getLevel(){return this.level}setLevel(e){this.level=e}isDevelopment(){return this.isDev}isProduction(){return!this.isDev}},ea=e=>{if(e&&e.clinic_name&&"عيادة الأسنان"!==e.clinic_name)try{const t={clinic_name:e.clinic_name,doctor_name:e.doctor_name,clinic_logo:e.clinic_logo,clinic_phone:e.clinic_phone,clinic_email:e.clinic_email,clinic_address:e.clinic_address,timestamp:Date.now()};localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t))}catch(t){console.warn("Failed to save settings backup:",t)}},ta=ee()(ie(ue((e,t)=>({settings:null,isLoading:!1,error:null,isDarkMode:!1,language:"en",currency:"USD",useArabicNumerals:!1,isLoaded:!1,loadSettings:async()=>{const a=performance.now(),r=t();if(r.isLoading)return void Zt.warn("Settings already loading, skipping duplicate request");if(r.isLoaded&&r.settings&&(Date.now()-r.lastSuccessfulLoad||0)<3e4)return void Zt.debug("Settings recently loaded, skipping duplicate request");const n=r.consecutiveFailures||0;if(n>=3)Zt.warn(`Settings loading circuit breaker open - ${n} consecutive failures`);else if(r.isLoaded&&r.error&&(Date.now()-r.lastLoadAttempt||0)<5e3)Zt.warn("Settings load failed recently, skipping retry to prevent loop");else{e({isLoading:!0,error:null,lastLoadAttempt:Date.now()});try{const t=performance.now();if(!window.electronAPI||!window.electronAPI.settings||!window.electronAPI.settings.get)throw new Error("electronAPI.settings.get is not available");const r=window.electronAPI.settings.get(),n=new Promise((e,t)=>setTimeout(()=>t(new Error("Settings loading timeout after 10 seconds")),1e4));Zt.debug("Settings Store: About to call window.electronAPI.settings.get()");const s=await Promise.race([r,n]);Zt.debug("Settings Store: Received settings from electronAPI:",{has_settings:!!s,clinic_name:s?.clinic_name,has_clinic_logo:!!s?.clinic_logo,clinic_logo_length:s?.clinic_logo?.length||0});const o=performance.now();if(Zt.debug(`Settings API Call: ${(o-t).toFixed(2)}ms`),!s)throw new Error("Settings API returned null or undefined");if(!s.clinic_logo||""!==s.clinic_logo.trim()&&"null"!==s.clinic_logo&&"undefined"!==s.clinic_logo||(Zt.warn("Settings Store: Invalid clinic_logo detected, setting to null to prevent errors"),s.clinic_logo=null),!s||!s.clinic_name||"عيادة الأسنان"===s.clinic_name){const t=performance.now(),r=(()=>{try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<2592e6&&t.clinic_name&&"عيادة الأسنان"!==t.clinic_name)return t}}catch(e){console.warn("Failed to restore settings backup:",e)}return null})();if(r){const n={...s,...r};await window.electronAPI.settings.update(r),e({settings:n,language:s?.language||"ar",currency:s?.currency||"USD",isLoading:!1,isLoaded:!0});try{window.__CLINIC_SETTINGS__=n}catch{}ea(n);const o=performance.now();return Zt.debug(`Settings Backup Restore: ${(o-t).toFixed(2)}ms`),Zt.success(`Settings Store: Load Settings: ${(o-a).toFixed(2)}ms`),void e({consecutiveFailures:0})}}const i=performance.now();e({settings:s,language:s?.language||"ar",currency:s?.currency||"USD",useArabicNumerals:s?.use_arabic_numerals||!1,isLoading:!1,isLoaded:!0});try{window.__CLINIC_SETTINGS__=s}catch{}const l=performance.now();Zt.debug(`Settings State Update: ${(l-i).toFixed(2)}ms`),ea(s);const d=performance.now();Zt.success(`Settings Store: Load Settings: ${(d-a).toFixed(2)}ms`),e({consecutiveFailures:0,lastSuccessfulLoad:Date.now()})}catch(s){const r=performance.now(),n=s instanceof Error&&(s.message.includes("Failed to load image from path")||s.message.includes("Failed to load image")),o={message:s instanceof Error?s.message:"Unknown error",stack:s instanceof Error?s.stack:void 0,type:typeof s,error:s,isImageError:n};if(n)Zt.warn(`Settings Store: Image Loading Error (non-critical): ${(r-a).toFixed(2)}ms`,o),e({error:null,isLoading:!1,isLoaded:!0,consecutiveFailures:0});else{Zt.error(`Settings Store: Load Settings Failed: ${(r-a).toFixed(2)}ms`,o);const n=t().consecutiveFailures||0;e({error:s instanceof Error?s.message:"Failed to load settings",isLoading:!1,isLoaded:!0,consecutiveFailures:n+1})}}}},updateSettings:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.settings.update(a);e({settings:r,language:r.language,currency:r.currency,useArabicNumerals:r.use_arabic_numerals||!1,isLoading:!1,isLoaded:!0});try{window.__CLINIC_SETTINGS__=r}catch{}ea(r),setTimeout(()=>{const a=t();a.settings&&e({settings:a.settings})},10)}catch(r){e({error:r instanceof Error?r.message:"Failed to update settings",isLoading:!1,isLoaded:!0})}},toggleDarkMode:()=>{const a=performance.now();Zt.performance("Theme switch initiated");const{isDarkMode:r,settings:n}=t(),s=!r,o=n;if(e({isDarkMode:s,settings:o}),requestAnimationFrame(()=>{const e=performance.now();s?(document.documentElement.classList.add("dark"),document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("dental-clinic-theme","dark"),Zt.performance(`DOM class added (dark mode): ${(performance.now()-e).toFixed(2)}ms`)):(document.documentElement.classList.remove("dark"),document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("dental-clinic-theme","light"),Zt.performance(`DOM class removed (light mode): ${(performance.now()-e).toFixed(2)}ms`))}),o)try{const e=performance.now();localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:o.clinic_name,doctor_name:o.doctor_name,clinic_logo:o.clinic_logo,clinic_phone:o.clinic_phone,clinic_email:o.clinic_email,clinic_address:o.clinic_address,backup_timestamp:Date.now()})),Zt.performance(`Settings backup saved: ${(performance.now()-e).toFixed(2)}ms`)}catch(i){console.warn("Failed to save settings backup:",i)}Zt.performance(`Theme switch completed: ${(performance.now()-a).toFixed(2)}ms total`),Zt.performance(`Theme switch state update: ${(performance.now()-a).toFixed(2)}ms`)},initializeDarkMode:()=>{const a=localStorage.getItem("dental-clinic-theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=t();let s=!1;a?s="dark"===a:(s=r,localStorage.setItem("dental-clinic-theme",s?"dark":"light"));const o=n.settings;s!==n.isDarkMode&&(e({isDarkMode:s,settings:o}),s?(document.documentElement.classList.add("dark"),document.documentElement.setAttribute("data-theme","dark")):(document.documentElement.classList.remove("dark"),document.documentElement.setAttribute("data-theme","light")))},setLanguage:a=>{e({language:a}),t().updateSettings({language:a})},setCurrency:a=>{e({currency:a}),t().updateSettings({currency:a})},setUseArabicNumerals:a=>{e({useArabicNumerals:a}),t().updateSettings({use_arabic_numerals:a})},clearError:()=>{e({error:null})},getWorkingDays:()=>{const{settings:e}=t();return e?.working_days?e.working_days.split(",").map(e=>e.trim()):["monday","tuesday","wednesday","thursday","friday"]},isWorkingDay:e=>{const a=t().getWorkingDays(),r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()];return a.includes(r)},getWorkingHours:()=>{const{settings:e}=t();return{start:e?.working_hours_start||"09:00",end:e?.working_hours_end||"17:00"}},isWithinWorkingHours:e=>{const{start:a,end:r}=t().getWorkingHours();return e>=a&&e<=r}}),{name:"settings-store",partialize:e=>({language:e.language,currency:e.currency,isDarkMode:e.isDarkMode,clinicSettingsBackup:e.settings?{clinic_name:e.settings.clinic_name,doctor_name:e.settings.doctor_name,clinic_logo:e.settings.clinic_logo,clinic_phone:e.settings.clinic_phone,clinic_email:e.settings.clinic_email,clinic_address:e.settings.clinic_address,backup_timestamp:Date.now()}:null}),storage:{getItem:e=>{const t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t)),t.state?.clinicSettingsBackup&&localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t.state.clinicSettingsBackup))},removeItem:e=>localStorage.removeItem(e)}}),{name:"settings-store"})),aa=Q.createContext(void 0);function ra({children:t}){const{isDarkMode:a,toggleDarkMode:r,initializeDarkMode:n,loadSettings:s,settings:o,isLoaded:i}=ta();Q.useEffect(()=>{if(!i)return;let e=!1;const t=setTimeout(()=>{if(!e){e=!0;try{const t=document.documentElement,r=t.getAttribute("data-theme"),n=t.classList.contains("dark"),s=a?"dark":"light";r!==s||n!==a?(t.setAttribute("data-theme",s),a?t.classList.add("dark"):t.classList.remove("dark"),t.style.setProperty("contain","layout style paint"),requestAnimationFrame(()=>{t.style.setProperty("--theme-transition-duration","0.2s"),t.classList.add("theme-transitions-enabled"),e=!1})):e=!1}catch(t){console.warn("Theme application failed:",t),e=!1}}},0);return()=>{clearTimeout(t),e=!1}},[a,i]);const l=Q.useCallback(()=>{r()},[r]),d=Q.useCallback(e=>{e!==a&&r()},[a,r]),c=Q.useMemo(()=>({isDarkMode:a,toggleDarkMode:l,setDarkMode:d,theme:a?"dark":"light"}),[a,l,d]);return e.jsx(aa.Provider,{value:c,children:t})}function na(){const e=Q.useContext(aa);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e}function sa(){const{isDarkMode:e}=na();return Q.useMemo(()=>({bgPrimary:"bg-background",bgSecondary:"bg-card",bgTertiary:"bg-muted",textPrimary:"text-foreground",textSecondary:"text-muted-foreground",textMuted:"text-muted-foreground",border:"border-border",borderLight:"border-input",borderFocus:"border-ring",nav:"bg-background border-border shadow-sm",navItem:"text-muted-foreground hover:text-foreground hover:bg-accent transition-colors rounded-md px-3 py-2",navItemActive:"text-primary bg-accent border-l-2 border-primary font-medium",tableHeader:"bg-muted text-foreground font-semibold",tableRow:"hover:bg-accent/50 transition-colors",tableCell:"text-foreground border-border",dialogHeader:"text-foreground font-semibold",dialogContent:"text-muted-foreground",buttonGhost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98] transition-colors",...{bgElevated:e?"bg-card shadow-lg shadow-black/10":"bg-card shadow-sm",textHighContrast:"text-foreground",textMediumContrast:"text-muted-foreground",card:e?"bg-card border-border text-card-foreground shadow-lg shadow-black/10 hover:shadow-xl":"bg-card border-border text-card-foreground shadow-sm hover:shadow-md",buttonPrimary:e?"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 active:scale-[0.98]":"bg-primary hover:bg-primary/90 text-primary-foreground shadow-md active:scale-[0.98]",buttonSecondary:e?"bg-secondary hover:bg-secondary/80 text-secondary-foreground border-border shadow-lg shadow-secondary/20 active:scale-[0.98]":"bg-secondary hover:bg-secondary/80 text-secondary-foreground border-border shadow-md active:scale-[0.98]",buttonOutline:e?"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] shadow-md":"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] shadow-sm",input:e?"bg-background border-input text-foreground placeholder-muted-foreground focus:border-ring shadow-md":"bg-background border-input text-foreground placeholder-muted-foreground focus:border-ring shadow-sm",table:e?"bg-card border-border shadow-lg shadow-black/10":"bg-background border-border shadow-sm",dialog:e?"bg-card border-border shadow-xl shadow-black/20":"bg-background border-border shadow-lg"},...e?{statusScheduled:"bg-primary/20 text-primary border border-primary/30 rounded-full px-2 py-1 text-xs font-medium",statusCompleted:"bg-green-900/20 text-green-400 border border-green-800 rounded-full px-2 py-1 text-xs font-medium",statusCancelled:"bg-destructive/20 text-destructive border border-destructive/30 rounded-full px-2 py-1 text-xs font-medium",statusNoShow:"bg-muted text-muted-foreground border border-border rounded-full px-2 py-1 text-xs font-medium",statusInProgress:"bg-amber-900/20 text-amber-400 border border-amber-800 rounded-full px-2 py-1 text-xs font-medium",notificationSuccess:"bg-green-900/20 text-green-400 border border-green-800 shadow-lg",notificationError:"bg-red-900/20 text-red-400 border border-red-800 shadow-lg",notificationWarning:"bg-amber-900/20 text-amber-400 border border-amber-800 shadow-lg",notificationInfo:"bg-blue-900/20 text-blue-400 border border-blue-800 shadow-lg",alertError:"bg-destructive/20 border-destructive/30",alertWarning:"bg-amber-900/20 border-amber-800/50",alertSuccess:"bg-green-900/20 border-green-800/50",alertInfo:"bg-blue-900/20 border-blue-800/50"}:{statusScheduled:"bg-primary/10 text-primary border border-primary/20 rounded-full px-2 py-1 text-xs font-medium",statusCompleted:"bg-green-100 text-green-800 border border-green-200 rounded-full px-2 py-1 text-xs font-medium",statusCancelled:"bg-destructive/10 text-destructive border border-destructive/20 rounded-full px-2 py-1 text-xs font-medium",statusNoShow:"bg-muted text-muted-foreground border border-border rounded-full px-2 py-1 text-xs font-medium",statusInProgress:"bg-amber-100 text-amber-800 border border-amber-200 rounded-full px-2 py-1 text-xs font-medium",notificationSuccess:"bg-green-50 text-green-800 border border-green-200 shadow-md",notificationError:"bg-red-50 text-red-800 border border-red-200 shadow-md",notificationWarning:"bg-amber-50 text-amber-800 border border-amber-200 shadow-md",notificationInfo:"bg-blue-50 text-blue-800 border border-blue-200 shadow-md",alertError:"bg-destructive/10 border-destructive/20",alertWarning:"bg-amber-50 border-amber-200",alertSuccess:"bg-green-50 border-green-200",alertInfo:"bg-blue-50 border-blue-200"}}),[e])}Q.memo(function({children:t,className:a="",enableContainment:r=!0,...n}){return na(),e.jsx("div",{...n,className:`theme-container ${r?"theme-optimized":""} ${a}`,"data-theme-aware":"true",children:t})});const oa=Q.createContext(void 0);function ia({children:t}){const{currency:a,setCurrency:r,useArabicNumerals:n,setUseArabicNumerals:s,settings:o,loadSettings:i}=ta();Q.useEffect(()=>{o||i()},[o,i]);const l=a||o?.currency||"USD",d=kt(l);Q.useEffect(()=>{At(l)},[l]);const c=Q.useCallback(e=>{jt[e]?(r(e),At(e)):console.warn(`Unsupported currency: ${e}`)},[r]),u=Q.useCallback(e=>{s(e)},[s]),m=Q.useCallback(()=>jt,[]),p=!1,g=Q.useCallback((e,t,a)=>Ct(e,t||l),[l]),h=Q.useCallback((e,t,a)=>function(e,t){const a=kt(t||Dt()),r=Number(e);if(isNaN(r)||!isFinite(r))return a.symbol;try{const e=Rt(a.locale,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(r));return"before"===a.position?`${a.symbol}${e}`:`${e} ${a.symbol}`}catch(n){const e=Math.round(r).toString();return"before"===a.position?`${a.symbol}${e}`:`${e} ${a.symbol}`}}(e,t||l),[l]),f=Q.useCallback((e,t,a)=>Tt(e,t||d),[d]),y=Q.useCallback(e=>kt(e||l).symbol,[l]),b=Q.useCallback((e,t=!1)=>{const a=kt(e||l);return t?a.nameAr:a.name},[l]),x=Q.useCallback(e=>kt(e||l).decimals,[l]),w=Q.useMemo(()=>({currentCurrency:l,currencyConfig:d,useArabicNumerals:p,setCurrency:c,setUseArabicNumerals:u,getSupportedCurrencies:m,formatAmount:g,formatAmountSymbol:h,formatAmountWithConfig:f,getCurrencySymbol:y,getCurrencyName:b,getCurrencyDecimals:x}),[l,d,p,c,u,m,g,h,f,y,b,x]);return e.jsx(oa.Provider,{value:w,children:t})}function la(){const e=Q.useContext(oa);if(void 0===e)throw new Error("useCurrency must be used within a CurrencyProvider");return e}const da=ee()(ie((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",a=>{const{patientId:r}=a.detail,{payments:n,selectedPayment:s}=t(),o=n.filter(e=>e.patient_id!==r);e({payments:o,selectedPayment:s?.patient_id===r?null:s}),t(),window.addEventListener("treatment-payments-deleted",a=>{const{treatmentId:r}=a.detail,{payments:n,selectedPayment:s}=t(),o=n.filter(e=>e.tooth_treatment_id!==r);e({payments:o,selectedPayment:s?.tooth_treatment_id===r?null:s}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments()}),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments()}),{payments:[],filteredPayments:[],selectedPayment:null,isLoading:!1,error:null,searchQuery:"",statusFilter:"all",paymentMethodFilter:"all",totalRevenue:0,pendingAmount:0,totalRemainingBalance:0,partialPaymentsCount:0,pendingPaymentsCount:0,monthlyRevenue:{},paymentMethodStats:{},loadPayments:async()=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.payments.getAll();e({payments:a,filteredPayments:a,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments()}catch(a){e({error:a instanceof Error?a.message:"Failed to load payments",isLoading:!1})}},createPayment:async a=>{e({isLoading:!0,error:null});try{const e=await window.electronAPI.payments.create(a);return await t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"created",paymentId:e.id,payment:e}})),window.dispatchEvent(new CustomEvent("payment-added",{detail:{type:"created",paymentId:e.id,payment:e}}))),e}catch(r){throw console.error("❌ Failed to create payment in store:",r),e({error:r instanceof Error?r.message:"Failed to create payment",isLoading:!1}),r}},updatePayment:async(a,r)=>{e({isLoading:!0,error:null});try{try{await Qt.deletePaymentAlerts(a)}catch(n){console.warn("Could not delete old payment alerts:",n)}const e=await window.electronAPI.payments.update(a,r);return await t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"updated",paymentId:a,payment:e}})),window.dispatchEvent(new CustomEvent("payment-updated",{detail:{type:"updated",paymentId:a,payment:e}}))),e}catch(n){throw console.error("❌ Failed to update payment in store:",n),e({error:n instanceof Error?n.message:"Failed to update payment",isLoading:!1}),n}},deletePayment:async a=>{e({isLoading:!0,error:null});try{await window.electronAPI.payments.delete(a);const{payments:r,selectedPayment:n}=t(),s=r.filter(e=>e.id!==a);e({payments:s,selectedPayment:n?.id===a?null:n,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"deleted",paymentId:a}})),window.dispatchEvent(new CustomEvent("payment-deleted",{detail:{type:"deleted",paymentId:a}})))}catch(r){e({error:r instanceof Error?r.message:"Failed to delete payment",isLoading:!1})}},searchPayments:a=>{e({searchQuery:a}),t().filterPayments()},setSelectedPayment:t=>{e({selectedPayment:t})},setSearchQuery:a=>{e({searchQuery:a}),t().filterPayments()},setStatusFilter:a=>{e({statusFilter:a}),t().filterPayments()},setPaymentMethodFilter:a=>{e({paymentMethodFilter:a}),t().filterPayments()},filterPayments:()=>{const{payments:a,searchQuery:r,statusFilter:n,paymentMethodFilter:s}=t();let o=a;r&&(o=o.filter(e=>{const t=e.patient?`${e.patient.first_name} ${e.patient.last_name}`:"";return e.receipt_number?.toLowerCase().includes(r.toLowerCase())||e.description?.toLowerCase().includes(r.toLowerCase())||t.toLowerCase().includes(r.toLowerCase())||e.amount.toString().includes(r)||e.payment_method.toLowerCase().includes(r.toLowerCase())||e.status.toLowerCase().includes(r.toLowerCase())})),"all"!==n&&(o=o.filter(e=>e.status===n)),"all"!==s&&(o=o.filter(e=>e.payment_method===s)),e({filteredPayments:o})},clearError:()=>{e({error:null})},calculateTotalRevenue:()=>{const{payments:a}=t(),r=a.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const a=Number(t.amount);return isNaN(a)||!isFinite(a)?(console.warn("Invalid payment amount:",t.amount,"for payment:",t.id),e):e+a},0),n=isNaN(r)||!isFinite(r)?0:Math.round(100*r)/100;e({totalRevenue:n})},calculatePendingAmount:()=>{const{payments:a}=t(),r=a.filter(e=>"pending"===e.status).reduce((e,t)=>{const a=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},r=a(t.amount),n=a(t.total_amount_due);let s=r;if(t.tooth_treatment_id){s=a(t.treatment_total_cost)||n}else if(n>0)s=n;else{const e=a(t.remaining_balance);e>0&&(s=e)}return e+s},0),n=isNaN(r)||!isFinite(r)?0:Math.round(100*r)/100;e({pendingAmount:n})},calculateTotalRemainingBalance:()=>{const{payments:a}=t();let r=0;const n=a.filter(e=>e.tooth_treatment_id&&"partial"===e.status),s={};n.forEach(e=>{s[e.tooth_treatment_id]||(s[e.tooth_treatment_id]=[]),s[e.tooth_treatment_id].push(e)}),Object.keys(s).forEach(e=>{const t=s[e],a=t[t.length-1];void 0!==a.treatment_remaining_balance&&(r+=a.treatment_remaining_balance)});const o=a.filter(e=>e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status),i={};o.forEach(e=>{i[e.appointment_id]||(i[e.appointment_id]=[]),i[e.appointment_id].push(e)}),Object.keys(i).forEach(e=>{const t=i[e],a=t[t.length-1];void 0!==a.remaining_balance&&(r+=a.remaining_balance)});a.filter(e=>!e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status).forEach(e=>{void 0!==e.remaining_balance&&e.remaining_balance>0&&(r+=e.remaining_balance)}),e({totalRemainingBalance:Math.round(100*r)/100})},calculatePartialPaymentsCount:()=>{const{payments:a}=t(),r=a.filter(e=>"partial"===e.status).length;e({partialPaymentsCount:r})},calculatePendingPaymentsCount:()=>{const{payments:a}=t(),r=a.filter(e=>"pending"===e.status).length;e({pendingPaymentsCount:r})},calculateMonthlyRevenue:()=>{const{payments:a}=t(),r={};a.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{try{const t=new Date(e.payment_date);if(isNaN(t.getTime()))return void console.warn("Invalid payment date:",e.payment_date);const a=t.toISOString().slice(0,7),n=Number(e.amount);if(isNaN(n)||!isFinite(n))return void console.warn("Invalid payment amount for monthly revenue:",e.amount,"for payment:",e.id);const s=(r[a]||0)+n;if(isNaN(s)||!isFinite(s))return void console.warn("Invalid monthly total calculation for month:",a);r[a]=Math.round(100*s)/100}catch(t){console.warn("Error processing payment date:",e.payment_date,t)}}),e({monthlyRevenue:r})},calculatePaymentMethodStats:()=>{const{payments:a}=t(),r={};a.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const t=e.payment_method||"unknown",a="partial"===e.status&&void 0!==e.amount_paid?Number(e.amount_paid):Number(e.amount);if(isNaN(a)||!isFinite(a))return void console.warn("Invalid payment amount for method stats:",e.amount,"for payment:",e.id);const n=(r[t]||0)+a;!isNaN(n)&&isFinite(n)?r[t]=Math.round(100*n)/100:console.warn("Invalid method total calculation for method:",t)}),e({paymentMethodStats:r})},getPaymentsByPatient:e=>{const{payments:a}=t();return a.filter(t=>t.patient_id===e)},getPaymentsByAppointment:e=>{const{payments:a}=t();return a.filter(t=>t.appointment_id===e)},getPaymentsByToothTreatment:e=>{const{payments:a}=t();return a.filter(t=>t.tooth_treatment_id===e)},getPaymentsByDateRange:(e,a)=>{const{payments:r}=t();return r.filter(t=>{const r=t.payment_date;if(!r)return!1;const n=new Date(r);let s;return s=r.includes("T")||r.includes(" ")?n:new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),s>=e&&s<=a})},getToothTreatmentPaymentSummary:async e=>{try{return await window.electronAPI.payments.getToothTreatmentSummary(e)}catch(t){throw console.error("Failed to get tooth treatment payment summary:",t),t}},markAsCompleted:async e=>{await t().updatePayment(e,{status:"completed"})},markAsPending:async e=>{await t().updatePayment(e,{status:"pending"})},markAsFailed:async e=>{await t().updatePayment(e,{status:"failed"})},markAsRefunded:async e=>{await t().updatePayment(e,{status:"refunded"})}}),{name:"payment-store"})),ca="dashboard-stats",ua=new Map,ma=e=>{const t={total_patients:e.totalPatients,total_appointments:e.totalAppointments,total_revenue:e.totalRevenue,pending_payments:e.pendingPayments,today_appointments:e.todayAppointments,this_month_revenue:e.thisMonthRevenue,low_stock_items:e.lowStockItems};ua.set(ca,{data:t,timestamp:Date.now()})},pa=ee()(ie((e,t)=>{if("undefined"!=typeof window){["patient-deleted","patient-added","patient-updated","appointment-changed","payment-changed","inventory-changed","clinic-needs-changed","clinic-expenses-changed","treatment-changed","treatment-updated","treatments-loaded"].forEach(e=>{window.addEventListener(e,()=>{ua.delete(ca)})}),window.addEventListener("patient-deleted",async e=>{await t().refreshStats()})}return{stats:{totalPatients:0,totalAppointments:0,totalRevenue:0,pendingPayments:0,todayAppointments:0,thisMonthRevenue:0,lowStockItems:0},isLoading:!1,error:null,lastUpdated:null,loadStats:async()=>{e({isLoading:!0,error:null});try{const t=(()=>{const e=ua.get(ca);if(!e)return null;if(Date.now()-e.timestamp>3e5)return ua.delete(ca),null;const t=e.data;return{totalPatients:t.total_patients,totalAppointments:t.total_appointments,totalRevenue:t.total_revenue,pendingPayments:t.pending_payments,todayAppointments:t.today_appointments,thisMonthRevenue:t.this_month_revenue,lowStockItems:t.low_stock_items}})();if(t)return void e({stats:t,isLoading:!1,lastUpdated:new Date});const[a,r,n,s]=await Promise.all([window.electronAPI?.dashboard?.getStats(),window.electronAPI?.patients?.getAll()?.catch(()=>[]),window.electronAPI?.appointments?.getAll()?.catch(()=>[]),window.electronAPI?.payments?.getAll()?.catch(()=>[])]);let o;if(a)o={totalPatients:a.total_patients||0,totalAppointments:a.total_appointments||0,totalRevenue:a.total_revenue||0,pendingPayments:a.pending_payments||0,todayAppointments:a.today_appointments||0,thisMonthRevenue:a.this_month_revenue||0,lowStockItems:a.low_stock_items||0};else{const e=r?.length||0,t=n?.length||0,a=s?.reduce((e,t)=>e+(t.amount||0),0)||0,i=s?.filter(e=>"pending"===e.status).length||0,l=(new Date).toISOString().split("T")[0],d=n?.filter(e=>e.start_time?.startsWith(l)).length||0,c=(new Date).toISOString().slice(0,7),u=s?.filter(e=>"completed"===e.status&&e.payment_date?.startsWith(c)).reduce((e,t)=>e+(t.amount||0),0)||0,m=0;o={totalPatients:e,totalAppointments:t,totalRevenue:Math.round(100*a)/100,pendingPayments:i,todayAppointments:d,thisMonthRevenue:Math.round(100*u)/100,lowStockItems:m}}ma(o),e({stats:o,isLoading:!1,lastUpdated:new Date})}catch(t){console.error("Error loading dashboard stats:",t),e({error:t instanceof Error?t.message:"Failed to load dashboard stats",isLoading:!1})}},updateStats:a=>{const{stats:r}=t();e({stats:{...r,...a},lastUpdated:new Date})},clearError:()=>{e({error:null})},refreshStats:async()=>{try{const t=await(window.electronAPI?.dashboard?.getStats());if(t){const a={totalPatients:t.total_patients||0,totalAppointments:t.total_appointments||0,totalRevenue:t.total_revenue||0,pendingPayments:t.pending_payments||0,todayAppointments:t.today_appointments||0,thisMonthRevenue:t.this_month_revenue||0,lowStockItems:t.low_stock_items||0};e({stats:a,lastUpdated:new Date}),ma(a)}}catch(t){console.error("Error refreshing dashboard stats:",t)}}}},{name:"dashboard-store"})),ga=ee()(ie((e,t)=>({items:[],filteredItems:[],usage:[],selectedItem:null,isLoading:!1,error:null,searchQuery:"",filters:{},categories:[],suppliers:[],totalItems:0,totalValue:0,lowStockCount:0,expiredCount:0,expiringSoonCount:0,loadItems:async()=>{e({isLoading:!0,error:null});try{const a=await(window.electronAPI?.inventory?.getAll())||[];e({items:a,filteredItems:a,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems()}catch(a){console.error("Error loading inventory items:",a),e({error:a instanceof Error?a.message:"Failed to load inventory items",isLoading:!1})}},createItem:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.inventory.create(a),{items:n}=t(),s=[...n,r];e({items:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"created",itemId:r.id,item:r}})),window.dispatchEvent(new CustomEvent("inventory-added",{detail:{type:"created",itemId:r.id,item:r}})))}catch(r){console.error("Error creating inventory item:",r),e({error:r instanceof Error?r.message:"Failed to create inventory item",isLoading:!1})}},updateItem:async(a,r)=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.inventory.update(a,r),{items:s,selectedItem:o}=t(),i=s.map(e=>e.id===a?n:e);e({items:i,selectedItem:o?.id===a?n:o,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"updated",itemId:a,item:n}})),window.dispatchEvent(new CustomEvent("inventory-updated",{detail:{type:"updated",itemId:a,item:n}})))}catch(n){console.error("Error updating inventory item:",n),e({error:n instanceof Error?n.message:"Failed to update inventory item",isLoading:!1})}},deleteItem:async a=>{e({isLoading:!0,error:null});try{if(!(await window.electronAPI.inventory.delete(a)))throw new Error("Failed to delete inventory item");{const{items:r,selectedItem:n}=t(),s=r.filter(e=>e.id!==a);e({items:s,selectedItem:n?.id===a?null:n,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"deleted",itemId:a}})),window.dispatchEvent(new CustomEvent("inventory-deleted",{detail:{type:"deleted",itemId:a}})))}}catch(r){console.error("Error deleting inventory item:",r),e({error:r instanceof Error?r.message:"Failed to delete inventory item",isLoading:!1})}},loadUsage:async()=>{try{const t=await(window.electronAPI?.inventoryUsage?.getAll())||[];e({usage:t})}catch(t){console.error("Error loading inventory usage:",t)}},recordUsage:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.inventoryUsage.create(a),{usage:n,items:s}=t(),o=[...n,r],i=s.map(e=>e.id===a.inventory_id?{...e,quantity:Math.max(0,e.quantity-a.quantity_used)}:e);e({usage:o,items:i,isLoading:!1}),t().calculateAnalytics(),t().filterItems()}catch(r){console.error("Error recording inventory usage:",r),e({error:r instanceof Error?r.message:"Failed to record inventory usage",isLoading:!1})}},getUsageHistory:e=>{const{usage:a}=t();return a.filter(t=>t.inventory_id===e).sort((e,t)=>new Date(t.usage_date).getTime()-new Date(e.usage_date).getTime())},setSelectedItem:t=>{e({selectedItem:t})},setSearchQuery:a=>{e({searchQuery:a}),t().searchItems(a)},setFilters:a=>{e({filters:a}),t().filterItems()},clearError:()=>{e({error:null})},searchItems:a=>{e({searchQuery:a}),t().filterItems()},filterItems:()=>{const{items:a,searchQuery:r,filters:n}=t();let s=[...a];if(""!==r.trim()){const e=r.toLowerCase();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.category?.toLowerCase().includes(e)||t.supplier?.toLowerCase().includes(e))}if(n.category&&"all"!==n.category&&(s=s.filter(e=>e.category===n.category)),n.supplier&&"all"!==n.supplier&&(s=s.filter(e=>e.supplier===n.supplier)),n.status&&"all"!==n.status){const e=new Date;s=s.filter(t=>{switch(n.status){case"in_stock":return t.quantity>t.minimum_stock;case"low_stock":return t.quantity<=t.minimum_stock&&t.quantity>0;case"out_of_stock":return 0===t.quantity;case"expired":return t.expiry_date&&new Date(t.expiry_date)<e;case"expiring_soon":if(!t.expiry_date)return!1;const a=new Date(t.expiry_date),r=Math.ceil((a.getTime()-e.getTime())/864e5);return r<=30&&r>0;default:return!0}})}e({filteredItems:s})},calculateAnalytics:()=>{const{items:a}=t(),r=new Date,n=a.length,s=a.reduce((e,t)=>e+("number"==typeof t.quantity?t.quantity:0)*("number"==typeof t.cost_per_unit?t.cost_per_unit:0),0),o=a.filter(e=>{const t="number"==typeof e.quantity?e.quantity:0;return t<=("number"==typeof e.minimum_stock?e.minimum_stock:0)&&t>0}).length,i=a.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);return!isNaN(t.getTime())&&t<r}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length,l=a.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);if(isNaN(t.getTime()))return!1;const a=Math.ceil((t.getTime()-r.getTime())/864e5);return a<=30&&a>0}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length;e({totalItems:n,totalValue:s,lowStockCount:o,expiredCount:i,expiringSoonCount:l})},getLowStockItems:()=>{const{items:e}=t();return e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0)},getExpiredItems:()=>{const{items:e}=t(),a=new Date;return e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<a)},getExpiringSoonItems:(e=30)=>{const{items:a}=t(),r=new Date;return a.filter(t=>{if(!t.expiry_date)return!1;const a=new Date(t.expiry_date),n=Math.ceil((a.getTime()-r.getTime())/864e5);return n<=e&&n>0})},updateCategories:()=>{const{items:a}=t(),r=[...new Set(a.map(e=>e.category).filter(Boolean))];e({categories:r})},updateSuppliers:()=>{const{items:a}=t(),r=[...new Set(a.map(e=>e.supplier).filter(Boolean))];e({suppliers:r})}}),{name:"inventory-store"})),ha=()=>{const e=me(e=>e.loadPatients),t=Jt(e=>e.loadAppointments),a=da(e=>e.loadPayments),r=pa(e=>e.refreshStats),n=ga(e=>e.loadItems),s=Q.useRef(null),o=Q.useRef(null);return Q.useEffect(()=>{const e=async e=>{const t=e,{patientId:a,patientName:n}=t.detail;console.log(`🔄 Real-time sync: Patient ${n} (${a}) deleted, updating all stores...`),s.current&&clearTimeout(s.current),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{o.current=null,s.current=setTimeout(async()=>{try{await r(),console.log("📊 Dashboard stats refreshed via real-time sync")}catch(e){console.error("Error refreshing dashboard stats:",e)}s.current=null},200)})},t=async e=>{const t=e,{type:a,appointmentId:n}=t.detail;console.log(`🔄 Real-time sync: Appointment ${a} (${n})`),s.current&&clearTimeout(s.current),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{o.current=null,s.current=setTimeout(async()=>{try{await r()}catch(e){console.error("Error refreshing dashboard stats after appointment change:",e)}s.current=null},150)})},a=async e=>{const t=e,{type:a,paymentId:n}=t.detail;console.log(`🔄 Real-time sync: Payment ${a} (${n})`),s.current&&clearTimeout(s.current),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{o.current=null,s.current=setTimeout(async()=>{try{await r()}catch(e){console.error("Error refreshing dashboard stats after payment change:",e)}s.current=null},150)})},n=async e=>{const t=e,{type:a,itemId:n}=t.detail;console.log(`🔄 Real-time sync: Inventory ${a} (${n})`),s.current&&clearTimeout(s.current),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{o.current=null,s.current=setTimeout(async()=>{try{await r()}catch(e){console.error("Error refreshing dashboard stats after inventory change:",e)}s.current=null},150)})};return window.addEventListener("patient-deleted",e),window.addEventListener("appointment-changed",t),window.addEventListener("payment-changed",a),window.addEventListener("inventory-changed",n),()=>{s.current&&(clearTimeout(s.current),s.current=null),o.current&&(cancelAnimationFrame(o.current),o.current=null),window.removeEventListener("patient-deleted",e),window.removeEventListener("appointment-changed",t),window.removeEventListener("payment-changed",a),window.removeEventListener("inventory-changed",n)}},[r]),{syncAll:async()=>{console.log("🔄 Manual sync: Refreshing all stores...");try{await Promise.all([e(),t(),a(),n(),r()]),console.log("✅ Manual sync completed successfully")}catch(s){console.error("❌ Manual sync failed:",s)}},syncAfterPatientDeletion:async(e,t)=>{console.log(`🔄 Sync after patient deletion: ${t} (${e})`),window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:e,patientName:t}})),s.current&&clearTimeout(s.current),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{o.current=null,s.current=setTimeout(async()=>{try{await r()}catch(e){console.error("Error in backup sync after patient deletion:",e)}s.current=null},300)})}}},fa=ee()(ie((e,t)=>({prescriptions:[],filteredPrescriptions:[],selectedPrescription:null,isLoading:!1,error:null,searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""},totalPrescriptions:0,recentPrescriptions:0,loadPrescriptions:async()=>{e({isLoading:!0,error:null});try{const a=await(window.electronAPI?.prescriptions?.getAll())||[];e({prescriptions:a,filteredPrescriptions:a,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions()}catch(a){console.error("Error loading prescriptions:",a),e({error:a instanceof Error?a.message:"Failed to load prescriptions",isLoading:!1})}},createPrescription:async a=>{e({isLoading:!0,error:null});try{const e=await(window.electronAPI?.prescriptions?.create(a));e&&(await t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-added",{detail:{type:"created",prescriptionId:e.id,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"created",prescriptionId:e.id,prescription:e}}))))}catch(r){throw console.error("Error creating prescription:",r),e({error:r instanceof Error?r.message:"Failed to create prescription",isLoading:!1}),r}},updatePrescription:async(a,r)=>{e({isLoading:!0,error:null});try{const e=await(window.electronAPI?.prescriptions?.update(a,r));e&&(await t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-updated",{detail:{type:"updated",prescriptionId:a,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"updated",prescriptionId:a,prescription:e}}))))}catch(n){throw console.error("Error updating prescription:",n),e({error:n instanceof Error?n.message:"Failed to update prescription",isLoading:!1}),n}},deletePrescription:async a=>{e({isLoading:!0,error:null});try{if(await(window.electronAPI?.prescriptions?.delete(a))){const r=t().prescriptions.filter(e=>e.id!==a);e({prescriptions:r,filteredPrescriptions:r,selectedPrescription:t().selectedPrescription?.id===a?null:t().selectedPrescription,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-deleted",{detail:{type:"deleted",prescriptionId:a}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"deleted",prescriptionId:a}})))}}catch(r){throw console.error("Error deleting prescription:",r),e({error:r instanceof Error?r.message:"Failed to delete prescription",isLoading:!1}),r}},setSearchQuery:a=>{e({searchQuery:a}),t().filterPrescriptions()},setPatientFilter:a=>{e({patientFilter:a}),t().filterPrescriptions()},setDateRangeFilter:a=>{e({dateRangeFilter:a}),t().filterPrescriptions()},clearFilters:()=>{e({searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""}}),t().filterPrescriptions()},filterPrescriptions:()=>{const{prescriptions:a,searchQuery:r,patientFilter:n,dateRangeFilter:s}=t();let o=[...a];if(r.trim()&&(o=o.filter(e=>e.patient?.full_name?.toLowerCase().includes(r.toLowerCase())||e.appointment?.title?.toLowerCase().includes(r.toLowerCase())||e.notes?.toLowerCase().includes(r.toLowerCase())||e.medications?.some(e=>e.medication_name?.toLowerCase().includes(r.toLowerCase())))),"all"!==n&&(o=o.filter(e=>e.patient_id===n)),s.start&&s.end){const e=new Date(s.start),t=new Date(s.end);o=o.filter(a=>{const r=new Date(a.prescription_date);return r>=e&&r<=t})}e({filteredPrescriptions:o})},setSelectedPrescription:t=>{e({selectedPrescription:t})},clearError:()=>{e({error:null})},calculateStatistics:()=>{const{prescriptions:a}=t(),r=a.length,n=new Date;n.setDate(n.getDate()-30);const s=a.filter(e=>new Date(e.prescription_date)>=n).length;e({totalPrescriptions:r,recentPrescriptions:s})},getPrescriptionsByPatient:e=>t().prescriptions.filter(t=>t.patient_id===e),getPrescriptionsByDateRange:(e,a)=>t().prescriptions.filter(t=>{const r=new Date(t.prescription_date);return r>=e&&r<=a})}),{name:"prescription-store"}));function ya(){const{loadAppointments:e}=Jt(),{loadPayments:t}=da(),{loadPatients:a}=me(),{loadPrescriptions:r}=fa(),{loadItems:n}=ga(),s=Q.useRef(new Set),o=Q.useRef(null),i=Q.useRef(null),l=Q.useCallback(async()=>{console.log("🔄 Refreshing all tables...");try{await Promise.all([e(),t(),a(),r(),n()]),console.log("✅ All tables refreshed successfully")}catch(s){console.error("❌ Error refreshing tables:",s)}},[e,t,a,r,n]),d=Q.useCallback(async s=>{console.log(`🔄 Refreshing ${s} table...`);try{switch(s){case"appointments":await e();break;case"payments":await t();break;case"patients":await a();break;case"prescriptions":await r();break;case"inventory":await n();break;default:console.warn("Unknown table type:",s)}console.log(`✅ ${s} table refreshed successfully`)}catch(o){console.error(`❌ Error refreshing ${s} table:`,o)}},[e,t,a,r,n]),c=Q.useCallback(()=>{i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{const e=Array.from(s.current);s.current.clear(),e.forEach(e=>{d(e)}),i.current=null},100)},[d]);return Q.useEffect(()=>{console.log("🔔 Setting up real-time table sync listeners...");const e={"appointment-added":["appointments"],"appointment-updated":["appointments"],"appointment-deleted":["appointments"],"appointment-changed":["appointments"],"payment-added":["payments"],"payment-updated":["payments"],"payment-deleted":["payments"],"payment-changed":["payments"],"patient-added":["patients","appointments","payments"],"patient-updated":["patients","appointments","payments"],"patient-deleted":["patients","appointments","payments"],"patient-changed":["patients","appointments","payments"],"prescription-added":["prescriptions"],"prescription-updated":["prescriptions"],"prescription-deleted":["prescriptions"],"prescription-changed":["prescriptions"],"inventory-added":["inventory"],"inventory-updated":["inventory"],"inventory-deleted":["inventory"],"inventory-changed":["inventory"]},t=t=>{const a=t.type,r=e[a];r&&(console.log(`📡 ${a} detected, queuing tables for update:`,r),r.forEach(e=>s.current.add(e)),null===o.current&&(o.current=requestAnimationFrame(()=>{c(),o.current=null})))},a=Object.keys(e);return a.forEach(e=>{window.addEventListener(e,t)}),()=>{console.log("🔔 Cleaning up real-time table sync listeners..."),null!==o.current&&(cancelAnimationFrame(o.current),o.current=null),i.current&&(clearTimeout(i.current),i.current=null),a.forEach(e=>{window.removeEventListener(e,t)}),s.current.clear()}},[c,d]),{refreshAllTables:l,refreshTable:d}}function ba(){const[e,t]=Q.useState({isAuthenticated:!1,isLoading:!0,passwordEnabled:!1}),{settings:a,loadSettings:r}=ta(),n=Q.useCallback(async()=>{try{Zt.auth("Checking auth status..."),a?.isLoaded||await r();const e=ta.getState().settings,n=1===e?.password_enabled,s=e?.app_password&&e.app_password.length>0;if(Zt.auth("Password enabled:",n),Zt.auth("Has password:",s),!n||!s)return Zt.auth("No password protection, allowing access"),void t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!1});const o="true"===sessionStorage.getItem("dental_clinic_auth");Zt.auth("Has valid session:",o),o?(Zt.auth("Valid session found, allowing access"),t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!0})):(Zt.auth("No valid session, requiring authentication"),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!0}))}catch(e){Zt.error("Error checking auth status:",e),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!1})}},[a,r]);Q.useEffect(()=>{n()},[n]);return{...e,login:async e=>{try{Zt.auth("Attempting login...");const a=ta.getState().settings;if(!a?.app_password)return Zt.auth("No password set in settings"),!1;const r=await xa(e);return Zt.auth("Password hashed, comparing..."),r===a.app_password?(Zt.success("Password correct, setting session"),sessionStorage.setItem("dental_clinic_auth","true"),t(e=>({...e,isAuthenticated:!0})),!0):(Zt.failure("Password incorrect"),!1)}catch(a){return Zt.error("Login error:",a),!1}},logout:async()=>{sessionStorage.removeItem("dental_clinic_auth");try{window.electronAPI?.auth?.clearSession&&await window.electronAPI.auth.clearSession()}catch(e){Zt.debug("Could not clear session via Electron:",e)}t(e=>({...e,isAuthenticated:!1}))},setPassword:async e=>{try{Zt.auth("Setting password...");const a=await xa(e);Zt.auth("Updating settings with hashed password...");const r=await wa(window.electronAPI.settings.update({app_password:a,password_enabled:1}),1e4);return Zt.auth("Settings updated:",r),r?(t(e=>({...e,passwordEnabled:!0})),Zt.success("Password set successfully"),!0):(Zt.failure("Failed to update settings"),!1)}catch(a){return Zt.error("Error setting password:",a),!1}},removePassword:async()=>{try{Zt.auth("Removing password...");const e=await wa(window.electronAPI.settings.update({app_password:null,password_enabled:0}),1e4);return Zt.auth("Settings updated:",e),e?(t(e=>({...e,passwordEnabled:!1,isAuthenticated:!0})),Zt.success("Password removed successfully"),!0):(Zt.failure("Failed to update settings"),!1)}catch(e){return Zt.error("Error removing password:",e),!1}},changePassword:async(e,t)=>{try{Zt.auth("Changing password...");const a=ta.getState().settings;if(!a?.app_password)return Zt.auth("No existing password found"),!1;if(await xa(e)!==a.app_password)return Zt.failure("Old password is incorrect"),!1;const r=await xa(t);Zt.auth("Updating with new password...");const n=await wa(window.electronAPI.settings.update({app_password:r}),1e4);return Zt.auth("Settings updated:",n),n?(Zt.success("Password changed successfully"),!0):(Zt.failure("Failed to update settings"),!1)}catch(a){return Zt.error("Error changing password:",a),!1}},checkAuthStatus:n}}async function xa(e){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),a=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw Zt.error("Error hashing password:",t),t}}function wa(e,t){return Promise.race([e,new Promise((e,a)=>setTimeout(()=>a(new Error("Operation timed out")),t))])}const va={"ش":"a","س":"s","ي":"d",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9","ق":"r","ب":"f"};function Na(e){const t=e.key;var a;return{originalKey:t,mappedKey:va[a=t]||a,isArabic:/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(t),ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,preventDefault:()=>e.preventDefault()}}
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */Object.fromEntries(Object.entries(va).map(([e,t])=>[t,e]));var ja={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=(e,t)=>{const a=Q.forwardRef(({color:a="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:o="",children:i,...l},d)=>{return Q.createElement("svg",{ref:d,...ja,width:r,height:r,stroke:a,strokeWidth:s?24*Number(n)/Number(r):n,className:["lucide",`lucide-${c=e,c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,o].join(" "),...l},[...t.map(([e,t])=>Q.createElement(e,t)),...Array.isArray(i)?i:[i]]);var c});return a.displayName=`${e}`,a},ka=_a("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Sa=_a("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ea=_a("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Aa=_a("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),Da=_a("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),Ia=_a("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Pa=_a("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Ca=_a("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ta=_a("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),La=_a("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Fa=_a("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ra=_a("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),$a=_a("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ma=_a("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Oa=_a("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),za=_a("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Va=_a("FileBarChart",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-4",key:"q1q25u"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M16 18v-6",key:"15y0np"}]]),qa=_a("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ua=_a("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Ba=_a("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Ha=_a("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Xa=_a("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Wa=_a("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Ga=_a("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]),Ka=_a("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),Ya=_a("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),Qa=_a("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ja=_a("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Za=_a("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),er=_a("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),tr=_a("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),ar=_a("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),rr=_a("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),nr=_a("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),sr=_a("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),or=_a("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function ir(){const{settings:e,isLoading:t,loadSettings:a}=ta(),[r,n]=Q.useState(null),s=Q.useRef(null),o=Q.useRef(!1);Q.useEffect(()=>{if(e){s.current=e,n(e),o.current=!0;try{localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:e.clinic_name||"",doctor_name:e.doctor_name||"",clinic_logo:e.clinic_logo||"",clinic_phone:e.clinic_phone||"",clinic_email:e.clinic_email||"",clinic_address:e.clinic_address||"",backup_timestamp:Date.now()}))}catch(a){console.warn("Failed to save settings backup:",a)}}else if(!o.current&&!t){try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);t.clinic_name&&(n(t),s.current=t)}}catch(a){console.warn("Failed to restore settings from backup:",a)}o.current=!0}},[e,t]),Q.useEffect(()=>{e||t||r||(console.log("🔄 useStableSettings: Attempting to load settings..."),a().catch(e=>{console.error("❌ useStableSettings: Failed to load settings:",e)}))},[e,t,r,a]);const i=r||s.current;return{settings:i,isLoading:t&&!i,hasValidSettings:Boolean(i),refreshSettings:a}}function lr(){const{settings:e}=ir();return e?.clinic_name||"عيادة الأسنان"}function dr(){const{settings:e}=ir();return e?.doctor_name||"د. محمد أحمد"}function cr(){const{settings:e}=ir();return e?.clinic_logo||""}function ur(){const{settings:e}=ir();return{phone:e?.clinic_phone||"",email:e?.clinic_email||"",address:e?.clinic_address||""}}const mr=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,pr=te,gr=(e,t)=>a=>{var r;if(null==(null==t?void 0:t.variants))return pr(e,null==a?void 0:a.class,null==a?void 0:a.className);const{variants:n,defaultVariants:s}=t,o=Object.keys(n).map(e=>{const t=null==a?void 0:a[e],r=null==s?void 0:s[e];if(null===t)return null;const o=mr(t)||mr(r);return n[e][o]}),i=a&&Object.entries(a).reduce((e,t)=>{let[a,r]=t;return void 0===r||(e[a]=r),e},{}),l=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:a,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,a]=e;return Array.isArray(a)?a.includes({...s,...i}[t]):{...s,...i}[t]===a})?[...e,a,r]:e},[]);return pr(e,o,l,null==a?void 0:a.class,null==a?void 0:a.className)},hr=gr("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-lg active:scale-[0.98] dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",destructive:"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 hover:shadow-lg active:scale-[0.98] dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",outline:"border-2 border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] dark:border-slate-600 dark:bg-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 dark:shadow-md",secondary:"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-lg active:scale-[0.98] dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",ghost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98] dark:hover:bg-slate-700 dark:text-slate-300 dark:hover:text-slate-100 transition-colors",link:"text-primary underline-offset-4 hover:underline active:scale-[0.98] dark:text-blue-400 dark:hover:text-blue-300",success:"bg-green-600 text-white shadow-md hover:bg-green-700 hover:shadow-lg active:scale-[0.98] dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",warning:"bg-amber-600 text-white shadow-md hover:bg-amber-700 hover:shadow-lg active:scale-[0.98] dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-11 rounded-md px-8 text-base",icon:"h-10 w-10",xs:"h-6 rounded px-2 text-xs"}},defaultVariants:{variant:"default",size:"default"}}),fr=Q.forwardRef(({className:a,variant:r,size:n,asChild:s=!1,...o},i)=>{const l=s?t:"button";return e.jsx(l,{className:Nt(hr({variant:r,size:n,className:a})),ref:i,...o})});function yr({onComplete:t,duration:a=3e3}){const{isDarkMode:r}=na(),n=sa(),s=lr(),o=cr(),[i,l]=Q.useState(0),[d,c]=Q.useState(!0);Q.useEffect(()=>{const e=setInterval(()=>{l(e=>{const t=e+100/(a/50);return t>=100?100:t})},50),t=setTimeout(()=>{u()},a),r=e=>{" "!==e.key&&"Spacebar"!==e.key&&"Escape"!==e.key&&"Enter"!==e.key||(e.preventDefault(),u())};return window.addEventListener("keydown",r),()=>{clearInterval(e),clearTimeout(t),window.removeEventListener("keydown",r)}},[a]);const u=()=>{c(!1),setTimeout(()=>{t()},500)};return e.jsxs("div",{className:`min-h-screen flex items-center justify-center relative overflow-hidden transition-opacity duration-500 ${d?"opacity-100":"opacity-0"} ${r?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900":"bg-gradient-to-br from-blue-50 via-white to-sky-50"}`,children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-br from-primary/10 to-secondary/5 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-tl from-secondary/10 to-accent/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-to-r from-accent/10 to-primary/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"2s"}})]}),e.jsxs("div",{className:"relative z-10 text-center space-y-8 px-4",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/30 to-secondary/30 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:`relative w-40 h-40 rounded-full ${n.card} backdrop-blur-xl border-2 border-primary/30 shadow-2xl flex items-center justify-center overflow-hidden`,children:o?e.jsx("img",{src:o,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx(Za,{className:"w-20 h-20 text-primary drop-shadow-lg"})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:`text-5xl font-bold ${n.textPrimary} arabic-enhanced drop-shadow-lg animate-fade-in`,children:s}),e.jsx("p",{className:`text-2xl ${n.textSecondary} arabic-enhanced font-medium animate-fade-in`,style:{animationDelay:"0.2s"},children:"نظام إدارة العيادة السنية"})]}),e.jsxs("div",{className:`${n.card} backdrop-blur-xl rounded-2xl p-6 shadow-xl border border-border/50 max-w-md mx-auto animate-fade-in`,style:{animationDelay:"0.4s"},children:[e.jsx("p",{className:`text-xl ${n.textPrimary} arabic-enhanced font-semibold mb-2`,children:"مرحباً بك"}),e.jsx("p",{className:`text-base ${n.textSecondary} arabic-enhanced`,children:"نحن سعداء بخدمتك"})]}),e.jsxs("div",{className:"max-w-md mx-auto space-y-4 animate-fade-in",style:{animationDelay:"0.6s"},children:[e.jsx("div",{className:`h-2 rounded-full ${n.card} overflow-hidden shadow-inner`,children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-secondary transition-all duration-100 ease-linear rounded-full",style:{width:`${i}%`}})}),e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0s"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]}),e.jsx("div",{className:"pt-4 animate-fade-in",style:{animationDelay:"0.8s"},children:e.jsx(fr,{variant:"outline",onClick:u,className:`${n.card} backdrop-blur-md hover:scale-105 transition-all duration-300 border-primary/30 hover:border-primary/50 shadow-lg`,children:e.jsx("span",{className:"arabic-enhanced font-semibold",children:"تخطي (Space)"})})}),e.jsx("div",{className:`text-sm ${n.textSecondary} arabic-enhanced animate-fade-in`,style:{animationDelay:"1s"},children:"DentaDesk - نظام إدارة العيادات السنية"})]}),e.jsx("style",{children:"\n        @keyframes fade-in {\n          from {\n            opacity: 0;\n            transform: translateY(10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        .animate-fade-in {\n          animation: fade-in 0.6s ease-out forwards;\n          opacity: 0;\n        }\n      "})]})}fr.displayName="Button";const br=i,xr=l,wr=Q.forwardRef(({className:t,...r},n)=>e.jsx(a,{ref:n,className:Nt("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));wr.displayName=a.displayName;const vr=Q.forwardRef(({className:t,children:a,...s},o)=>e.jsxs(xr,{children:[e.jsx(wr,{}),e.jsxs(r,{ref:o,dir:"rtl",className:Nt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:bg-gray-800 dark:border-gray-700",t),...s,children:[a,e.jsxs(n,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground dark:text-gray-300 dark:hover:bg-gray-700 dark:data-[state=open]:bg-gray-700 dark:data-[state=open]:text-gray-300",children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]})]})]}));vr.displayName=r.displayName;const Nr=({className:t,...a})=>e.jsx("div",{className:Nt("flex flex-col space-y-1.5 text-center sm:text-right",t),...a});Nr.displayName="DialogHeader";const jr=({className:t,...a})=>e.jsx("div",{className:Nt("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",t),...a});jr.displayName="DialogFooter";const _r=Q.forwardRef(({className:t,...a},r)=>e.jsx(s,{ref:r,className:Nt("text-lg font-semibold leading-none tracking-tight dark:text-white",t),...a}));_r.displayName=s.displayName;const kr=Q.forwardRef(({className:t,...a},r)=>e.jsx(o,{ref:r,className:Nt("text-sm text-muted-foreground dark:text-gray-300",t),...a}));kr.displayName=o.displayName;const Sr=Q.forwardRef(({className:t,type:a,...r},n)=>e.jsx("input",{type:a,className:Nt("flex h-10 w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder:text-gray-400 dark:focus-visible:ring-blue-400 dark:hover:border-blue-500/50 dark:shadow-md",t),ref:n,...r}));Sr.displayName="Input";var Er=Q.forwardRef((t,a)=>e.jsx(d.label,{...t,ref:a,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(t.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));Er.displayName="Label";var Ar=Er;const Dr=gr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground dark:text-white"),Ir=Q.forwardRef(({className:t,...a},r)=>e.jsx(Ar,{ref:r,className:Nt(Dr(),t),...a}));Ir.displayName=Ar.displayName;const Pr=gr("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground dark:bg-gray-800 dark:text-white dark:border-gray-700",destructive:"border-destructive/50 text-destructive dark:border-red-600 dark:bg-red-600/10 dark:text-red-400 [&>svg]:text-destructive dark:[&>svg]:text-red-400"}},defaultVariants:{variant:"default"}}),Cr=Q.forwardRef(({className:t,variant:a,...r},n)=>e.jsx("div",{ref:n,role:"alert",className:Nt(Pr({variant:a}),t),...r}));Cr.displayName="Alert";Q.forwardRef(({className:t,...a},r)=>e.jsx("h5",{ref:r,className:Nt("mb-1 font-medium leading-none tracking-tight dark:text-white",t),...a})).displayName="AlertTitle";const Tr=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("text-sm [&_p]:leading-relaxed dark:text-gray-300",t),...a}));async function Lr(e){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),a=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}}function Fr({open:t,onOpenChange:a,onPasswordReset:r}){const[n,s]=Q.useState("question"),[o,i]=Q.useState(""),[l,d]=Q.useState(""),[c,u]=Q.useState(""),[m,p]=Q.useState(""),[g,h]=Q.useState(!1),[f,y]=Q.useState(!1),[b,x]=Q.useState(!1),[w,v]=Q.useState(""),[N,j]=Q.useState("");J.useEffect(()=>{t&&(_(),s("question"),d(""),u(""),p(""),v(""),j(""))},[t]);const _=async()=>{try{const e=await window.electronAPI.settings.get();e?.security_question?(i(e.security_question),s("answer")):v("لم يتم تعيين سؤال أمان. يرجى التواصل مع المسؤول.")}catch(e){console.error("Error loading security question:",e),v("حدث خطأ في تحميل سؤال الأمان")}},k=async()=>{if(l.trim()){x(!0),v("");try{const e=await window.electronAPI.settings.get();if(!e?.security_answer)return v("لم يتم تعيين إجابة سؤال الأمان"),void x(!1);await Lr(l.trim().toLowerCase())===e.security_answer?(s("newPassword"),v("")):v("إجابة سؤال الأمان غير صحيحة")}catch(e){console.error("Error verifying security answer:",e),v("حدث خطأ في التحقق من إجابة سؤال الأمان")}finally{x(!1)}}else v("يرجى إدخال إجابة سؤال الأمان")},S=async()=>{if(c&&m)if(c===m)if(c.length<4)v("كلمة المرور يجب أن تكون 4 أحرف على الأقل");else{x(!0),v("");try{const e=await Lr(c);await window.electronAPI.settings.update({app_password:e}),j("تم تغيير كلمة المرور بنجاح"),setTimeout(()=>{r(),a(!1)},2e3)}catch(e){console.error("Error resetting password:",e),v("حدث خطأ في تغيير كلمة المرور")}finally{x(!1)}}else v("كلمة المرور وتأكيدها غير متطابقتين");else v("يرجى إدخال كلمة المرور الجديدة وتأكيدها")},E=()=>{s("question"),d(""),u(""),p(""),v(""),j(""),a(!1)};return e.jsx(br,{open:t,onOpenChange:E,children:e.jsxs(vr,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(Nr,{children:e.jsxs(_r,{className:"flex items-center gap-2 text-right",children:[e.jsx(Ba,{className:"w-5 h-5 text-primary"}),"استعادة كلمة المرور"]})}),e.jsxs("div",{className:"space-y-6",children:["question"===n&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"جاري تحميل سؤال الأمان..."})]}),"answer"===n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(qa,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:o})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"answer",children:"الإجابة"}),e.jsx(Sr,{id:"answer",type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"أدخل إجابة سؤال الأمان",className:"text-right",onKeyDown:e=>"Enter"===e.key&&k()})]}),e.jsx(fr,{onClick:k,disabled:b||!l.trim(),className:"w-full",children:b?"جاري التحقق...":"تحقق من الإجابة"})]}),"newPassword"===n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-green-800 dark:text-green-200 font-medium",children:"تم التحقق بنجاح! يمكنك الآن تعيين كلمة مرور جديدة"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"newPassword",type:g?"text":"password",value:c,onChange:e=>u(e.target.value),placeholder:"أدخل كلمة المرور الجديدة",className:"text-right pr-10"}),e.jsx("button",{type:"button",onClick:()=>h(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:g?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"confirmPassword",type:f?"text":"password",value:m,onChange:e=>p(e.target.value),placeholder:"أعد إدخال كلمة المرور",className:"text-right pr-10",onKeyDown:e=>"Enter"===e.key&&S()}),e.jsx("button",{type:"button",onClick:()=>y(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:f?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsx(fr,{onClick:S,disabled:b||!c||!m,className:"w-full",children:b?"جاري التغيير...":"تغيير كلمة المرور"})]}),w&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Sa,{className:"h-4 w-4"}),e.jsx(Tr,{children:w})]}),N&&e.jsxs(Cr,{className:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-200",children:[e.jsx(Ia,{className:"h-4 w-4"}),e.jsx(Tr,{children:N})]}),"question"!==n&&!N&&e.jsx(fr,{variant:"outline",onClick:E,className:"w-full",children:"إلغاء"})]})]})})}function Rr({onLogin:t,isLoading:a=!1}){const{isDarkMode:r,toggleDarkMode:n}=na(),s=sa(),o=cr(),[i,l]=Q.useState(""),[d,c]=Q.useState(!1),[u,m]=Q.useState(""),[p,g]=Q.useState(0),[h,f]=Q.useState(!1),[y,b]=Q.useState(0),[x,w]=Q.useState(!1);Q.useEffect(()=>{let e;return h&&y>0&&(e=setInterval(()=>{b(e=>e<=1e3?(f(!1),g(0),m(""),0):e-1e3)},1e3)),()=>clearInterval(e)},[h,y]);return e.jsxs("div",{className:"min-h-screen login-gradient-bg flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-accent/5 via-transparent to-primary/3"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-br from-primary/8 to-secondary/4 rounded-full login-floating-orb"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-tl from-secondary/8 to-accent/4 rounded-full login-floating-orb",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-to-r from-accent/8 to-primary/4 rounded-full login-floating-orb",style:{animationDelay:"4s"}}),e.jsx("button",{onClick:n,className:`absolute top-6 right-6 p-4 rounded-full ${s.card} backdrop-blur-md hover:scale-110 hover:rotate-12 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:r?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:r?e.jsx(ar,{className:"w-6 h-6 text-yellow-400 drop-shadow-sm transition-transform duration-300"}):e.jsx(Ka,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"mx-auto w-28 h-28 bg-gradient-to-br from-primary/20 via-primary/15 to-secondary/20 rounded-full flex items-center justify-center mb-8 shadow-2xl backdrop-blur-sm border border-primary/20 hover:scale-105 hover:shadow-3xl transition-all duration-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/10 to-transparent rounded-full animate-pulse"}),o?e.jsx("img",{src:o,alt:"Clinic Logo",className:"w-full h-full object-cover rounded-full relative z-10"}):e.jsx(Za,{className:"w-14 h-14 text-primary drop-shadow-lg relative z-10"})]}),e.jsx("h1",{className:`text-5xl font-bold ${s.textPrimary} arabic-enhanced mb-4 drop-shadow-lg`,children:"نظام إدارة العيادة"}),e.jsx("p",{className:`${s.textSecondary} arabic-enhanced text-xl font-medium opacity-90`,children:"يرجى إدخال كلمة المرور للدخول"})]}),e.jsxs("div",{className:`${s.card} backdrop-blur-xl rounded-3xl p-10 login-card-glow hover:scale-[1.02] transition-all duration-500 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 rounded-3xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h)m(`تم حظر المحاولات لمدة ${Math.ceil(y/6e4)} دقيقة`);else if(i.trim()){m("");try{if(await t(i))g(0),l("");else{const e=p+1;g(e),e>=5?(f(!0),b(3e5),m("تم تجاوز عدد المحاولات المسموحة. تم حظر المحاولات لمدة 5 دقائق")):m("كلمة مرور خاطئة. المحاولات المتبقية: "+(5-e)),l("")}}catch(a){m("حدث خطأ أثناء التحقق من كلمة المرور"),console.error("Login error:",a)}}else m("يرجى إدخال كلمة المرور")},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"password",className:`block text-lg font-semibold ${s.textPrimary} arabic-enhanced`,children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:e.jsx(Xa,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("input",{type:d?"text":"password",id:"password",value:i,onChange:e=>l(e.target.value),disabled:a||h,className:`w-full pr-14 pl-14 py-4 border-2 ${s.input} rounded-xl focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-lg backdrop-blur-sm`,placeholder:"أدخل كلمة المرور",autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>c(!d),disabled:a||h,className:"absolute inset-y-0 left-0 pl-4 flex items-center text-muted-foreground hover:text-foreground focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:d?e.jsx(Oa,{className:"w-6 h-6"}):e.jsx(za,{className:"w-6 h-6"})})]})]}),u&&e.jsxs("div",{className:`flex items-center space-x-3 space-x-reverse p-4 ${s.alertError} rounded-xl backdrop-blur-sm`,children:[e.jsx(Sa,{className:"w-6 h-6 text-destructive flex-shrink-0"}),e.jsx("span",{className:"text-base font-medium text-destructive arabic-enhanced",children:u})]}),h&&y>0&&e.jsx("div",{className:`text-center p-4 ${s.alertWarning} rounded-xl backdrop-blur-sm`,children:e.jsxs("p",{className:"text-base font-semibold arabic-enhanced",children:["الوقت المتبقي للحظر: ",(v=y,`${Math.floor(v/6e4)}:${Math.floor(v%6e4/1e3).toString().padStart(2,"0")}`)]})}),e.jsx("button",{type:"submit",disabled:a||h||!i.trim(),className:`w-full py-4 px-6 ${s.buttonPrimary} rounded-xl font-bold text-xl focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 arabic-enhanced`,children:a?e.jsxs("div",{className:"flex items-center justify-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"arabic-enhanced",children:"جاري التحقق..."})]}):h?e.jsx("span",{className:"arabic-enhanced",children:"محظور مؤقتاً"}):e.jsx("span",{className:"arabic-enhanced",children:"دخول"})}),p>0&&!h&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:`text-base ${s.textSecondary} font-medium arabic-enhanced`,children:["المحاولات المتبقية: ",5-p," من ",5]})}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"button",onClick:()=>w(!0),className:`text-sm ${s.textSecondary} hover:text-primary transition-colors duration-200 arabic-enhanced flex items-center justify-center gap-2 mx-auto`,children:[e.jsx(qa,{className:"w-4 h-4"}),"نسيت كلمة المرور؟"]})})]})})]}),e.jsx(Fr,{open:x,onOpenChange:w,onPasswordReset:()=>{g(0),f(!1),b(0),m(""),l("")}}),e.jsx("div",{className:"text-center mt-12",children:e.jsxs("div",{className:`inline-flex items-center space-x-3 space-x-reverse px-8 py-4 ${s.card} backdrop-blur-md rounded-full shadow-lg hover:shadow-xl transition-all duration-300 border border-border/30`,children:[e.jsx(Za,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:`text-base ${s.textSecondary} font-semibold arabic-enhanced`,children:"نظام إدارة العيادة - DentaDesk"})]})})]})]});var v}function $r({onActivate:t,isLoading:a=!1,machineInfo:r}){const{isDarkMode:n,toggleDarkMode:s}=na(),o=sa(),[i,l]=Q.useState(""),[d,c]=Q.useState(""),[u,m]=Q.useState(!1),[p,g]=Q.useState(!1),h=e=>/^[A-Z0-9]{4,5}-[A-Z0-9]{4,5}-[A-Z0-9]{4,5}-[A-Z0-9]{4,5}$/.test(e),f=h(i),y=a||u||!f;return e.jsxs("div",{className:"min-h-screen login-gradient-bg flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-accent/5 via-transparent to-primary/3"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-br from-primary/8 to-secondary/4 rounded-full login-floating-orb"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-tl from-secondary/8 to-accent/4 rounded-full login-floating-orb",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-to-r from-accent/8 to-primary/4 rounded-full login-floating-orb",style:{animationDelay:"4s"}}),e.jsx("button",{onClick:s,className:`absolute top-6 right-6 p-4 rounded-full ${o.card} backdrop-blur-md hover:scale-110 hover:rotate-12 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:n?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:n?e.jsx(ar,{className:"w-6 h-6 text-yellow-400 drop-shadow-sm transition-transform duration-300"}):e.jsx(Ka,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),r&&e.jsx("button",{onClick:()=>g(!p),className:`absolute top-6 left-6 p-4 rounded-full ${o.card} backdrop-blur-md hover:scale-110 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:"معلومات الجهاز",children:e.jsx(Ua,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),e.jsxs("div",{className:"w-full max-w-lg relative z-10",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-primary/20 via-primary/15 to-secondary/20 rounded-full flex items-center justify-center mb-3 shadow-xl backdrop-blur-sm border border-primary/20 hover:scale-105 hover:shadow-2xl transition-all duration-500 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/10 to-transparent rounded-full animate-pulse"}),e.jsx(Ba,{className:"w-8 h-8 text-primary drop-shadow-lg relative z-10"})]}),e.jsx("h1",{className:`text-2xl font-bold ${o.textPrimary} arabic-enhanced mb-2 drop-shadow-lg`,children:"تفعيل الترخيص"}),e.jsx("p",{className:`${o.textSecondary} arabic-enhanced text-sm font-medium opacity-90 mb-1`,children:"يرجى إدخال مفتاح الترخيص لتفعيل النظام"}),e.jsx("p",{className:`${o.textSecondary} arabic-enhanced text-xs opacity-75`,children:"التنسيق المطلوب: XXXXX-XXXXX-XXXXX-XXXXX"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`${o.card} backdrop-blur-xl rounded-xl p-3 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-500/5 via-transparent to-blue-500/5 rounded-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h3",{className:`text-sm font-bold ${o.textPrimary} arabic-enhanced`,children:"تحتاج مساعدة في التفعيل؟"}),e.jsx("p",{className:`text-xs ${o.textSecondary} arabic-enhanced`,children:"فريق التطوير"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"p-1 bg-green-100 dark:bg-green-900/20 rounded",children:e.jsx(Wa,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"text-center sm:text-right",children:e.jsx("p",{className:`text-xs font-medium ${o.textPrimary} arabic-enhanced`,children:"00963938352132"})})]}),e.jsxs("button",{type:"button",onClick:async()=>{const e="https://api.whatsapp.com/send/?phone=963959669628&text=مرحباً، أحتاج مساعدة في تفعيل ترخيص نظام إدارة العيادة السنية";try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(t){console.log("Method 1 failed:",t)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(t){console.log("Method 2 failed:",t)}window.open(e,"_blank","noopener,noreferrer")},className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-1 space-x-reverse",children:[e.jsx(Wa,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"واتساب"})]})]})]})]})}),e.jsxs("div",{className:`${o.card} backdrop-blur-xl rounded-2xl p-4 login-card-glow hover:scale-[1.02] transition-all duration-500 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 rounded-2xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.trim())if(h(i)){c(""),m(!0);try{const e=await t(i);e.success||c(e.error||"فشل في تفعيل الترخيص")}catch(a){c("حدث خطأ أثناء تفعيل الترخيص"),console.error("License activation error:",a)}finally{m(!1)}}else c("تنسيق مفتاح الترخيص غير صحيح. يجب أن يكون بالشكل: XXXXX-XXXXX-XXXXX-XXXXX");else c("يرجى إدخال مفتاح الترخيص")},className:"space-y-3",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"licenseKey",className:`block text-sm font-semibold ${o.textPrimary} arabic-enhanced`,children:"مفتاح الترخيص"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(Ba,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("input",{type:"text",id:"licenseKey",value:i,onChange:e=>{const t=(e=>{const t=e.replace(/[^A-Z0-9]/gi,"").toUpperCase(),a=[];for(let r=0;r<t.length;r+=5)a.push(t.slice(r,r+5));return a.slice(0,4).join("-")})(e.target.value);l(t),c("")},disabled:a||u,className:`w-full pr-10 pl-3 py-2 border-2 ${o.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm backdrop-blur-sm font-mono tracking-wider text-center`,placeholder:"XXXXX-XXXXX-XXXXX-XXXXX",maxLength:23,autoComplete:"off",spellCheck:!1}),f&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx(Ia,{className:"w-4 h-4 text-green-500"})})]}),e.jsx("p",{className:`text-xs ${o.textSecondary} arabic-enhanced`,children:"أدخل مفتاح الترخيص المكون من 20 حرف وأرقام مقسمة إلى 4 مجموعات"})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:`text-xs font-medium ${o.textSecondary} arabic-enhanced`,children:"معرف الجهاز (أرسله للمطور)"}),e.jsx("button",{type:"button",onClick:()=>{r.hwid&&navigator.clipboard.writeText(r.hwid)},className:`text-xs px-2 py-1 rounded ${o.button} hover:opacity-80 transition-opacity`,title:"انقر للنسخ",children:"📋 نسخ"})]}),e.jsxs("div",{className:`p-2 ${o.cardSecondary} rounded border border-border/50 bg-muted/30`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Ua,{className:"w-3 h-3 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-primary arabic-enhanced",children:"معرف جهازك الفريد"})]}),e.jsx("code",{className:"text-xs font-mono text-foreground break-all bg-background/50 p-1 rounded block",children:r.hwid}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 arabic-enhanced leading-relaxed",children:"💡 أرسل هذا المعرف للمطور عبر الواتساب للحصول على مفتاح ترخيص"})]})]}),d&&e.jsxs("div",{className:`flex items-center space-x-2 space-x-reverse p-2 ${o.alertError} rounded-lg backdrop-blur-sm`,children:[e.jsx(Sa,{className:"w-4 h-4 text-destructive flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-destructive arabic-enhanced",children:d})]}),e.jsx("button",{type:"submit",disabled:y,className:`w-full py-3 px-4 ${o.buttonPrimary} rounded-lg font-bold text-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 arabic-enhanced`,children:a||u?e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[e.jsx(Ha,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"arabic-enhanced",children:"جاري التفعيل..."})]}):e.jsx("span",{className:"arabic-enhanced",children:"تفعيل الترخيص"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-xs ${o.textSecondary} font-medium arabic-enhanced`,children:i.length>0&&e.jsxs("span",{className:f?"text-green-500":"text-orange-500",children:[i.length,"/23 حرف ",f?"✓":""]})})})]})})]}),p&&r&&e.jsxs("div",{className:`mt-2 ${o.card} backdrop-blur-xl rounded-lg p-3 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h3",{className:`text-sm font-semibold ${o.textPrimary} arabic-enhanced mb-2 flex items-center`,children:[e.jsx(Za,{className:"w-4 h-4 ml-1"}),"معلومات الجهاز"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:`${o.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"معرف الجهاز:"}),e.jsxs("span",{className:"font-mono ml-1 bg-muted px-1 py-0.5 rounded text-xs",children:[r.hwid.substring(0,8),"..."]})]}),e.jsxs("div",{className:`${o.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"النظام:"}),e.jsx("span",{className:"ml-1",children:r.platform})]}),e.jsxs("div",{className:`${o.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"المعمارية:"}),e.jsx("span",{className:"ml-1",children:r.arch})]})]})]})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("div",{className:`inline-flex items-center space-x-2 space-x-reverse px-4 py-2 ${o.card} backdrop-blur-md rounded-full shadow-lg hover:shadow-xl transition-all duration-300 border border-border/30`,children:[e.jsx(Za,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:`text-xs ${o.textSecondary} font-semibold arabic-enhanced`,children:"نظام إدارة العيادة - تفعيل الترخيص"})]})})]})]})}Tr.displayName="AlertDescription";var Mr=e=>"checkbox"===e.type,Or=e=>e instanceof Date,zr=e=>null==e;const Vr=e=>"object"==typeof e;var qr=e=>!zr(e)&&!Array.isArray(e)&&Vr(e)&&!Or(e),Ur=e=>qr(e)&&e.target?Mr(e.target)?e.target.checked:e.target.value:e,Br=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),Hr="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function Xr(e){let t;const a=Array.isArray(e),r="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(Hr&&(e instanceof Blob||r)||!a&&!qr(e))return e;if(t=a?[]:{},a||(e=>{const t=e.constructor&&e.constructor.prototype;return qr(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const a in e)e.hasOwnProperty(a)&&(t[a]=Xr(e[a]));else t=e}return t}var Wr=e=>/^\w*$/.test(e),Gr=e=>void 0===e,Kr=e=>Array.isArray(e)?e.filter(Boolean):[],Yr=e=>Kr(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Qr=(e,t,a)=>{if(!t||!qr(e))return a;const r=(Wr(t)?[t]:Yr(t)).reduce((e,t)=>zr(e)?e:e[t],e);return Gr(r)||r===e?Gr(e[t])?a:e[t]:r},Jr=e=>"boolean"==typeof e,Zr=(e,t,a)=>{let r=-1;const n=Wr(t)?[t]:Yr(t),s=n.length,o=s-1;for(;++r<s;){const t=n[r];let s=a;if(r!==o){const a=e[t];s=qr(a)||Array.isArray(a)?a:isNaN(+n[r+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=s,e=e[t]}};const en="blur",tn="focusout",an="change",rn="onBlur",nn="onChange",sn="onSubmit",on="onTouched",ln="all",dn="max",cn="min",un="maxLength",mn="minLength",pn="pattern",gn="required",hn="validate",fn=J.createContext(null);fn.displayName="HookFormContext";const yn=()=>J.useContext(fn),bn=e=>{const{children:t,...a}=e;return J.createElement(fn.Provider,{value:a},t)};var xn=(e,t,a,r=!0)=>{const n={defaultValues:t._defaultValues};for(const s in e)Object.defineProperty(n,s,{get:()=>{const n=s;return t._proxyFormState[n]!==ln&&(t._proxyFormState[n]=!r||ln),a&&(a[n]=!0),e[n]}});return n};const wn="undefined"!=typeof window?Q.useLayoutEffect:Q.useEffect;var vn=e=>"string"==typeof e,Nn=(e,t,a,r,n)=>vn(e)?(r&&t.watch.add(e),Qr(a,e,n)):Array.isArray(e)?e.map(e=>(r&&t.watch.add(e),Qr(a,e))):(r&&(t.watchAll=!0),a);function jn(e){const t=yn(),{name:a,disabled:r,control:n=t.control,shouldUnregister:s}=e,o=Br(n._names.array,a),i=function(e){const t=yn(),{control:a=t.control,name:r,defaultValue:n,disabled:s,exact:o}=e||{},i=J.useRef(n),[l,d]=J.useState(a._getWatch(r,i.current));return wn(()=>a._subscribe({name:r,formState:{values:!0},exact:o,callback:e=>!s&&d(Nn(r,a._names,e.values||a._formValues,!1,i.current))}),[r,a,s,o]),J.useEffect(()=>a._removeUnmounted()),l}({control:n,name:a,defaultValue:Qr(n._formValues,a,Qr(n._defaultValues,a,e.defaultValue)),exact:!0}),l=function(e){const t=yn(),{control:a=t.control,disabled:r,name:n,exact:s}=e||{},[o,i]=J.useState(a._formState),l=J.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return wn(()=>a._subscribe({name:n,formState:l.current,exact:s,callback:e=>{!r&&i({...a._formState,...e})}}),[n,r,s]),J.useEffect(()=>{l.current.isValid&&a._setValid(!0)},[a]),J.useMemo(()=>xn(o,a,l.current,!1),[o,a])}({control:n,name:a,exact:!0}),d=J.useRef(e),c=J.useRef(n.register(a,{...e.rules,value:i,...Jr(e.disabled)?{disabled:e.disabled}:{}})),u=J.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Qr(l.errors,a)},isDirty:{enumerable:!0,get:()=>!!Qr(l.dirtyFields,a)},isTouched:{enumerable:!0,get:()=>!!Qr(l.touchedFields,a)},isValidating:{enumerable:!0,get:()=>!!Qr(l.validatingFields,a)},error:{enumerable:!0,get:()=>Qr(l.errors,a)}}),[l,a]),m=J.useCallback(e=>c.current.onChange({target:{value:Ur(e),name:a},type:an}),[a]),p=J.useCallback(()=>c.current.onBlur({target:{value:Qr(n._formValues,a),name:a},type:en}),[a,n._formValues]),g=J.useCallback(e=>{const t=Qr(n._fields,a);t&&e&&(t._f.ref={focus:()=>e.focus&&e.focus(),select:()=>e.select&&e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})},[n._fields,a]),h=J.useMemo(()=>({name:a,value:i,...Jr(r)||l.disabled?{disabled:l.disabled||r}:{},onChange:m,onBlur:p,ref:g}),[a,r,l.disabled,m,p,g,i]);return J.useEffect(()=>{const e=n._options.shouldUnregister||s;n.register(a,{...d.current.rules,...Jr(d.current.disabled)?{disabled:d.current.disabled}:{}});const t=(e,t)=>{const a=Qr(n._fields,e);a&&a._f&&(a._f.mount=t)};if(t(a,!0),e){const e=Xr(Qr(n._options.defaultValues,a));Zr(n._defaultValues,a,e),Gr(Qr(n._formValues,a))&&Zr(n._formValues,a,e)}return!o&&n.register(a),()=>{(o?e&&!n._state.action:e)?n.unregister(a):t(a,!1)}},[a,n,o,s]),J.useEffect(()=>{n._setDisabledField({disabled:r,name:a})},[r,a,n]),J.useMemo(()=>({field:h,formState:l,fieldState:u}),[h,l,u])}const _n=e=>e.render(jn(e));var kn=(e,t,a,r,n)=>t?{...a[e],types:{...a[e]&&a[e].types?a[e].types:{},[r]:n||!0}}:{},Sn=e=>Array.isArray(e)?e:[e],En=()=>{let e=[];return{get observers(){return e},next:t=>{for(const a of e)a.next&&a.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter(e=>e!==t)}}),unsubscribe:()=>{e=[]}}},An=e=>zr(e)||!Vr(e);function Dn(e,t,a=new WeakSet){if(An(e)||An(t))return e===t;if(Or(e)&&Or(t))return e.getTime()===t.getTime();const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;if(a.has(e)||a.has(t))return!0;a.add(e),a.add(t);for(const s of r){const r=e[s];if(!n.includes(s))return!1;if("ref"!==s){const e=t[s];if(Or(r)&&Or(e)||qr(r)&&qr(e)||Array.isArray(r)&&Array.isArray(e)?!Dn(r,e,a):r!==e)return!1}}return!0}var In=e=>qr(e)&&!Object.keys(e).length,Pn=e=>"file"===e.type,Cn=e=>"function"==typeof e,Tn=e=>{if(!Hr)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Ln=e=>"select-multiple"===e.type,Fn=e=>"radio"===e.type,Rn=e=>Tn(e)&&e.isConnected;function $n(e,t){const a=Array.isArray(t)?t:Wr(t)?[t]:Yr(t),r=1===a.length?e:function(e,t){const a=t.slice(0,-1).length;let r=0;for(;r<a;)e=Gr(e)?r++:e[t[r++]];return e}(e,a),n=a.length-1,s=a[n];return r&&delete r[s],0!==n&&(qr(r)&&In(r)||Array.isArray(r)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!Gr(e[t]))return!1;return!0}(r))&&$n(e,a.slice(0,-1)),e}var Mn=e=>{for(const t in e)if(Cn(e[t]))return!0;return!1};function On(e,t={}){const a=Array.isArray(e);if(qr(e)||a)for(const r in e)Array.isArray(e[r])||qr(e[r])&&!Mn(e[r])?(t[r]=Array.isArray(e[r])?[]:{},On(e[r],t[r])):zr(e[r])||(t[r]=!0);return t}function zn(e,t,a){const r=Array.isArray(e);if(qr(e)||r)for(const n in e)Array.isArray(e[n])||qr(e[n])&&!Mn(e[n])?Gr(t)||An(a[n])?a[n]=Array.isArray(e[n])?On(e[n],[]):{...On(e[n])}:zn(e[n],zr(t)?{}:t[n],a[n]):a[n]=!Dn(e[n],t[n]);return a}var Vn=(e,t)=>zn(e,t,On(t));const qn={value:!1,isValid:!1},Un={value:!0,isValid:!0};var Bn=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Gr(e[0].attributes.value)?Gr(e[0].value)||""===e[0].value?Un:{value:e[0].value,isValid:!0}:Un:qn}return qn},Hn=(e,{valueAsNumber:t,valueAsDate:a,setValueAs:r})=>Gr(e)?e:t?""===e?NaN:e?+e:e:a&&vn(e)?new Date(e):r?r(e):e;const Xn={isValid:!1,value:null};var Wn=e=>Array.isArray(e)?e.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,Xn):Xn;function Gn(e){const t=e.ref;return Pn(t)?t.files:Fn(t)?Wn(e.refs).value:Ln(t)?[...t.selectedOptions].map(({value:e})=>e):Mr(t)?Bn(e.refs).value:Hn(Gr(t.value)?e.ref.value:t.value,e)}var Kn=e=>e instanceof RegExp,Yn=e=>Gr(e)?e:Kn(e)?e.source:qr(e)?Kn(e.value)?e.value.source:e.value:e,Qn=e=>({isOnSubmit:!e||e===sn,isOnBlur:e===rn,isOnChange:e===nn,isOnAll:e===ln,isOnTouch:e===on});const Jn="AsyncFunction";var Zn=e=>!!e&&!!e.validate&&!!(Cn(e.validate)&&e.validate.constructor.name===Jn||qr(e.validate)&&Object.values(e.validate).find(e=>e.constructor.name===Jn)),es=(e,t,a)=>!a&&(t.watchAll||t.watch.has(e)||[...t.watch].some(t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))));const ts=(e,t,a,r)=>{for(const n of a||Object.keys(e)){const a=Qr(e,n);if(a){const{_f:e,...s}=a;if(e){if(e.refs&&e.refs[0]&&t(e.refs[0],n)&&!r)return!0;if(e.ref&&t(e.ref,e.name)&&!r)return!0;if(ts(s,t))break}else if(qr(s)&&ts(s,t))break}}};function as(e,t,a){const r=Qr(e,a);if(r||Wr(a))return{error:r,name:a};const n=a.split(".");for(;n.length;){const r=n.join("."),s=Qr(t,r),o=Qr(e,r);if(s&&!Array.isArray(s)&&a!==r)return{name:a};if(o&&o.type)return{name:r,error:o};if(o&&o.root&&o.root.type)return{name:`${r}.root`,error:o.root};n.pop()}return{name:a}}var rs=(e,t,a)=>{const r=Sn(Qr(e,a));return Zr(r,"root",t[a]),Zr(e,a,r),e},ns=e=>vn(e);function ss(e,t,a="validate"){if(ns(e)||Array.isArray(e)&&e.every(ns)||Jr(e)&&!e)return{type:a,message:ns(e)?e:"",ref:t}}var os=e=>qr(e)&&!Kn(e)?e:{value:e,message:""},is=async(e,t,a,r,n,s)=>{const{ref:o,refs:i,required:l,maxLength:d,minLength:c,min:u,max:m,pattern:p,validate:g,name:h,valueAsNumber:f,mount:y}=e._f,b=Qr(a,h);if(!y||t.has(h))return{};const x=i?i[0]:o,w=e=>{n&&x.reportValidity&&(x.setCustomValidity(Jr(e)?"":e||""),x.reportValidity())},v={},N=Fn(o),j=Mr(o),_=N||j,k=(f||Pn(o))&&Gr(o.value)&&Gr(b)||Tn(o)&&""===o.value||""===b||Array.isArray(b)&&!b.length,S=kn.bind(null,h,r,v),E=(e,t,a,r=un,n=mn)=>{const s=e?t:a;v[h]={type:e?r:n,message:s,ref:o,...S(e?r:n,s)}};if(s?!Array.isArray(b)||!b.length:l&&(!_&&(k||zr(b))||Jr(b)&&!b||j&&!Bn(i).isValid||N&&!Wn(i).isValid)){const{value:e,message:t}=ns(l)?{value:!!l,message:l}:os(l);if(e&&(v[h]={type:gn,message:t,ref:x,...S(gn,t)},!r))return w(t),v}if(!(k||zr(u)&&zr(m))){let e,t;const a=os(m),n=os(u);if(zr(b)||isNaN(b)){const r=o.valueAsDate||new Date(b),s=e=>new Date((new Date).toDateString()+" "+e),i="time"==o.type,l="week"==o.type;vn(a.value)&&b&&(e=i?s(b)>s(a.value):l?b>a.value:r>new Date(a.value)),vn(n.value)&&b&&(t=i?s(b)<s(n.value):l?b<n.value:r<new Date(n.value))}else{const r=o.valueAsNumber||(b?+b:b);zr(a.value)||(e=r>a.value),zr(n.value)||(t=r<n.value)}if((e||t)&&(E(!!e,a.message,n.message,dn,cn),!r))return w(v[h].message),v}if((d||c)&&!k&&(vn(b)||s&&Array.isArray(b))){const e=os(d),t=os(c),a=!zr(e.value)&&b.length>+e.value,n=!zr(t.value)&&b.length<+t.value;if((a||n)&&(E(a,e.message,t.message),!r))return w(v[h].message),v}if(p&&!k&&vn(b)){const{value:e,message:t}=os(p);if(Kn(e)&&!b.match(e)&&(v[h]={type:pn,message:t,ref:o,...S(pn,t)},!r))return w(t),v}if(g)if(Cn(g)){const e=ss(await g(b,a),x);if(e&&(v[h]={...e,...S(hn,e.message)},!r))return w(e.message),v}else if(qr(g)){let e={};for(const t in g){if(!In(e)&&!r)break;const n=ss(await g[t](b,a),x,t);n&&(e={...n,...S(t,n.message)},w(n.message),r&&(v[h]=e))}if(!In(e)&&(v[h]={ref:x,...e},!r))return v}return w(!0),v};const ls={mode:sn,reValidateMode:nn,shouldFocusError:!0};function ds(e={}){let t={...ls,...e},a={submitCount:0,isDirty:!1,isReady:!1,isLoading:Cn(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const r={};let n,s=(qr(t.defaultValues)||qr(t.values))&&Xr(t.defaultValues||t.values)||{},o=t.shouldUnregister?{}:Xr(s),i={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},d=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let u={...c};const m={array:En(),state:En()},p=t.criteriaMode===ln,g=async e=>{if(!t.disabled&&(c.isValid||u.isValid||e)){const e=t.resolver?In((await x()).errors):await w(r,!0);e!==a.isValid&&m.state.next({isValid:e})}},h=(e,r)=>{!t.disabled&&(c.isValidating||c.validatingFields||u.isValidating||u.validatingFields)&&((e||Array.from(l.mount)).forEach(e=>{e&&(r?Zr(a.validatingFields,e,r):$n(a.validatingFields,e))}),m.state.next({validatingFields:a.validatingFields,isValidating:!In(a.validatingFields)}))},f=(e,t,a,n)=>{const l=Qr(r,e);if(l){const r=Qr(o,e,Gr(a)?Qr(s,e):a);Gr(r)||n&&n.defaultChecked||t?Zr(o,e,t?r:Gn(l._f)):j(e,r),i.mount&&g()}},y=(e,r,n,o,i)=>{let l=!1,d=!1;const p={name:e};if(!t.disabled){if(!n||o){(c.isDirty||u.isDirty)&&(d=a.isDirty,a.isDirty=p.isDirty=v(),l=d!==p.isDirty);const t=Dn(Qr(s,e),r);d=!!Qr(a.dirtyFields,e),t?$n(a.dirtyFields,e):Zr(a.dirtyFields,e,!0),p.dirtyFields=a.dirtyFields,l=l||(c.dirtyFields||u.dirtyFields)&&d!==!t}if(n){const t=Qr(a.touchedFields,e);t||(Zr(a.touchedFields,e,n),p.touchedFields=a.touchedFields,l=l||(c.touchedFields||u.touchedFields)&&t!==n)}l&&i&&m.state.next(p)}return l?p:{}},b=(e,r,s,o)=>{const i=Qr(a.errors,e),l=(c.isValid||u.isValid)&&Jr(r)&&a.isValid!==r;var p;if(t.delayError&&s?(p=()=>((e,t)=>{Zr(a.errors,e,t),m.state.next({errors:a.errors})})(e,s),n=e=>{clearTimeout(d),d=setTimeout(p,e)},n(t.delayError)):(clearTimeout(d),n=null,s?Zr(a.errors,e,s):$n(a.errors,e)),(s?!Dn(i,s):i)||!In(o)||l){const t={...o,...l&&Jr(r)?{isValid:r}:{},errors:a.errors,name:e};a={...a,...t},m.state.next(t)}},x=async e=>{h(e,!0);const a=await t.resolver(o,t.context,((e,t,a,r)=>{const n={};for(const s of e){const e=Qr(t,s);e&&Zr(n,s,e._f)}return{criteriaMode:a,names:[...e],fields:n,shouldUseNativeValidation:r}})(e||l.mount,r,t.criteriaMode,t.shouldUseNativeValidation));return h(e),a},w=async(e,r,n={valid:!0})=>{for(const s in e){const i=e[s];if(i){const{_f:e,...d}=i;if(e){const d=l.array.has(e.name),u=i._f&&Zn(i._f);u&&c.validatingFields&&h([s],!0);const m=await is(i,l.disabled,o,p,t.shouldUseNativeValidation&&!r,d);if(u&&c.validatingFields&&h([s]),m[e.name]&&(n.valid=!1,r))break;!r&&(Qr(m,e.name)?d?rs(a.errors,m,e.name):Zr(a.errors,e.name,m[e.name]):$n(a.errors,e.name))}!In(d)&&await w(d,r,n)}}return n.valid},v=(e,a)=>!t.disabled&&(e&&a&&Zr(o,e,a),!Dn(D(),s)),N=(e,t,a)=>Nn(e,l,{...i.mount?o:Gr(t)?s:vn(e)?{[e]:t}:t},a,t),j=(e,t,a={})=>{const n=Qr(r,e);let s=t;if(n){const a=n._f;a&&(!a.disabled&&Zr(o,e,Hn(t,a)),s=Tn(a.ref)&&zr(t)?"":t,Ln(a.ref)?[...a.ref.options].forEach(e=>e.selected=s.includes(e.value)):a.refs?Mr(a.ref)?a.refs.forEach(e=>{e.defaultChecked&&e.disabled||(Array.isArray(s)?e.checked=!!s.find(t=>t===e.value):e.checked=s===e.value||!!s)}):a.refs.forEach(e=>e.checked=e.value===s):Pn(a.ref)?a.ref.value="":(a.ref.value=s,a.ref.type||m.state.next({name:e,values:Xr(o)})))}(a.shouldDirty||a.shouldTouch)&&y(e,s,a.shouldTouch,a.shouldDirty,!0),a.shouldValidate&&A(e)},_=(e,t,a)=>{for(const n in t){if(!t.hasOwnProperty(n))return;const s=t[n],o=e+"."+n,i=Qr(r,o);(l.array.has(e)||qr(s)||i&&!i._f)&&!Or(s)?_(o,s,a):j(o,s,a)}},k=(e,t,n={})=>{const d=Qr(r,e),p=l.array.has(e),g=Xr(t);Zr(o,e,g),p?(m.array.next({name:e,values:Xr(o)}),(c.isDirty||c.dirtyFields||u.isDirty||u.dirtyFields)&&n.shouldDirty&&m.state.next({name:e,dirtyFields:Vn(s,o),isDirty:v(e,g)})):!d||d._f||zr(g)?j(e,g,n):_(e,g,n),es(e,l)&&m.state.next({...a}),m.state.next({name:i.mount?e:void 0,values:Xr(o)})},S=async e=>{i.mount=!0;const s=e.target;let d=s.name,f=!0;const v=Qr(r,d),N=e=>{f=Number.isNaN(e)||Or(e)&&isNaN(e.getTime())||Dn(e,Qr(o,d,e))},j=Qn(t.mode),_=Qn(t.reValidateMode);if(v){let i,S;const E=s.type?Gn(v._f):Ur(e),D=e.type===en||e.type===tn,I=!((k=v._f).mount&&(k.required||k.min||k.max||k.maxLength||k.minLength||k.pattern||k.validate)||t.resolver||Qr(a.errors,d)||v._f.deps)||((e,t,a,r,n)=>!n.isOnAll&&(!a&&n.isOnTouch?!(t||e):(a?r.isOnBlur:n.isOnBlur)?!e:!(a?r.isOnChange:n.isOnChange)||e))(D,Qr(a.touchedFields,d),a.isSubmitted,_,j),P=es(d,l,D);Zr(o,d,E),D?(v._f.onBlur&&v._f.onBlur(e),n&&n(0)):v._f.onChange&&v._f.onChange(e);const C=y(d,E,D),T=!In(C)||P;if(!D&&m.state.next({name:d,type:e.type,values:Xr(o)}),I)return(c.isValid||u.isValid)&&("onBlur"===t.mode?D&&g():D||g()),T&&m.state.next({name:d,...P?{}:C});if(!D&&P&&m.state.next({...a}),t.resolver){const{errors:e}=await x([d]);if(N(E),f){const t=as(a.errors,r,d),n=as(e,r,t.name||d);i=n.error,d=n.name,S=In(e)}}else h([d],!0),i=(await is(v,l.disabled,o,p,t.shouldUseNativeValidation))[d],h([d]),N(E),f&&(i?S=!1:(c.isValid||u.isValid)&&(S=await w(r,!0)));f&&(v._f.deps&&A(v._f.deps),b(d,S,i,C))}var k},E=(e,t)=>{if(Qr(a.errors,t)&&e.focus)return e.focus(),1},A=async(e,n={})=>{let s,o;const i=Sn(e);if(t.resolver){const t=await(async e=>{const{errors:t}=await x(e);if(e)for(const r of e){const e=Qr(t,r);e?Zr(a.errors,r,e):$n(a.errors,r)}else a.errors=t;return t})(Gr(e)?e:i);s=In(t),o=e?!i.some(e=>Qr(t,e)):s}else e?(o=(await Promise.all(i.map(async e=>{const t=Qr(r,e);return await w(t&&t._f?{[e]:t}:t)}))).every(Boolean),(o||a.isValid)&&g()):o=s=await w(r);return m.state.next({...!vn(e)||(c.isValid||u.isValid)&&s!==a.isValid?{}:{name:e},...t.resolver||!e?{isValid:s}:{},errors:a.errors}),n.shouldFocus&&!o&&ts(r,E,e?i:l.mount),o},D=e=>{const t={...i.mount?o:s};return Gr(e)?t:vn(e)?Qr(t,e):e.map(e=>Qr(t,e))},I=(e,t)=>({invalid:!!Qr((t||a).errors,e),isDirty:!!Qr((t||a).dirtyFields,e),error:Qr((t||a).errors,e),isValidating:!!Qr(a.validatingFields,e),isTouched:!!Qr((t||a).touchedFields,e)}),P=(e,t,n)=>{const s=(Qr(r,e,{_f:{}})._f||{}).ref,o=Qr(a.errors,e)||{},{ref:i,message:l,type:d,...c}=o;Zr(a.errors,e,{...c,...t,ref:s}),m.state.next({name:e,errors:a.errors,isValid:!1}),n&&n.shouldFocus&&s&&s.focus&&s.focus()},C=e=>m.state.subscribe({next:t=>{var r,n,s;r=e.name,n=t.name,s=e.exact,r&&n&&r!==n&&!Sn(r).some(e=>e&&(s?e===n:e.startsWith(n)||n.startsWith(e)))||!((e,t,a,r)=>{a(e);const{name:n,...s}=e;return In(s)||Object.keys(s).length>=Object.keys(t).length||Object.keys(s).find(e=>t[e]===(!r||ln))})(t,e.formState||c,z,e.reRenderRoot)||e.callback({values:{...o},...a,...t})}}).unsubscribe,T=(e,n={})=>{for(const i of e?Sn(e):l.mount)l.mount.delete(i),l.array.delete(i),n.keepValue||($n(r,i),$n(o,i)),!n.keepError&&$n(a.errors,i),!n.keepDirty&&$n(a.dirtyFields,i),!n.keepTouched&&$n(a.touchedFields,i),!n.keepIsValidating&&$n(a.validatingFields,i),!t.shouldUnregister&&!n.keepDefaultValue&&$n(s,i);m.state.next({values:Xr(o)}),m.state.next({...a,...n.keepDirty?{isDirty:v()}:{}}),!n.keepIsValid&&g()},L=({disabled:e,name:t})=>{(Jr(e)&&i.mount||e||l.disabled.has(t))&&(e?l.disabled.add(t):l.disabled.delete(t))},F=(e,a={})=>{let n=Qr(r,e);const o=Jr(a.disabled)||Jr(t.disabled);return Zr(r,e,{...n||{},_f:{...n&&n._f?n._f:{ref:{name:e}},name:e,mount:!0,...a}}),l.mount.add(e),n?L({disabled:Jr(a.disabled)?a.disabled:t.disabled,name:e}):f(e,!0,a.value),{...o?{disabled:a.disabled||t.disabled}:{},...t.progressive?{required:!!a.required,min:Yn(a.min),max:Yn(a.max),minLength:Yn(a.minLength),maxLength:Yn(a.maxLength),pattern:Yn(a.pattern)}:{},name:e,onChange:S,onBlur:S,ref:o=>{if(o){F(e,a),n=Qr(r,e);const t=Gr(o.value)&&o.querySelectorAll&&o.querySelectorAll("input,select,textarea")[0]||o,i=(e=>Fn(e)||Mr(e))(t),l=n._f.refs||[];if(i?l.find(e=>e===t):t===n._f.ref)return;Zr(r,e,{_f:{...n._f,...i?{refs:[...l.filter(Rn),t,...Array.isArray(Qr(s,e))?[{}]:[]],ref:{type:t.type,name:e}}:{ref:t}}}),f(e,!1,void 0,t)}else n=Qr(r,e,{}),n._f&&(n._f.mount=!1),(t.shouldUnregister||a.shouldUnregister)&&(!Br(l.array,e)||!i.action)&&l.unMount.add(e)}}},R=()=>t.shouldFocusError&&ts(r,E,l.mount),$=(e,n)=>async s=>{let i;s&&(s.preventDefault&&s.preventDefault(),s.persist&&s.persist());let d=Xr(o);if(m.state.next({isSubmitting:!0}),t.resolver){const{errors:e,values:t}=await x();a.errors=e,d=Xr(t)}else await w(r);if(l.disabled.size)for(const e of l.disabled)$n(d,e);if($n(a.errors,"root"),In(a.errors)){m.state.next({errors:{}});try{await e(d,s)}catch(c){i=c}}else n&&await n({...a.errors},s),R(),setTimeout(R);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:In(a.errors)&&!i,submitCount:a.submitCount+1,errors:a.errors}),i)throw i},M=(e,n={})=>{const d=e?Xr(e):s,u=Xr(d),p=In(e),g=p?s:u;if(n.keepDefaultValues||(s=d),!n.keepValues){if(n.keepDirtyValues){const e=new Set([...l.mount,...Object.keys(Vn(s,o))]);for(const t of Array.from(e))Qr(a.dirtyFields,t)?Zr(g,t,Qr(o,t)):k(t,Qr(g,t))}else{if(Hr&&Gr(e))for(const e of l.mount){const t=Qr(r,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(Tn(e)){const t=e.closest("form");if(t){t.reset();break}}}}for(const e of l.mount){const t=Qr(g,e,Qr(s,e));Gr(t)||(Zr(g,e,t),k(e,Qr(g,e)))}}o=Xr(g),m.array.next({values:{...g}}),m.state.next({values:{...g}})}l={mount:n.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!c.isValid||!!n.keepIsValid||!!n.keepDirtyValues,i.watch=!!t.shouldUnregister,m.state.next({submitCount:n.keepSubmitCount?a.submitCount:0,isDirty:!p&&(n.keepDirty?a.isDirty:!(!n.keepDefaultValues||Dn(e,s))),isSubmitted:!!n.keepIsSubmitted&&a.isSubmitted,dirtyFields:p?{}:n.keepDirtyValues?n.keepDefaultValues&&o?Vn(s,o):a.dirtyFields:n.keepDefaultValues&&e?Vn(s,e):n.keepDirty?a.dirtyFields:{},touchedFields:n.keepTouched?a.touchedFields:{},errors:n.keepErrors?a.errors:{},isSubmitSuccessful:!!n.keepIsSubmitSuccessful&&a.isSubmitSuccessful,isSubmitting:!1})},O=(e,t)=>M(Cn(e)?e(o):e,t),z=e=>{a={...a,...e}},V={control:{register:F,unregister:T,getFieldState:I,handleSubmit:$,setError:P,_subscribe:C,_runSchema:x,_focusError:R,_getWatch:N,_getDirty:v,_setValid:g,_setFieldArray:(e,n=[],l,d,p=!0,g=!0)=>{if(d&&l&&!t.disabled){if(i.action=!0,g&&Array.isArray(Qr(r,e))){const t=l(Qr(r,e),d.argA,d.argB);p&&Zr(r,e,t)}if(g&&Array.isArray(Qr(a.errors,e))){const t=l(Qr(a.errors,e),d.argA,d.argB);p&&Zr(a.errors,e,t),((e,t)=>{!Kr(Qr(e,t)).length&&$n(e,t)})(a.errors,e)}if((c.touchedFields||u.touchedFields)&&g&&Array.isArray(Qr(a.touchedFields,e))){const t=l(Qr(a.touchedFields,e),d.argA,d.argB);p&&Zr(a.touchedFields,e,t)}(c.dirtyFields||u.dirtyFields)&&(a.dirtyFields=Vn(s,o)),m.state.next({name:e,isDirty:v(e,n),dirtyFields:a.dirtyFields,errors:a.errors,isValid:a.isValid})}else Zr(o,e,n)},_setDisabledField:L,_setErrors:e=>{a.errors=e,m.state.next({errors:a.errors,isValid:!1})},_getFieldArray:e=>Kr(Qr(i.mount?o:s,e,t.shouldUnregister?Qr(s,e,[]):[])),_reset:M,_resetDefaultValues:()=>Cn(t.defaultValues)&&t.defaultValues().then(e=>{O(e,t.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:()=>{for(const e of l.unMount){const t=Qr(r,e);t&&(t._f.refs?t._f.refs.every(e=>!Rn(e)):!Rn(t._f.ref))&&T(e)}l.unMount=new Set},_disableForm:e=>{Jr(e)&&(m.state.next({disabled:e}),ts(r,(t,a)=>{const n=Qr(r,a);n&&(t.disabled=n._f.disabled||e,Array.isArray(n._f.refs)&&n._f.refs.forEach(t=>{t.disabled=n._f.disabled||e}))},0,!1))},_subjects:m,_proxyFormState:c,get _fields(){return r},get _formValues(){return o},get _state(){return i},set _state(e){i=e},get _defaultValues(){return s},get _names(){return l},set _names(e){l=e},get _formState(){return a},get _options(){return t},set _options(e){t={...t,...e}}},subscribe:e=>(i.mount=!0,u={...u,...e.formState},C({...e,formState:u})),trigger:A,register:F,handleSubmit:$,watch:(e,t)=>Cn(e)?m.state.subscribe({next:a=>e(N(void 0,t),a)}):N(e,t,!0),setValue:k,getValues:D,reset:O,resetField:(e,t={})=>{Qr(r,e)&&(Gr(t.defaultValue)?k(e,Xr(Qr(s,e))):(k(e,t.defaultValue),Zr(s,e,Xr(t.defaultValue))),t.keepTouched||$n(a.touchedFields,e),t.keepDirty||($n(a.dirtyFields,e),a.isDirty=t.defaultValue?v(e,Xr(Qr(s,e))):v()),t.keepError||($n(a.errors,e),c.isValid&&g()),m.state.next({...a}))},clearErrors:e=>{e&&Sn(e).forEach(e=>$n(a.errors,e)),m.state.next({errors:e?a.errors:{}})},unregister:T,setError:P,setFocus:(e,t={})=>{const a=Qr(r,e),n=a&&a._f;if(n){const e=n.refs?n.refs[0]:n.ref;e.focus&&(e.focus(),t.shouldSelect&&Cn(e.select)&&e.select())}},getFieldState:I};return{...V,formControl:V}}function cs(e={}){const t=J.useRef(void 0),a=J.useRef(void 0),[r,n]=J.useState({isDirty:!1,isValidating:!1,isLoading:Cn(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Cn(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:r},e.defaultValues&&!Cn(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:a,...n}=ds(e);t.current={...n,formState:r}}const s=t.current.control;return s._options=e,wn(()=>{const e=s._subscribe({formState:s._proxyFormState,callback:()=>n({...s._formState}),reRenderRoot:!0});return n(e=>({...e,isReady:!0})),s._formState.isReady=!0,e},[s]),J.useEffect(()=>s._disableForm(e.disabled),[s,e.disabled]),J.useEffect(()=>{e.mode&&(s._options.mode=e.mode),e.reValidateMode&&(s._options.reValidateMode=e.reValidateMode)},[s,e.mode,e.reValidateMode]),J.useEffect(()=>{e.errors&&(s._setErrors(e.errors),s._focusError())},[s,e.errors]),J.useEffect(()=>{e.shouldUnregister&&s._subjects.state.next({values:s._getWatch()})},[s,e.shouldUnregister]),J.useEffect(()=>{if(s._proxyFormState.isDirty){const e=s._getDirty();e!==r.isDirty&&s._subjects.state.next({isDirty:e})}},[s,r.isDirty]),J.useEffect(()=>{e.values&&!Dn(e.values,a.current)?(s._reset(e.values,s._options.resetOptions),a.current=e.values,n(e=>({...e}))):s._resetDefaultValues()},[s,e.values]),J.useEffect(()=>{s._state.mount||(s._setValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),t.current.formState=xn(r,s),t.current}const us=Q.forwardRef(({className:t,...a},r)=>e.jsx("textarea",{className:Nt("flex min-h-[80px] w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 resize-vertical dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder:text-gray-400 dark:focus-visible:ring-blue-400 dark:hover:border-blue-500/50 dark:shadow-md",t),ref:r,...a}));us.displayName="Textarea";const ms=N,ps=j,gs=_,hs=Q.forwardRef(({className:t,children:a,...r},n)=>e.jsxs(c,{ref:n,className:Nt("flex h-10 w-full items-center justify-between whitespace-nowrap rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background transition-all duration-200 data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:data-[placeholder]:text-gray-400 dark:focus:ring-blue-400 dark:hover:border-blue-500/50 dark:shadow-md",t),...r,children:[a,e.jsx(u,{asChild:!0,children:e.jsx(Ca,{className:"h-4 w-4 opacity-50"})})]}));hs.displayName=c.displayName;const fs=Q.forwardRef(({className:t,...a},r)=>e.jsx(m,{ref:r,className:Nt("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(La,{className:"h-4 w-4"})}));fs.displayName=m.displayName;const ys=Q.forwardRef(({className:t,...a},r)=>e.jsx(p,{ref:r,className:Nt("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(Ca,{className:"h-4 w-4"})}));ys.displayName=p.displayName;const bs=Q.forwardRef(({className:t,children:a,position:r="popper",...n},s)=>e.jsx(g,{children:e.jsxs(h,{ref:s,className:Nt("relative z-50 max-h-[min(var(--radix-select-content-available-height),20rem)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin] dark:bg-gray-800 dark:border-gray-700 dark:text-white","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[e.jsx(fs,{}),e.jsx(f,{className:Nt("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(ys,{})]})}));bs.displayName=h.displayName;const xs=Q.forwardRef(({className:t,...a},r)=>e.jsx(y,{ref:r,className:Nt("px-2 py-1.5 text-sm font-semibold text-muted-foreground dark:text-gray-300",t),...a}));xs.displayName=y.displayName;const ws=Q.forwardRef(({className:t,...a},r)=>e.jsx(b,{ref:r,className:Nt("-mx-1 my-1 h-px bg-muted",t),...a}));ws.displayName=b.displayName;const vs=Q.forwardRef(({className:t,children:a,...r},n)=>e.jsxs(x,{ref:n,className:Nt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(w,{children:e.jsx(Pa,{className:"h-4 w-4"})})}),e.jsx(v,{children:a})]}));vs.displayName=x.displayName;let Ns=0;const js=new Map,_s=e=>{if(js.has(e))return;const t=setTimeout(()=>{js.delete(e),As({type:"REMOVE_TOAST",toastId:e})},3e3);js.set(e,t)},ks=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?_s(a):e.toasts.forEach(e=>{_s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},Ss=[];let Es={toasts:[]};function As(e){Es=ks(Es,e),Ss.forEach(e=>{e(Es)})}function Ds({...e}){const t=(Ns=(Ns+1)%Number.MAX_SAFE_INTEGER,Ns.toString()),a=()=>As({type:"DISMISS_TOAST",toastId:t});return As({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>As({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Is(){const[e,t]=Q.useState(Es);return Q.useEffect(()=>(Ss.push(t),()=>{const e=Ss.indexOf(t);e>-1&&Ss.splice(e,1)}),[e]),{...e,toast:Ds,dismiss:e=>As({type:"DISMISS_TOAST",toastId:e})}}function Ps({open:t,onOpenChange:a}){const{createPatient:r,isLoading:n}=me(),{toast:s}=Is(),[o,i]=Q.useState(!1),{register:l,handleSubmit:d,reset:c,setValue:u,watch:m,formState:{errors:p}}=cs({defaultValues:{full_name:"",gender:void 0,age:void 0,patient_condition:"",allergies:"",medical_conditions:"",email:"",address:"",notes:"",phone:"",date_added:(new Date).toISOString().slice(0,16)}}),g=()=>{c(),a(!1)};return e.jsx(br,{open:t,onOpenChange:g,children:e.jsxs(vr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Nr,{children:[e.jsx(_r,{children:"إضافة مريض جديد"}),e.jsx(kr,{children:"أدخل معلومات المريض أدناه. الحقول المميزة بـ * مطلوبة."})]}),e.jsxs("form",{onSubmit:d(async e=>{if(e.gender){i(!0);try{const t=Date.now().toString().slice(-8)+Math.floor(100*Math.random()).toString().padStart(2,"0"),n={...e,serial_number:t,age:Number(e.age),date_added:e.date_added||(new Date).toISOString()};await r(n),s({title:"تم بنجاح",description:"تم إضافة المريض بنجاح"}),c(),a(!1)}catch(t){s({title:"خطأ",description:"فشل في إضافة المريض",variant:"destructive"})}finally{i(!1)}}else s({title:"خطأ",description:"يرجى اختيار الجنس",variant:"destructive"})}),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول المطلوبة"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الاسم الكامل *"}),e.jsx(Sr,{...l("full_name",{required:"الاسم الكامل مطلوب"}),placeholder:"أدخل الاسم الكامل"}),p.full_name&&e.jsx("p",{className:"text-sm text-destructive",children:p.full_name.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الجنس *"}),e.jsxs(ms,{onValueChange:e=>u("gender",e),children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر الجنس",className:"text-muted-foreground"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"male",children:"ذكر"}),e.jsx(vs,{value:"female",children:"أنثى"})]})]}),p.gender&&e.jsx("p",{className:"text-sm text-destructive",children:"الجنس مطلوب"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"العمر *"}),e.jsx(Sr,{type:"number",min:"1",max:"120",...l("age",{required:"العمر مطلوب",min:{value:1,message:"العمر يجب أن يكون أكبر من 0"},max:{value:120,message:"العمر يجب أن يكون أقل من 120"}}),placeholder:"أدخل العمر"}),p.age&&e.jsx("p",{className:"text-sm text-destructive",children:p.age.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"تاريخ الإضافة *"}),e.jsx(Sr,{type:"datetime-local",...l("date_added",{required:"تاريخ الإضافة مطلوب"})}),p.date_added&&e.jsx("p",{className:"text-sm text-destructive",children:p.date_added.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"رقم الهاتف"}),e.jsx(Sr,{type:"tel",...l("phone",{pattern:{value:/^[0-9]{12}$/,message:"رقم الهاتف يجب أن يكون 12 رقم (مثل: 963987654321)"}}),placeholder:"963987654321"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يرجى إدخال رقم الهاتف مع رمز الدولة بدون + أو 00 (مثل: 963987654321)"}),p.phone&&e.jsx("p",{className:"text-sm text-destructive",children:p.phone.message})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول الاختيارية"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"حالة المريض / التشخيص"}),e.jsx(us,{...l("patient_condition"),placeholder:"أدخل وصف الحالة الطبية أو التشخيص",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحساسية"}),e.jsx(Sr,{...l("allergies"),placeholder:"أدخل معلومات الحساسية المعروفة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالات الطبية / الأمراض"}),e.jsx(us,{...l("medical_conditions"),placeholder:"أدخل الحالات الطبية أو الأمراض المزمنة",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"البريد الإلكتروني"}),e.jsx(Sr,{type:"email",...l("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"البريد الإلكتروني غير صحيح"}}),placeholder:"أدخل البريد الإلكتروني"}),p.email&&e.jsx("p",{className:"text-sm text-destructive",children:p.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"العنوان"}),e.jsx(Sr,{...l("address"),placeholder:"أدخل العنوان الكامل"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"ملاحظات / تعليقات"}),e.jsx(us,{...l("notes"),placeholder:"أدخل أي ملاحظات أو تعليقات إضافية",rows:3})]})]}),e.jsxs(jr,{className:"flex justify-end space-x-4 space-x-reverse",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:g,disabled:o,children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:o||n,children:o?"جاري الإضافة...":"حفظ المريض"})]})]})]})})}var Cs="AlertDialog",[Ts,Ls]=k(Cs,[S]),Fs=S(),Rs=t=>{const{__scopeAlertDialog:a,...r}=t,n=Fs(a);return e.jsx(i,{...n,...r,modal:!0})};Rs.displayName=Cs;Q.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...n}=t,s=Fs(r);return e.jsx(E,{...s,...n,ref:a})}).displayName="AlertDialogTrigger";var $s=t=>{const{__scopeAlertDialog:a,...r}=t,n=Fs(a);return e.jsx(l,{...n,...r})};$s.displayName="AlertDialogPortal";var Ms=Q.forwardRef((t,r)=>{const{__scopeAlertDialog:n,...s}=t,o=Fs(n);return e.jsx(a,{...o,...s,ref:r})});Ms.displayName="AlertDialogOverlay";var Os="AlertDialogContent",[zs,Vs]=Ts(Os),qs=P("AlertDialogContent"),Us=Q.forwardRef((t,a)=>{const{__scopeAlertDialog:n,children:s,...o}=t,i=Fs(n),l=Q.useRef(null),d=A(a,l),c=Q.useRef(null);return e.jsx(D,{contentName:Os,titleName:Bs,docsSlug:"alert-dialog",children:e.jsx(zs,{scope:n,cancelRef:c,children:e.jsxs(r,{role:"alertdialog",...i,...o,ref:d,onOpenAutoFocus:I(o.onOpenAutoFocus,e=>{e.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[e.jsx(qs,{children:s}),e.jsx(Qs,{contentRef:l})]})})})});Us.displayName=Os;var Bs="AlertDialogTitle",Hs=Q.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...n}=t,o=Fs(r);return e.jsx(s,{...o,...n,ref:a})});Hs.displayName=Bs;var Xs="AlertDialogDescription",Ws=Q.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...n}=t,s=Fs(r);return e.jsx(o,{...s,...n,ref:a})});Ws.displayName=Xs;var Gs=Q.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...s}=t,o=Fs(r);return e.jsx(n,{...o,...s,ref:a})});Gs.displayName="AlertDialogAction";var Ks="AlertDialogCancel",Ys=Q.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...s}=t,{cancelRef:o}=Vs(Ks,r),i=Fs(r),l=A(a,o);return e.jsx(n,{...i,...s,ref:l})});Ys.displayName=Ks;var Qs=({contentRef:e})=>{const t=`\`${Os}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Os}\` by passing a \`${Xs}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Os}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return Q.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},Js=Ms,Zs=Us,eo=Gs,to=Ys,ao=Hs,ro=Ws;const no=Rs,so=$s,oo=Q.forwardRef(({className:t,...a},r)=>e.jsx(Js,{className:Nt("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a,ref:r}));oo.displayName=Js.displayName;const io=Q.forwardRef(({className:t,...a},r)=>e.jsxs(so,{children:[e.jsx(oo,{}),e.jsx(Zs,{ref:r,dir:"rtl",className:Nt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:bg-gray-800 dark:border-gray-700",t),...a})]}));io.displayName=Zs.displayName;const lo=({className:t,...a})=>e.jsx("div",{className:Nt("flex flex-col space-y-2 text-center sm:text-right",t),...a});lo.displayName="AlertDialogHeader";const co=({className:t,...a})=>e.jsx("div",{className:Nt("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",t),...a});co.displayName="AlertDialogFooter";const uo=Q.forwardRef(({className:t,...a},r)=>e.jsx(ao,{ref:r,className:Nt("text-lg font-semibold",t),...a}));uo.displayName=ao.displayName;const mo=Q.forwardRef(({className:t,...a},r)=>e.jsx(ro,{ref:r,className:Nt("text-sm text-muted-foreground",t),...a}));mo.displayName=ro.displayName;const po=Q.forwardRef(({className:t,...a},r)=>e.jsx(eo,{ref:r,className:Nt(hr(),t),...a}));po.displayName=eo.displayName;const go=Q.forwardRef(({className:t,...a},r)=>e.jsx(to,{ref:r,className:Nt(hr({variant:"outline"}),"mt-2 sm:mt-0",t),...a}));go.displayName=to.displayName;var ho={exports:{}},fo={},yo=Q;var bo="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},xo=yo.useState,wo=yo.useEffect,vo=yo.useLayoutEffect,No=yo.useDebugValue;function jo(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!bo(e,a)}catch(r){return!0}}var _o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),r=xo({inst:{value:a,getSnapshot:t}}),n=r[0].inst,s=r[1];return vo(function(){n.value=a,n.getSnapshot=t,jo(n)&&s({inst:n})},[e,a,t]),wo(function(){return jo(n)&&s({inst:n}),e(function(){jo(n)&&s({inst:n})})},[e]),No(a),a};fo.useSyncExternalStore=void 0!==yo.useSyncExternalStore?yo.useSyncExternalStore:_o,ho.exports=fo;var ko=ho.exports;function So(){return()=>{}}var Eo="Avatar",[Ao,Do]=k(Eo),[Io,Po]=Ao(Eo),Co=Q.forwardRef((t,a)=>{const{__scopeAvatar:r,...n}=t,[s,o]=Q.useState("idle");return e.jsx(Io,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:o,children:e.jsx(d.span,{...n,ref:a})})});Co.displayName=Eo;var To="AvatarImage",Lo=Q.forwardRef((t,a)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:s=()=>{},...o}=t,i=Po(To,r),l=function(e,{referrerPolicy:t,crossOrigin:a}){const r=ko.useSyncExternalStore(So,()=>!0,()=>!1),n=Q.useRef(null),s=r?(n.current||(n.current=new window.Image),n.current):null,[o,i]=Q.useState(()=>$o(s,e));return T(()=>{i($o(s,e))},[s,e]),T(()=>{const e=e=>()=>{i(e)};if(!s)return;const r=e("loaded"),n=e("error");return s.addEventListener("load",r),s.addEventListener("error",n),t&&(s.referrerPolicy=t),"string"==typeof a&&(s.crossOrigin=a),()=>{s.removeEventListener("load",r),s.removeEventListener("error",n)}},[s,a,t]),o}(n,o),c=C(e=>{s(e),i.onImageLoadingStatusChange(e)});return T(()=>{"idle"!==l&&c(l)},[l,c]),"loaded"===l?e.jsx(d.img,{...o,ref:a,src:n}):null});Lo.displayName=To;var Fo="AvatarFallback",Ro=Q.forwardRef((t,a)=>{const{__scopeAvatar:r,delayMs:n,...s}=t,o=Po(Fo,r),[i,l]=Q.useState(void 0===n);return Q.useEffect(()=>{if(void 0!==n){const e=window.setTimeout(()=>l(!0),n);return()=>window.clearTimeout(e)}},[n]),i&&"loaded"!==o.imageLoadingStatus?e.jsx(d.span,{...s,ref:a}):null});function $o(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}Ro.displayName=Fo;var Mo=Co,Oo=Lo,zo=Ro;const Vo=Q.forwardRef(({className:t,...a},r)=>e.jsx(Mo,{ref:r,className:Nt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a}));Vo.displayName=Mo.displayName;Q.forwardRef(({className:t,...a},r)=>e.jsx(Oo,{ref:r,className:Nt("aspect-square h-full w-full",t),...a})).displayName=Oo.displayName;const qo=Q.forwardRef(({className:t,...a},r)=>e.jsx(zo,{ref:r,className:Nt("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a}));function Uo({isOpen:t,patient:a,appointment:r,onClose:n,onConfirm:s,isLoading:o=!1,deletionProgress:i}){if(!a&&!r)return null;const l=!!a;return e.jsx(no,{open:t,onOpenChange:n,children:e.jsxs(io,{className:"max-w-md",dir:"rtl",children:[e.jsx(lo,{children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ea,{className:"w-8 h-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx(uo,{children:l?"هل أنت متأكد من حذف هذا المريض؟":"هل أنت متأكد من حذف هذا الموعد؟"}),e.jsx(mo,{children:"هذا الإجراء لا يمكن التراجع عنه"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx(Vo,{className:"w-10 h-10",children:e.jsx(qo,{className:"bg-primary/10 text-primary",children:l?`${a.first_name.charAt(0)}${a.last_name.charAt(0)}`:"📅"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l?`${a.first_name} ${a.last_name}`:r.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l?a.phone||"لا يوجد رقم هاتف":new Date(r.start_time).toLocaleString("ar-SA")})]})]})}),l&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(Ea,{className:"w-5 h-5 text-destructive mt-0.5 ml-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-destructive",children:"تحذير مهم"}),e.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:"سيتم حذف جميع البيانات المرتبطة بهذا المريض بما في ذلك:"}),e.jsxs("ul",{className:"text-sm text-destructive/80 mt-2 list-disc list-inside",children:[e.jsx("li",{children:"جميع المواعيد المجدولة"}),e.jsx("li",{children:"سجل الإيرادات"}),e.jsx("li",{children:"التاريخ الطبي والملاحظات"}),e.jsx("li",{children:"الصور الطبية والأشعة"}),e.jsx("li",{children:"سجل استخدام المخزون"})]})]})]})}),o&&i&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"جاري المعالجة..."}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:i})]})]})})]}),e.jsxs(co,{className:"flex justify-end space-x-3 space-x-reverse",children:[e.jsx(go,{disabled:o,children:"إلغاء"}),e.jsx(po,{onClick:s,disabled:o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:o?e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:i||"جاري الحذف..."})]}):"تأكيد الحذف"})]})]})})}qo.displayName=zo.displayName;const Bo=Q.memo(function({isOpen:t,onClose:a,onSave:r,patients:n,treatments:s,selectedDate:o,selectedTime:i,initialData:l,preSelectedPatientId:d}){const[c,u]=Q.useState({patient_id:"",gender:"",description:"",start_time:"",end_time:"",status:"scheduled",notes:""}),{toast:m}=Is();Q.useEffect(()=>{if(t)if(l){const e=n.find(e=>e.id===l.patient_id),t=new Date(l.start_time),a=new Date(l.end_time),r=e=>{if(isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};u({patient_id:l.patient_id||"",gender:"male"===e?.gender?"ذكر":"female"===e?.gender?"أنثى":"",description:l.description||"",start_time:r(t),end_time:r(a),status:l.status||"scheduled",notes:l.notes||""})}else if(o){const e=new Date(o);if(i){const[t,a]=i.split(":");e.setHours(parseInt(t),parseInt(a),0,0)}const t=new Date(e);t.setHours(e.getHours()+1);const a=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;u(r=>({...r,start_time:a(e),end_time:a(t)}))}else{const e=new Date,t=new Date(e.getTime()+36e5),a=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;u({patient_id:"",gender:"",description:"",start_time:a(e),end_time:a(t),status:"scheduled",notes:""})}},[o,i,l,t]),Q.useEffect(()=>{if(t&&d&&n.length>0){const e=n.find(e=>e.id===d);u(t=>({...t,patient_id:d,gender:"male"===e?.gender?"ذكر":"female"===e?.gender?"أنثى":""}))}},[t,d,n.length]);const p=e=>{const{name:t,value:a}=e.target;if("start_time"===t){const e=new Date(a);if(isNaN(e.getTime()))u(e=>({...e,[t]:a}));else{const r=new Date(e.getTime()+36e5),n=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;u(e=>({...e,[t]:a,end_time:n(r)}))}}else u(e=>({...e,[t]:a}))};return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Nr,{children:[e.jsx(_r,{className:"text-xl font-semibold",children:l?"تعديل الموعد":"إضافة موعد جديد"}),e.jsx(kr,{children:l?"تعديل بيانات الموعد المحدد":"إضافة موعد جديد للمريض"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!c.patient_id||!c.start_time)return void m({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});const t=new Date(c.start_time);if(isNaN(t.getTime()))return void m({title:"خطأ",description:"يرجى إدخال تاريخ ووقت بداية صحيح",variant:"destructive"});let a;if(c.end_time?(a=new Date(c.end_time),isNaN(a.getTime())&&(a=new Date(t.getTime()+36e5))):a=new Date(t.getTime()+36e5),a<=t)return void m({title:"خطأ",description:"يجب أن يكون وقت النهاية بعد وقت البداية",variant:"destructive"});try{if(await window.electronAPI.appointments.checkConflict(t.toISOString(),a.toISOString(),l?.id))return void m({title:"تعارض في المواعيد",description:"يوجد موعد آخر في نفس الوقت المحدد. يرجى اختيار وقت آخر.",variant:"destructive"})}catch(f){console.error("Error checking appointment conflict:",f)}const s=n.find(e=>e.id===c.patient_id),o=new Date(c.start_time),i=`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()}`,d=o.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),u=s?`موعد ${s.full_name} - ${i} ${d}`:`موعد جديد - ${i} ${d}`,{gender:p,...g}=c,h={...g,title:u,start_time:t.toISOString(),end_time:a.toISOString()};console.log("📝 Submitting appointment data:",{isEdit:!!l,appointmentId:l?.id,appointmentData:h}),r(h)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول المطلوبة"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center",children:[e.jsx(sr,{className:"w-4 h-4 ml-1"}),"المريض *"]}),e.jsxs(ms,{value:c.patient_id,onValueChange:e=>{u(t=>({...t,patient_id:e}));const t=n.find(t=>t.id===e);t&&u(a=>({...a,patient_id:e,gender:"male"===t.gender?"ذكر":"female"===t.gender?"أنثى":""}))},children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),e.jsx(bs,{children:n.map(t=>e.jsx(vs,{value:t.id,children:t.full_name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{children:"الجنس"}),e.jsx(Sr,{value:c.gender,readOnly:!0,className:"bg-muted cursor-not-allowed",placeholder:"سيتم ملؤه تلقائياً"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center",children:[e.jsx(Da,{className:"w-4 h-4 ml-1"}),"تاريخ ووقت البداية *"]}),e.jsx(Sr,{type:"datetime-local",name:"start_time",value:c.start_time,onChange:p,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center",children:[e.jsx(Fa,{className:"w-4 h-4 ml-1"}),"وقت النهاية"]}),e.jsx(Sr,{type:"datetime-local",name:"end_time",value:c.end_time,onChange:p,placeholder:"سيتم حساب الوقت تلقائياً (ساعة واحدة)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"اتركه فارغاً لحساب ساعة واحدة تلقائياً من وقت البداية"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{children:"حالة الموعد *"}),e.jsxs(ms,{value:c.status,onValueChange:e=>u(t=>({...t,status:e})),children:[e.jsx(hs,{children:e.jsx(gs,{placeholder:"اختر حالة الموعد"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"scheduled",children:"مجدول"}),e.jsx(vs,{value:"cancelled",children:"ملغي"}),e.jsx(vs,{value:"completed",children:"مكتمل"}),e.jsx(vs,{value:"no_show",children:"لم يحضر"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول الاختيارية"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{children:"وصف الموعد"}),e.jsx(us,{name:"description",value:c.description,onChange:p,rows:3,placeholder:"أدخل وصف الموعد"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{children:"ملاحظات إضافية"}),e.jsx(us,{name:"notes",value:c.notes,onChange:p,rows:2,placeholder:"أي ملاحظات إضافية"})]})]}),e.jsxs(jr,{className:"flex justify-end space-x-4 space-x-reverse",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,children:"إلغاء"}),e.jsx(fr,{type:"submit",children:"حفظ الموعد"})]})]})]})})}),Ho=Object.freeze(Object.defineProperty({__proto__:null,default:Bo},Symbol.toStringTag,{value:"Module"})),Xo=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("rounded-xl border bg-card text-card-foreground shadow-sm hover:shadow-md transition-all duration-200 dark:bg-slate-800 dark:border-slate-600 dark:shadow-lg dark:shadow-black/20 dark:hover:shadow-xl",t),...a}));Xo.displayName="Card";const Wo=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("flex flex-col space-y-1.5 p-6 dark:text-slate-100",t),...a}));Wo.displayName="CardHeader";const Go=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("font-semibold leading-none tracking-tight dark:text-slate-100",t),...a}));Go.displayName="CardTitle";const Ko=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("text-sm text-muted-foreground dark:text-slate-300",t),...a}));Ko.displayName="CardDescription";const Yo=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("p-6 pt-0 dark:text-slate-100",t),...a}));Yo.displayName="CardContent";Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:Nt("flex items-center p-6 pt-0 dark:text-card-foreground",t),...a})).displayName="CardFooter";const Qo=gr("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",success:"border-transparent bg-green-600 text-white shadow hover:bg-green-700 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",warning:"border-transparent bg-amber-600 text-white shadow hover:bg-amber-700 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",info:"border-transparent bg-blue-600 text-white shadow hover:bg-blue-700 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-200 dark:shadow-lg dark:shadow-slate-800/20",outline:"text-foreground border-border hover:bg-accent hover:text-accent-foreground dark:text-slate-300 dark:border-slate-600 dark:hover:bg-slate-700 dark:hover:text-slate-100",ghost:"border-transparent hover:bg-accent hover:text-accent-foreground dark:text-slate-300 dark:hover:bg-slate-700 dark:hover:text-slate-100"}},defaultVariants:{variant:"default"}});function Jo({className:t,variant:a,...r}){return e.jsx("div",{className:Nt(Qo({variant:a}),t),...r})}const Zo=ee((e,t)=>({toothTreatments:[],images:[],toothTreatmentImages:[],isLoading:!1,error:null,selectedPatientId:null,selectedToothNumber:null,loadToothTreatments:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.toothTreatments.getAll();e({toothTreatments:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load tooth treatments",isLoading:!1})}},loadToothTreatmentsByPatient:async t=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.toothTreatments.getByPatient(t);e({toothTreatments:a,isLoading:!1,selectedPatientId:t}),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("treatments-loaded",{detail:{patientId:t,treatmentsCount:a.length}}))}catch(a){console.error("🦷 Error loading treatments:",a),e({error:a instanceof Error?a.message:"Failed to load patient tooth treatments",isLoading:!1})}},loadToothTreatmentsByTooth:async(t,a)=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.toothTreatments.getByTooth(t,a);e({toothTreatments:r,isLoading:!1,selectedPatientId:t,selectedToothNumber:a})}catch(r){e({error:r instanceof Error?r.message:"Failed to load tooth treatments",isLoading:!1})}},createToothTreatment:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.toothTreatments.create(a),{toothTreatments:n,selectedPatientId:s}=t();if(e({toothTreatments:[...n,r],isLoading:!1}),s){const t=await window.electronAPI.toothTreatments.getByPatient(s);e({toothTreatments:t})}return"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-added",{detail:{type:"created",treatmentId:r.id,treatment:r}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"created",treatmentId:r.id,treatment:r}}))),r}catch(r){throw e({error:r instanceof Error?r.message:"Failed to create tooth treatment",isLoading:!1}),r}},updateToothTreatment:async(a,r)=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatments.update(a,r);const{toothTreatments:s,selectedPatientId:o}=t(),i=s.map(e=>e.id===a?{...e,...r,updated_at:(new Date).toISOString()}:e);if(e({toothTreatments:i,isLoading:!1}),o)try{const t=await window.electronAPI.toothTreatments.getByPatient(o);e({toothTreatments:t})}catch(n){console.warn("🦷 Store: Failed to refresh treatments, but update was successful:",n)}"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-updated",{detail:{type:"updated",treatmentId:a,updates:r}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"updated",treatmentId:a,updates:r}})),window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-changed",treatmentId:a,updates:r,timestamp:Date.now()}})))}catch(s){console.error("🦷 Store: Error updating treatment:",s),e({error:s instanceof Error?s.message:"Failed to update tooth treatment",isLoading:!1})}},deleteToothTreatment:async a=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatments.delete(a);const{toothTreatments:r}=t();e({toothTreatments:r.filter(e=>e.id!==a),isLoading:!1}),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-deleted",{detail:{type:"deleted",treatmentId:a}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"deleted",treatmentId:a}})),window.dispatchEvent(new CustomEvent("treatment-payments-deleted",{detail:{treatmentId:a}})))}catch(r){throw e({error:r instanceof Error?r.message:"Failed to delete tooth treatment",isLoading:!1}),r}},reorderToothTreatments:async(a,r,n)=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatments.reorder(a,r,n);const s=await window.electronAPI.toothTreatments.getByTooth(a,r),{toothTreatments:o}=t(),i=o.map(e=>{if(e.patient_id===a&&e.tooth_number===r){return s.find(t=>t.id===e.id)||e}return e});e({toothTreatments:i,isLoading:!1})}catch(s){throw e({error:s instanceof Error?s.message:"Failed to reorder tooth treatments",isLoading:!1}),s}},loadImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load images",isLoading:!1})}},loadImagesByTreatment:async t=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.dentalTreatmentImages.getByTreatment(t);e({images:a,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to load treatment images",isLoading:!1})}},createImage:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.dentalTreatmentImages.create(a),{images:n}=t();return e({images:[...n,r],isLoading:!1}),r}catch(r){throw e({error:r instanceof Error?r.message:"Failed to create image",isLoading:!1}),r}},deleteImage:async a=>{e({isLoading:!0,error:null});try{await window.electronAPI.dentalTreatmentImages.delete(a);const{images:r}=t(),n=r.filter(e=>e.id!==a);e({images:n,isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"Failed to delete image",isLoading:!1})}},refreshAllImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to refresh images",isLoading:!1})}},clearImages:()=>{e({images:[]})},setSelectedPatient:t=>{e({selectedPatientId:t})},setSelectedTooth:t=>{e({selectedToothNumber:t})},clearError:()=>{e({error:null})},loadAllToothTreatmentImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.toothTreatmentImages.getAll();e({toothTreatmentImages:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load all tooth treatment images",isLoading:!1})}},loadToothTreatmentImagesByTreatment:async t=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.toothTreatmentImages.getByTreatment(t);e({toothTreatmentImages:a,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to load tooth treatment images",isLoading:!1})}},loadToothTreatmentImagesByTooth:async(a,r)=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.toothTreatmentImages.getByTooth(a,r),{toothTreatmentImages:s}=t(),o=s.filter(e=>!(e.tooth_number===r&&e.patient_id===a));e({toothTreatmentImages:[...o,...n],isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load tooth treatment images",isLoading:!1})}},createToothTreatmentImage:async a=>{e({isLoading:!0,error:null});try{const r=await window.electronAPI.toothTreatmentImages.create(a),{toothTreatmentImages:n}=t();return e({toothTreatmentImages:[...n,r],isLoading:!1}),r}catch(r){throw e({error:r instanceof Error?r.message:"Failed to create tooth treatment image",isLoading:!1}),r}},deleteToothTreatmentImage:async a=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatmentImages.delete(a);const{toothTreatmentImages:r}=t();e({toothTreatmentImages:r.filter(e=>e.id!==a),isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"Failed to delete tooth treatment image",isLoading:!1}),r}},clearToothTreatmentImages:()=>{e({toothTreatmentImages:[]})},loadAllToothTreatmentImagesByPatient:async t=>{e({isLoading:!0,error:null});try{const a=(await window.electronAPI.toothTreatmentImages.getAll()).filter(e=>e.patient_id===t);e({toothTreatmentImages:a,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to load all tooth treatment images",isLoading:!1})}}})),ei=[{number:28,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"right",type:"molar"},{number:27,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:26,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:25,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"right",type:"premolar"},{number:24,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"right",type:"premolar"},{number:23,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:22,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:21,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:11,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:12,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:13,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:14,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"left",type:"premolar"},{number:15,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"left",type:"premolar"},{number:16,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:17,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:18,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"left",type:"molar"},{number:38,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"right",type:"molar"},{number:37,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:36,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:35,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"right",type:"premolar"},{number:34,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"right",type:"premolar"},{number:33,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:32,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:31,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:41,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:42,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:43,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:44,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"left",type:"premolar"},{number:45,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"left",type:"premolar"},{number:46,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:47,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"},{number:48,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"left",type:"molar"}],ti=[{number:65,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:64,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:63,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:62,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:61,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:51,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:52,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:53,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:54,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:55,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:75,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:74,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:73,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:72,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:71,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:81,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:82,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:83,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:84,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:85,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"}],ai=(e,t=!1)=>(t?ti:ei).find(t=>t.number===e),ri=[{value:"healthy",label:"سليم",color:"#22c55e",category:"العلاجات الوقائية"},{value:"cleaning",label:"تنظيف",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"fluoride",label:"فلورايد",color:"#0ea5e9",category:"العلاجات الوقائية"},{value:"sealant",label:"حشو وقائي",color:"#14b8a6",category:"العلاجات الوقائية"},{value:"scaling",label:"تقليح",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"filling_metal",label:"حشو معدني",color:"#64748b",category:"الترميمية (المحافظة)"},{value:"filling_cosmetic",label:"حشو تجميلي",color:"#f97316",category:"الترميمية (المحافظة)"},{value:"filling_glass_ionomer",label:"حشو زجاجي",color:"#fb7185",category:"الترميمية (المحافظة)"},{value:"inlay",label:"حشو داخلي",color:"#a855f7",category:"الترميمية (المحافظة)"},{value:"onlay",label:"حشو خارجي",color:"#8b5cf6",category:"الترميمية (المحافظة)"},{value:"pulp_therapy",label:"مداولة لبية",color:"#dc2626",category:"علاج العصب"},{value:"direct_pulp_cap",label:"تغطية مباشرة",color:"#f87171",category:"علاج العصب"},{value:"indirect_pulp_cap",label:"تغطية غير مباشرة",color:"#fca5a5",category:"علاج العصب"},{value:"retreatment",label:"إعادة معالجة",color:"#b91c1c",category:"علاج العصب"},{value:"deep_pulp_treatment",label:"معالجة لبية عفنة",color:"#991b1b",category:"علاج العصب"},{value:"extraction_simple",label:"قلع بسيط",color:"#6b7280",category:"العلاجات الجراحية"},{value:"extraction_surgical",label:"قلع جراحي",color:"#4b5563",category:"العلاجات الجراحية"},{value:"implant",label:"زراعة",color:"#10b981",category:"العلاجات الجراحية"},{value:"bone_graft",label:"ترقيع عظم",color:"#059669",category:"العلاجات الجراحية"},{value:"sinus_lift",label:"رفع الجيب الفكي",color:"#047857",category:"العلاجات الجراحية"},{value:"gum_surgery",label:"جراحة لثة",color:"#065f46",category:"العلاجات الجراحية"},{value:"apical_resection",label:"قطع ذروة",color:"#374151",category:"العلاجات الجراحية"},{value:"veneer_porcelain",label:"قشرة خزفية",color:"#ec4899",category:"العلاجات التجميلية"},{value:"veneer_composite",label:"قشرة مركبة",color:"#f472b6",category:"العلاجات التجميلية"},{value:"whitening",label:"تبييض",color:"#fbbf24",category:"العلاجات التجميلية"},{value:"bonding",label:"ربط تجميلي",color:"#f59e0b",category:"العلاجات التجميلية"},{value:"contouring",label:"تشكيل تجميلي",color:"#d97706",category:"العلاجات التجميلية"},{value:"polish",label:"بوليش",color:"#eab308",category:"العلاجات التجميلية"},{value:"orthodontic_metal",label:"تقويم معدني",color:"#6366f1",category:"علاجات التقويم"},{value:"orthodontic_ceramic",label:"تقويم خزفي",color:"#8b5cf6",category:"علاجات التقويم"},{value:"orthodontic_clear",label:"تقويم شفاف",color:"#a855f7",category:"علاجات التقويم"},{value:"retainer",label:"مثبت",color:"#7c3aed",category:"علاجات التقويم"},{value:"space_maintainer",label:"حافظ مسافة",color:"#5b21b6",category:"علاجات التقويم"},{value:"scaling_periodontal",label:"تقليح",color:"#0891b2",category:"علاجات اللثة"},{value:"subgingival_scaling",label:"تقليح تحت لثوي",color:"#0e7490",category:"علاجات اللثة"},{value:"deep_cleaning",label:"تنظيف عميق",color:"#0891b2",category:"علاجات اللثة"},{value:"root_planing",label:"تسوية الجذور",color:"#0e7490",category:"علاجات اللثة"},{value:"gum_graft",label:"ترقيع لثة",color:"#155e75",category:"علاجات اللثة"},{value:"pocket_reduction",label:"تقليل الجيوب",color:"#164e63",category:"علاجات اللثة"},{value:"pediatric_filling",label:"حشوة",color:"#f472b6",category:"علاجات الأطفال"},{value:"pulp_amputation",label:"بتر لب",color:"#ec4899",category:"علاجات الأطفال"},{value:"pediatric_pulp_treatment",label:"معالجة لبية",color:"#db2777",category:"علاجات الأطفال"},{value:"pulp_therapy_pediatric",label:"علاج عصب لبني",color:"#f472b6",category:"علاجات الأطفال"},{value:"stainless_crown",label:"تاج ستانلس",color:"#9ca3af",category:"علاجات الأطفال"},{value:"space_maintainer_fixed",label:"حافظ مسافة ثابت",color:"#6b7280",category:"علاجات الأطفال"},{value:"space_maintainer_removable",label:"حافظ مسافة متحرك",color:"#4b5563",category:"علاجات الأطفال"},{value:"crown_metal",label:"تاج معدني",color:"#6b7280",category:"التعويضات"},{value:"crown_ceramic",label:"تاج خزفي",color:"#8b5cf6",category:"التعويضات"},{value:"crown_zirconia",label:"تاج زيركونيا",color:"#a855f7",category:"التعويضات"},{value:"bridge",label:"جسر",color:"#f59e0b",category:"التعويضات"},{value:"complete_denture_acrylic",label:"جهاز متحرك كامل أكريل",color:"#94a3b8",category:"التعويضات"},{value:"partial_denture_acrylic",label:"جهاز متحرك جزئي أكريل",color:"#64748b",category:"التعويضات"},{value:"complete_denture_vitalium",label:"جهاز متحرك كامل فيتاليوم",color:"#475569",category:"التعويضات"},{value:"partial_denture_vitalium",label:"جهاز متحرك جزئي فيتاليوم",color:"#334155",category:"التعويضات"},{value:"complete_denture_flexible",label:"جهاز متحرك كامل مرن",color:"#e879f9",category:"التعويضات"},{value:"partial_denture_flexible",label:"جهاز متحرك جزئي مرن",color:"#d946ef",category:"التعويضات"},{value:"implant_crown_zirconia",label:"تعويض زركونيا فوق زرعة",color:"#a855f7",category:"التعويضات"},{value:"implant_crown_ceramic",label:"تعويض خزف فوق زرعة",color:"#8b5cf6",category:"التعويضات"},{value:"cast_post_core",label:"قلب ووتد مصبوب معدني",color:"#6b7280",category:"التعويضات"},{value:"zirconia_post_core",label:"قلب ووتد زركونيا",color:"#a855f7",category:"التعويضات"},{value:"veneer",label:"فينير",color:"#a855f7",category:"التعويضات"}],ni=[{value:"العلاجات الوقائية",label:"العلاجات الوقائية",color:"#22c55e",icon:"🛡️"},{value:"الترميمية (المحافظة)",label:"الترميمية (المحافظة)",color:"#f97316",icon:"🔧"},{value:"علاج العصب",label:"علاج العصب",color:"#ef4444",icon:"🦷"},{value:"العلاجات الجراحية",label:"العلاجات الجراحية",color:"#6b7280",icon:"⚔️"},{value:"العلاجات التجميلية",label:"العلاجات التجميلية",color:"#ec4899",icon:"✨"},{value:"علاجات التقويم",label:"علاجات التقويم",color:"#6366f1",icon:"📐"},{value:"علاجات اللثة",label:"علاجات اللثة",color:"#0891b2",icon:"🌿"},{value:"علاجات الأطفال",label:"علاجات الأطفال",color:"#f472b6",icon:"👶"},{value:"التعويضات",label:"التعويضات",color:"#8b5cf6",icon:"👑"}],si=e=>ri.filter(t=>t.category===e),oi=e=>ri.find(t=>t.value===e),ii=e=>ni.find(t=>t.value===e),li=e=>{const t=oi(e);return t?t.label:e},di=e=>{if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},ci=[{value:"planned",label:"مخطط",color:"#3b82f6"},{value:"in_progress",label:"قيد التنفيذ",color:"#eab308"},{value:"completed",label:"مكتمل",color:"#22c55e"},{value:"cancelled",label:"ملغي",color:"#6b7280"}],ui=[{value:"before",label:"قبل العلاج",icon:"📷"},{value:"after",label:"بعد العلاج",icon:"✨"},{value:"xray",label:"أشعة سينية",icon:"🦴"},{value:"clinical",label:"صورة سريرية",icon:"🔬"}];let mi={},pi=!1;const gi=async()=>{if(!pi){pi=!0;try{if(window.electronAPI?.treatments?.getAll){const e=await window.electronAPI.treatments.getAll();e&&Array.isArray(e)&&e.forEach(e=>{e.id&&e.name&&(mi[e.id]=e.name)})}}catch(e){console.warn("خطأ في تحميل العلاجات المخصصة:",e)}finally{pi=!1}}},hi=async()=>{mi={},await gi()},fi=e=>{if("string"!=typeof e)return console.warn("getTreatmentNameInArabic: treatmentType is not a string:",e),"غير محدد";if(!e)return"غير محدد";const t=oi(e);return t?t.label:"string"!=typeof(a=e)?(console.warn("getCustomTreatmentName: treatmentId is not a string:",a),"غير محدد"):mi[a]?mi[a]:(pi||0!==Object.keys(mi).length||gi(),a);var a},yi=e=>{if("string"!=typeof e)return console.warn("getCategoryNameInArabic: category is not a string:",e),"غير محدد";if(!e)return"غير محدد";if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},bi=e=>{if("string"!=typeof e)return console.warn("getStatusLabelInArabic: status is not a string:",e),"غير محدد";if(!e)return"غير محدد";return{planned:"مخطط",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي",pending:"آجل",active:"نشط",inactive:"غير نشط"}[e]||e},xi=e=>{if(!e)return"غير محدد";return{pending:"آجل",completed:"مكتمل",partial:"جزئي",cancelled:"ملغي",refunded:"مسترد"}[e]||e},wi=e=>{if(!e)return"غير محدد";return{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e]||e},vi=e=>{if(!e)return"غير محدد";return{pending:"آجل",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e};const Ni=Q.memo(function({open:t,onOpenChange:a,preSelectedPatientId:r}){const{toast:n}=Is(),{createPayment:s,updatePayment:o,isLoading:i,getPaymentsByPatient:l,getPaymentsByAppointment:d,getPaymentsByToothTreatment:c}=da(),u=me(e=>e.patients),m=Jt(e=>e.appointments),p=Zo(e=>e.toothTreatments),g=Zo(e=>e.loadToothTreatmentsByPatient),{formatAmount:h}=la(),[f,y]=Q.useState({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),[b,x]=Q.useState({}),[w,v]=Q.useState({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}),N=e=>{if(!e)return"";const t=e.replace(/,/g,"");if(isNaN(Number(t)))return e;const a=t.split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join(".")},j=e=>e.replace(/,/g,""),_=()=>{const e=new Date;return`RCP-${e.getFullYear().toString().slice(-2)}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}-${e.getTime().toString().slice(-4)}`},k=()=>parseFloat(f.total_amount_due)||0,S=()=>{const e=parseFloat(f.amount)||0;return w.previousPayments+e},E=()=>{const e=parseFloat(f.total_amount_due)||0,t=S();return Math.max(0,e-t)},A=()=>{const e=f.amount?parseFloat(f.amount):0,t=f.total_amount_due?parseFloat(f.total_amount_due):0;if(t>0){if(f.tooth_treatment_id&&"none"!==f.tooth_treatment_id){const a=w.previousPayments+e;return a>=t?"completed":a>0?"partial":"pending"}if(f.appointment_id&&"none"!==f.appointment_id){const a=w.previousPayments+e;return a>=t?"completed":a>0?"partial":"pending"}{const e=S();return e>=t?"completed":e>0?"partial":"pending"}}return e>0?"completed":"pending"};Q.useEffect(()=>{if(f.tooth_treatment_id&&"none"!==f.tooth_treatment_id){v(e=>({...e,isCalculating:!0}));const t=p.find(e=>e.id===f.tooth_treatment_id),a=t?.cost||0,r=(e=f.tooth_treatment_id)&&"none"!==e?c(e).reduce((e,t)=>e+t.amount,0):0,n=_();v({previousPayments:r,suggestedReceiptNumber:n,isCalculating:!1}),y(e=>({...e,total_amount_due:a.toString(),amount:Math.max(0,a-r).toString(),receipt_number:e.receipt_number||n}))}var e},[f.tooth_treatment_id,p,c]),Q.useEffect(()=>{if(f.appointment_id&&"none"!==f.appointment_id){v(e=>({...e,isCalculating:!0}));const t=(e=f.appointment_id)&&"none"!==e?d(e).reduce((e,t)=>e+t.amount,0):0,a=_(),r=d(f.appointment_id),n=r.find(e=>e.total_amount_due)?.total_amount_due;v({previousPayments:t,suggestedReceiptNumber:a,isCalculating:!1}),f.receipt_number||y(e=>({...e,receipt_number:a})),!f.total_amount_due&&n&&y(e=>({...e,total_amount_due:n.toString()}))}else v(e=>({...e,previousPayments:0,suggestedReceiptNumber:_()}));var e},[f.appointment_id]),Q.useEffect(()=>{if(f.amount&&w.previousPayments>=0){const e=S();y(t=>({...t,amount_paid:e.toString()}))}},[f.amount,w.previousPayments]),Q.useEffect(()=>{t||(y({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),x({}),v({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}))},[t]),Q.useEffect(()=>{t&&r&&y(e=>({...e,patient_id:r}))},[t,r]),Q.useEffect(()=>{f.patient_id&&""!==f.patient_id&&g(f.patient_id)},[f.patient_id,g]),Q.useEffect(()=>{const e=f.amount?parseFloat(f.amount):0;if((f.total_amount_due?parseFloat(f.total_amount_due):0)>0||e>0){const e=A();y(t=>({...t,status:e}))}},[f.amount,f.total_amount_due,f.tooth_treatment_id,f.appointment_id,w.previousPayments]);const D=m.filter(e=>e.patient_id===f.patient_id),I=p.filter(e=>{if(e.patient_id!==f.patient_id)return!1;const t=c(e.id),a=e.cost||0;if(0===t.length)return!0;return t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0)<a});return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[e.jsxs(Nr,{className:"border-b border-border pb-4",children:[e.jsxs(_r,{className:"flex items-center text-xl font-semibold text-foreground",children:[e.jsx(Ra,{className:"w-5 h-5 ml-2 text-primary"}),"تسجيل دفعة جديدة"]}),e.jsx(kr,{className:"text-muted-foreground",children:"أدخل تفاصيل الدفعة الجديدة وتتبع المدفوعات"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};f.patient_id||(e.patient_id="يرجى اختيار المريض");const t=f.amount?parseFloat(f.amount):0,a=f.total_amount_due?parseFloat(f.total_amount_due):0;if(t<0?e.amount="المبلغ لا يمكن أن يكون سالباً":0===t&&0===a&&(e.amount="يرجى إدخال مبلغ صحيح أو مبلغ إجمالي مطلوب"),f.payment_date||(e.payment_date="يرجى اختيار تاريخ الدفع"),f.total_amount_due&&parseFloat(f.total_amount_due)<=0&&(e.total_amount_due="المبلغ الإجمالي المطلوب يجب أن يكون أكبر من صفر"),f.tooth_treatment_id&&"none"!==f.tooth_treatment_id){const r=a-w.previousPayments;a>0&&t>r&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${h(r)})`),t<=0&&a>0&&(e.amount="يجب أن يكون مبلغ الدفعة أكبر من صفر")}else if(f.appointment_id&&"none"!==f.appointment_id){const r=a-w.previousPayments;a>0&&t>r&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${r.toFixed(2)} $)`)}else{const t=S();a>0&&t>a&&(e.amount="إجمالي المدفوعات لا يمكن أن يتجاوز المبلغ الإجمالي المطلوب")}return x(e),0===Object.keys(e).length})())try{const e=f.amount?parseFloat(f.amount):0,t=f.discount_amount?parseFloat(f.discount_amount):0,i=f.tax_amount?parseFloat(f.tax_amount):0,l=e+i-t,d=f.status,u={patient_id:f.patient_id,appointment_id:f.appointment_id&&"none"!==f.appointment_id?f.appointment_id:void 0,amount:e,payment_method:f.payment_method,payment_date:f.payment_date,description:f.description||void 0,receipt_number:f.receipt_number||w.suggestedReceiptNumber,status:d,notes:f.notes||void 0,discount_amount:t>0?t:void 0,tax_amount:i>0?i:void 0,total_amount:l},m=f.total_amount_due?parseFloat(f.total_amount_due):l;if(u.total_amount_due=m,f.tooth_treatment_id&&"none"!==f.tooth_treatment_id){u.tooth_treatment_id=f.tooth_treatment_id,u.treatment_total_cost=m;const e=S(),t=m-e;u.treatment_total_paid=e,u.treatment_remaining_balance=t}else if(f.appointment_id&&"none"!==f.appointment_id){u.appointment_total_cost=m;const e=S(),t=m-e;u.amount_paid=e,u.remaining_balance=t}else{const e=S(),t=m-e;u.amount_paid=e,u.remaining_balance=t}let p;if(f.tooth_treatment_id&&"none"!==f.tooth_treatment_id){const a=c(f.tooth_treatment_id);if(a.length>0){const r=a.find(e=>"pending"===e.status)||a[0],n=r.amount+e;let s;s=n>=m?"completed":n>0?"partial":"pending";const l={amount:n,payment_method:f.payment_method,payment_date:f.payment_date,description:f.description||r.description,receipt_number:f.receipt_number||w.suggestedReceiptNumber||r.receipt_number,status:s,notes:f.notes||r.notes,discount_amount:t>0?t:r.discount_amount,tax_amount:i>0?i:r.tax_amount,total_amount:n+(i||0)-(t||0),total_amount_due:m,treatment_total_cost:m,treatment_total_paid:n,treatment_remaining_balance:Math.max(0,m-n)};p=await o(r.id,l)}else p=await s(u)}else p=await s(u);const g=f.tooth_treatment_id&&"none"!==f.tooth_treatment_id&&c(f.tooth_treatment_id).length>0;n({title:"تم بنجاح",description:g?"تم تحديث الدفعة الموجودة بنجاح":"تم تسجيل الدفعة بنجاح"}),y({patient_id:r||"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),a(!1)}catch(t){n({title:"خطأ",description:t instanceof Error?t.message:"فشل في تسجيل الدفعة",variant:"destructive"})}},className:"space-y-6",children:[e.jsxs(Xo,{className:"border-border bg-card shadow-sm",children:[e.jsx(Wo,{children:e.jsxs(Go,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Ya,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),e.jsx(Yo,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"المريض *"}),e.jsxs(ms,{value:f.patient_id,onValueChange:e=>y(t=>({...t,patient_id:e,appointment_id:"none"})),children:[e.jsx(hs,{className:b.patient_id?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),e.jsx(bs,{children:u.map(t=>e.jsx(vs,{value:t.id,children:t.full_name},t.id))})]}),b.patient_id&&e.jsx("p",{className:"text-sm text-destructive",children:b.patient_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"العلاج *"}),e.jsxs(ms,{value:f.tooth_treatment_id,onValueChange:e=>y(t=>({...t,tooth_treatment_id:e,appointment_id:"none"})),disabled:!f.patient_id,children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر العلاج",className:"text-muted-foreground"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"none",children:"بدون علاج محدد"}),I.map(t=>{const a=c(t.id),r=t.cost||0,n=r-a.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0);return e.jsx(vs,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:`السن ${t.tooth_number} - ${fi(t.treatment_type)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["التكلفة: ",h(r)]}),n>0&&n<r&&e.jsxs("span",{className:"text-orange-600 font-medium",children:[" • متبقي: ",h(n)]})]})]})},t.id)})]})]})]}),e.jsxs("div",{className:"space-y-2 hidden",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"الموعد (اختياري)"}),e.jsxs(ms,{value:f.appointment_id,onValueChange:e=>y(t=>({...t,appointment_id:e,tooth_treatment_id:"none"!==e?"none":t.tooth_treatment_id})),disabled:!f.patient_id,children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر الموعد",className:"text-muted-foreground"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"none",children:"بدون موعد محدد"}),D.map(t=>e.jsxs(vs,{value:t.id,children:[t.title," - ",$t(t.start_time)]},t.id))]})]})]})]})})]}),e.jsxs(Xo,{className:"border-border bg-card shadow-sm",children:[e.jsx(Wo,{children:e.jsxs(Go,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Ma,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل المبالغ"]})}),e.jsx(Yo,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"المبلغ *"}),e.jsx(Sr,{type:"text",placeholder:"0",value:N(f.amount),onChange:e=>{const t=j(e.target.value);(""===t||/^\d*\.?\d*$/.test(t))&&y(e=>({...e,amount:t}))},onBlur:e=>{const t=j(e.target.value),a=parseFloat(t)||0;y(e=>({...e,amount:a.toString()}))},onKeyDown:e=>{e.stopPropagation()},"data-prevent-shortcuts":"true",className:b.amount?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),b.amount&&e.jsx("p",{className:"text-sm text-destructive",children:b.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"مبلغ الخصم"}),e.jsx(Sr,{type:"text",placeholder:"0",value:N(f.discount_amount),onChange:e=>{const t=j(e.target.value);(""===t||/^\d*\.?\d*$/.test(t))&&y(e=>({...e,discount_amount:t}))},onBlur:e=>{const t=j(e.target.value),a=parseFloat(t)||0;y(e=>({...e,discount_amount:a.toString()}))},className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"مبلغ الضريبة"}),e.jsx(Sr,{type:"text",placeholder:"0",value:N(f.tax_amount),onChange:e=>{const t=j(e.target.value);(""===t||/^\d*\.?\d*$/.test(t))&&y(e=>({...e,tax_amount:t}))},onBlur:e=>{const t=j(e.target.value),a=parseFloat(t)||0;y(e=>({...e,tax_amount:a.toString()}))},className:"bg-background border-input text-foreground"})]})]})})]}),e.jsxs(Xo,{className:"border-border bg-card shadow-sm",children:[e.jsx(Wo,{children:e.jsxs(Go,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Ra,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل الدفع"]})}),e.jsx(Yo,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"طريقة الدفع"}),e.jsxs(ms,{value:f.payment_method,onValueChange:e=>y(t=>({...t,payment_method:e})),children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر طريقة الدفع",className:"text-muted-foreground"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"cash",children:"نقداً"}),e.jsx(vs,{value:"bank_transfer",children:"تحويل بنكي"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground font-medium",children:"تاريخ الدفع *"}),e.jsx(Sr,{type:"date",value:f.payment_date,onChange:e=>y(t=>({...t,payment_date:e.target.value})),className:b.payment_date?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),b.payment_date&&e.jsx("p",{className:"text-sm text-destructive",children:b.payment_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"text-foreground font-medium",children:["الحالة",f.amount&&parseFloat(f.amount)>0&&e.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:["(مقترح: ","completed"===A()?"مكتمل":"partial"===A()?"جزئي":"آجل",")"]})]}),e.jsxs(ms,{value:f.status,onValueChange:e=>y(t=>({...t,status:e})),children:[e.jsx(hs,{className:"bg-background border-input text-foreground",children:e.jsx(gs,{placeholder:"اختر الحالة",className:"text-muted-foreground"})}),e.jsxs(bs,{children:[e.jsx(vs,{value:"completed",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"مكتمل"}),"completed"===A()&&e.jsx("span",{className:"text-xs text-green-600",children:"✓ مقترح"})]})}),e.jsx(vs,{value:"partial",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"جزئي"}),"partial"===A()&&e.jsx("span",{className:"text-xs text-orange-600",children:"✓ مقترح"})]})}),e.jsx(vs,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"آجل"}),"pending"===A()&&e.jsx("span",{className:"text-xs text-blue-600",children:"✓ مقترح"})]})})]})]})]})]})})]}),e.jsxs(Xo,{className:"border-border bg-card shadow-sm",children:[e.jsxs(Wo,{children:[e.jsxs(Go,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(er,{className:"w-4 h-4 ml-2 text-primary"}),"تتبع المدفوعات للموعد"]}),e.jsx(Ko,{className:"text-muted-foreground",children:"تتبع دقيق للمدفوعات والرصيد المتبقي لكل موعد على حدة"})]}),e.jsxs(Yo,{className:"space-y-4",children:[f.appointment_id&&"none"!==f.appointment_id&&e.jsx(Xo,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800 shadow-sm transition-all duration-200",children:e.jsxs(Yo,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(er,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"ملخص مدفوعات الموعد"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الإجمالي المطلوب:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[k().toFixed(2)," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المدفوع سابقاً:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[w.previousPayments.toFixed(2)," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المتبقي قبل هذه الدفعة:"}),e.jsxs("span",{className:"font-medium text-emerald-600 dark:text-emerald-400",children:[(k()-w.previousPayments).toFixed(2)," $"]})]})]}),f.amount&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-700",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المتبقي بعد هذه الدفعة:"}),e.jsxs("span",{className:"font-bold text-lg text-emerald-600 dark:text-emerald-400",children:[E().toFixed(2)," $"]})]})})]})}),"none"===f.appointment_id&&e.jsx(Xo,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-950/50 dark:to-yellow-900/30 border-yellow-200 dark:border-yellow-800 shadow-sm transition-all duration-200",children:e.jsxs(Yo,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Sa,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"دفعة عامة غير مرتبطة بموعد"})]}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"هذه دفعة عامة غير مرتبطة بموعد محدد، يمكنك تحديد المبلغ المطلوب يدوياً"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center gap-2 text-foreground font-medium",children:["المبلغ الإجمالي المطلوب",e.jsx(Jo,{variant:"secondary",className:"text-xs",children:"اختياري"})]}),e.jsx(Sr,{type:"text",placeholder:"أدخل المبلغ الإجمالي المطلوب (اختياري)",value:N(f.total_amount_due),onChange:e=>{const t=j(e.target.value);(""===t||/^\d*\.?\d*$/.test(t))&&y(e=>({...e,total_amount_due:t}))},onBlur:e=>{const t=j(e.target.value),a=parseFloat(t)||0;y(e=>({...e,total_amount_due:a.toString()}))},className:"bg-background border-input text-foreground "+(b.total_amount_due?"border-destructive":"")}),b.total_amount_due&&e.jsx("p",{className:"text-sm text-destructive",children:b.total_amount_due}),!b.total_amount_due&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"💡 إدخال المبلغ الإجمالي يساعد في تتبع المدفوعات الجزئية"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center gap-2 text-foreground font-medium",children:["إجمالي المبلغ المدفوع",e.jsxs(Jo,{variant:"secondary",className:"text-xs",children:[e.jsx(er,{className:"w-3 h-3 ml-1"}),"محسوب تلقائياً"]})]}),e.jsx(Sr,{type:"number",step:"0.1",placeholder:"0.00",value:f.amount_paid,readOnly:!0,className:"bg-muted cursor-not-allowed border-input text-foreground font-medium"}),e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:["✓ محسوب تلقائياً: المدفوعات السابقة (",h(w.previousPayments),") + هذه الدفعة (",h(parseFloat(f.amount)||0),")"]})]})]}),f.total_amount_due&&e.jsx(Xo,{className:"shadow-sm transition-all duration-200 "+(E()>0?"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/30 border-orange-200 dark:border-orange-800":"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/50 dark:to-green-900/30 border-green-200 dark:border-green-800"),children:e.jsxs(Yo,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"المبلغ المتبقي:"}),e.jsxs(Jo,{variant:E()>0?"destructive":"default",className:"text-lg px-3 py-1",children:["$",E().toFixed(2)]})]}),0===E()&&e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-2",children:"✓ تم سداد المبلغ بالكامل"})]})}),e.jsxs(Xo,{className:"bg-gradient-to-r from-muted/30 to-muted/50 border-border",children:[e.jsx(Wo,{children:e.jsx(Go,{className:"text-sm text-card-foreground",children:"ملخص هذه الدفعة"})}),e.jsxs(Yo,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأساسي:"}),e.jsx("span",{className:"font-medium text-foreground",children:h(parseFloat(f.amount)||0)})]}),f.tax_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الضريبة:"}),e.jsxs("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["+",h(parseFloat(f.tax_amount)||0)]})]}),f.discount_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الخصم:"}),e.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["-",h(parseFloat(f.discount_amount)||0)]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2",children:[e.jsx("span",{className:"text-foreground",children:"إجمالي هذه الدفعة:"}),e.jsx(Jo,{variant:"outline",className:"text-base",children:h((parseFloat(f.amount)||0)+(parseFloat(f.tax_amount)||0)-(parseFloat(f.discount_amount)||0))})]})]})]})]})]}),e.jsxs(Xo,{className:"border-border bg-card shadow-sm",children:[e.jsx(Wo,{children:e.jsx(Go,{className:"text-lg text-card-foreground",children:"معلومات إضافية"})}),e.jsxs(Yo,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ir,{className:"flex items-center gap-2 text-foreground",children:["رقم الإيصال",e.jsxs(Jo,{variant:"secondary",className:"text-xs",children:[e.jsx(er,{className:"w-3 h-3 ml-1"}),"مولد تلقائياً"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Sr,{type:"text",placeholder:"رقم الإيصال",value:f.receipt_number,onChange:e=>y(t=>({...t,receipt_number:e.target.value})),className:"flex-1 bg-background border-input text-foreground"}),e.jsx(fr,{type:"button",variant:"outline",size:"sm",onClick:()=>y(e=>({...e,receipt_number:_()})),className:"px-3",children:e.jsx(er,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:"✓ تم توليد رقم إيصال فريد تلقائياً"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground",children:"الوصف"}),e.jsx(us,{placeholder:"وصف الدفعة (اختياري)",value:f.description,onChange:e=>y(t=>({...t,description:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-foreground",children:"ملاحظات"}),e.jsx(us,{placeholder:"ملاحظات إضافية (اختياري)",value:f.notes,onChange:e=>y(t=>({...t,notes:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]})]})]}),e.jsxs(jr,{className:"flex justify-end space-x-2 space-x-reverse border-t border-border pt-4",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:i,children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:i,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:i?"جاري الحفظ...":"حفظ الدفعة"})]})]})]})})}),ji=Object.freeze(Object.defineProperty({__proto__:null,default:Ni},Symbol.toStringTag,{value:"Module"}));function _i({message:t="جاري التحميل...",className:a=""}){return e.jsx("div",{className:`flex items-center justify-center min-h-[400px] bg-background dark:bg-gray-900 ${a}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Qa,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-4 dark:text-blue-400"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-300",children:t})]})})}class ki extends Q.Component{state={hasError:!1};static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}handleRetry=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex items-center justify-center min-h-[400px] bg-background border border-destructive/20 rounded-lg",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(Ea,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"حدث خطأ غير متوقع"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:this.state.error?.message||"حدث خطأ أثناء تحميل المحتوى"}),e.jsxs("button",{onClick:this.handleRetry,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:[e.jsx(Qa,{className:"w-4 h-4"}),"إعادة المحاولة"]})]})}):this.props.children}}function Si({variant:t="ghost",size:a="icon",showLabel:r=!1}){const{isDarkMode:n,toggleDarkMode:s}=na(),[o,i]=Q.useState(!1);return e.jsxs(fr,{variant:t,size:a,onClick:async()=>{if(!o){i(!0);try{await s()}finally{setTimeout(()=>i(!1),300)}}},disabled:o,className:"transition-all duration-200 "+(o?"opacity-50 cursor-not-allowed":""),title:n?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:[n?e.jsx(ar,{className:"h-4 w-4 transition-transform duration-200 "+(o?"rotate-180":"")}):e.jsx(Ka,{className:"h-4 w-4 transition-transform duration-200 "+(o?"rotate-180":"")}),r&&e.jsx("span",{className:"ml-2",children:n?"فاتح":"مظلم"})]})}const Ei=()=>{const[e,t]=Q.useState(!1);Q.useEffect(()=>{(async()=>{t(!0);try{await hi()}finally{t(!1)}})()},[]);return{updateTreatmentName:Q.useCallback((e,t)=>{((e,t)=>{mi[e]=t})(e,t)},[]),refreshTreatmentNames:Q.useCallback(async()=>{t(!0);try{await hi()}finally{t(!1)}},[]),isLoading:e}};var Ai="horizontal",Di=["horizontal","vertical"],Ii=Q.forwardRef((t,a)=>{const{decorative:r,orientation:n=Ai,...s}=t,o=function(e){return Di.includes(e)}(n)?n:Ai,i=r?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"};return e.jsx(d.div,{"data-orientation":o,...i,...s,ref:a})});Ii.displayName="Separator";var Pi=Ii;const Ci=Q.forwardRef(({className:t,orientation:a="horizontal",decorative:r=!0,...n},s)=>e.jsx(Pi,{ref:s,decorative:r,orientation:a,className:Nt("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...n}));Ci.displayName=Pi.displayName;const Ti=i,Li=l,Fi=Q.forwardRef(({className:t,...r},n)=>e.jsx(a,{className:Nt("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:n}));Fi.displayName=a.displayName;const Ri=gr("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out dark:bg-gray-800 dark:border-gray-700",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),$i=Q.forwardRef(({side:t="right",className:a,children:s,...o},i)=>e.jsxs(Li,{children:[e.jsx(Fi,{}),e.jsxs(r,{ref:i,dir:"rtl",className:Nt(Ri({side:t}),a),...o,children:[e.jsxs(n,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]}),s]})]}));$i.displayName=r.displayName;const Mi=({className:t,...a})=>e.jsx("div",{className:Nt("flex flex-col space-y-2 text-center sm:text-right",t),...a});Mi.displayName="SheetHeader";const Oi=Q.forwardRef(({className:t,...a},r)=>e.jsx(s,{ref:r,className:Nt("text-lg font-semibold text-foreground",t),...a}));Oi.displayName=s.displayName;const zi=Q.forwardRef(({className:t,...a},r)=>e.jsx(o,{ref:r,className:Nt("text-sm text-muted-foreground",t),...a}));function Vi({className:t,...a}){return e.jsx("div",{className:Nt("animate-pulse rounded-md bg-primary/10 dark:bg-gray-700",t),...a})}zi.displayName=o.displayName;var[qi,Ui]=k("Tooltip",[L]),Bi=L(),Hi="TooltipProvider",Xi=700,Wi="tooltip.open",[Gi,Ki]=qi(Hi),Yi=t=>{const{__scopeTooltip:a,delayDuration:r=Xi,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:o}=t,i=Q.useRef(!0),l=Q.useRef(!1),d=Q.useRef(0);return Q.useEffect(()=>{const e=d.current;return()=>window.clearTimeout(e)},[]),e.jsx(Gi,{scope:a,isOpenDelayedRef:i,delayDuration:r,onOpen:Q.useCallback(()=>{window.clearTimeout(d.current),i.current=!1},[]),onClose:Q.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>i.current=!0,n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:Q.useCallback(e=>{l.current=e},[]),disableHoverableContent:s,children:o})};Yi.displayName=Hi;var Qi="Tooltip",[Ji,Zi]=qi(Qi),el=t=>{const{__scopeTooltip:a,children:r,open:n,defaultOpen:s,onOpenChange:o,disableHoverableContent:i,delayDuration:l}=t,d=Ki(Qi,t.__scopeTooltip),c=Bi(a),[u,m]=Q.useState(null),p=V(),g=Q.useRef(0),h=i??d.disableHoverableContent,f=l??d.delayDuration,y=Q.useRef(!1),[b,x]=q({prop:n,defaultProp:s??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(Wi))):d.onClose(),o?.(e)},caller:Qi}),w=Q.useMemo(()=>b?y.current?"delayed-open":"instant-open":"closed",[b]),v=Q.useCallback(()=>{window.clearTimeout(g.current),g.current=0,y.current=!1,x(!0)},[x]),N=Q.useCallback(()=>{window.clearTimeout(g.current),g.current=0,x(!1)},[x]),j=Q.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>{y.current=!0,x(!0),g.current=0},f)},[f,x]);return Q.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=0)},[]),e.jsx(U,{...c,children:e.jsx(Ji,{scope:a,contentId:p,open:b,stateAttribute:w,trigger:u,onTriggerChange:m,onTriggerEnter:Q.useCallback(()=>{d.isOpenDelayedRef.current?j():v()},[d.isOpenDelayedRef,j,v]),onTriggerLeave:Q.useCallback(()=>{h?N():(window.clearTimeout(g.current),g.current=0)},[N,h]),onOpen:v,onClose:N,disableHoverableContent:h,children:r})})};el.displayName=Qi;var tl="TooltipTrigger",al=Q.forwardRef((t,a)=>{const{__scopeTooltip:r,...n}=t,s=Zi(tl,r),o=Ki(tl,r),i=Bi(r),l=Q.useRef(null),c=A(a,l,s.onTriggerChange),u=Q.useRef(!1),m=Q.useRef(!1),p=Q.useCallback(()=>u.current=!1,[]);return Q.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(F,{asChild:!0,...i,children:e.jsx(d.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:c,onPointerMove:I(t.onPointerMove,e=>{"touch"!==e.pointerType&&(m.current||o.isPointerInTransitRef.current||(s.onTriggerEnter(),m.current=!0))}),onPointerLeave:I(t.onPointerLeave,()=>{s.onTriggerLeave(),m.current=!1}),onPointerDown:I(t.onPointerDown,()=>{s.open&&s.onClose(),u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:I(t.onFocus,()=>{u.current||s.onOpen()}),onBlur:I(t.onBlur,s.onClose),onClick:I(t.onClick,s.onClose)})})});al.displayName=tl;var rl="TooltipPortal",[nl,sl]=qi(rl,{forceMount:void 0}),ol=t=>{const{__scopeTooltip:a,forceMount:r,children:n,container:s}=t,o=Zi(rl,a);return e.jsx(nl,{scope:a,forceMount:r,children:e.jsx(R,{present:r||o.open,children:e.jsx(B,{asChild:!0,container:s,children:n})})})};ol.displayName=rl;var il="TooltipContent",ll=Q.forwardRef((t,a)=>{const r=sl(il,t.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...o}=t,i=Zi(il,t.__scopeTooltip);return e.jsx(R,{present:n||i.open,children:i.disableHoverableContent?e.jsx(pl,{side:s,...o,ref:a}):e.jsx(dl,{side:s,...o,ref:a})})}),dl=Q.forwardRef((t,a)=>{const r=Zi(il,t.__scopeTooltip),n=Ki(il,t.__scopeTooltip),s=Q.useRef(null),o=A(a,s),[i,l]=Q.useState(null),{trigger:d,onClose:c}=r,u=s.current,{onPointerInTransitChange:m}=n,p=Q.useCallback(()=>{l(null),m(!1)},[m]),g=Q.useCallback((e,t)=>{const a=e.currentTarget,r={x:e.clientX,y:e.clientY},n=function(e,t,a=5){const r=[];switch(t){case"top":r.push({x:e.x-a,y:e.y+a},{x:e.x+a,y:e.y+a});break;case"bottom":r.push({x:e.x-a,y:e.y-a},{x:e.x+a,y:e.y-a});break;case"left":r.push({x:e.x+a,y:e.y-a},{x:e.x+a,y:e.y+a});break;case"right":r.push({x:e.x-a,y:e.y-a},{x:e.x-a,y:e.y+a})}return r}(r,function(e,t){const a=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),n=Math.abs(t.right-e.x),s=Math.abs(t.left-e.x);switch(Math.min(a,r,n,s)){case s:return"left";case n:return"right";case a:return"top";case r:return"bottom";default:throw new Error("unreachable")}}(r,a.getBoundingClientRect())),s=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const e=t[t.length-1],r=t[t.length-2];if(!((e.x-r.x)*(a.y-r.y)>=(e.y-r.y)*(a.x-r.x)))break;t.pop()}t.push(a)}t.pop();const a=[];for(let r=e.length-1;r>=0;r--){const t=e[r];for(;a.length>=2;){const e=a[a.length-1],r=a[a.length-2];if(!((e.x-r.x)*(t.y-r.y)>=(e.y-r.y)*(t.x-r.x)))break;a.pop()}a.push(t)}return a.pop(),1===t.length&&1===a.length&&t[0].x===a[0].x&&t[0].y===a[0].y?t:t.concat(a)}(t)}([...n,...function(e){const{top:t,right:a,bottom:r,left:n}=e;return[{x:n,y:t},{x:a,y:t},{x:a,y:r},{x:n,y:r}]}(t.getBoundingClientRect())]);l(s),m(!0)},[m]);return Q.useEffect(()=>()=>p(),[p]),Q.useEffect(()=>{if(d&&u){const e=e=>g(e,u),t=e=>g(e,d);return d.addEventListener("pointerleave",e),u.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),u.removeEventListener("pointerleave",t)}}},[d,u,g,p]),Q.useEffect(()=>{if(i){const e=e=>{const t=e.target,a={x:e.clientX,y:e.clientY},r=d?.contains(t)||u?.contains(t),n=!function(e,t){const{x:a,y:r}=e;let n=!1;for(let s=0,o=t.length-1;s<t.length;o=s++){const e=t[s],i=t[o],l=e.x,d=e.y,c=i.x,u=i.y;d>r!=u>r&&a<(c-l)*(r-d)/(u-d)+l&&(n=!n)}return n}(a,i);r?p():n&&(p(),c())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,u,i,c,p]),e.jsx(pl,{...t,ref:o})}),[cl,ul]=qi(Qi,{isInside:!1}),ml=P("TooltipContent"),pl=Q.forwardRef((t,a)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:o,onPointerDownOutside:i,...l}=t,d=Zi(il,r),c=Bi(r),{onClose:u}=d;return Q.useEffect(()=>(document.addEventListener(Wi,u),()=>document.removeEventListener(Wi,u)),[u]),Q.useEffect(()=>{if(d.trigger){const e=e=>{const t=e.target;t?.contains(d.trigger)&&u()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,u]),e.jsx($,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:e=>e.preventDefault(),onDismiss:u,children:e.jsxs(M,{"data-state":d.stateAttribute,...c,...l,ref:a,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(ml,{children:n}),e.jsx(cl,{scope:r,isInside:!0,children:e.jsx(O,{id:d.contentId,role:"tooltip",children:s||n})})]})})});ll.displayName=il;var gl="TooltipArrow";Q.forwardRef((t,a)=>{const{__scopeTooltip:r,...n}=t,s=Bi(r);return ul(gl,r).isInside?null:e.jsx(z,{...s,...n,ref:a})}).displayName=gl;var hl=ol,fl=ll;const yl=Yi,bl=el,xl=al,wl=Q.forwardRef(({className:t,sideOffset:a=4,...r},n)=>e.jsx(hl,{children:e.jsx(fl,{ref:n,sideOffset:a,className:Nt("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin] dark:bg-gray-800 dark:text-white",t),...r})}));wl.displayName=fl.displayName;const vl=Q.createContext(null);function Nl(){const e=Q.useContext(vl);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const jl=Q.forwardRef(({defaultOpen:t=!0,open:a,onOpenChange:r,className:n,style:s,children:o,...i},l)=>{const d=function(){const[e,t]=Q.useState(void 0);return Q.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),a=()=>{t(window.innerWidth<768)};return e.addEventListener("change",a),t(window.innerWidth<768),()=>e.removeEventListener("change",a)},[]),!!e}(),[c,u]=Q.useState(!1),[m,p]=Q.useState(t),g=a??m,h=Q.useCallback(e=>{const t="function"==typeof e?e(g):e;r?r(t):p(t),document.cookie=`sidebar_state=${t}; path=/; max-age=604800`},[r,g]),f=Q.useCallback(()=>d?u(e=>!e):h(e=>!e),[d,h,u]);Q.useEffect(()=>{const e=e=>{const t=e.target,a="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");"b"!==e.key||a||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),f())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]);const y=g?"expanded":"collapsed",b=Q.useMemo(()=>({state:y,open:g,setOpen:h,isMobile:d,openMobile:c,setOpenMobile:u,toggleSidebar:f}),[y,g,h,d,c,u,f]);return e.jsx(vl.Provider,{value:b,children:e.jsx(yl,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem",...s},className:Nt("sidebar-wrapper group/sidebar-wrapper flex min-h-screen w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:l,...i,children:o})})})});jl.displayName="SidebarProvider";const _l=Q.forwardRef(({side:t="left",variant:a="sidebar",collapsible:r="offcanvas",className:n,children:s,...o},i)=>{const{isMobile:l,state:d,openMobile:c,setOpenMobile:u}=Nl();return"none"===r?e.jsx("div",{className:Nt("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:i,...o,children:s}):l?e.jsx(Ti,{open:c,onOpenChange:u,...o,children:e.jsxs($i,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:t,children:[e.jsxs(Mi,{className:"sr-only",children:[e.jsx(Oi,{children:"Sidebar"}),e.jsx(zi,{children:"Displays the mobile sidebar."})]}),e.jsx("div",{className:"flex h-full w-full flex-col",children:s})]})}):e.jsxs("div",{ref:i,className:"group peer hidden text-sidebar-foreground md:block","data-state":d,"data-collapsible":"collapsed"===d?r:"","data-variant":a,"data-side":t,children:[e.jsx("div",{className:Nt("relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[state=collapsed]:w-0","group-data-[side=right]:rotate-180","floating"===a||"inset"===a?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:Nt("w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex h-full","left"===t?"left-0 group-data-[state=collapsed]:-left-[var(--sidebar-width)]":"right-0 group-data-[state=collapsed]:-right-[var(--sidebar-width)]","floating"===a||"inset"===a?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]",n),...o,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow flex-grow",children:s})})]})});_l.displayName="Sidebar";const kl=Q.forwardRef(({className:t,onClick:a,...r},n)=>{const{toggleSidebar:s,open:o}=Nl();return e.jsxs(fr,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:Nt("h-7 w-7 hover:bg-red-100 dark:hover:bg-red-900/30 hover:text-red-600 dark:hover:text-red-400 dark:text-gray-300 transition-colors",t),onClick:e=>{a?.(e),s()},title:o?"إغلاق السايدبار":"فتح السايدبار",...r,children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق السايدبار"})]})});kl.displayName="SidebarTrigger";Q.forwardRef(({className:t,...a},r)=>{const{toggleSidebar:n}=Nl();return e.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:Nt("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...a})}).displayName="SidebarRail";const Sl=Q.forwardRef(({className:t,...a},r)=>e.jsx("main",{ref:r,className:Nt("relative flex w-full flex-1 flex-col bg-background","md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...a}));Sl.displayName="SidebarInset";Q.forwardRef(({className:t,...a},r)=>e.jsx(Sr,{ref:r,"data-sidebar":"input",className:Nt("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...a})).displayName="SidebarInput";const El=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"header",className:Nt("flex flex-col gap-2 p-2",t),...a}));El.displayName="SidebarHeader";const Al=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"footer",className:Nt("flex flex-col gap-2 p-2",t),...a}));Al.displayName="SidebarFooter";Q.forwardRef(({className:t,...a},r)=>e.jsx(Ci,{ref:r,"data-sidebar":"separator",className:Nt("mx-2 w-auto bg-sidebar-border",t),...a})).displayName="SidebarSeparator";const Dl=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"content",className:Nt("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...a}));Dl.displayName="SidebarContent";const Il=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"group",className:Nt("relative flex w-full min-w-0 flex-col p-2",t),...a}));Il.displayName="SidebarGroup";const Pl=Q.forwardRef(({className:a,asChild:r=!1,...n},s)=>{const o=r?t:"div";return e.jsx(o,{ref:s,"data-sidebar":"group-label",className:Nt("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",a),...n})});Pl.displayName="SidebarGroupLabel";Q.forwardRef(({className:a,asChild:r=!1,...n},s)=>{const o=r?t:"button";return e.jsx(o,{ref:s,"data-sidebar":"group-action",className:Nt("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",a),...n})}).displayName="SidebarGroupAction";const Cl=Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"group-content",className:Nt("w-full text-sm",t),...a}));Cl.displayName="SidebarGroupContent";const Tl=Q.forwardRef(({className:t,...a},r)=>e.jsx("ul",{ref:r,"data-sidebar":"menu",className:Nt("flex w-full min-w-0 flex-col gap-1",t),...a}));Tl.displayName="SidebarMenu";const Ll=Q.forwardRef(({className:t,...a},r)=>e.jsx("li",{ref:r,"data-sidebar":"menu-item",className:Nt("group/menu-item relative",t),...a}));Ll.displayName="SidebarMenuItem";const Fl=gr("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Rl=Q.forwardRef(({asChild:a=!1,isActive:r=!1,variant:n="default",size:s="default",tooltip:o,className:i,...l},d)=>{const c=a?t:"button",{isMobile:u,state:m}=Nl(),p=e.jsx(c,{ref:d,"data-sidebar":"menu-button","data-size":s,"data-active":r,className:Nt(Fl({variant:n,size:s}),i),...l});return o?("string"==typeof o&&(o={children:o}),e.jsxs(bl,{children:[e.jsx(xl,{asChild:!0,children:p}),e.jsx(wl,{side:"right",align:"center",hidden:"collapsed"!==m||u,...o})]})):p});Rl.displayName="SidebarMenuButton";Q.forwardRef(({className:a,asChild:r=!1,showOnHover:n=!1,...s},o)=>{const i=r?t:"button";return e.jsx(i,{ref:o,"data-sidebar":"menu-action",className:Nt("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",a),...s})}).displayName="SidebarMenuAction";Q.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:Nt("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...a})).displayName="SidebarMenuBadge";Q.forwardRef(({className:t,showIcon:a=!1,...r},n)=>{const s=Q.useMemo(()=>`${Math.floor(40*Math.random())+50}%`,[]);return e.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:Nt("flex h-8 items-center gap-2 rounded-md px-2",t),...r,children:[a&&e.jsx(Vi,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Vi,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":s}})]})}).displayName="SidebarMenuSkeleton";Q.forwardRef(({className:t,...a},r)=>e.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:Nt("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...a})).displayName="SidebarMenuSub";Q.forwardRef(({...t},a)=>e.jsx("li",{ref:a,...t})).displayName="SidebarMenuSubItem";Q.forwardRef(({asChild:a=!1,size:r="md",isActive:n,className:s,...o},i)=>{const l=a?t:"a";return e.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":r,"data-active":n,className:Nt("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground","sm"===r&&"text-xs","md"===r&&"text-sm","group-data-[collapsible=icon]:hidden",s),...o})}).displayName="SidebarMenuSubButton";const $l=[{title:"لوحة التحكم",url:"dashboard",icon:ka},{title:"المرضى",url:"patients",icon:rr},{title:"المواعيد",url:"appointments",icon:Aa},{title:"الواردات",url:"payments",icon:Ma},{title:"المختبرات",url:"labs",icon:Ga},{title:"العلاجات",url:"dental-treatments",icon:tr},{title:"المصروفات",url:"expenses",icon:Ya},{title:"التقارير",url:"reports",icon:Va},{title:"النسخ الاحتياطية",url:"production-backup",icon:$a,style:{fontSize:"15px"}},{title:"الإعدادات",url:"settings",icon:Za}];function Ml({activeTab:t,onTabChange:a,...r}){const n=lr(),s=dr(),o=cr();return e.jsxs(_l,{collapsible:"offcanvas",side:"right",className:"border-l border-border/50 dark:border-gray-700 shadow-xl rtl-layout bg-gradient-to-b from-slate-50 to-white dark:from-gray-900 dark:to-gray-800 performance-optimized sidebar-performance loaded",...r,children:[e.jsx(El,{className:"border-b border-border/50 dark:border-gray-700 dark:bg-gray-800 flex-shrink-0 performance-optimized layout-contained",style:{position:"sticky",top:0,zIndex:10,background:"hsl(var(--background))",contain:"layout style",willChange:"auto"},children:e.jsx(Tl,{children:e.jsx(Ll,{children:e.jsx(Rl,{size:"lg",asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl hover:bg-accent/50 dark:hover:bg-accent/20 transition-all duration-200 ease-out flex-rtl shadow-sm hover:shadow-md hover:scale-[1.01] cursor-pointer",children:[e.jsx("div",{className:"flex aspect-square size-12 items-center justify-center rounded-xl bg-gradient-to-br from-primary to-primary/70 dark:from-blue-600 dark:to-blue-700 text-primary-foreground shadow-lg overflow-hidden ring-2 ring-primary/20 dark:ring-blue-500/20",children:o&&""!==o.trim()?e.jsx("img",{src:o,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-lg",onError:e=>{console.error("Sidebar header logo failed to load:",o),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',t.appendChild(e)}}}):e.jsx(tr,{className:"size-6"})}),e.jsxs("div",{className:"grid flex-1 text-right leading-tight ",children:[e.jsx("span",{className:"truncate font-bold text-l text-foreground dark:text-white",children:n}),e.jsx("span",{className:"truncate text-sm text-muted-foreground dark:text-gray-300 font-medium",children:"نظام إدارة العيادة"})]})]})})})})}),e.jsx(Dl,{className:"px-4 py-6 dark:bg-gray-800/20 flex-1 overflow-y-auto performance-optimized scroll-optimized flex-grow",style:{scrollBehavior:"smooth",scrollbarWidth:"thin",scrollbarColor:"rgb(148 163 184 / 0.3) transparent",contain:"layout style",willChange:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:e.jsxs(Il,{className:"space-y-2 flex-1 min-h-0 performance-optimized layout-contained",style:{contain:"layout style",willChange:"auto"},children:[e.jsx(Pl,{className:"text-sm font-bold text-muted-foreground dark:text-gray-300 uppercase tracking-wider px-3 py-2 text-right border-r-2 border-primary dark:border-blue-500",children:"القائمة الرئيسية"}),e.jsx(Cl,{children:e.jsx(Tl,{className:"space-y-2 nav-rtl",children:$l.map(r=>e.jsx(Ll,{children:e.jsxs(Rl,{isActive:t===r.url,onClick:()=>a(r.url),className:"flex items-center gap-4 w-full text-right justify-start transition-all duration-200 ease-out py-4 px-6 text-base nav-item rounded-xl shadow-sm hover:shadow-md border group hover:scale-[1.02] focus:scale-[1.02] focus:outline-none focus:ring-2 "+(t===r.url?"bg-primary/10 dark:bg-blue-500/20 border-primary/30 dark:border-blue-500/30 text-primary dark:text-blue-400 font-semibold":"hover:bg-gradient-to-r hover:from-accent/50 hover:to-accent/30 dark:hover:from-blue-500/20 dark:hover:to-blue-500/10 border-transparent hover:border-primary/30 dark:hover:border-blue-500/30 text-foreground dark:text-gray-300"),children:[e.jsx(r.icon,{className:"size-5 nav-icon transition-all duration-300 "+(t===r.url?"text-primary dark:text-blue-400 scale-110":"text-muted-foreground dark:text-gray-300 group-hover:text-primary dark:group-hover:text-blue-400")}),e.jsx("span",{className:"font-medium transition-all duration-300 "+(t===r.url?"text-primary dark:text-blue-400 font-semibold":"text-muted-foreground dark:text-gray-300"),style:r.style,children:r.title})]})},r.title))})})]})}),e.jsx(Al,{className:"border-t border-border/50 dark:border-border dark:bg-slate-900 flex-shrink-0 performance-optimized layout-contained",style:{position:"sticky",bottom:0,zIndex:10,background:"hsl(var(--background))",marginTop:"auto",contain:"layout style",willChange:"auto"},children:e.jsx(Tl,{children:e.jsx(Ll,{children:e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-accent/50 to-accent/30 dark:from-accent/20 dark:to-accent/10 hover:from-accent/60 hover:to-accent/40 dark:hover:from-accent/30 dark:hover:to-accent/20 shadow-sm hover:shadow-md transition-all duration-200 ease-out hover:scale-[1.01] cursor-pointer",children:[e.jsx("div",{className:"flex aspect-square size-10 items-center justify-center rounded-full bg-gradient-to-br from-primary/80 to-purple-700 text-primary-foreground overflow-hidden ring-2 ring-primary/20 shadow-md",children:o&&""!==o.trim()?e.jsx("img",{src:o,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-full",onError:e=>{console.error("Sidebar footer logo failed to load:",o),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',t.appendChild(e)}}}):e.jsx(nr,{className:"size-4"})}),e.jsxs("div",{className:"grid flex-1 text-right leading-tight",children:[e.jsxs("span",{className:"truncate font-bold text-foreground dark:text-foreground text-sm",children:["د. ",s]}),e.jsx("span",{className:"truncate text-xs text-muted-foreground dark:text-muted-foreground font-medium",children:n})]})]})})})})]})}function Ol(){const[t,a]=Q.useState(new Date);Q.useEffect(()=>{const e=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(e)},[]);return e.jsxs("div",{className:"flex items-center gap-2 font-mono",children:[e.jsx("span",{className:"text-xs",children:"📅"}),e.jsx("span",{children:(e=>{const t=e.getDate(),a=e.getMonth()+1,r=e.getFullYear(),n=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return`${`${t.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${r}`} - ${`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}`})(t)})]})}const zl="dental_clinic_payment_password",Vl="dental_clinic_security_question",ql="dental_clinic_security_answer",Ul="dental_clinic_payment_failed_attempts",Bl="dental_clinic_payment_last_attempt",Hl="dental_clinic_payment_setup_complete",Xl=3e4,Wl=[{id:"pet",question:"ما اسم حيوانك الأليف الأول؟"},{id:"city",question:"ما اسم مدينتك المفضلة؟"},{id:"school",question:"ما اسم مدرستك الابتدائية؟"},{id:"food",question:"ما هو طبق الطعام المفضل لديك؟"},{id:"color",question:"ما هو لونك المفضل؟"},{id:"movie",question:"ما هو فيلمك المفضل؟"},{id:"book",question:"ما هو كتابك المفضل؟"}];function Gl(){try{return"true"===localStorage.getItem(Hl)}catch(e){return console.error("Error checking password setup:",e),!1}}async function Kl(e){try{if(!rd(e.password))throw new Error("كلمة المرور ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const t=await Lr(e.password),a=e.securityAnswer.trim().toLowerCase(),r=await Lr(a);return localStorage.setItem(zl,t),localStorage.setItem(Vl,JSON.stringify(e.securityQuestion)),localStorage.setItem(ql,r),localStorage.setItem(Hl,"true"),ad(),!0}catch(t){return console.error("Error setting up password:",t),!1}}async function Yl(e,t){try{if(!(await Ql(e)))throw new Error("كلمة المرور الحالية غير صحيحة");if(!rd(t))throw new Error("كلمة المرور الجديدة ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const a=await Lr(t);return localStorage.setItem(zl,a),!0}catch(a){return console.error("Error changing password:",a),!1}}async function Ql(e){try{if(!Gl())return!1;if(ed())throw new Error("تم تجاوز عدد المحاولات المسموحة. يرجى الانتظار 30 ثانية قبل المحاولة مرة أخرى");const t=localStorage.getItem(zl);if(!t)return!1;const a=await Lr(e)===t;return a?ad():function(){try{const e=Zl();localStorage.setItem(Ul,(e+1).toString()),localStorage.setItem(Bl,Date.now().toString())}catch(e){console.error("Error incrementing failed attempts:",e)}}(),a}catch(t){return console.error("Error verifying password:",t),!1}}async function Jl(e){try{const t=localStorage.getItem(ql);if(!t)return!1;const a=e.trim().toLowerCase();return await Lr(a)===t}catch(t){return console.error("Error verifying security answer:",t),!1}}function Zl(){try{return parseInt(localStorage.getItem(Ul)||"0",10)}catch(e){return console.error("Error getting failed attempts:",e),0}}function ed(){try{const e=localStorage.getItem(Bl);if(!e)return!1;const t=parseInt(e,10);if(Zl()>=3){return Date.now()-t<Xl}return!1}catch(e){return console.error("Error checking lockout status:",e),!1}}function td(){try{const e=localStorage.getItem(Bl);if(!e)return 0;const t=parseInt(e,10),a=Date.now()-t;return a<Xl?Math.ceil((Xl-a)/1e3):0}catch(e){return console.error("Error getting remaining lockout time:",e),0}}function ad(){try{localStorage.removeItem(Ul),localStorage.removeItem(Bl)}catch(e){console.error("Error resetting failed attempts:",e)}}function rd(e){return!(e.length<4)&&!!/[a-zA-Z0-9]/.test(e)}function nd(){try{localStorage.removeItem(zl),localStorage.removeItem(Vl),localStorage.removeItem(ql),localStorage.removeItem(Ul),localStorage.removeItem(Bl),localStorage.removeItem(Hl)}catch(e){console.error("Error clearing security data:",e)}}function sd({isOpen:t,onClose:a,onSuccess:r,onForgotPassword:n}){const{toast:s}=Is(),[o,i]=Q.useState(""),[l,d]=Q.useState(!1),[c,u]=Q.useState(!1),[m,p]=Q.useState(""),[g,h]=Q.useState(!1),[f,y]=Q.useState(0);Q.useEffect(()=>{t&&(h(ed()),y(td()),i(""),p(""))},[t]),Q.useEffect(()=>{if(g&&f>0){const e=setInterval(()=>{const e=td();y(e),e<=0&&h(!1)},1e3);return()=>clearInterval(e)}},[g,f]);const b=async e=>{if(e.preventDefault(),!g)if(o.trim()){u(!0),p("");try{if(await Ql(o.trim()))s({title:"تم الدخول بنجاح",description:"مرحباً بك في قسم المدفوعات",variant:"default"}),r(),a();else{const e=Zl();e>=3?(h(!0),y(30),p("تم تجاوز عدد المحاولات المسموحة. يرجى الانتظار 30 ثانية قبل المحاولة مرة أخرى أو استخدم إعادة تعيين كلمة المرور.")):p("كلمة المرور غير صحيحة. محاولات متبقية: "+(3-e))}}catch(t){p(t.message||"حدث خطأ أثناء التحقق من كلمة المرور")}finally{u(!1)}}else p("يرجى إدخال كلمة المرور")};return Gl()?e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-md",onKeyDown:e=>{"Enter"!==e.key||c||g?"Escape"===e.key&&a():b(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(Xa,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"أدخل كلمة المرور للوصول إلى المدفوعات"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"password",className:"text-right block",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"password",type:l?"text":"password",value:o,onChange:e=>i(e.target.value),placeholder:"أدخل كلمة المرور",className:"pr-10 text-right",disabled:c||g,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>d(!l),disabled:c,children:l?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),m&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:m})]}),g&&f>0&&e.jsxs(Cr,{children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsxs(Tr,{className:"text-right",children:["تم إغلاق النظام مؤقتاً. الوقت المتبقي: ",f," ثانية"]})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:c,className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:c||g||!o.trim(),className:"w-full sm:w-auto",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"دخول"]})})]}),n&&e.jsx("div",{className:"text-center pt-2",children:e.jsx(fr,{type:"button",variant:"link",onClick:n,disabled:c,className:"text-sm text-muted-foreground hover:text-primary",children:"نسيت كلمة المرور؟"})})]})]})}):null}function od({isOpen:t,onClose:a,onSuccess:r}){const{toast:n}=Is(),[s,o]=Q.useState("answer"),[i,l]=Q.useState(""),[d,c]=Q.useState(""),[u,m]=Q.useState(""),[p,g]=Q.useState(!1),[h,f]=Q.useState(!1),[y,b]=Q.useState(!1),[x,w]=Q.useState(""),[v,N]=Q.useState("");Q.useEffect(()=>{if(t){const e=function(){try{const e=localStorage.getItem(Vl);return e?JSON.parse(e):null}catch(x){return console.error("Error getting security question:",x),null}}();e&&N(e.question),j()}},[t]);const j=()=>{o("answer"),l(""),c(""),m(""),w(""),g(!1),f(!1)},_=async e=>{if(e.preventDefault(),i.trim()){b(!0),w("");try{await Jl(i.trim())?o("newPassword"):w("الإجابة غير صحيحة. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء التحقق من الإجابة")}finally{b(!1)}}else w("يرجى إدخال إجابة السؤال الأماني")},k=async e=>{if(e.preventDefault(),d.trim())if(u.trim())if(d===u)if(rd(d)){b(!0),w("");try{const e=await async function(e,t){try{if(!(await Jl(t)))throw new Error("إجابة السؤال الأماني غير صحيحة");if(!rd(e))throw new Error("كلمة المرور الجديدة ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const a=await Lr(e);return localStorage.setItem(zl,a),ad(),!0}catch(x){return console.error("Error resetting password:",x),!1}}(d,i.trim());e?(n({title:"تم إعادة تعيين كلمة المرور بنجاح",description:"يمكنك الآن استخدام كلمة المرور الجديدة للوصول إلى المدفوعات",variant:"default"}),r(),a()):w("فشل في إعادة تعيين كلمة المرور. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء إعادة تعيين كلمة المرور")}finally{b(!1)}}else w("كلمة المرور ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");else w("كلمات المرور غير متطابقة");else w("يرجى تأكيد كلمة المرور الجديدة");else w("يرجى إدخال كلمة مرور جديدة")};return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-md",onKeyDown:e=>{"Enter"!==e.key||y?"Escape"===e.key&&a():"answer"===s?_(e):k(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"إعادة تعيين كلمة المرور"})]}),"answer"===s?e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-right block font-medium",children:"السؤال الأماني:"}),e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground text-right",children:v})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"securityAnswer",className:"text-right block",children:"الإجابة"}),e.jsx(Sr,{id:"securityAnswer",type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"أدخل إجابتك على السؤال الأماني",className:"text-right",disabled:y,autoFocus:!0})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:y,className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:y||!i.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"التالي"]})})]})]}):e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"newPassword",className:"text-right block",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"newPassword",type:p?"text":"password",value:d,onChange:e=>c(e.target.value),placeholder:"أدخل كلمة مرور جديدة",className:"pr-10 text-right",disabled:y,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>g(!p),disabled:y,children:p?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"confirmPassword",className:"text-right block",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"confirmPassword",type:h?"text":"password",value:u,onChange:e=>m(e.target.value),placeholder:"أعد إدخال كلمة المرور الجديدة",className:"pr-10 text-right",disabled:y}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>f(!h),disabled:y,children:h?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsx("p",{children:"• على الأقل 4 أحرف"}),e.jsx("p",{children:"• حرف أو رقم واحد على الأقل"})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:()=>o("answer"),disabled:y,className:"w-full sm:w-auto",children:"العودة"}),e.jsx(fr,{type:"submit",disabled:y||!d.trim()||!u.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"إعادة تعيين"]})})]})]})]})})}function id({isOpen:t,onClose:a,onSuccess:r}){const{toast:n}=Is(),[s,o]=Q.useState(""),[i,l]=Q.useState(""),[d,c]=Q.useState(""),[u,m]=Q.useState(""),[p,g]=Q.useState(!1),[h,f]=Q.useState(!1),[y,b]=Q.useState(!1),[x,w]=Q.useState("");Q.useEffect(()=>{t&&v()},[t]);const v=()=>{o(""),l(""),c(""),m(""),w(""),g(!1),f(!1)},N=async e=>{if(e.preventDefault(),s.trim())if(i.trim())if(s===i)if(rd(s))if(d)if(u.trim())if(u.trim().length<2)w("إجابة السؤال الأماني يجب أن تكون على الأقل حرفين");else{b(!0),w("");try{const e=Wl.find(e=>e.id===d);if(!e)throw new Error("سؤال أماني غير صالح");const t={password:s.trim(),securityQuestion:e,securityAnswer:u.trim()};await Kl(t)?(n({title:"تم إعداد الأمان بنجاح",description:"يمكنك الآن استخدام كلمة المرور لحماية قسم المدفوعات",variant:"default"}),r(),a()):w("فشل في إعداد كلمة المرور. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء إعداد كلمة المرور")}finally{b(!1)}}else w("يرجى إدخال إجابة السؤال الأماني");else w("يرجى اختيار سؤال أماني");else w("كلمة المرور ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");else w("كلمات المرور غير متطابقة");else w("يرجى تأكيد كلمة المرور");else w("يرجى إدخال كلمة مرور")};return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-lg",onKeyDown:e=>{"Enter"!==e.key||y?"Escape"===e.key&&a():N(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"إعداد أمان قسم المدفوعات"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"password",className:"text-right block",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"password",type:p?"text":"password",value:s,onChange:e=>o(e.target.value),placeholder:"أدخل كلمة مرور قوية",className:"pr-10 text-right",disabled:y,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>g(!p),disabled:y,children:p?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"confirmPassword",className:"text-right block",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"confirmPassword",type:h?"text":"password",value:i,onChange:e=>l(e.target.value),placeholder:"أعد إدخال كلمة المرور",className:"pr-10 text-right",disabled:y}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>f(!h),disabled:y,children:h?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-right block",children:"السؤال الأماني"}),e.jsxs(ms,{value:d,onValueChange:c,disabled:y,children:[e.jsx(hs,{className:"text-right",children:e.jsx(gs,{placeholder:"اختر سؤال أماني"})}),e.jsx(bs,{children:Wl.map(t=>e.jsx(vs,{value:t.id,className:"text-right",children:t.question},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"securityAnswer",className:"text-right block",children:"إجابة السؤال الأماني"}),e.jsx(Sr,{id:"securityAnswer",type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"أدخل إجابتك على السؤال المختار",className:"text-right",disabled:y})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsx("p",{className:"font-medium mb-1",children:"متطلبات كلمة المرور:"}),e.jsx("p",{children:"• على الأقل 4 أحرف"}),e.jsx("p",{children:"• حرف أو رقم واحد على الأقل"})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:y,className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:y||!s.trim()||!i.trim()||!d||!u.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري الإعداد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"إعداد الأمان"]})})]})]})]})})}const ld="dental_clinic_reports_password",dd="dental_clinic_reports_security_question",cd="dental_clinic_reports_security_answer",ud="dental_clinic_reports_failed_attempts",md="dental_clinic_reports_last_attempt",pd="dental_clinic_reports_setup_complete",gd=3e4,hd=[{id:"pet",question:"ما اسم حيوانك الأليف الأول؟"},{id:"city",question:"ما اسم مدينتك المفضلة؟"},{id:"school",question:"ما اسم مدرستك الابتدائية؟"},{id:"food",question:"ما هو طبق الطعام المفضل لديك؟"},{id:"color",question:"ما هو لونك المفضل؟"},{id:"movie",question:"ما هو فيلمك المفضل؟"},{id:"book",question:"ما هو كتابك المفضل؟"}];function fd(){try{return"true"===localStorage.getItem(pd)}catch(e){return console.error("Error checking password setup:",e),!1}}async function yd(e){try{if(!kd(e.password))throw new Error("كلمة المرور ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const t=await Lr(e.password),a=e.securityAnswer.trim().toLowerCase(),r=await Lr(a);return localStorage.setItem(ld,t),localStorage.setItem(dd,JSON.stringify(e.securityQuestion)),localStorage.setItem(cd,r),localStorage.setItem(pd,"true"),_d(),!0}catch(t){return console.error("Error setting up password:",t),!1}}async function bd(e,t){try{if(!(await xd(e)))throw new Error("كلمة المرور الحالية غير صحيحة");if(!kd(t))throw new Error("كلمة المرور الجديدة ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const a=await Lr(t);return localStorage.setItem(ld,a),!0}catch(a){return console.error("Error changing password:",a),!1}}async function xd(e){try{if(!fd())return!1;if(Nd())throw new Error("تم تجاوز عدد المحاولات المسموحة. يرجى الانتظار 30 ثانية قبل المحاولة مرة أخرى");const t=localStorage.getItem(ld);if(!t)return!1;const a=await Lr(e)===t;return a?_d():function(){try{const e=vd();localStorage.setItem(ud,(e+1).toString()),localStorage.setItem(md,Date.now().toString())}catch(e){console.error("Error incrementing failed attempts:",e)}}(),a}catch(t){return console.error("Error verifying password:",t),!1}}async function wd(e){try{const t=localStorage.getItem(cd);if(!t)return!1;const a=e.trim().toLowerCase();return await Lr(a)===t}catch(t){return console.error("Error verifying security answer:",t),!1}}function vd(){try{return parseInt(localStorage.getItem(ud)||"0",10)}catch(e){return console.error("Error getting failed attempts:",e),0}}function Nd(){try{const e=localStorage.getItem(md);if(!e)return!1;const t=parseInt(e,10);if(vd()>=3){return Date.now()-t<gd}return!1}catch(e){return console.error("Error checking lockout status:",e),!1}}function jd(){try{const e=localStorage.getItem(md);if(!e)return 0;const t=parseInt(e,10),a=Date.now()-t;return a<gd?Math.ceil((gd-a)/1e3):0}catch(e){return console.error("Error getting remaining lockout time:",e),0}}function _d(){try{localStorage.removeItem(ud),localStorage.removeItem(md)}catch(e){console.error("Error resetting failed attempts:",e)}}function kd(e){return!(e.length<4)&&!!/[a-zA-Z0-9]/.test(e)}function Sd(){try{localStorage.removeItem(ld),localStorage.removeItem(dd),localStorage.removeItem(cd),localStorage.removeItem(ud),localStorage.removeItem(md),localStorage.removeItem(pd)}catch(e){console.error("Error clearing security data:",e)}}function Ed({isOpen:t,onClose:a,onSuccess:r,onForgotPassword:n}){const{toast:s}=Is(),[o,i]=Q.useState(""),[l,d]=Q.useState(!1),[c,u]=Q.useState(!1),[m,p]=Q.useState(""),[g,h]=Q.useState(!1),[f,y]=Q.useState(0);Q.useEffect(()=>{t&&(h(Nd()),y(jd()),i(""),p(""))},[t]),Q.useEffect(()=>{if(g&&f>0){const e=setInterval(()=>{const e=jd();y(e),e<=0&&h(!1)},1e3);return()=>clearInterval(e)}},[g,f]);const b=async e=>{if(e.preventDefault(),!g)if(o.trim()){u(!0),p("");try{if(await xd(o.trim()))s({title:"تم الدخول بنجاح",description:"مرحباً بك في قسم التقارير",variant:"default"}),r(),a();else{const e=vd();e>=3?(h(!0),y(30),p("تم تجاوز عدد المحاولات المسموحة. يرجى الانتظار 30 ثانية قبل المحاولة مرة أخرى أو استخدم إعادة تعيين كلمة المرور.")):p("كلمة المرور غير صحيحة. محاولات متبقية: "+(3-e))}}catch(t){p(t.message||"حدث خطأ أثناء التحقق من كلمة المرور")}finally{u(!1)}}else p("يرجى إدخال كلمة المرور")};return fd()?e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-md",onKeyDown:e=>{"Enter"!==e.key||c||g?"Escape"===e.key&&a():b(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(Xa,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"الوصول إلى قسم التقارير"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"يرجى إدخال كلمة المرور للمتابعة"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"password",className:"text-right block",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"password",type:l?"text":"password",value:o,onChange:e=>i(e.target.value),placeholder:"أدخل كلمة المرور",className:"pr-10 text-right",disabled:c||g,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>d(!l),disabled:c||g,children:l?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),g&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsxs(Tr,{className:"text-right",children:["تم قفل النظام لمدة ",f," ثانية بسبب تجاوز عدد المحاولات المسموحة"]})]}),m&&!g&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:m})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:c,className:"w-full sm:w-auto",children:"إلغاء"}),n&&e.jsx(fr,{type:"button",variant:"ghost",onClick:n,disabled:c,className:"w-full sm:w-auto text-sm",children:"نسيت كلمة المرور؟"}),e.jsx(fr,{type:"submit",disabled:c||!o.trim()||g,className:"w-full sm:w-auto",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"دخول"]})})]})]})]})}):null}function Ad({isOpen:t,onClose:a,onSuccess:r}){const{toast:n}=Is(),[s,o]=Q.useState("answer"),[i,l]=Q.useState(""),[d,c]=Q.useState(""),[u,m]=Q.useState(""),[p,g]=Q.useState(!1),[h,f]=Q.useState(!1),[y,b]=Q.useState(!1),[x,w]=Q.useState(""),[v,N]=Q.useState("");Q.useEffect(()=>{if(t){const e=function(){try{const e=localStorage.getItem(dd);return e?JSON.parse(e):null}catch(x){return console.error("Error getting security question:",x),null}}();e&&N(e.question),j()}},[t]);const j=()=>{o("answer"),l(""),c(""),m(""),w(""),g(!1),f(!1)},_=async e=>{if(e.preventDefault(),i.trim()){b(!0),w("");try{await wd(i.trim())?o("newPassword"):w("الإجابة غير صحيحة. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء التحقق من الإجابة")}finally{b(!1)}}else w("يرجى إدخال إجابة السؤال الأماني")},k=async e=>{if(e.preventDefault(),d.trim())if(u.trim())if(d===u)if(kd(d)){b(!0),w("");try{const e=await async function(e,t){try{if(!(await wd(t)))throw new Error("إجابة السؤال الأماني غير صحيحة");if(!kd(e))throw new Error("كلمة المرور الجديدة ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");const a=await Lr(e);return localStorage.setItem(ld,a),_d(),!0}catch(x){return console.error("Error resetting password:",x),!1}}(d,i.trim());e?(n({title:"تم إعادة تعيين كلمة المرور بنجاح",description:"يمكنك الآن استخدام كلمة المرور الجديدة للوصول إلى التقارير",variant:"default"}),r(),a()):w("فشل في إعادة تعيين كلمة المرور. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء إعادة تعيين كلمة المرور")}finally{b(!1)}}else w("كلمة المرور ضعيفة. يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم، ورمز خاص");else w("كلمات المرور غير متطابقة");else w("يرجى تأكيد كلمة المرور الجديدة");else w("يرجى إدخال كلمة مرور جديدة")};return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-md",onKeyDown:e=>{"Enter"!==e.key||y?"Escape"===e.key&&a():"answer"===s?_(e):k(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"إعادة تعيين كلمة المرور"})]}),"answer"===s?e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-right block font-medium",children:"السؤال الأماني:"}),e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground text-right",children:v})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"securityAnswer",className:"text-right block",children:"الإجابة"}),e.jsx(Sr,{id:"securityAnswer",type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"أدخل إجابتك على السؤال الأماني",className:"text-right",disabled:y,autoFocus:!0})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:y,className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:y||!i.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"التالي"]})})]})]}):e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"newPassword",className:"text-right block",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"newPassword",type:p?"text":"password",value:d,onChange:e=>c(e.target.value),placeholder:"أدخل كلمة مرور جديدة",className:"pr-10 text-right",disabled:y,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>g(!p),disabled:y,children:p?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"confirmPassword",className:"text-right block",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"confirmPassword",type:h?"text":"password",value:u,onChange:e=>m(e.target.value),placeholder:"أعد إدخال كلمة المرور الجديدة",className:"pr-10 text-right",disabled:y}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>f(!h),disabled:y,children:h?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsx("p",{children:"• على الأقل 4 أحرف"}),e.jsx("p",{children:"• حرف أو رقم واحد على الأقل"})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:()=>o("answer"),disabled:y,className:"w-full sm:w-auto",children:"العودة"}),e.jsx(fr,{type:"submit",disabled:y||!d.trim()||!u.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"إعادة تعيين"]})})]})]})]})})}function Dd({isOpen:t,onClose:a,onSuccess:r}){const{toast:n}=Is(),[s,o]=Q.useState(""),[i,l]=Q.useState(""),[d,c]=Q.useState(""),[u,m]=Q.useState(""),[p,g]=Q.useState(!1),[h,f]=Q.useState(!1),[y,b]=Q.useState(!1),[x,w]=Q.useState("");Q.useEffect(()=>{t&&v()},[t]);const v=()=>{o(""),l(""),c(""),m(""),w(""),g(!1),f(!1)},N=async e=>{if(e.preventDefault(),s.trim())if(i.trim())if(s===i)if(kd(s))if(d&&u.trim()){b(!0),w("");try{const e=hd.find(e=>e.id===d);if(!e)return w("سؤال أماني غير صالح"),void b(!1);const t={password:s.trim(),securityQuestion:e,securityAnswer:u.trim()};await yd(t)?(n({title:"تم إعداد كلمة المرور بنجاح",description:"سيتم طلب كلمة المرور عند الوصول لقسم التقارير",variant:"default"}),r(),a()):w("فشل في إعداد كلمة المرور. يرجى المحاولة مرة أخرى.")}catch(t){w(t.message||"حدث خطأ أثناء إعداد كلمة المرور")}finally{b(!1)}}else w("يرجى اختيار سؤال أماني والإجابة عليه");else w("كلمة المرور ضعيفة. يجب أن تحتوي على 4 أحرف على الأقل وحرف أو رقم واحد");else w("كلمات المرور غير متطابقة");else w("يرجى تأكيد كلمة المرور");else w("يرجى إدخال كلمة مرور")};return e.jsx(br,{open:t,onOpenChange:a,children:e.jsxs(vr,{className:"sm:max-w-md",onKeyDown:e=>{"Enter"!==e.key||y?"Escape"===e.key&&a():N(e)},dir:"rtl",children:[e.jsxs(Nr,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(_r,{className:"text-xl font-bold text-foreground",children:"إعداد كلمة المرور"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"حماية قسم التقارير بكلمة مرور"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"password",className:"text-right block",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"password",type:p?"text":"password",value:s,onChange:e=>o(e.target.value),placeholder:"أدخل كلمة مرور",className:"pr-10 text-right",disabled:y,autoFocus:!0}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>g(!p),disabled:y,children:p?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"confirmPassword",className:"text-right block",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sr,{id:"confirmPassword",type:h?"text":"password",value:i,onChange:e=>l(e.target.value),placeholder:"أعد إدخال كلمة المرور",className:"pr-10 text-right",disabled:y}),e.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 h-auto p-1",onClick:()=>f(!h),disabled:y,children:h?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(za,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{className:"text-right block",children:"السؤال الأماني (لإعادة التعيين في حال نسيان كلمة المرور)"}),e.jsxs(ms,{value:d,onValueChange:c,disabled:y,children:[e.jsx(hs,{className:"text-right",children:e.jsx(gs,{placeholder:"اختر سؤال أماني"})}),e.jsx(bs,{children:hd.map(t=>e.jsx(vs,{value:t.id,className:"text-right",children:t.question},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{htmlFor:"securityAnswer",className:"text-right block",children:"إجابة السؤال الأماني"}),e.jsx(Sr,{id:"securityAnswer",type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"أدخل إجابتك على السؤال المختار",className:"text-right",disabled:y})]}),x&&e.jsxs(Cr,{variant:"destructive",children:[e.jsx(Ea,{className:"h-4 w-4"}),e.jsx(Tr,{className:"text-right",children:x})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsx("p",{className:"font-medium mb-1",children:"متطلبات كلمة المرور:"}),e.jsx("p",{children:"• على الأقل 4 أحرف"}),e.jsx("p",{children:"• حرف أو رقم واحد على الأقل"})]}),e.jsxs(jr,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fr,{type:"button",variant:"outline",onClick:a,disabled:y,className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(fr,{type:"submit",disabled:y||!s.trim()||!i.trim()||!d||!u.trim(),className:"w-full sm:w-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ia,{className:"w-4 h-4 ml-2"}),"إعداد كلمة المرور"]})})]})]})]})})}var Id="ToastProvider",[Pd,Cd,Td]=H("Toast"),[Ld,Fd]=k("Toast",[Td]),[Rd,$d]=Ld(Id),Md=t=>{const{__scopeToast:a,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=t,[l,d]=Q.useState(null),[c,u]=Q.useState(0),m=Q.useRef(!1),p=Q.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${Id}\`. Expected non-empty \`string\`.`),e.jsx(Pd.Provider,{scope:a,children:e.jsx(Rd,{scope:a,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:c,viewport:l,onViewportChange:d,onToastAdd:Q.useCallback(()=>u(e=>e+1),[]),onToastRemove:Q.useCallback(()=>u(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:m,isClosePausedRef:p,children:i})})};Md.displayName=Id;var Od="ToastViewport",zd=["F8"],Vd="toast.viewportPause",qd="toast.viewportResume",Ud=Q.forwardRef((t,a)=>{const{__scopeToast:r,hotkey:n=zd,label:s="Notifications ({hotkey})",...o}=t,i=$d(Od,r),l=Cd(r),c=Q.useRef(null),u=Q.useRef(null),m=Q.useRef(null),p=Q.useRef(null),g=A(a,p,i.onViewportChange),h=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),f=i.toastCount>0;Q.useEffect(()=>{const e=e=>{0!==n.length&&n.every(t=>e[t]||e.code===t)&&p.current?.focus()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),Q.useEffect(()=>{const e=c.current,t=p.current;if(f&&e&&t){const a=()=>{if(!i.isClosePausedRef.current){const e=new CustomEvent(Vd);t.dispatchEvent(e),i.isClosePausedRef.current=!0}},r=()=>{if(i.isClosePausedRef.current){const e=new CustomEvent(qd);t.dispatchEvent(e),i.isClosePausedRef.current=!1}},n=t=>{!e.contains(t.relatedTarget)&&r()},s=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",a),e.addEventListener("focusout",n),e.addEventListener("pointermove",a),e.addEventListener("pointerleave",s),window.addEventListener("blur",a),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",a),e.removeEventListener("focusout",n),e.removeEventListener("pointermove",a),e.removeEventListener("pointerleave",s),window.removeEventListener("blur",a),window.removeEventListener("focus",r)}}},[f,i.isClosePausedRef]);const y=Q.useCallback(({tabbingDirection:e})=>{const t=l().map(t=>{const a=t.ref.current,r=[a,...lc(a)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[l]);return Q.useEffect(()=>{const e=p.current;if(e){const t=t=>{const a=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!a){const a=document.activeElement,r=t.shiftKey;if(t.target===e&&r)return void u.current?.focus();const n=y({tabbingDirection:r?"backwards":"forwards"}),s=n.findIndex(e=>e===a);dc(n.slice(s+1))?t.preventDefault():r?u.current?.focus():m.current?.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[l,y]),e.jsxs(X,{ref:c,role:"region","aria-label":s.replace("{hotkey}",h),tabIndex:-1,style:{pointerEvents:f?void 0:"none"},children:[f&&e.jsx(Hd,{ref:u,onFocusFromOutsideViewport:()=>{dc(y({tabbingDirection:"forwards"}))}}),e.jsx(Pd.Slot,{scope:r,children:e.jsx(d.ol,{tabIndex:-1,...o,ref:g})}),f&&e.jsx(Hd,{ref:m,onFocusFromOutsideViewport:()=>{dc(y({tabbingDirection:"backwards"}))}})]})});Ud.displayName=Od;var Bd="ToastFocusProxy",Hd=Q.forwardRef((t,a)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=t,o=$d(Bd,r);return e.jsx(W,{"aria-hidden":!0,tabIndex:0,...s,ref:a,style:{position:"fixed"},onFocus:e=>{const t=e.relatedTarget;!o.viewport?.contains(t)&&n()}})});Hd.displayName=Bd;var Xd="Toast",Wd=Q.forwardRef((t,a)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...i}=t,[l,d]=q({prop:n,defaultProp:s??!0,onChange:o,caller:Xd});return e.jsx(R,{present:r||l,children:e.jsx(Yd,{open:l,...i,ref:a,onClose:()=>d(!1),onPause:C(t.onPause),onResume:C(t.onResume),onSwipeStart:I(t.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:I(t.onSwipeMove,e=>{const{x:t,y:a}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${a}px`)}),onSwipeCancel:I(t.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:I(t.onSwipeEnd,e=>{const{x:t,y:a}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${a}px`),d(!1)})})})});Wd.displayName=Xd;var[Gd,Kd]=Ld(Xd,{onClose(){}}),Yd=Q.forwardRef((t,a)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:l,onPause:c,onResume:u,onSwipeStart:m,onSwipeMove:p,onSwipeCancel:g,onSwipeEnd:h,...f}=t,y=$d(Xd,r),[b,x]=Q.useState(null),w=A(a,e=>x(e)),v=Q.useRef(null),N=Q.useRef(null),j=s||y.duration,_=Q.useRef(0),k=Q.useRef(j),S=Q.useRef(0),{onToastAdd:E,onToastRemove:D}=y,P=C(()=>{const e=b?.contains(document.activeElement);e&&y.viewport?.focus(),i()}),T=Q.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(S.current),_.current=(new Date).getTime(),S.current=window.setTimeout(P,e))},[P]);Q.useEffect(()=>{const e=y.viewport;if(e){const t=()=>{T(k.current),u?.()},a=()=>{const e=(new Date).getTime()-_.current;k.current=k.current-e,window.clearTimeout(S.current),c?.()};return e.addEventListener(Vd,a),e.addEventListener(qd,t),()=>{e.removeEventListener(Vd,a),e.removeEventListener(qd,t)}}},[y.viewport,j,c,u,T]),Q.useEffect(()=>{o&&!y.isClosePausedRef.current&&T(j)},[o,j,y.isClosePausedRef,T]),Q.useEffect(()=>(E(),()=>D()),[E,D]);const L=Q.useMemo(()=>b?sc(b):null,[b]);return y.viewport?e.jsxs(e.Fragment,{children:[L&&e.jsx(Qd,{__scopeToast:r,role:"status","aria-live":"foreground"===n?"assertive":"polite","aria-atomic":!0,children:L}),e.jsx(Gd,{scope:r,onClose:P,children:Y.createPortal(e.jsx(Pd.ItemSlot,{scope:r,children:e.jsx(G,{asChild:!0,onEscapeKeyDown:I(l,()=>{y.isFocusedToastEscapeKeyDownRef.current||P(),y.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(d.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":y.swipeDirection,...f,ref:w,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:I(t.onKeyDown,e=>{"Escape"===e.key&&(l?.(e.nativeEvent),e.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,P()))}),onPointerDown:I(t.onPointerDown,e=>{0===e.button&&(v.current={x:e.clientX,y:e.clientY})}),onPointerMove:I(t.onPointerMove,e=>{if(!v.current)return;const t=e.clientX-v.current.x,a=e.clientY-v.current.y,r=Boolean(N.current),n=["left","right"].includes(y.swipeDirection),s=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,o=n?s(0,t):0,i=n?0:s(0,a),l="touch"===e.pointerType?10:2,d={x:o,y:i},c={originalEvent:e,delta:d};r?(N.current=d,oc("toast.swipeMove",p,c,{discrete:!1})):ic(d,y.swipeDirection,l)?(N.current=d,oc("toast.swipeStart",m,c,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(a)>l)&&(v.current=null)}),onPointerUp:I(t.onPointerUp,e=>{const t=N.current,a=e.target;if(a.hasPointerCapture(e.pointerId)&&a.releasePointerCapture(e.pointerId),N.current=null,v.current=null,t){const a=e.currentTarget,r={originalEvent:e,delta:t};ic(t,y.swipeDirection,y.swipeThreshold)?oc("toast.swipeEnd",h,r,{discrete:!0}):oc("toast.swipeCancel",g,r,{discrete:!0}),a.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),y.viewport)})]}):null}),Qd=t=>{const{__scopeToast:a,children:r,...n}=t,s=$d(Xd,a),[o,i]=Q.useState(!1),[l,d]=Q.useState(!1);return function(e=()=>{}){const t=C(e);T(()=>{let e=0,a=0;return e=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(a)}},[t])}(()=>i(!0)),Q.useEffect(()=>{const e=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(e)},[]),l?null:e.jsx(B,{asChild:!0,children:e.jsx(W,{...n,children:o&&e.jsxs(e.Fragment,{children:[s.label," ",r]})})})},Jd=Q.forwardRef((t,a)=>{const{__scopeToast:r,...n}=t;return e.jsx(d.div,{...n,ref:a})});Jd.displayName="ToastTitle";var Zd=Q.forwardRef((t,a)=>{const{__scopeToast:r,...n}=t;return e.jsx(d.div,{...n,ref:a})});Zd.displayName="ToastDescription";var ec="ToastAction",tc=Q.forwardRef((t,a)=>{const{altText:r,...n}=t;return r.trim()?e.jsx(nc,{altText:r,asChild:!0,children:e.jsx(rc,{...n,ref:a})}):(console.error(`Invalid prop \`altText\` supplied to \`${ec}\`. Expected non-empty \`string\`.`),null)});tc.displayName=ec;var ac="ToastClose",rc=Q.forwardRef((t,a)=>{const{__scopeToast:r,...n}=t,s=Kd(ac,r);return e.jsx(nc,{asChild:!0,children:e.jsx(d.button,{type:"button",...n,ref:a,onClick:I(t.onClick,s.onClose)})})});rc.displayName=ac;var nc=Q.forwardRef((t,a)=>{const{__scopeToast:r,altText:n,...s}=t;return e.jsx(d.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:a})});function sc(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const a=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!a)if(r){const a=e.dataset.radixToastAnnounceAlt;a&&t.push(a)}else t.push(...sc(e))}}),t}function oc(e,t,a,{discrete:r}){const n=a.originalEvent.currentTarget,s=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:a});t&&n.addEventListener(e,t,{once:!0}),r?K(n,s):n.dispatchEvent(s)}var ic=(e,t,a=0)=>{const r=Math.abs(e.x),n=Math.abs(e.y),s=r>n;return"left"===t||"right"===t?s&&r>a:!s&&n>a};function lc(e){const t=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)t.push(a.currentNode);return t}function dc(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var cc=Ud,uc=Wd,mc=Jd,pc=Zd,gc=tc,hc=rc;const fc=Md,yc=Q.forwardRef(({className:t,...a},r)=>e.jsx(cc,{ref:r,className:Nt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:left-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...a}));yc.displayName=cc.displayName;const bc=gr("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 space-x-reverse overflow-hidden rounded-md border p-4 pl-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-left-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:shadow-xl dark:shadow-black/20",{variants:{variant:{default:"border bg-background text-foreground dark:bg-gray-800 dark:border-gray-700 dark:text-white",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground dark:border-red-600 dark:bg-red-600 dark:text-white",success:"border-green-200 bg-green-50 text-green-800 dark:border-green-600 dark:bg-green-600 dark:text-white",warning:"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-600 dark:bg-amber-600 dark:text-white",info:"border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-600 dark:bg-blue-600 dark:text-white"}},defaultVariants:{variant:"default"}}),xc=Q.forwardRef(({className:t,variant:a,...r},n)=>e.jsx(uc,{ref:n,dir:"rtl",className:Nt(bc({variant:a}),t),...r}));xc.displayName=uc.displayName;Q.forwardRef(({className:t,...a},r)=>e.jsx(gc,{ref:r,className:Nt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive dark:text-gray-300 dark:hover:bg-gray-700 dark:border-gray-600",t),...a})).displayName=gc.displayName;const wc=Q.forwardRef(({className:t,...a},r)=>e.jsx(hc,{ref:r,className:Nt("absolute left-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-400 dark:hover:text-white",t),"toast-close":"",...a,children:e.jsx(or,{className:"h-4 w-4"})}));wc.displayName=hc.displayName;const vc=Q.forwardRef(({className:t,...a},r)=>e.jsx(mc,{ref:r,className:Nt("text-sm font-semibold [&+div]:text-xs dark:text-white",t),...a}));vc.displayName=mc.displayName;const Nc=Q.forwardRef(({className:t,...a},r)=>e.jsx(pc,{ref:r,className:Nt("text-sm opacity-90 dark:text-gray-300",t),...a}));function jc(){const{toasts:t}=Is();return e.jsxs(fc,{children:[t.map(function({id:t,title:a,description:r,action:n,...s}){return e.jsxs(xc,{...s,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(vc,{children:a}),r&&e.jsx(Nc,{children:r})]}),n,e.jsx(wc,{})]},t)}),e.jsx(yc,{})]})}Nc.displayName=pc.displayName;const _c=Q.forwardRef(({...t},a)=>e.jsx("nav",{ref:a,"aria-label":"breadcrumb",...t}));_c.displayName="Breadcrumb";const kc=Q.forwardRef(({className:t,...a},r)=>e.jsx("ol",{ref:r,className:Nt("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...a}));kc.displayName="BreadcrumbList";const Sc=Q.forwardRef(({className:t,...a},r)=>e.jsx("li",{ref:r,className:Nt("inline-flex items-center gap-1.5",t),...a}));Sc.displayName="BreadcrumbItem";const Ec=Q.forwardRef(({asChild:a,className:r,...n},s)=>{const o=a?t:"a";return e.jsx(o,{ref:s,className:Nt("transition-colors hover:text-foreground",r),...n})});Ec.displayName="BreadcrumbLink";const Ac=Q.forwardRef(({className:t,...a},r)=>e.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:Nt("font-normal text-foreground",t),...a}));Ac.displayName="BreadcrumbPage";const Dc=({children:t,className:a,...r})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:Nt("[&>svg]:size-3.5",a),...r,children:t??e.jsx(Ta,{})});Dc.displayName="BreadcrumbSeparator";const Ic=J.lazy(()=>Z(()=>import("./Payments-5bfd40b9.js"),["./Payments-5bfd40b9.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./cardStyles-c77ef46a.js","./useTimeFilteredStats-1c30c8be.js","./collapsible-d3d2b240.js","./pen-square-6c634feb.js","./qr-d6f50769.js","./settings-39dd9f65.js","./upload-4df8a268.js","./printer-5ab76652.js","./file-text-861b9f90.js","./table-20957d0a.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./unlock-51cfe0e8.js","./notificationService-09cb27cc.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./plus-1eab3b5b.js","./trending-up-5cd3f2a0.js","./filter-f006659c.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Pc=J.lazy(()=>Z(()=>import("./Settings-38cb2511.js"),["./Settings-38cb2511.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./qr-d6f50769.js","./utils-ec524415.js","./unlock-51cfe0e8.js","./pen-square-6c634feb.js","./users-5a609aa2.js","./zap-6d3cd988.js","./file-text-861b9f90.js","./bar-chart-3-2a89747c.js","./settings-39dd9f65.js","./plus-1eab3b5b.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./switch-3ea40783.js","./upload-4df8a268.js","./phone-a8e6eab2.js","./hard-drive-04d0cddb.js","./image-d8fa81df.js","./mail-8c3a07ed.js","./charts-b4389b44.js"],import.meta.url)),Cc=J.lazy(()=>Z(()=>import("./Inventory-14af1a78.js"),["./Inventory-14af1a78.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./cardStyles-c77ef46a.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./tabs-952e3ebd.js","./index-a46c293c.js","./collapsible-d3d2b240.js","./package-557fa287.js","./file-text-861b9f90.js","./table-20957d0a.js","./filter-f006659c.js","./pen-square-6c634feb.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./currency-display-e01ebf49.js","./plus-1eab3b5b.js","./bell-847606c7.js","./trending-up-5cd3f2a0.js","./trending-down-0dc1e939.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Tc=J.lazy(()=>Z(()=>import("./Reports-682cdc8c.js"),["./Reports-682cdc8c.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./tabs-952e3ebd.js","./index-a46c293c.js","./chartDataHelpers-a79b834e.js","./utils-ec524415.js","./expensesStore-f3f1428b.js","./clinicNeedsStore-c3c0792a.js","./labOrderStore-b969024d.js","./cardStyles-c77ef46a.js","./currency-display-e01ebf49.js","./excel-37615a09.js","./collapsible-d3d2b240.js","./unlock-51cfe0e8.js","./pdfService-844f6d4e.js","./pdf-991f41f6.js","./exportService-1536567b.js","./users-5a609aa2.js","./upload-4df8a268.js","./pie-chart-ac153dee.js","./charts-b4389b44.js","./bar-chart-3-2a89747c.js","./trending-up-5cd3f2a0.js","./trending-down-0dc1e939.js","./notificationService-09cb27cc.js","./useTimeFilteredStats-1c30c8be.js","./package-557fa287.js","./calculator-63fcb348.js","./plus-1eab3b5b.js","./zap-6d3cd988.js","./table-20957d0a.js","./building-2-acc8549f.js","./file-text-861b9f90.js","./filter-f006659c.js"],import.meta.url)),Lc=J.lazy(()=>Z(()=>import("./EnhancedDashboard-f08c8cb0.js"),["./EnhancedDashboard-f08c8cb0.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./pdf-991f41f6.js","./bar-chart-3-2a89747c.js","./bell-847606c7.js","./chevron-left-343e35ff.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Fc=J.lazy(()=>Z(()=>import("./Patients-ece1a460.js"),["./Patients-ece1a460.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./collapsible-d3d2b240.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./table-20957d0a.js","./PatientDetailsModal-ebd37fae.js","./tabs-952e3ebd.js","./pdfService-844f6d4e.js","./printer-5ab76652.js","./file-text-861b9f90.js","./pen-square-6c634feb.js","./phone-a8e6eab2.js","./mail-8c3a07ed.js","./map-pin-a7696fe0.js","./plus-1eab3b5b.js","./more-horizontal-5517ce56.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./ComprehensivePendingInvoiceDialog-f22679a2.js","./switch-3ea40783.js","./qr-d6f50769.js","./filter-f006659c.js","./calculator-63fcb348.js","./settings-39dd9f65.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Rc=J.lazy(()=>Z(()=>import("./Appointments-e8577b40.js"),["./Appointments-e8577b40.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./defineProperty-1a4785df.js","./pdf-991f41f6.js","./charts-b4389b44.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./tabs-952e3ebd.js","./collapsible-d3d2b240.js","./table-20957d0a.js","./filter-f006659c.js","./pen-square-6c634feb.js","./upload-4df8a268.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./notificationService-09cb27cc.js","./exportService-1536567b.js","./excel-37615a09.js","./PatientDetailsModal-ebd37fae.js","./pdfService-844f6d4e.js","./printer-5ab76652.js","./file-text-861b9f90.js","./phone-a8e6eab2.js","./mail-8c3a07ed.js","./map-pin-a7696fe0.js","./plus-1eab3b5b.js","./utils-ec524415.js","./Appointments-07f0607c.css"],import.meta.url)),$c=J.lazy(()=>Z(()=>import("./Labs-31ea9338.js"),["./Labs-31ea9338.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./tabs-952e3ebd.js","./collapsible-d3d2b240.js","./labStore-8f239aba.js","./utils-ec524415.js","./labOrderStore-b969024d.js","./cardStyles-c77ef46a.js","./useTimeFilteredStats-1c30c8be.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./table-20957d0a.js","./building-2-acc8549f.js","./map-pin-a7696fe0.js","./pen-square-6c634feb.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./phone-a8e6eab2.js","./calculator-63fcb348.js","./file-text-861b9f90.js","./plus-1eab3b5b.js","./filter-f006659c.js","./charts-b4389b44.js"],import.meta.url)),Mc=J.lazy(()=>Z(()=>import("./Medications-1ffc1649.js"),["./Medications-1ffc1649.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./tabs-952e3ebd.js","./index-a46c293c.js","./collapsible-d3d2b240.js","./AddPrescriptionDialog-e7062ace.js","./utils-ec524415.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./file-text-861b9f90.js","./plus-1eab3b5b.js","./pill-2f66511d.js","./cardStyles-c77ef46a.js","./useTimeFilteredStats-1c30c8be.js","./table-20957d0a.js","./pen-square-6c634feb.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./PrescriptionReceiptDialog-36713fb4.js","./qr-d6f50769.js","./settings-39dd9f65.js","./printer-5ab76652.js","./filter-f006659c.js","./pdf-991f41f6.js","./charts-b4389b44.js"],import.meta.url)),Oc=J.lazy(()=>Z(()=>import("./DentalTreatments-77fbe86d.js"),["./DentalTreatments-77fbe86d.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./checkbox-8b9b9c35.js","./tabs-952e3ebd.js","./index-a46c293c.js","./currency-display-e01ebf49.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./pen-square-6c634feb.js","./plus-1eab3b5b.js","./labStore-8f239aba.js","./utils-ec524415.js","./labOrderStore-b969024d.js","./arrow-up-832b5917.js","./image-d8fa81df.js","./PrescriptionReceiptDialog-36713fb4.js","./qr-d6f50769.js","./file-text-861b9f90.js","./settings-39dd9f65.js","./pill-2f66511d.js","./printer-5ab76652.js","./table-20957d0a.js","./phone-a8e6eab2.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./pdf-991f41f6.js","./charts-b4389b44.js","./DentalTreatments-ef731e6a.css"],import.meta.url)),zc=J.lazy(()=>Z(()=>import("./ClinicNeeds-c4218ca0.js"),["./ClinicNeeds-c4218ca0.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./clinicNeedsStore-c3c0792a.js","./utils-ec524415.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./cardStyles-c77ef46a.js","./table-20957d0a.js","./package-557fa287.js","./pen-square-6c634feb.js","./upload-4df8a268.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./filter-f006659c.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./pdfService-844f6d4e.js","./notificationService-09cb27cc.js","./file-text-861b9f90.js","./plus-1eab3b5b.js","./charts-b4389b44.js"],import.meta.url)),Vc=J.lazy(()=>Z(()=>import("./Expenses-f7e3d5bd.js"),["./Expenses-f7e3d5bd.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./collapsible-d3d2b240.js","./expensesStore-f3f1428b.js","./utils-ec524415.js","./currency-display-e01ebf49.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./checkbox-8b9b9c35.js","./table-20957d0a.js","./pen-square-6c634feb.js","./more-horizontal-5517ce56.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./file-text-861b9f90.js","./plus-1eab3b5b.js","./filter-f006659c.js","./charts-b4389b44.js"],import.meta.url)),qc=J.lazy(()=>Z(()=>import("./ExternalEstimate-ecfa605c.js"),["./ExternalEstimate-ecfa605c.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./pdf-991f41f6.js","./file-text-861b9f90.js","./phone-a8e6eab2.js","./map-pin-a7696fe0.js","./printer-5ab76652.js","./calculator-63fcb348.js","./plus-1eab3b5b.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Uc=J.lazy(()=>Z(()=>import("./ProductionBackup-a2a3e250.js"),["./ProductionBackup-a2a3e250.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./file-text-861b9f90.js","./hard-drive-04d0cddb.js","./upload-4df8a268.js","./pdf-991f41f6.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Bc=e=>e(),Hc=J.lazy(()=>Z(()=>import("./GlobalSearch-c12c1759.js"),["./GlobalSearch-c12c1759.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./globalStore-4b1adbba.js","./utils-ec524415.js","./file-text-861b9f90.js","./pdf-991f41f6.js","./charts-b4389b44.js"],import.meta.url));function Xc(){const{toast:t}=Is(),{isAuthenticated:a,isLoading:r,passwordEnabled:n,login:s}=ba(),{isLicenseValid:o,isFirstRun:i,isLoading:l,error:d,machineInfo:c,activateLicense:u}=function(){const[e,t]=Q.useState({isLicenseValid:!1,isFirstRun:!0,isLoading:!0,error:null,licenseData:null,machineInfo:null}),a=Q.useCallback(async()=>{try{if(console.log("🔐 Checking license status..."),!window.electronAPI?.license?.checkStatus)throw new Error("License API not available");const e=await window.electronAPI.license.checkStatus();return console.log("🔐 License status result:",e),e}catch(e){return console.error("❌ Error checking license status:",e),{isValid:!1,error:"Failed to check license status",isFirstRun:!0}}},[]),r=Q.useCallback(async()=>{try{if(console.log("🔐 Getting machine info..."),!window.electronAPI?.license?.getMachineInfo)throw new Error("License API not available");const e=await window.electronAPI.license.getMachineInfo();return console.log("🔐 Machine info result:",e),e}catch(e){return console.error("❌ Error getting machine info:",e),{hwid:"error",platform:"unknown",arch:"unknown",error:"Failed to get machine info"}}},[]),n=Q.useCallback(async e=>{try{if(console.log("🔐 Activating license..."),!window.electronAPI?.license?.activate)throw new Error("License API not available");if(!e||"string"!=typeof e)throw new Error("Invalid license key provided");const t=await window.electronAPI.license.activate(e.trim());return console.log("🔐 License activation result:",t.success),t.success&&await i(),t}catch(t){return console.error("❌ Error activating license:",t),{success:!1,error:"Failed to activate license"}}},[]),s=Q.useCallback(async()=>{try{if(console.log("🔐 Getting license info..."),!window.electronAPI?.license?.getLicenseInfo)throw new Error("License API not available");const e=await window.electronAPI.license.getLicenseInfo();return console.log("🔐 License info result:",e),e}catch(e){return console.error("❌ Error getting license info:",e),null}},[]),o=Q.useCallback(async()=>{try{if(console.log("🔐 Clearing license data..."),!window.electronAPI?.license?.clearData)throw new Error("License API not available");const e=await window.electronAPI.license.clearData();return console.log("🔐 License clear result:",e.success),e.success&&await i(),e}catch(e){return console.error("❌ Error clearing license data:",e),{success:!1,error:"Failed to clear license data"}}},[]),i=Q.useCallback(async()=>{t(e=>({...e,isLoading:!0,error:null}));try{const[e,n,o]=await Promise.all([a(),r(),s()]);t({isLicenseValid:e.isValid,isFirstRun:e.isFirstRun,isLoading:!1,error:e.error||n.error||null,licenseData:o,machineInfo:n}),console.log("🔐 License state updated:",{isValid:e.isValid,isFirstRun:e.isFirstRun,hasError:!(!e.error&&!n.error)})}catch(e){console.error("❌ Error refreshing license status:",e),t(e=>({...e,isLoading:!1,error:"Failed to refresh license status"}))}},[a,r,s]);Q.useEffect(()=>{console.log("🔐 Initializing license hook..."),i()},[i]);const l=Q.useCallback(e=>!(!e||"string"!=typeof e)&&/^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/.test(e.trim().toUpperCase()),[]),d=Q.useCallback(e=>{const t=e.replace(/[^A-Z0-9]/gi,"").toUpperCase(),a=[];for(let r=0;r<t.length;r+=5)a.push(t.slice(r,r+5));return a.slice(0,4).join("-")},[]);return{isLicenseValid:e.isLicenseValid,isFirstRun:e.isFirstRun,isLoading:e.isLoading,error:e.error,licenseData:e.licenseData,machineInfo:e.machineInfo,activateLicense:n,refreshLicenseStatus:i,clearLicenseData:o,getLicenseInfo:s,getMachineInfo:r,checkLicenseStatus:a,validateLicenseFormat:l,formatLicenseKey:d}}();ha(),ya(),Ei();const{loadPatients:m,patients:p}=me(),{isLoading:g,loadAppointments:h,createAppointment:f,updateAppointment:y,deleteAppointment:b}=Jt(),{loadSettings:x}=ta(),[w,v]=Q.useState("dashboard"),[N,j]=Q.useState(!1),[_,k]=Q.useState(!1),[S,E]=Q.useState(!1),[A,D]=Q.useState(!1),[I,P]=Q.useState(!1),[C,T]=Q.useState(!1),[L,F]=Q.useState(!1),[R,$]=Q.useState(!1),[M,O]=Q.useState(!1),[z,V]=Q.useState(!1),[q,U]=Q.useState(!1),[B,H]=Q.useState(!1),[X,W]=Q.useState(!1),[G,K]=Q.useState(!0),[Y,J]=Q.useState(!1),[ee,te]=Q.useState(!1),[ae,re]=Q.useState(!1),[ne,se]=Q.useState(null),oe=Q.useCallback(e=>{switch(Zt.search("Search result selected:",e),e.type){case"patient":v("patients");break;case"appointment":v("appointments");break;case"payment":ie("payments");break;case"treatment":v("dental-treatments");break;case"prescription":v("medications");break;default:v("dashboard")}H(!1)},[]),ie=e=>{"payments"===e?Gl()?L?v("payments"):D(!0):v("payments"):"reports"===e?fd()?q?v("reports"):$(!0):v("reports"):(L&&F(!1),q&&U(!1),v(e))};Q.useEffect(()=>(Zt.start("App component mounted"),"undefined"!=typeof window&&(Zt.system("electronAPI available:",!!window.electronAPI),Zt.system("window.electron available:",!!window.electron)),setTimeout(()=>{Bc(()=>Z(()=>import("./Patients-ece1a460.js"),["./Patients-ece1a460.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./collapsible-d3d2b240.js","./notificationService-09cb27cc.js","./upload-4df8a268.js","./exportService-1536567b.js","./pdf-991f41f6.js","./excel-37615a09.js","./table-20957d0a.js","./PatientDetailsModal-ebd37fae.js","./tabs-952e3ebd.js","./pdfService-844f6d4e.js","./printer-5ab76652.js","./file-text-861b9f90.js","./pen-square-6c634feb.js","./phone-a8e6eab2.js","./mail-8c3a07ed.js","./map-pin-a7696fe0.js","./plus-1eab3b5b.js","./more-horizontal-5517ce56.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./ComprehensivePendingInvoiceDialog-f22679a2.js","./switch-3ea40783.js","./qr-d6f50769.js","./filter-f006659c.js","./calculator-63fcb348.js","./settings-39dd9f65.js","./utils-ec524415.js","./charts-b4389b44.js"],import.meta.url)),Bc(()=>Z(()=>import("./Appointments-e8577b40.js"),["./Appointments-e8577b40.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./defineProperty-1a4785df.js","./pdf-991f41f6.js","./charts-b4389b44.js","./dropdown-menu-0651433f.js","./index-a46c293c.js","./tabs-952e3ebd.js","./collapsible-d3d2b240.js","./table-20957d0a.js","./filter-f006659c.js","./pen-square-6c634feb.js","./upload-4df8a268.js","./chevrons-right-9b995d31.js","./chevron-left-343e35ff.js","./arrow-up-832b5917.js","./notificationService-09cb27cc.js","./exportService-1536567b.js","./excel-37615a09.js","./PatientDetailsModal-ebd37fae.js","./pdfService-844f6d4e.js","./printer-5ab76652.js","./file-text-861b9f90.js","./phone-a8e6eab2.js","./mail-8c3a07ed.js","./map-pin-a7696fe0.js","./plus-1eab3b5b.js","./utils-ec524415.js","./Appointments-07f0607c.css"],import.meta.url)),Bc(()=>Z(()=>import("./Dashboard-9e89bf9d.js"),["./Dashboard-9e89bf9d.js","./ui-cacc1eea.js","./vendor-696af5bd.js","./expensesStore-f3f1428b.js","./utils-ec524415.js","./chartDataHelpers-a79b834e.js","./useTimeFilteredStats-1c30c8be.js","./collapsible-d3d2b240.js","./plus-1eab3b5b.js","./users-5a609aa2.js","./trending-up-5cd3f2a0.js","./package-557fa287.js","./charts-b4389b44.js","./pdf-991f41f6.js"],import.meta.url))},2e3),()=>{Zt.stop("App component unmounting")}),[]),Q.useEffect(()=>{const e=e=>{const t=e.target,a="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");if(e.ctrlKey&&"F1"!==e.key)return;const r=e.altKey;if(a&&!r)return void Zt.debug("Ignoring shortcut for typing element:",{key:e.key,tagName:t.tagName,hasPreventAttr:t.hasAttribute("data-prevent-shortcuts"),hasNoGlobalAttr:t.hasAttribute("data-no-globalThis-shortcuts")});const n=Na(e);switch(n.mappedKey.toLowerCase()){case"0":n.preventDefault(),v("dashboard");break;case"1":n.preventDefault(),v("patients");break;case"2":n.preventDefault(),v("appointments");break;case"3":n.preventDefault(),ie("payments");break;case"4":n.preventDefault(),v("labs");break;case"5":n.preventDefault(),v("dental-treatments");break;case"6":n.preventDefault(),v("expenses");break;case"7":n.preventDefault(),v("reports");break;case"8":n.preventDefault(),v("production-backup");break;case"9":n.preventDefault(),v("settings");break;case"a":n.preventDefault(),Zt.ui("Shortcut A/ش pressed - Opening Add Patient dialog"),j(!0);break;case"s":n.preventDefault(),Zt.ui("Shortcut S/س pressed - Opening Add Appointment dialog"),J(!0);break;case"d":n.preventDefault(),Zt.ui("Shortcut D/ي pressed - Opening Add Payment dialog"),k(!0);break;case"r":n.preventDefault(),Zt.ui("Shortcut R/ق pressed - Triggering data refresh"),x(),m(),h();break;case"f":n.preventDefault(),Zt.ui("Shortcut F/ب pressed - Opening globalThis search"),H(!0);break;case"F1":e.preventDefault(),Zt.ui("Opening Settings"),v("settings");break;case"F12":e.preventDefault(),W(!0)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ie,x,m,h]);const le=(e,a="success")=>{t({title:"success"===a?"نجح":"خطأ",description:e,variant:"error"===a?"destructive":"default"})};Q.useEffect(()=>{(async()=>{o&&a?(Zt.time("App Data Initialization"),Zt.start("Initializing app with valid license and authentication"),Zt.time("Settings Loading"),await x().then(()=>{Zt.timeEnd("Settings Loading")}).catch(e=>{Zt.error("Settings loading failed:",e)}),Zt.time("Patients Loading"),m().then(()=>{Zt.timeEnd("Patients Loading")}).catch(e=>{Zt.error("Patients loading failed:",e)}),Zt.time("Appointments Loading"),h().then(()=>{Zt.timeEnd("Appointments Loading"),Zt.timeEnd("App Data Initialization")}).catch(e=>{Zt.error("Appointments loading failed:",e)})):Zt.loading("Waiting for license validation and authentication before initializing app")})()},[o,a,m,h,x]);const de=async e=>{E(!0);try{return await s(e)}finally{E(!1)}},ce=async e=>{try{Zt.license("Handling license activation...");const a=await u(e);return a.success?(Zt.success("License activated successfully"),t({title:"نجح التفعيل",description:"تم تفعيل الترخيص بنجاح",variant:"default"})):(Zt.failure("License activation failed:",a.error),t({title:"فشل التفعيل",description:a.error||"فشل في تفعيل الترخيص",variant:"destructive"})),a}catch(a){Zt.error("License activation error:",a);const e="حدث خطأ أثناء تفعيل الترخيص";return t({title:"خطأ",description:e,variant:"destructive"}),{success:!1,error:e}}};if(G)return e.jsx(yr,{onComplete:()=>K(!1),duration:6e3});if(l||r)return e.jsx("div",{className:"min-h-screen bg-background dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-300",children:l?"جاري التحقق من الترخيص...":"جاري التحميل..."}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-gray-400 mt-2",children:"إذا استمر هذا التحميل، حاول إعادة تشغيل التطبيق"})]})});if(d&&!i)return e.jsx("div",{className:"min-h-screen bg-background dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-red-500 dark:text-red-400 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-lg font-semibold mb-2 dark:text-white",children:"خطأ في الترخيص"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-300 mb-4",children:d}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-primary text-primary-foreground px-4 py-2 rounded hover:bg-primary/90 dark:bg-blue-600 dark:hover:bg-blue-700",children:"إعادة المحاولة"})]})});if(X)return e.jsx("div",{className:"min-h-screen bg-background dark:bg-gray-900 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 dark:text-white",children:"تشخيص التطبيق"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-card dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-white",children:"حالة التطبيق"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"dark:text-gray-300",children:["ترخيص صالح: ",o?"✅":"❌"]}),e.jsxs("p",{className:"dark:text-gray-300",children:["مصادق عليه: ",a?"✅":"❌"]}),e.jsxs("p",{className:"dark:text-gray-300",children:["كلمة مرور مطلوبة: ",n?"✅":"❌"]}),e.jsxs("p",{className:"dark:text-gray-300",children:["أول تشغيل: ",i?"✅":"❌"]})]})]}),e.jsxs("div",{className:"bg-card dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-white",children:"واجهات API"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"dark:text-gray-300",children:["electronAPI متوفر: ",window.electronAPI?"✅":"❌"]}),e.jsxs("p",{className:"dark:text-gray-300",children:["electron متوفر: ",window.electron?"✅":"❌"]}),e.jsxs("p",{className:"dark:text-gray-300",children:["window.electronAPI.patients: ",window.electronAPI?.patients?"✅":"❌"]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>W(!1),className:"bg-primary text-primary-foreground px-4 py-2 rounded hover:bg-primary/90 dark:bg-blue-600 dark:hover:bg-blue-700",children:"إغلاق التشخيص"})})]})});if(!o||i)return e.jsx($r,{onActivate:ce,isLoading:l,machineInfo:c||void 0});if(n&&!a)return e.jsx(Rr,{onLogin:de,isLoading:S});return e.jsxs(jl,{children:[e.jsxs("div",{className:"flex w-full group/sidebar-layout h-screen min-h-screen",children:[e.jsx(Ml,{activeTab:w,onTabChange:ie}),e.jsxs(Sl,{className:"flex-1",children:[e.jsxs("header",{className:"flex flex-row-reverse items-center justify-between h-16 w-full bg-background/95 backdrop-blur border-b border-border/40 dark:bg-gray-900/95 dark:border-gray-700 px-4 gap-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground dark:text-gray-300 bg-accent/20 dark:bg-gray-700/50 px-4 py-1 rounded-full font-mono",children:e.jsx(Ol,{})}),e.jsxs("div",{className:"flex flex-row-reverse items-center gap-4",children:[e.jsx(Si,{}),e.jsx(Ci,{orientation:"vertical",className:"h-6 dark:bg-gray-600"}),e.jsxs("div",{className:"relative w-64 max-w-xs",children:[e.jsx(Ja,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground dark:text-gray-400 w-5 h-5"}),e.jsx(Sr,{placeholder:"بحث شامل... (F)",className:"pr-10 pl-4 py-2 bg-slate-50 dark:bg-gray-800 dark:border-gray-600 border border-border rounded-lg shadow-sm dark:shadow-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent cursor-pointer text-right dark:text-white",readOnly:!0,onClick:()=>H(!0),"aria-label":"البحث الشامل",role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),H(!0))}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-muted-foreground dark:text-gray-300 bg-background/70 dark:bg-gray-800/70 px-2 py-0.5 rounded","aria-hidden":"true",children:"F"})]}),e.jsx(_c,{children:e.jsxs(kc,{className:"flex flex-row-reverse items-center",children:[e.jsx(Sc,{className:"hidden md:block",children:e.jsx(Ec,{href:"#",className:"text-muted-foreground dark:text-gray-300 hover:text-foreground dark:hover:text-white transition-colors duration-200",children:"🦷 نظام إدارة العيادة السنية"})}),e.jsx(Dc,{className:"hidden md:block"}),e.jsx(Sc,{children:e.jsx(Ac,{className:"font-semibold text-sky-600 dark:text-blue-400",children:{dashboard:"لوحة التحكم",patients:"المرضى",appointments:"المواعيد",payments:"المدفوعات",inventory:"المخزون",labs:"المختبرات",medications:"الأدوية والوصفات","dental-treatments":"العلاجات السنية","clinic-needs":"احتياجات العيادة",expenses:"مصروفات العيادة",reports:"التقارير","external-estimate":"فاتورة تقديرية خارجية",settings:"الإعدادات"}[w]||"لوحة التحكم"})})]})}),e.jsx(kl,{})]})]}),e.jsx("div",{className:"flex flex-1 flex-col gap-6 p-12 pt-6 max-w-full overflow-hidden relative rtl-layout dark:bg-gray-900",children:e.jsx("div",{className:"w-full max-w-none content-wrapper",children:e.jsx(ki,{children:e.jsx(Q.Suspense,{fallback:e.jsx(_i,{message:"جاري تحميل الصفحة..."}),children:(()=>{switch(w){case"patients":return e.jsx(Fc,{onNavigateToTreatments:v,onNavigateToPayments:v});case"appointments":return e.jsx(Rc,{});case"payments":return e.jsx(Ic,{});case"inventory":return e.jsx(Cc,{});case"labs":return e.jsx($c,{});case"medications":return e.jsx(Mc,{});case"dental-treatments":return e.jsx(Oc,{});case"clinic-needs":return e.jsx(zc,{});case"expenses":return e.jsx(Vc,{});case"reports":return e.jsx(Tc,{});case"external-estimate":return e.jsx(qc,{});case"production-backup":return e.jsx(Uc,{});case"settings":return e.jsx(Pc,{});default:return e.jsx(Lc,{onNavigateToPatients:()=>v("patients"),onNavigateToAppointments:()=>v("appointments"),onNavigateToPayments:()=>v("payments"),onNavigateToTreatments:()=>v("dental-treatments"),onAddPatient:()=>j(!0),onAddAppointment:()=>J(!0),onAddPayment:()=>k(!0)})}})()})})})})]})]}),e.jsx(Ps,{open:N,onOpenChange:j}),e.jsx(Bo,{isOpen:Y,onClose:()=>J(!1),onSave:async e=>{try{await f(e),J(!1),Zt.success("New appointment created successfully"),le("تم إضافة الموعد الجديد بنجاح","success")}catch(t){Zt.error("Error creating appointment:",t),le("فشل في إضافة الموعد. يرجى المحاولة مرة أخرى","error")}},patients:p,treatments:[]}),ee&&ne&&e.jsx(Bo,{isOpen:ee,onClose:()=>{te(!1),se(null)},onSave:async e=>{try{await y(ne.id,e),te(!1),se(null),Zt.success("Appointment updated successfully"),le("تم تحديث الموعد بنجاح","success")}catch(t){Zt.error("Error updating appointment:",t),le("فشل في تحديث الموعد. يرجى المحاولة مرة أخرى","error")}},patients:p,treatments:[],initialData:ne}),ae&&ne&&e.jsx(Uo,{isOpen:ae,patient:null,appointment:ne,onClose:()=>{re(!1),se(null)},onConfirm:async()=>{if(ne)try{await b(ne.id),re(!1),se(null),Zt.success("Appointment deleted successfully"),le("تم حذف الموعد بنجاح","success")}catch(e){Zt.error("Error deleting appointment:",e),le("فشل في حذف الموعد. يرجى المحاولة مرة أخرى","error")}},isLoading:g}),e.jsx(Ni,{open:_,onOpenChange:k}),e.jsx(sd,{isOpen:A,onClose:()=>D(!1),onSuccess:()=>{F(!0),v("payments")},onForgotPassword:()=>{D(!1),P(!0)}}),e.jsx(od,{isOpen:I,onClose:()=>P(!1),onSuccess:()=>{P(!1),setTimeout(()=>{D(!0)},500)}}),e.jsx(id,{isOpen:C,onClose:()=>T(!1),onSuccess:()=>{F(!0),v("payments")}}),e.jsx(Ed,{isOpen:R,onClose:()=>$(!1),onSuccess:()=>{U(!0),v("reports")},onForgotPassword:()=>{$(!1),O(!0)}}),e.jsx(Ad,{isOpen:M,onClose:()=>O(!1),onSuccess:()=>{O(!1),setTimeout(()=>{$(!0)},500)}}),e.jsx(Dd,{isOpen:z,onClose:()=>V(!1),onSuccess:()=>{U(!0),v("reports")}}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-gray-900/50 z-50 flex items-start justify-center pt-24",children:e.jsx("div",{className:"w-full max-w-2xl mx-4",children:e.jsx(Q.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 dark:border-blue-400"})}),children:e.jsx(Hc,{onResultSelect:oe,onClose:()=>H(!1),autoFocus:!0})})})}),e.jsx(jc,{})]})}function Wc(){return e.jsx(ra,{children:e.jsx(ia,{children:e.jsx(Xc,{})})})}if("undefined"!=typeof window){const e=Object.prototype.toString;Object.prototype.toString=function(){try{return e.call(this)}catch(t){return"[Object]"}};const t=Array.prototype.toString;Array.prototype.toString=function(){try{return t.call(this)}catch(e){return"[Array]"}};const a=Date.prototype.toString;Date.prototype.toString=function(){try{return a.call(this)}catch(e){return"[Date]"}}}const Gc=e=>{if("string"==typeof e)return e;if("number"==typeof e)return isNaN(e)?"0":e.toString();if("boolean"==typeof e)return e.toString();if(e instanceof Date)try{return e.toISOString()}catch(t){return"Invalid Date"}if(null===e)return"";if(void 0===e)return"";if("object"==typeof e&&null!==e){if(void 0!==e.name)return Gc(e.name);if(void 0!==e.title)return Gc(e.title);if(void 0!==e.text)return Gc(e.text);if(void 0!==e.label)return Gc(e.label);if(void 0!==e.value)return Gc(e.value);try{if("function"==typeof e.toString&&e.toString!==Object.prototype.toString){const t=e.toString();if("string"==typeof t)return t}}catch(t){}try{const t=JSON.stringify(e);if(t&&"{}"!==t&&"[]"!==t)return t}catch(t){}return"[Object]"}if("function"==typeof e)return"[Function]";if("symbol"==typeof e)try{return e.toString()}catch(t){return"[Symbol]"}return"bigint"==typeof e?e.toString():"[Unknown]"},Kc={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug},Yc=e=>(...t)=>{try{if(t.length>0&&t[0]instanceof Error)return void e.apply(console,[t[0].message||"Unknown error","\nStack:",t[0].stack||"No stack trace","\nName:",t[0].name||"Error",...t.slice(1)]);const a=t.map(e=>"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null==e?e:Gc(e));e.apply(console,a)}catch(a){try{e.apply(console,["[Console Error]",Gc(t[0]||"")])}catch(r){e.apply(console,["[Console Error]"])}}};if(console.log("🚀 Starting React application..."),(()=>{console.log=Yc(Kc.log),console.warn=Yc(Kc.warn),console.error=Yc(Kc.error),console.info=Yc(Kc.info),console.debug=Yc(Kc.debug);const e=String,t=function(e){try{return 0===arguments.length?"":Gc(e)}catch(t){return"[String Error]"}};Object.setPrototypeOf(t,e),Object.defineProperty(t,"prototype",{value:e.prototype,writable:!1});for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);try{globalThis.String=t,window.String=t}catch(a){console.warn("Could not override String constructor:",a)}window.addEventListener("error",e=>{if(e.error&&e.error.message&&e.error.message.includes("Cannot convert object to primitive value"))return e.preventDefault(),console.warn('Prevented "Cannot convert object to primitive value" error'),!0}),window.addEventListener("unhandledrejection",e=>{if(e.reason&&"object"==typeof e.reason&&e.reason.message&&e.reason.message.includes("Cannot convert object to primitive value"))return e.preventDefault(),console.warn('Prevented unhandled "Cannot convert object to primitive value" promise rejection'),!0}),console.log("🛡️ Global error handler initialized")})(),"undefined"!=typeof window){const e=Object.prototype.toString;Object.prototype.toString=function(){try{return e.call(this)}catch(t){return"[Object]"}};const t=Array.prototype.toString;Array.prototype.toString=function(){try{return t.call(this)}catch(e){return"[Array]"}}}const Qc=document.getElementById("root");if(!Qc)throw console.error("❌ Root element not found!"),document.body.innerHTML='\n    <div style="\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      font-family: Arial, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n      text-align: center;\n    ">\n      <div>\n        <h1>خطأ في التحميل</h1>\n        <p>لم يتم العثور على عنصر الجذر في الصفحة</p>\n        <p>يرجى إعادة تشغيل التطبيق</p>\n      </div>\n    </div>\n  ',new Error("Root element not found");console.log("✅ Root element found, creating React root...");try{const t=ae.createRoot(Qc);console.log("✅ React root created successfully"),t.render(e.jsx(J.StrictMode,{children:e.jsx(Wc,{})})),console.log("✅ React app rendered successfully")}catch(Jc){console.error("❌ Failed to render React app:",Jc),Qc.innerHTML=`\n    <div style="\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      font-family: Arial, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n      text-align: center;\n    ">\n      <div>\n        <h1>خطأ في تحميل التطبيق</h1>\n        <p>حدث خطأ أثناء تحميل التطبيق</p>\n        <p>يرجى إعادة تشغيل التطبيق أو الاتصال بالدعم الفني</p>\n        <details style="margin-top: 20px; text-align: left;">\n          <summary>تفاصيل الخطأ</summary>\n          <pre style="background: #fff; padding: 10px; border-radius: 4px; margin-top: 10px;">\n${Jc.message}\n${Jc.stack}\n          </pre>\n        </details>\n      </div>\n    </div>\n  `}export{Fa as $,Sa as A,Jo as B,Xo as C,br as D,lo as E,Ea as F,uo as G,mo as H,Sr as I,Ra as J,Ct as K,Ir as L,Da as M,co as N,go as O,po as P,ta as Q,Ya as R,ms as S,us as T,sr as U,lr as V,dr as W,cr as X,ur as Y,za as Z,ka as _,da as a,Wa as a$,Ia as a0,Ta as a1,Gl as a2,Xa as a3,La as a4,Ca as a5,Oa as a6,Wl as a7,Cr as a8,Tr as a9,kn as aA,bn as aB,_n as aC,yn as aD,cs as aE,Ha as aF,ga as aG,Gc as aH,xi as aI,Ot as aJ,yi as aK,bi as aL,fd as aM,hd as aN,kd as aO,bd as aP,yd as aQ,Sd as aR,rr as aS,Bt as aT,Wt as aU,Xt as aV,Gt as aW,Ei as aX,tr as aY,Ci as aZ,fa as a_,rd as aa,Yl as ab,Kl as ac,nd as ad,ha as ae,ya as af,Ja as ag,or as ah,Ni as ai,_a as aj,ie as ak,Za as al,Ua as am,qa as an,Lr as ao,ba as ap,Ba as aq,na as ar,Nt as as,Qa as at,$a as au,Ka as av,ar as aw,jt as ax,Qr as ay,Zr as az,me as b,Kt as b0,Ps as b1,Mt as b2,qt as b3,Bo as b4,vt as b5,li as b6,ci as b7,Ga as b8,yl as b9,zt as bA,Qt as bB,Ho as bC,ji as bD,bl as ba,xl as bb,wl as bc,ni as bd,ti as be,ei as bf,ai as bg,oi as bh,si as bi,ri as bj,ii as bk,ps as bl,xs as bm,ws as bn,ui as bo,Pa as bp,It as bq,kt as br,Dt as bs,Tt as bt,vi as bu,wi as bv,di as bw,Ds as bx,Vt as by,Aa as bz,Jt as c,Zo as d,la as e,vr as f,Nr as g,_r as h,kr as i,Wo as j,Go as k,Yo as l,hs as m,gs as n,bs as o,vs as p,fi as q,$t as r,Ma as s,er as t,Is as u,Ko as v,fr as w,jr as x,no as y,io as z};
