# ميزة إدارة جلسات WhatsApp - اقتراح التصميم

## المطلوب
1. عرض الجلسات النشطة في WhatsApp
2. إصدار تنبيهات عند حذف الجلسة وعند وصل الجلسة
3. الحفاظ على البساطة وعدم التعقيد

## التحليل والتصميم المقترح

### 🎯 الهدف
إنشاء نظام بسيط وفعال لمراقبة حالة جلسات WhatsApp مع تنبيهات واضحة للمستخدم.

### 📋 المتطلبات المفصلة

#### 1. عرض الجلسات النشطة
**المعلومات المطلوبة:**
- حالة الاتصال (متصل/غير متصل/قيد التحميل)
- وقت آخر نشاط
- معلومات أساسية عن الجلسة

**الموقع:**
- قسم منفصل في تبويبة "تذكيرات واتساب"
- عرض واضح ومباشر
- تحديث تلقائي للحالة

#### 2. التنبيهات
**أنواع التنبيهات:**
- ✅ **تنبيه عند وصل الجلسة**: "تم ربط حساب واتساب بنجاح!"
- ❌ **تنبيه عند حذف الجلسة**: "تم حذف جلسة واتساب بنجاح"
- ⚠️ **تنبيه عند انقطاع الاتصال**: "انقطع اتصال واتساب"
- 🔄 **تنبيه عند إعادة الاتصال**: "تم استعادة اتصال واتساب"

**طرق العرض:**
- تنبيهات مؤقتة في أعلى الشاشة
- أيقونات ملونة للحالات المختلفة
- رسائل واضحة باللغة العربية

### 🎨 التصميم المقترح

#### قسم حالة الجلسة
```jsx
// قسم بسيط يعرض حالة الجلسة الحالية
<div className="bg-card rounded-lg shadow border border-border p-4">
  <h4 className="text-sm font-medium text-foreground mb-3">حالة الجلسة</h4>

  <div className="flex items-center justify-between">
    <div className="flex items-center space-x-3 space-x-reverse">
      {/* أيقونة الحالة */}
      <div className={`w-3 h-3 rounded-full ${
        isConnected ? 'bg-green-500' :
        isConnecting ? 'bg-yellow-500 animate-pulse' :
        'bg-red-500'
      }`}></div>

      {/* نص الحالة */}
      <span className="text-sm text-foreground">
        {isConnected ? 'متصل' :
         isConnecting ? 'جاري الربط...' :
         'غير متصل'}
      </span>
    </div>

    {/* وقت آخر نشاط */}
    <span className="text-xs text-muted-foreground">
      آخر نشاط: {lastActivity}
    </span>
  </div>
</div>
```

#### نظام التنبيهات
```jsx
// نظام تنبيهات بسيط وفعال
function showSessionNotification(type, message) {
  const notifications = {
    connected: { icon: '✅', color: 'green' },
    disconnected: { icon: '❌', color: 'red' },
    deleted: { icon: '🗑️', color: 'orange' },
    restored: { icon: '🔄', color: 'blue' }
  }

  // عرض التنبيه لمدة 5 ثوان
  showNotification(message, notifications[type].color)
}
```

### 📊 تدفق العمل

#### 1. تدفق الاتصال الأولي
```
مسح QR → وصل الجلسة → تنبيه نجاح الاتصال → عرض الحالة الخضراء
```

#### 2. تدفق حذف الجلسة
```
زر حذف → نافذة التأكيد → حذف الجلسة → تنبيه نجاح الحذف → عرض الحالة الحمراء
```

#### 3. تدفق انقطاع الاتصال
```
انقطاع الشبكة → كشف الانقطاع → تنبيه الانقطاع → محاولة إعادة الاتصال → تنبيه الاستعادة
```

### 🔧 التنفيذ الفني

#### الملفات المطلوبة للتعديل:
1. `src/pages/Settings.tsx` - إضافة قسم حالة الجلسة
2. `electron/services/whatsapp.js` - تحسين معالجة الأحداث
3. `src/services/notificationService.tsx` - نظام التنبيهات

#### التعديلات المطلوبة:

**في Settings.tsx:**
- إضافة قسم `SessionStatusCard` في تبويبة WhatsApp
- ربط مع `getWhatsAppStatus()` 
- تحديث تلقائي للحالة

**في whatsapp.js:**
- تحسين event listeners للأحداث المختلفة
- إضافة إرسال تنبيهات عند تغيير الحالة
- تحسين `getWhatsAppStatus()` لإرجاع معلومات أكثر

### 📈 الفوائد المتوقعة

✅ **وضوح أكبر** في حالة الاتصال  
✅ **تنبيهات فورية** للتغييرات المهمة  
✅ **سهولة الاستخدام** بدون تعقيد  
✅ **تحسين تجربة المستخدم**  
✅ **تقليل الأخطاء** من خلال التنبيهات الواضحة  

### 🎯 النطاق والأولويات

#### المرحلة الأولى (أساسية):
- [ ] قسم عرض حالة الجلسة البسيط
- [ ] تنبيهات أساسية للوصل والحذف
- [ ] تحديث تلقائي للحالة

#### المرحلة الثانية (متقدمة - إذا لزم الأمر):
- [ ] تنبيهات إضافية للانقطاع والاستعادة
- [ ] تاريخ الجلسات السابقة
- [ ] إحصائيات الاتصال

### 💡 الاعتبارات

1. **البساطة**: الحفاظ على واجهة بسيطة وغير معقدة
2. **الأداء**: عدم التأثير على أداء التطبيق
3. **التوافق**: العمل مع الإصدارات المختلفة من WhatsApp
4. **الأمان**: عدم عرض معلومات حساسة
5. **اللغة**: جميع النصوص باللغة العربية

### 🚀 التوصية

أوصي بتنفيذ **المرحلة الأولى** فقط في البداية لأنها تغطي المتطلبات الأساسية:
- عرض حالة الجلسة بوضوح
- تنبيهات بسيطة للوصل والحذف
- تحديث تلقائي بسيط

هذا سيحقق الهدف المطلوب بدون تعقيد زائد ويمكن توسيعه لاحقاً حسب الحاجة.

هل توافق على هذا التصميم أم تريد تعديلات معينة؟